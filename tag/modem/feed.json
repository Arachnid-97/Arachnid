{
    "version": "https://jsonfeed.org/version/1",
    "title": "命运转轮 • All posts by \"modem\" tag",
    "description": "不曾亏欠, 不曾辜负, 如此足矣",
    "home_page_url": "https://arachnid.cc",
    "items": [
        {
            "id": "https://arachnid.cc/x-ymodem-protocol/",
            "url": "https://arachnid.cc/x-ymodem-protocol/",
            "title": "X/YModem 传输协议",
            "date_published": "2022-03-27T15:41:27.000Z",
            "content_html": "<h1 id=\"文件传输\"><a class=\"anchor\" href=\"#文件传输\">#</a> 文件传输</h1>\n<p>最常用的几种文件传输协议有：XModem、YModem、ZModem 等。</p>\n<ul>\n<li>\n<p>XModem 是最早的文件传输协议之一，由于出现较早，几乎大部分的通讯程序所支持的文件传输都使用该协议，通常是传输 128 字节的信息块；这种古老的传输协议速度虽然较慢，但由于使用了 CRC 错误校验方法，传输的准确率可高达 99.6%。</p>\n</li>\n<li>\n<p>YModem 协议是 XModem 的改进版，它最早用于调制解调器之间的文件传输，具有快速，稳定传输的优点。它的传输速度比 XModem 快，这是由于它可以一次传输 1024 字节的信息块，同时它还支持传输多个文件，也就是常说的批文件传输。</p>\n</li>\n<li>\n<p>ZModem 协议的处理速度快于 XModem 和 YModem，这是因为它采用了串流式（streaming）传输方式，而且还具有自动改变区段大小和断点续传、快速错误侦测等功能，可以很好地进行断开后恢复传输。这是目前最流行的文件传输协议。</p>\n</li>\n<li>\n<p>除开上面介绍的三种 X / Y / ZModem 协议，还有个常见的传输协议 --- ASCII 协议，这是最快的传输协议，但只能传送文本文件。</p>\n</li>\n</ul>\n<p>X / Ymodem 协议：<br />\n<a href=\"http://pauillac.inria.fr/~doligez/zmodem/ymodem.txt\">http://pauillac.inria.fr/~doligez/zmodem/ymodem.txt</a></p>\n<p>Zmodem 协议：<br />\n<a href=\"http://gallium.inria.fr/~doligez/zmodem/zmodem.txt\">http://gallium.inria.fr/~doligez/zmodem/zmodem.txt</a></p>\n<h1 id=\"控制字符定义\"><a class=\"anchor\" href=\"#控制字符定义\">#</a> 控制字符定义</h1>\n<pre><code>&lt;SOH&gt; 01H       // 传输 128Byte 启动标志\n&lt;STX&gt; 02H \t\t// 传输 1024Byte 启动标志\n&lt;EOT&gt; 04H       // 传输结束\n&lt;ACK&gt; 06H       // 应答\n&lt;NAK&gt; 15H       // 没应答\n&lt;CAN&gt; 18H       // 取消传输\n&lt;C&gt; 43H         // ASCII 'C' CRC校验请求\n\n&lt;NUL&gt; 00H       // 空符填充\n&lt;CPMEOF&gt; 1AH    // 数据填充 (^Z)\n</code></pre>\n<h1 id=\"xmodem通讯\"><a class=\"anchor\" href=\"#xmodem通讯\">#</a> XModem 通讯</h1>\n<p>Xmodem 是使用最广泛的文件传输协议之一。原始的 Xmodem 协议使用 128 字节数据包和一个简单的 “校验和 &quot; 错误检测方法。后面增强为 Xmodem-CRC，使用了更安全的循环冗余校验 (CRC) 用于错误检测方法。Xmodem 协议总是首先尝试使用 CRC。如果发件人不确认对 CRC 的请求，接收器将转移到 ” 校验和 “ 模式并继续其传输请求。</p>\n<p>增强型 Xmodem-1K 本质上是 Xmodem CRC 模式传输 1K (1024 字节) 数据包。在某些系统和通报上它也可以称为 Ymodem。</p>\n<p>Xmodem 协议传输由接收程序和发送程序完成，先由接收程序发送协商字符，协商校验方式，协商通过之后发送程序就开始发送数据包，接收程序接收到完整的一个数据包之后按照协商的方式对数据包进行校验。校验通过之后发送确认字符，然后发送程序继续发送下一包；如果校验失败，则发送否认字符，发送程序重传此数据包。<strong>信息报中如果剩余的数据不足 128 字节，不足的部分将以  <code>0x1A</code>  填充。</strong></p>\n<h2 id=\"校验和模式\"><a class=\"anchor\" href=\"#校验和模式\">#</a> 校验和模式</h2>\n<h3 id=\"帧包格式\"><a class=\"anchor\" href=\"#帧包格式\">#</a> 帧包格式</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Byte1</th>\n<th style=\"text-align:center\">Byte2</th>\n<th style=\"text-align:center\">Byte3</th>\n<th style=\"text-align:center\">Byte4~131</th>\n<th style=\"text-align:center\">Byte132</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Start Of Header(SOH)</td>\n<td style=\"text-align:center\">Packet NumberID</td>\n<td style=\"text-align:center\">~(Packet NumberID)</td>\n<td style=\"text-align:center\">Packet Data[128]</td>\n<td style=\"text-align:center\">CheckSUM</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"传输方式\"><a class=\"anchor\" href=\"#传输方式\">#</a> 传输方式</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Sender</th>\n<th style=\"text-align:center\">Flow</th>\n<th style=\"text-align:center\">Receiver</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">NAK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">Time out after 3 Second</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">NAK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x01&gt; &lt;0xFE&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x02&gt; &lt;0xFD&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\"><strong>Line hit during transmission</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\"><strong>NAK</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x02&gt; &lt;0xFD&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x03&gt; &lt;0xFC&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>ACK get garbaged</strong></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x03&gt; &lt;0xFC&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\"><strong>Duplicate packet</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\"><strong>NAK</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x04&gt; &lt;0xFB&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\"><strong>UART Framing err on any byte</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\"><strong>NAK</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x04&gt; &lt;0xFB&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x05&gt; &lt;0xFA&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\"><strong>UART Overrun err on any byte</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\"><strong>NAK</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x05&gt; &lt;0xFA&gt; &lt;Data[0-127]&gt; &lt;Chksum&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">EOT</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>ACK get garbaged</strong></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">EOT</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Finished</td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"crc模式\"><a class=\"anchor\" href=\"#crc模式\">#</a> CRC 模式</h2>\n<p>计算 16 位 CRC 校验的除数多项式为： <code>X ^ 16 + X ^ 12 + X ^ 5 + 1</code> ，信息报中的 128 数据字节将参加 CRC 校验的计算，在发送端 CRC-16 的高字节在前，低字节在后。</p>\n<h3 id=\"帧包格式-2\"><a class=\"anchor\" href=\"#帧包格式-2\">#</a> 帧包格式</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Byte1</th>\n<th style=\"text-align:center\">Byte2</th>\n<th style=\"text-align:center\">Byte3</th>\n<th style=\"text-align:center\">Byte4~131</th>\n<th style=\"text-align:center\">Byte132~133</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Start Of Header(SOH)</td>\n<td style=\"text-align:center\">Packet NumberID</td>\n<td style=\"text-align:center\">~(Packet NumberID)</td>\n<td style=\"text-align:center\">Packet Data[128]</td>\n<td style=\"text-align:center\">16-Bit CRC</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"传输方式-2\"><a class=\"anchor\" href=\"#传输方式-2\">#</a> 传输方式</h3>\n<p>传输流程：接收方要求发送方以 CRC 校验方式发送时以 ‘C’ 来请求，发送方将对此作出应答。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Sender</th>\n<th style=\"text-align:center\">Flow</th>\n<th style=\"text-align:center\">Receiver</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">'C'</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">Time out after 3 Second</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">'C'</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x01&gt; &lt;0xFE&gt; &lt;Data[0-127]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x02&gt; &lt;0xFD&gt; &lt;Data[0-127]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\"><strong>Line hit during transmission</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\"><strong>NAK</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x02&gt; &lt;0xFD&gt; &lt;Data[0-127]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x03&gt; &lt;0xFC&gt; &lt;Data[0-127]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">EOT</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ACK get garbaged</td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">EOT</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Finished</td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"扩展\"><a class=\"anchor\" href=\"#扩展\">#</a> 扩展</h2>\n<p>关于校验和和 CRC 校验可以看以前的文章《<a href=\"https://arachnid.cc/check-algorithm/\">常用校验算法</a>》</p>\n<p><a href=\"https://web.mit.edu/6.115/www/amulet/xmodem.htm\">XModem Protocol with CRC</a></p>\n<h1 id=\"ymodem通讯\"><a class=\"anchor\" href=\"#ymodem通讯\">#</a> YModem 通讯</h1>\n<p>Ymodem 本质上是允许多个批处理文件传输的 Xmodem-1K，也可表示为 YModem-1K。</p>\n<p>Ymodem 在 Xmodem-1K 基础上发展，沿用了  <code>TeLink</code>  协议的添加空头块的做法，也就是增加  <code>block 0</code> 。该 block 标识即将发送文件的  <code>文件名</code> ， <code>文件大小</code>  和   <code>文件创建时间戳(一般不填写)</code></p>\n<p>Ymodem-g 是 Ymodem 的变体。它设计用于支持错误控制的调制解调器。该协议不提供软件纠错或恢复，但期望调制解调器提供服务。它是一种流式传输协议，以连续流的形式发送和接收 1K 个数据包，直到指示停止。YModem-g 传输形式与 YModem-1K 差不多，同时在发送完一个数据块后，它不会等待应答确认，而是快速连续地发送下一个数据块；如果有任何块不成功转移，整个转移被取消。</p>\n<h2 id=\"起始帧block-0\"><a class=\"anchor\" href=\"#起始帧block-0\">#</a> 起始帧（block 0）</h2>\n<p>YModem 的起始帧并不直接传输文件的数据，而是将文件名与文件的大小放在数据帧中传输，它的帧长 = 3 字节数据首部 + 128 字节数据 + 2 字节 CRC16 校验码 = 33 字节。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Byte1</th>\n<th style=\"text-align:center\">Byte2</th>\n<th style=\"text-align:center\">Byte3</th>\n<th style=\"text-align:center\">Byte4~131</th>\n<th style=\"text-align:center\">Byte132~133</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Start Of Header(SOH)</td>\n<td style=\"text-align:center\">0x00</td>\n<td style=\"text-align:center\">0xFF</td>\n<td style=\"text-align:center\">[ &lt; <code>filename</code> &gt; &lt; <code>filezise</code> &gt; &lt;NUL&gt; ]</td>\n<td style=\"text-align:center\">16-Bit CRC</td>\n</tr>\n</tbody>\n</table>\n<p>说明：</p>\n<ul>\n<li>Byte 1~3：头标志是 SOH，起始帧序固定为 0x00，帧序取反为 0xFF。</li>\n<li>Byte 4~131：\n<ul>\n<li><code>filename</code>  是传输的文件名字，如文件名  <code>foo.c</code> ，它在起始帧中的格式为： <code>66 6F 6F 2E 63 00</code> ，也就是把 ASCII 码转成十六进制，最后的 0x00 代表文件名结束。</li>\n<li><code>filesize</code>  是要传输的文件的大小，比如文件大小为 120 KByte，转换为  <code>120 * 1024 = 122880</code>  Byte，转化为十六进制为  <code>0x1E00</code> ，它在起始帧中的格式为： <code>31 45 30 30 00</code> ，对应 ASCII 为  <code>1E00</code> ，最后的 0x00 代表文件长度结束。</li>\n<li>最后  <code>NUL</code>  代表剩余不足 128 Byte 部分用 0x00 填充。</li>\n</ul>\n</li>\n<li>Byte 132~133：CRCH、CRCL 分别表示 16 位 CRC 校验码的高 8 位与低 8 位，高字节在前，低字节在后。</li>\n</ul>\n<h2 id=\"数据帧block-n\"><a class=\"anchor\" href=\"#数据帧block-n\">#</a> 数据帧（block n）</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Byte1</th>\n<th style=\"text-align:center\">Byte2</th>\n<th style=\"text-align:center\">Byte3</th>\n<th style=\"text-align:center\">Byte4~1027</th>\n<th style=\"text-align:center\">Byte1028~1029</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Start Of Header(STX)</td>\n<td style=\"text-align:center\">Packet NumberID</td>\n<td style=\"text-align:center\">~(Packet NumberID)</td>\n<td style=\"text-align:center\">Packet Data[1024]</td>\n<td style=\"text-align:center\">16-Bit CRC</td>\n</tr>\n</tbody>\n</table>\n<p>注意：有一种特殊的情况是，如果文件总大小小于等于 128 字节或者文件数据最后剩余的数据小于 128 字节，则 YModem 会选择 SOH 数据帧格式用 128 字节来传输数据，而数据不满 128 字节，剩余的数据用  <code>0x1A</code>  填充。</p>\n<p>这时数据帧的结构就变成了：</p>\n<p>文件大小小于 128 字节： <code>&lt;SOH&gt; &lt;01&gt; &lt;FE&gt; &lt;data1&gt; &lt;data2&gt; ... &lt;datan&gt;  &lt;CPMEOF&gt; ... &lt;CRCH&gt; &lt;CRCL&gt;</code></p>\n<p>文件最后剩余数据小于 128 字节： <code>&lt;SOH&gt; &lt;ID&gt; &lt;~ID&gt; &lt;data1&gt; &lt;data2&gt; ... &lt;datan&gt; &lt;CPMEOF&gt; ... &lt;CRCH&gt; &lt;CRCL&gt;</code></p>\n<h2 id=\"结束帧block-n1\"><a class=\"anchor\" href=\"#结束帧block-n1\">#</a> 结束帧（block n+1）</h2>\n<p>YModem 的结束帧数据也采用 SOH 的 128 字节数据帧</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Byte1</th>\n<th style=\"text-align:center\">Byte2</th>\n<th style=\"text-align:center\">Byte3</th>\n<th style=\"text-align:center\">Byte4~131</th>\n<th style=\"text-align:center\">Byte132~133</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Start Of Header(SOH)</td>\n<td style=\"text-align:center\">0x00</td>\n<td style=\"text-align:center\">0xFF</td>\n<td style=\"text-align:center\">&lt;NUL&gt;</td>\n<td style=\"text-align:center\">16-Bit CRC</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"传输流程\"><a class=\"anchor\" href=\"#传输流程\">#</a> 传输流程</h2>\n<p>以把 foo.c，大小为 4196Byte（16 进制为 0x1064）的文件作为传输的对象：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Sender</th>\n<th style=\"text-align:center\">Flow</th>\n<th style=\"text-align:center\">Receiver</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">'C'</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">Time out after 3 Second</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">'C'</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x00&gt; &lt;0xFF&gt; &lt;Data[  <code>&lt;foo.c&gt;</code>  |  <code>&lt;0x1064&gt;</code>  | &lt;NUL&gt; ]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">'C'</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;STX&gt; &lt;0x01&gt; &lt;0xFE&gt; &lt;Data[0-1023]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;STX&gt; &lt;0x02&gt; &lt;0xFD&gt; &lt;Data[0-1023]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;STX&gt; &lt;0x03&gt; &lt;0xFC&gt; &lt;Data[0-1023]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;STX&gt; &lt;0x04&gt; &lt;0xFB&gt; &lt;Data[0-1023]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x05&gt; &lt;0xFA&gt; &lt;Data[0-99]&gt; &lt;CPMEOF[0-27]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">EOT</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\"><strong>NAK</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">EOT</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">'C'</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;SOH&gt; &lt;0x00&gt; &lt;0xFF&gt; &lt;NUL[0-127]&gt; &lt;CRC16&gt;</td>\n<td style=\"text-align:center\">---&gt;</td>\n<td style=\"text-align:center\">Packet OK</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Finished</td>\n<td style=\"text-align:center\">&lt;---</td>\n<td style=\"text-align:center\">ACK</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><a href=\"https://en.wikipedia.org/wiki/XMODEM\">https://en.wikipedia.org/wiki/XMODEM</a></p>\n<p><a href=\"https://en.wikipedia.org/wiki/YMODEM\">https://en.wikipedia.org/wiki/YMODEM</a></p>\n<p><a href=\"https://en.wikipedia.org/wiki/ZMODEM\">https://en.wikipedia.org/wiki/ZMODEM</a></p>\n<p><a href=\"http://web.cecs.pdx.edu/~rootd/catdoc/guide/TheGuide_toc.html#SEC237\">XMODEM, YMODEM, and ZMODEM</a></p>\n<p><a href=\"https://slideplayer.pl/slide/434572/\">Transmisja modemowa - Xmodem, Ymodem, Zmodem</a></p>\n<p><a href=\"https://www.ohse.de/uwe/software/lrzsz.html\">lrzsz: free x/y/zmodem implementation</a></p>\n<h1 id=\"附录\"><a class=\"anchor\" href=\"#附录\">#</a> 附录</h1>\n<p>CRC 校验计算：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">calcrc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>ptr<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> count<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span>  crc<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">char</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    crc <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>count <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        crc <span class=\"token operator\">=</span> crc <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>ptr<span class=\"token operator\">++</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        i <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>crc <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x8000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                crc <span class=\"token operator\">=</span> crc <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">^</span> <span class=\"token number\">0x1021</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                crc <span class=\"token operator\">=</span> crc <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>crc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "history",
                "Modem"
            ]
        }
    ]
}