{
    "version": "https://jsonfeed.org/version/1",
    "title": "命运转轮 • All posts by \"c\" tag",
    "description": "不曾亏欠, 不曾辜负, 如此足矣",
    "home_page_url": "https://arachnid.cc",
    "items": [
        {
            "id": "https://arachnid.cc/C-structure-alignment/",
            "url": "https://arachnid.cc/C-structure-alignment/",
            "title": "C 语言结构体大小及对齐问题",
            "date_published": "2020-02-08T06:51:13.000Z",
            "content_html": "<h1 id=\"内存大小问题\"><a class=\"anchor\" href=\"#内存大小问题\">#</a> 内存大小问题</h1>\n<p>有时候，我们在不同的编译环境，或者不同的机子上测试编译，会呈现不同的结果，于是我们会陷入疑问，内存的大小是谁分配的呢？</p>\n<p>在系统中，系统对内存的识别是以 Byte（字节）为单位，每个字节由 8 位二进制数组成，即 8bit（比特，也称 “位” ）。按照计算机的二进制方式，1Byte = 8bit；1KB = 1024Byte；1MB = 1024KB；1GB = 1024MB；1TB = 1024GB。</p>\n<p>我们都知道 Byte（字节）的大小是固定的，但是，我们目前接触的都是以 Word（字长）、HalfWord（半字），而他的解释是：在电脑领域，对于某种特定的计算机设计而言，<strong>字</strong>（英语：word）是用于表示其自然的数据单位的术语。在这个特定电脑中，字是其用来一次性处理事务的一个固定长度的位（bit）组。一个字的位数（即<strong>字长</strong>）是电脑系统结构中的一个重要特性。</p>\n<p>来源：<a href=\"https://zh.wikipedia.org/wiki/%E5%AD%97_(%E8%AE%A1%E7%AE%97%E6%9C%BA)\">字 (计算机) - 维基百科</a></p>\n<h1 id=\"分配问题\"><a class=\"anchor\" href=\"#分配问题\">#</a> 分配问题</h1>\n<p>我们之所以有可能出现编译的数据内存大小不一样，是因为在不同的处理器和编译器中它所呈现的结果是不一样的，直白的说就是所对应的 Word（字长）不一样，其实字长并非一个十分严格的概念，要从汇编语言的角度理解，就是指令集里面的运算和内存操作时操作数的长度，具体还是看一下关于计算机底层的东西。</p>\n<p>在 32 位处理器中 32 位指的就是 CPU GPRs（General-Purpose Registers，通用寄存器）的数据宽度，当然 64 位 CPU 的数据宽度为 64 位，所以 32 位 CPU 的数据宽度指的是 32 位了。</p>\n<p>64 位指令集就是运行 64 位数据的指令，也就是说处理器一次可以运行 64Bit 数据。这样一来 32 位处理器一次最多只能处理 32 位，也就是 4 个字节的数据，而 64 位处理器一次就能处理 64 位，即 8 个字节的数据。</p>\n<p>按照上面总的来说：各种类型的存储大小与系统位数有关。</p>\n<p>而至于为什么又跟编译器有关呢？</p>\n<p>假设我们在 64 位处理器上运行 32 位的编译器来写代码的，这样编译器就只会默认我们的程序是在 32 位系统下运行，因为这编译器最多只能处理 32 位，多了它处理不来啊 [哭笑]</p>\n<p>所以，一般严格来说，在进行编译测试后，想要告诉别人结果，也应该把你当时所测试的操作系统以及编译系统告诉别人，同样的例子也有：就像我们在下载一个程序的时候，你可能会看到程序文件名后面带有 x32 或者 x64 等一些标志性文本，这就是要告诉别人它支持的操作环境。</p>\n<p><img src=\"20200208120209731.png\" alt=\"img\" /></p>\n<h1 id=\"结构体分配的空间\"><a class=\"anchor\" href=\"#结构体分配的空间\">#</a> 结构体分配的空间</h1>\n<p>在进行讨论之前先来看一下程序</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 操作系统：基于 x64 的处理器</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * 编译环境：Dev-C++ V5.11 </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span> </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SIZE</span>\t\t<span class=\"token expression\"><span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">s</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">char</span> a<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">short</span> b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">int</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">double</span> d<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">char</span> f<span class=\"token punctuation\">[</span>SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//    double i;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">s</span> temp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"char:%d,short:%d,int:%d,double:%d\\n\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">short</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sizeof = %d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sizeof = %d\\n\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"temp addr = %p\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"b    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"c    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"e    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>e<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nf    addr = %p\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"f    sizeof = %d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">//\tprintf(\"\\ni addr = %p,%d\\n\",&amp;temp.i,sizeof(temp.i));</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\" /></p>\n<p>我们定义了一个  <code>struct s</code>  的结构体，里面有不同数据类型的结构体成员  <code>.a /.b /.c /.e /.f</code> （成员  <code>i</code>  我们先屏蔽先，这个是关于后面对齐问题测试的）；成员  <code>f</code>  为数组，特殊点我们把地址跟大小分开打印；指针我们不知道他的大小，也打印出来；最后我们打印一下输出看下结果：</p>\n<p><img src=\"20200208121340412.png\" alt=\"img\" /></p>\n<p>先看第一行，我们打印出了  <code>char /short /int /double</code>  所对应的数据类型大小；</p>\n<p>第二行我们是打印了指针的数据大小，大小为 8Byte（因为指针在实质上是一个内存地址，内存地址的长度跟 CPU 的寻址有关；在 32 位系统上， CPU 用 32 位表示一个内存地址，这样的系统上一个指针占据 4 个字节（32 / 8 = 4）；在 64 位系统上， CPU 用 64 位表示一个内存地址，这样的系统上一个指针占据 8 个字节（64 / 8 = 8））</p>\n<p>第三行是打印出结构体总的大小为 32</p>\n<p>再到后面的，当前的结构体地址对应着第一个结构体成员地址，这个没问题；后面每个结构体成员所对应的数据类型大小也没问题；但是，当我们一加起来 1 + 2 + 4 + 8 + 8 + 1 = 24 ？？？跟打印出来的总大小不一样啊，这就关系到数据对齐了。</p>\n<h1 id=\"内存大小对齐原则\"><a class=\"anchor\" href=\"#内存大小对齐原则\">#</a> 内存大小对齐原则</h1>\n<ol>\n<li>结构体变量的首地址能够被其最宽基本类型成员的大小所整除。</li>\n<li>结构体每个成员相对于结构体首地址的偏移量（offset）都是成员大小的整数倍，如有需要编译器会在成员之间加上填充字节（internal adding）。即结构体成员的末地址减去结构体首地址（第一个结构体成员的首地址）得到的偏移量都要是对应成员大小的整数倍。</li>\n<li>结构体的总大小为结构体最宽基本类型成员大小的整数倍，如有需要编译器会在成员末尾加上填充字节。</li>\n</ol>\n<p>看了以上的原则后，我们来继续分析一下上面的数据类型大小问题</p>\n<p>实际上：结构体 s = a (1byte) + 空闲 (1byte) + b (2byte) + c (4byte) + d (8byte) + e (8byte) + f * SIZE (1byte *1) + 空闲 (7byte) = 32 (byte)。</p>\n<p>解释一下：上面输出的结构体变量的首地址为 0x0407A20，对于第一个成员  <code>a</code>  的地址就是结构体的首地址，占用 1 个字节（符合第一个的原则）；因为成员  <code>a</code>  只用了 1 个字节，而成员  <code>b</code>  地址要 2 的倍数，中间隔着一个字节，那么就需要把这个一个字节填充进去，为后面的成员  <code>b</code>  的地址制造出 2 的倍数的地址数）；成员  <code>b</code>  自己的大小为 2byte，他所对的地址必须是 2 的倍数，那么在填充完那一个字节后，他的地址排下去就是 0x0407A22，对应上了 2 的倍数（即上面的第二点原则）；成员  <code>c</code>  大小为 4，同样的他所对的地址就得要 4 的倍数，算一下前面一共占用的地址数：a (1byte) + 空闲 (1byte) + b (2byte) = 4 (byte)，当前的地址就已经是 4 的倍数了，所以不需要填充；后面两个成员也一样；然后再到最后一个成员  <code>f</code>  的分析，因为这是最后一个成员了，这样就已经知道在整个结构体  <code>s</code>  中他的最宽基本类型成员大小是多小了，没错，是 8byte（double 类型或者指针的内存地址大小）；那么按照第三点的原则，我们先能加起来的先加起来，先不考虑最后一项成员需要填充多少个字节： a (1byte) + 空闲 (1byte) + b (2byte) + c (4byte) + d (8byte) + e (8byte) + f (1byte) = 25 (byte)；25byte 明显不是最宽基本类型成员大小 8byte 的倍数了，那么距离 25 最近的 8 的倍数有两个 24 和 32，若是选 24，内存明显不够放，所以只能取大进行填充 7byte，以便总大小成为 32byte。</p>\n<p>因此简单总结一下（在 x64 位机，64 位编译器中）：</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>对齐方式（变量存放的起始地址相对于结构的起始地址的偏移量）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Char</td>\n<td>偏移量必须为 sizeof (char) 即 1 的倍数</td>\n</tr>\n<tr>\n<td>Short</td>\n<td>偏移量必须为 sizeof (short) 即 2 的倍数</td>\n</tr>\n<tr>\n<td>int</td>\n<td>偏移量必须为 sizeof (int) 即 4 的倍数</td>\n</tr>\n<tr>\n<td>float</td>\n<td>偏移量必须为 sizeof (float) 即 4 的倍数</td>\n</tr>\n<tr>\n<td>double</td>\n<td>偏移量必须为 sizeof (double) 即 8 的倍数</td>\n</tr>\n</tbody>\n</table>\n<p>各成员变量在存放的时候根据在结构中出现的顺序依次申请空间，同时按照上面的对齐方式调整位置，空缺的字节会自动填充。同时为了确保结构的大小为结构的字节边界数（即该结构中占用最大空间的类型所占用的字节数）的倍数，所以在为最后一个成员变量申请空间后，还会根据需要自动填充空缺的字节。</p>\n<h1 id=\"其他\"><a class=\"anchor\" href=\"#其他\">#</a> 其他</h1>\n<p>案例一（结构体中的成员数组不指定大小，只限于成员数组在结构体尾部）：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 操作系统：基于 x64 的处理器</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * 编译环境：Dev-C++ V5.11 </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span> </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SIZE</span>\t\t<span class=\"token expression\"><span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">s</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">char</span> a<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">short</span> b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">int</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">double</span> d<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">char</span> f<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//    double i;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">s</span> temp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"char:%d,short:%d,int:%d,double:%d\\n\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">short</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sizeof = %d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sizeof = %d\\n\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"temp addr = %p\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"b    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"c    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"e    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>e<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nf    addr = %p\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">//\tprintf(\"f    sizeof = %d\\n\",sizeof(temp.f));</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">//\tprintf(\"\\ni addr = %p,%d\\n\",&amp;temp.i,sizeof(temp.i));</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>运行结果：</p>\n<p><img src=\"2020020814355773.png\" alt=\"img\" /></p>\n<p>可以发现在程序中，由于没有为结构体成员数组  <code>f</code>  指定大小，将不为其分配空间</p>\n<p>案例二（在案例一下，再追加一个结构体成员 i (double 类型) ）：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span> </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SIZE</span>\t\t<span class=\"token expression\"><span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">s</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">char</span> a<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">short</span> b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">int</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">double</span> d<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">char</span> f<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">double</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">s</span> temp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"char:%d,short:%d,int:%d,double:%d\\n\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">short</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sizeof = %d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sizeof = %d\\n\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"temp addr = %p\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"b    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"c    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"e    addr = %p,%2d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>e<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nf    addr = %p\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">//\tprintf(\"f    sizeof = %d\\n\",sizeof(temp.f));</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\ni addr = %p,%d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">.</span>i<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">.</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>这下编译直接报错： [Error] flexible array member not at end of struct，因为成员数组  <code>f</code>  并不知道他的大小。</p>\n",
            "tags": [
                "history",
                "C"
            ]
        },
        {
            "id": "https://arachnid.cc/C-pointer/",
            "url": "https://arachnid.cc/C-pointer/",
            "title": "对 C 指针的理解",
            "date_published": "2019-11-20T13:51:04.000Z",
            "content_html": "<blockquote>\n<p>前排声明一下，本篇是在学习 typedef 高级应用的时候发现对于指针的应用有很多不熟，然后查看了好多资料（参考链接在后面），于是又重新复习了一遍，并把它以自己通俗的语言整理出来，可能会有炒鸡多的不对，内容多来自书本和网络，希望各方大佬进行指正；同样的，在看这篇文章之前，不可全信，请务必持怀疑的态度去思考（我也不敢打保单一定是正确的，毕竟我也在学习中）</p>\n</blockquote>\n<p>指针这东西，讨人喜爱的同时也惹人烦恼，反正对我而言，谈起指针就脑壳疼，所以别在我面前谈它，不然出来打一架；哈哈哈，开玩笑的</p>\n<h1 id=\"什么是指针\"><a class=\"anchor\" href=\"#什么是指针\">#</a> 什么是指针？</h1>\n<p>首先你要明白什么是指针，指针是<strong>一个值为内存地址的变量（或数据对象）</strong>，即，内存位置的直接地址；记住：<strong>指针变量的值并不是它所指向的内存位置所存储的值</strong> 。</p>\n<h1 id=\"指针是用来干什么的\"><a class=\"anchor\" href=\"#指针是用来干什么的\">#</a> 指针是用来干什么的？</h1>\n<p>那么指针是用来干嘛的？简单的说，指针是用来操作内存的，因为内存中的每个位置都是由一个独一无二的地址标识，并且内存的每个位置都包含一个值，所以，我们常说的 “谁谁谁指向 xxx”，其实就是通过它的地址来找到所需的变量单元（也就是内存）然后再对它进行操作，注意，这个地址它不是固定的，它是由计算机随机安排的。</p>\n<h1 id=\"指针变量的声明\"><a class=\"anchor\" href=\"#指针变量的声明\">#</a> 指针变量的声明</h1>\n<pre><code>type * var-name;\n</code></pre>\n<p>在这里，<strong>type</strong> 是指针的基类型，它必须是一个有效的 C 数据类型（就是 int、char 那些），<strong>var-name</strong> 是指针变量的名称。用来声明指针的星号 ***** 与乘法中使用的星号是相同的（符号一样）。但是，<strong>在这个语句中，星号是用来指定一个变量是指针</strong> 。</p>\n<p>例如：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>ip<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* 一个整型的指针（int *） */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">double</span> <span class=\"token operator\">*</span>dp<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* 一个 double 型的指针（double *） */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">float</span> <span class=\"token operator\">*</span>fp<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* 一个浮点型的指针（float *） */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>ch<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* 一个字符型的指针（char *） */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>……</pre></td></tr></table></figure><p>在声明一个指针变量，计算机并不会自动分配用来存储指针所指向的数据的内存，其缺省值是随机的，所以我们必须对指针进行初始化，否则可能会带来严重的危害。</p>\n<h2 id=\"四-指针的初始化及赋值\"><a class=\"anchor\" href=\"#四-指针的初始化及赋值\">#</a> 四、指针的初始化及赋值</h2>\n<p>在进行初始化之前，首先我们需要了解  <code>&amp;</code>  、  <code>*</code>  这两个与指针相关的运算符，在 C 中，可以<strong>通过 &amp; 运算符访问地址，通过 * 运算符获得地址上的值</strong> 。</p>\n<p>在写程序过程中，为每个指针变量初始化赋值是个良好的习惯，会有效的防止指针指向未知的内存（也是野指针的一种）；对指针进行初始化，要让它：①指向现有的内存、②配置成 NULL 指针、③或者给它分配动态内存</p>\n<p>示例：</p>\n<p>1、/* 指向现有内存 */</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> q <span class=\"token operator\">=</span> <span class=\"token number\">25</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>ptr <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>q<span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 定义一个指针变量名为 ptr，并且 *ptr 是 int 类型的；同时，把 q 的地址赋给 ptr（就是我们常说的：把 ptr 指向 q）</span></pre></td></tr></table></figure><p>2、/* NULL 空指针 */</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>ptr <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>3、/* 分配所需的动态内存空间 */</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>ptr <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">calloc</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 在空闲内存池中分配连续内存 n * sizeof (int) 个字节的堆内存空间，并自动将这一块的内存之初始化为 0；</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/* 注意区分 ‘malloc’‘calloc’; 若是用 malloc 函数，则一般还要调用 memset 函数对内存进行初始化，</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>因为 memset 函数只是向计算机申请了一块内存空间，并没有对这些内存的值进行初始化，虽然说不调</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>用 memset 这个函数初始化也能通过编译，但是分配内存的值为一些垃圾数值，而且后面也有可能出错，</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>所以啊，用到指针就得给它初始化，否则别用，不然得不偿失 */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>ptr <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">calloc</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">*</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>ptr<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> n<span class=\"token operator\">*</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>另外，稍微拓展一下：对于我们常见的利用 malloc 函数来为指针申请一段空间来存储数据，那么什么时候需要为指针申请空间，什么时候不需要呢？</p>\n<p>要知道，C 库函数  <code>void *malloc(size_t size)</code>  是用来分配所需的内存空间，并返回一个指向它的指针；<strong>如果定义指针的时候，指针指向一个有空间的数据，这时就不需要分配空间；如果要给指针赋值，则需要分配内存空间</strong> 。</p>\n<h1 id=\"指针和数组\"><a class=\"anchor\" href=\"#指针和数组\">#</a> 指针和数组</h1>\n<p>数组表示法其实是在变相地使用指针，<strong>数组名是数组首元素的地址</strong> 。</p>\n<p>举个栗子：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* 我们定义一个数组，把它初始化一下 */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">int</span> array<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/* 那么下面的语句是成立的 */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// array == &amp;array[0];</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 你可以测试输出看一下它们的地址，你会发现是一样的</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>temp <span class=\"token operator\">=</span> array<span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 把数组的地址赋给指针</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"array = %x\\n\"</span><span class=\"token punctuation\">,</span> temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"array[0] = %x\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>array<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>但是，<strong>指针和数组并不是相等的</strong>，虽然数组也可以像指针那样进行间接访问，但还是有很大差别的：</p>\n<p><mark>声明一个数组时，编译器将根据声明所指定的元素数量为数组保留内存空间，然后再创建数组名，它的值是一个常量，指向这段空间的起始位置。声明一个指针变量时，编译器只为指针本身保留内存空间，它并不为任何整形值分配内存空间；而且，指针变量并未被初始化为指向任何现有的内存空间，如果它是一个自动变量，他甚至根本不会被初始化。</mark></p>\n<p>同样的</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>temp <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token operator\">==</span> <span class=\"token operator\">&amp;</span>array<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">// 相同的地址</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>temp <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> array<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 相同的值</span></pre></td></tr></table></figure><p>顺带一提，不要混淆  <code>*(temp + 2)</code>  和  <code>*temp + 2</code>  ；间接运算符  <code>*</code>  的优先级是高于  <code>+</code>  的，所以  <code>*temp + 2</code>  相当于  <code>(*temp)+ 2</code>  。</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>temp <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>       <span class=\"token comment\">//temp 第 3 个元素的值</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">*</span>temp <span class=\"token operator\">+</span> <span class=\"token number\">2</span>         <span class=\"token comment\">//temp 第 1 个元素的值加 2</span></pre></td></tr></table></figure><h1 id=\"指针与-const\"><a class=\"anchor\" href=\"#指针与-const\">#</a> 指针与 const</h1>\n<p>我们知道 const 关键字是用来声明常量的，用于限定一个变量为只读，所以在指针中，由于指针的特殊，有多种情况，这是因为要区分是限定指针本身为 const 还是限定指针指向的值为 const；在指针中，const 常见的用法是声明为函数形参的指针。</p>\n<p>在分析之前，我们先来复习一下：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>pi<span class=\"token punctuation\">;</span>   <span class=\"token comment\">//pi 是一个普通的指向整形的指针</span></pre></td></tr></table></figure><p>然后，下面我们在此基础上，让指针跟 const 关键字结合来分析。</p>\n<p>1、指向整形常量的指针  <code>(int const *pci / const int *pci)</code></p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 注意其实 const int *p 跟 int const *p 效果一样的</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">fun1</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> <span class=\"token keyword\">const</span> <span class=\"token operator\">*</span>p <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> temp <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    p <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 正确</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 错误</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>在这种情况下，它的特点就是：<strong>你可以修改指针的值，但你不能修改它所指向的值</strong> 。</p>\n<p>2、指向整形的常量指针  <code>(int *const cpi)</code></p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">fun2</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> <span class=\"token operator\">*</span><span class=\"token keyword\">const</span> p <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> temp <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    p <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 错误</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">// 正确</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>而现在这种情况：<strong>此时指针是常量，它的值无法修改，但你可以修改它所指向的整形的值</strong> 。</p>\n<p>然后，用个例子验证一下</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">int</span> temp <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">fun1</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> <span class=\"token keyword\">const</span> <span class=\"token operator\">*</span>p <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    p <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//  *p = 8;           // 错误，编译器警报</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fun1 -> p = %x\\n\"</span><span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fun1 -> *p = %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">fun2</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> <span class=\"token operator\">*</span><span class=\"token keyword\">const</span> p <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//  p = &amp;temp;        // 错误，编译器警报</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fun2 -> p = %x\\n\"</span><span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fun2 -> *p = %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">int</span> value <span class=\"token operator\">=</span> <span class=\"token number\">11</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&amp;temp = %x\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&amp;value = %x\\n\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token function\">fun1</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"value1 = %d\\n\"</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"value1 = %x\\n\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    value <span class=\"token operator\">=</span> <span class=\"token number\">11</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token function\">fun2</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"value2 = %d\\n\"</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"value2 = %x\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>note：</strong> 既然，在指针和形参声明中使用 const 有以上这两种情况，那么怎么区分呢？</p>\n<p>其实细心点可以发现，const 放在  <code>*</code>  左侧任意位置，限定了指针指向的数据不能改变；const 放在  <code>*</code>  的右侧，限定了指针本身不能改变。</p>\n<p>3、指向整形常量的常量指针  <code>(int const *const cpci)</code></p>\n<p>根据上面的，我们会想，在指针上能不能同时加 const 呢？可以，这就是第三种：指向整形常量的常量指针。</p>\n<p>在这里，<strong>无论是指针本身还是它所指向的值都是常量，都不允许修改</strong> 。</p>\n<p>你可能会问，上面的第一、二种不是常说的 “常量指针” 和 “指针常量” 吗？或许你说的是对的，但对于我目前找到的参考文献中，并没有找到对应出现的这两个词；正如文章开头所说的，请务必持怀疑的态度去思考，所以，我并不打算把上面的两个分点写上 “常量指针” 和 “指针常量”，毕竟，也有可能是大部分人为了叫的好听一点或者区分这个关系而命名的，但相对的，我想如果你理解了上面分点的那两个的特点及应用，比记 “常量指针” 和 “指针常量” 更好理解吧</p>\n<h1 id=\"指向指针的指针\"><a class=\"anchor\" href=\"#指向指针的指针\">#</a> 指向指针的指针</h1>\n<p><code>int **p;</code>  --- 我们从右往左看，首先从 p 开始，先与  <code>*</code>  结合，说明 p 是一个指针  <code>*p</code>  ，然后再与  <code>*</code>  结合  <code>**p</code>  ，说明指针所指向的元素是指针；然后再与 int 结合，说明该指针所指向的元素是整型数据。由于二级指针以及更高级的指针极少用在复杂的类型中，所以在这里最多只考虑一级指针。</p>\n<p>例子：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>n <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>a<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>n<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>然后，我们来分析一下</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">表达式</th>\n<th style=\"text-align:center\">与之相对应的表达式</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">a</td>\n<td style=\"text-align:center\">==  <code>12</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">n</td>\n<td style=\"text-align:center\">==  <code>&amp;a</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">*n</td>\n<td style=\"text-align:center\">==  <code>a</code>  or == <code>12</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">P</td>\n<td style=\"text-align:center\">==  <code>&amp;n</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">*p</td>\n<td style=\"text-align:center\">==  <code>n</code>  or ==  <code>&amp;a</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">**p</td>\n<td style=\"text-align:center\">==  <code>*n</code>  or ==  <code>a</code>  or ==  <code>12</code></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"指针与结构体\"><a class=\"anchor\" href=\"#指针与结构体\">#</a> 指针与结构体</h1>\n<p>先来放一个例子：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SIZE</span>  <span class=\"token expression\"><span class=\"token number\">10</span></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">int</span> num<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">float</span> score<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span>Student_TypeDef<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Student_TypeDef stu <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"Tom\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">136.5</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>                  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Student_TypeDef <span class=\"token operator\">*</span>pstu <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>stu<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// 读取结构体成员的值</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s的学号是%d，成绩是%.1f！\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>pstu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>pstu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>num<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>pstu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>score<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s的学号是%d，成绩是%.1f！\\n\"</span><span class=\"token punctuation\">,</span> pstu<span class=\"token operator\">-></span>name<span class=\"token punctuation\">,</span> pstu<span class=\"token operator\">-></span>num<span class=\"token punctuation\">,</span> pstu<span class=\"token operator\">-></span>score<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>输出都是：</p>\n<pre><code>Tom的学号是13，成绩是136.5！\n</code></pre>\n<p>先来认识一下结构成员的访问：</p>\n<p>直接访问：结构变量的成员是通过点操作符  <code>.</code>  访问的</p>\n<p>间接访问：利用操作符  <code>-&gt;</code>  （也称箭头操作符）通过结构体指针直接取得结构体成员</p>\n<p>值得注意的是：通过结构体指针获取结构体成员，一般形式为：</p>\n<p><code>(*pointer).memberName</code></p>\n<p>或者：</p>\n<p><code>pointer-&gt;memberName</code></p>\n<p>第一种写法中， <code>.</code>  的优先级高于  <code>*</code> ，  <code>(*pointer)</code>  两边的括号不能少。如果去掉括号写作  <code>*pointer.memberName</code>  ，那么就等效于  <code>*( pointer.memberName)</code>  ，这样意义就完全不对了。</p>\n<p>然后我们结合上面的例子来分析一下，为什么在操作结构体指针的时候，这两种输出的情况是一样的</p>\n<p>首先，<mark>①</mark>  <code>pstu = &amp;stu;</code>  指针 pstu 指向了定义为 Student_TypeDef 类型的结构体，这个结构变量名为 stu；和数组不同的是，结构变量名并不是结构的地址；数组名在表达式中会被转换为数组指针，而结构体变量名不会，无论在任何表达式中它表示的都是整个集合本身，要想取得结构体变量的地址，因此得在结构变量名前加上  <code>&amp;</code>  运算符。<mark>②</mark>  <code>pointer-&gt;memberName</code>  输出结构先来分析使用  <code>-&gt;</code>  运算符的，也是最常用的方法；按照上面的，如果  <code>pstu == &amp;stu</code>  ，那么  <code>pstu-&gt;num</code>  即是  <code>stu.num</code>  ；这里 <strong>pstu 是一个指针</strong>，但是  <code>pstu-&gt;num</code>  是该指针所指向结构的一个成员，所以  <code>pstu-&gt;num</code>  是一个 int 类型的变量，至于为什么不能写成  <code>pstu.num</code>  ，因为 <strong>pstu 不是结构体</strong>。<mark>③</mark>  <code>(*pointer).memberName</code>  是等价于  <code>pointer-&gt;memberName</code>  的，如果  <code>pstu == &amp;stu</code>  ，那么  <code>*pstu == stu</code>  ，因为我们从上面学习到  <code>&amp;</code>  和  <code>*</code>  是一对互逆运算符；因此就有了这样的替代：  <code>stu.num == (*pstu).num</code>  。</p>\n<h1 id=\"函数和指针\"><a class=\"anchor\" href=\"#函数和指针\">#</a> 函数和指针</h1>\n<p>1、返回指针的函数</p>\n<p><code>int *pf(void)</code>  ：首先执行的是函数调用操作符 () ，因为它的优先级高于间接访问操作符；因此， <code>pf</code>  是一个函数，它的返回值是一个指向整形的指针。</p>\n<p>2、指向函数的指针（函数指针）</p>\n<p><code>int (*pf)(void)</code>  ：这个声明有两对括号，每对的含义各不相同。第二对括号是函数调用操作符，但第一对括号只起聚组的作用；它迫使间接访问在函数调用之前进行，使 pf 成为一个函数指针，它所指向的函数返回一个整形值 <strong>（你也可以这样理解：  <code>int pam(void)</code>  是我们常见的函数声明，它声明了  <code>pam</code>  是一个返回整形的函数；如果我们将  <code>pam</code>  替换为  <code>*pf</code>  ，由于  <code>pam</code>  是函数，因此  <code>*pf</code>  也是函数；而如果  <code>*pf</code>  是函数，则  <code>pf</code>  就成为指向该类型的指针，也就是函数指针）</strong> 。</p>\n<p>我们知道在声明一个数据指针时，必须声明指针所指向的数据类型。而声明一个函数指针时，必须声明指针指向的函数类型；为了指明函数类型，要指明函数签名，即函数的返回类型和形参类型。在声明了函数指针后，可以把类型匹配的函数地址赋给它。</p>\n<p>下面来个例子熟悉一遍：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">NUM1</span>  <span class=\"token expression\"><span class=\"token number\">76</span></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">NUM2</span>  <span class=\"token expression\"><span class=\"token number\">83</span></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">char</span> x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> y <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">></span>y <span class=\"token operator\">?</span> x<span class=\"token operator\">:</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">min</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">char</span> x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> y <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">&lt;</span>y <span class=\"token operator\">?</span> x<span class=\"token operator\">:</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">double</span> <span class=\"token function\">product</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">int</span> x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">*</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">pam</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>ptf<span class=\"token punctuation\">)</span>       <span class=\"token comment\">// 返回指针的函数</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">return</span> ptf<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">char</span> temp<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hello, world!\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token function\">calloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 申请空间</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>pf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">char</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> b <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// 指向函数的指针</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    p <span class=\"token operator\">=</span> <span class=\"token function\">pam</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">//  pf = product;     // 错误，编译器警报；product 与指针类型不匹配</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    pf <span class=\"token operator\">=</span> max<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"max = %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>pf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>NUM1<span class=\"token punctuation\">,</span> NUM2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    pf <span class=\"token operator\">=</span> min<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"min = %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">pf</span><span class=\"token punctuation\">(</span>NUM1<span class=\"token punctuation\">,</span> NUM2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       </pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>从上面可以看到  <code>(*pf)()</code>  和  <code>pf()</code>  ，两种其中一种都可以；先来看第一种：由于  <code>pf</code>  指向  <code>max()</code>  函数，那么  <code>*pf</code>  就相当于  <code>max()</code>  函数，表达式  <code>(*pf)()</code>  和  <code>max()</code>  相同；第二种：由于函数名是指针，那么指针和函数名可以互换使用。但是我们一般都是使用第一种，也就是  <code>(*pf)()</code>  ，因为它明确指出是通过指针而非函数名来调用函数的，这样我们才好区分函数指针，如果我们用第二种，则看上去和函数调用无异。</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><em>《C Primer Plus》</em></p>\n<p><em>《C++ Primer Plus》</em></p>\n<p><em>《C 和指针》</em></p>\n<p><a href=\"https://www.runoob.com/w3cnote/c-pointer-detail.html\">C 指针详解</a></p>\n<p><a href=\"https://blog.csdn.net/mhjcumt/article/details/7351032\">C 语言指针的初始化和赋值</a></p>\n<p><a href=\"https://blog.csdn.net/linpengbin/article/details/43243549\">内存分配函数 malloc 与 calloc 的用法及区别</a></p>\n<p><a href=\"https://blog.csdn.net/missuever/article/details/540045\">malloc 和 calloc 的区别</a></p>\n<p><a href=\"https://zhidao.baidu.com/question/261858227.html?sort=11&amp;rn=5&amp;pn=0#wgt-answers\">C 中指针变量何时需要初始化 malloc</a></p>\n<p><a href=\"https://blog.csdn.net/jackystudio/article/details/11519817\">【C++ 基础之二】常量指针和指针常量</a></p>\n<p><a href=\"http://c.biancheng.net/cpp/html/94.html\">C 语言结构体和指针</a></p>\n<p><a href=\"https://www.jianshu.com/p/20e7c3568a12\">指针函数与函数指针（C 语言）</a></p>\n",
            "tags": [
                "history",
                "C"
            ]
        }
    ]
}