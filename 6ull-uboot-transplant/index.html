<!-- build time:Tue Jun 11 2024 22:44:47 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="命运转轮" href="https://arachnid.cc/rss.xml"><link rel="alternate" type="application/atom+xml" title="命运转轮" href="https://arachnid.cc/atom.xml"><link rel="alternate" type="application/json" title="命运转轮" href="https://arachnid.cc/feed.json"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Linux"><link rel="canonical" href="https://arachnid.cc/6ull-uboot-transplant/"><title>imx-6ULL uboot 移植 | Arachnid's blog = 命运转轮 = Life is ...the time you did something you're afraid of doing</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="loader-state"><svg viewBox="0 0 178 40" width="178" height="40"><path class="air" d="M 46 16.5 h -20 a 8 8 0 0 1 0 -16" fill="none" stroke="#E85725" stroke-width="1" stroke-linejoin="round" stroke-linecap="round"></path><g id="car"><svg viewBox="0 0 118 28.125" x="30" y="11.725" width="118" height="28.125"><defs><circle id="circle" cx="0" cy="0" r="1"></circle><g id="wheel"><use href="#circle" fill="#1E191A" transform="scale(10)"></use><use href="#circle" fill="#fff" transform="scale(5)"></use><path fill="#1E191A" stroke="#1E191A" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" opacity="0.2" stroke-dashoffset="0" d="M -3.5 0 a 4 4 0 0 1 7 0 a 3.5 3.5 0 0 0 -7 0"></path><use href="#circle" fill="#1E191A" transform="scale(1.5)"></use><path fill="none" stroke="#F9B35C" stroke-width="0.75" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="20 14 8 5" d="M 0 -7.5 a 7.5 7.5 0 0 1 0 15 a 7.5 7.5 0 0 1 0 -15"></path><path fill="none" stroke="#fff" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" opacity="0.1" stroke-dashoffset="0" d="M -6.5 -6.25 a 10 10 0 0 1 13 0 a 9 9 0 0 0 -13 0"></path></g></defs><g transform="translate(51.5 11.125)"><path stroke-width="2" stroke="#1E191A" fill="#EF3F33" d="M 0 0 v -2 a 4.5 4.5 0 0 1 9 0 v 2"></path><rect fill="#1E191A" x="3.25" y="-3" width="5" height="3"></rect></g><g transform="translate(10 24.125)"><g transform="translate(59 0)"><path id="shadow" opacity="0.7" fill="#1E191A" d="M -64 0 l -4 4 h 9 l 8 -1.5 h 100 l -3.5 -2.5"></path></g><path fill="#fff" stroke="#1E191A" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round" d="M 0 0 v -10 l 35 -13 v 5 l 4 0.5 l 0.5 4.5 h 35.5 l 30 13"></path><g fill="#fff" stroke="#1E191A" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"><path d="M -6 0 v -22 h 10 z"></path><path d="M 105 0 h -3 l -12 -5.2 v 6.2 h 12"></path></g><g fill="#949699" opacity="0.7"><rect x="16" y="-6" width="55" height="6"></rect><path d="M 24 -14 l 13 -1.85 v 1.85"></path></g><g fill="none" stroke="#1E191A" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"><path stroke-dasharray="30 7 42" d="M 90 0 h -78"></path><path d="M 39.5 -13 h -15"></path></g><path fill="#fff" stroke="#1E191A" stroke-width="2.25" stroke-linejoin="round" d="M 48.125 -6 h -29 v 6 h 29"></path><rect x="48" y="-7.125" width="6.125" height="7.125" fill="#1E191A"></rect><g fill="#1E191A"><rect x="60" y="-15" width="1" height="6"></rect><rect x="56.5" y="-17.5" width="6" height="2.5"></rect></g></g><g class="wheels" transform="translate(0 18.125)"><g transform="translate(10 0)"><use href="#wheel"></use></g><g transform="translate(87 0)"><use href="#wheel" stroke-dashoffset="-22"></use></g></g></svg></g><g fill="none" stroke-width="1" stroke-linejoin="round" stroke-linecap="round"><path class="air" stroke="#E85725" d="M 177.5 34 h -10 q -16 0 -32 -8"></path><path class="air" stroke="#949699" d="M 167 28.5 c -18 -2 -22 -8 -37 -10.75"></path><path class="air" stroke="#949699" d="M 153 20 q -4 -1.7 -8 -3"></path><path class="air" stroke="#E85725" d="M 117 16.85 c -12 0 -12 16 -24 16 h -8"></path><path class="air" stroke="#949699" d="M 65 12 q -5 3 -12 3.8"></path><path class="air" stroke="#949699" stroke-dasharray="9 10" d="M 30 13.5 h -2.5 q -5 0 -5 -5"></path><path class="air" stroke="#949699" d="M 31 33 h -10"></path><path class="air" stroke="#949699" d="M 29.5 23 h -12"></path><path class="air" stroke="#949699" d="M 13.5 23 h -6"></path><path class="air" stroke="#E85725" d="M 28 28 h -27.5"></path></g></svg></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline"><a href="/6ull-uboot-transplant" class="link external" itemprop="url">imx-6ULL uboot 移植<i class="ic i-link-alt"></i></a></h1><div class="meta"><span class="item" title="创建时间：2023-03-03 20:52:11"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-03-03T20:52:11+08:00">2023-03-03</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>11k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>12 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Arachnid's blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://arachnid.cc/picture/(4).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(14).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(9).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(22).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(3).webp"></li><li class="item" data-background-image="https://arachnid.cc/picture/(16).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="cn"><link itemprop="mainEntityOfPage" href="https://arachnid.cc/6ull-uboot-transplant/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.webp"><meta itemprop="name" content="夏沫の浅雨"><meta itemprop="description" content="Life is ...the time you did something you're afraid of doing, 不曾亏欠，不曾辜负，如此足矣"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="命运转轮"></span><div class="body md" itemprop="articleBody"><blockquote><p>开发平台：Ubuntu 18.04.6</p><p>目标平台：imx-6ull</p><p>uboot 版本：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvdWJvb3QtaW14L3RyZWUvaW14X3YyMDIwLjA0XzUuNC43MF8yLjMuMA==">uboot-imx-imx_v2020.04_5.4.70_2.3.0</span></p><p>编译工具链：gcc versions 10.3.1 20210621 (GNU Toolchain for the A-profile Architecture 10.3-2021.07 (arm-10.29))</p></blockquote><h1 id="环境搭建"><a class="anchor" href="#环境搭建">#</a> 环境搭建</h1><h2 id="交叉编译器"><a class="anchor" href="#交叉编译器">#</a> 交叉编译器</h2><p>在 ARM <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb3dubG9hZHMvLS9nbnUtYQ==">官方链接</span>下载 Arm A-profile architecture 编译工具链，选择自己相应的平台，这里的话是： <code>gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf</code> 。</p><p>解压添加至本地：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command></td><td><pre><span class="token comment"># 创建存放编译工具链的文件夹</span></pre></td></tr><tr><td data-num="2"></td><td data-command="[user@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">mkdir</span> /usr/local/arm</pre></td></tr><tr><td data-num="3"></td><td data-command></td><td><pre><span class="token comment"># 移动文件</span></pre></td></tr><tr><td data-num="4"></td><td data-command="[user@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">mv</span> gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf.tar.xz /usr/local/arm/</pre></td></tr><tr><td data-num="5"></td><td data-command></td><td><pre><span class="token comment"># 解压文件</span></pre></td></tr><tr><td data-num="6"></td><td data-command="[user@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-xvf</span> /usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf.tar.xz</pre></td></tr></table></figure><p>添加环境变量：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command></td><td><pre><span class="token comment"># 添加到系统环境变量 (对所有用户有效)</span></pre></td></tr><tr><td data-num="2"></td><td data-command="[user@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">vim</span> /etc/profile</pre></td></tr><tr><td data-num="3"></td><td data-command></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin</pre></td></tr><tr><td data-num="4"></td><td data-command></td><td><pre><span class="token comment"># 添加到用户环境变量 (仅对当前用户有效)</span></pre></td></tr><tr><td data-num="5"></td><td data-command="[user@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">vim</span> ~/.bashrc </pre></td></tr><tr><td data-num="6"></td><td data-command></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin</pre></td></tr><tr><td data-num="7"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td data-command></td><td><pre><span class="token comment"># 以上二选一</span></pre></td></tr></table></figure><p>测试命令：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command></td><td><pre><span class="token comment"># 成功打印版本信息则为通过</span></pre></td></tr><tr><td data-num="2"></td><td data-command="[user@localhost] $"></td><td><pre>arm-none-linux-gnueabihf-gcc <span class="token parameter variable">-v</span></pre></td></tr></table></figure><h2 id="uboot-源码"><a class="anchor" href="#uboot-源码">#</a> uboot 源码</h2><p>NXP 维护的 uboot 仓库地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvdWJvb3QtaW14">https://github.com/nxp-imx/uboot-imx</span></p><p>获取 NXP uboot 5.4.70_2.3.0 版本的源码：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 拉取源码文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">git</span> clone https://github.com/nxp-imx/uboot-imx.git</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 切换到</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">git</span> checkout imx_v2020.04_5.4.70_2.3.0</pre></td></tr></table></figure><p>上面的 clone 操作会拉取所有分支文件及历史提交信息下来，文件比较大，如果网络不太好，可以尝试打开 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvdWJvb3QtaW14L3RyZWUvaW14X3YyMDIwLjA0XzUuNC43MF8yLjMuMA==">https://github.com/nxp-imx/uboot-imx/tree/imx_v2020.04_5.4.70_2.3.0</span> 只下载 ZIP 压缩包下来，然后利用 <code>unzip</code> 命令解压。</p><p>note：对于不同分支，有 <code>fslc</code> 和 <code>imx</code> 关键字的区分，以下摘录解释：</p><figure class="highlight wiki"><figcaption data-lang="Wiki markup"></figcaption><table><tr><td data-num="1"></td><td><pre>There are two BSPs, the BSP Releases which are supported by NXP and their documentation can be found on the Linux i.MX webpage, and the Community BSP.</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>A BSP Release roadmap is not publicly available, but as you may see there are new BSPs every several months. However, it usually lags in respect to the Linux Mainline Kernel as a lot of work is done to ensure that the kernel works correctly on the NXP hardware. The kernel from these BSP Releases (linux-imx) can be found on the following repository and it is indeed an upstream from the Community BSP Kernel.</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>https://source.codeaurora.org/external/imx/linux-imx/</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>As for the Community BSP, it’s constantly being updated by the Community but due to its nature is hard to predict how fast each branch will be developed.</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>You can find more information about the Community BSP on the link below:</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>http://freescale.github.io/</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>The Kernel recipes of the community BSP (linux-fslc) would be on the meta-freescale layer:</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>http://git.yoctoproject.org/cgit/cgit.cgi/meta-freescale</pre></td></tr></table></figure><p>简单的来讲，就是 <code>imx</code> 是官方发行版，而 <code>fslc</code> 是社区发行版。</p><p>来源：<span class="exturl" data-url="aHR0cHM6Ly9jb21tdW5pdHkubnhwLmNvbS90NS9pLU1YLVByb2Nlc3NvcnMvd2hhdC1pcy10aGUtcHVycG9zZS1vZi1saW51eC1mc2xjLWdpdC9tLXAvMTA0NzYwMg==">https://community.nxp.com/t5/i-MX-Processors/what-is-the-purpose-of-linux-fslc-git/m-p/1047602</span></p><p>关于 uboot 版本选择：</p><p>随着时间的变化，uboot 的更新也出现了多个的版本，那么到底应该选择哪一个呢？有些人可能会说当然是越新越好啦。其实呢不是这个样子的，虽然 uboot 本身是在不断的开发和进化当中，但对于新版本来说，可能开发者们在某一个版本中加入了一些新的特性，然后呢过了一段时间又发现这个新功能不是很稳定，就有可能会把它删掉或者需要后期继续更新迭代修复；这样一来就会对我们所移植的 uboot 来说就会增加很多不必要的复杂性，因为不排除是否会影响到所使用的功能，所以一般的原则就是够用就可以了，不需要频繁更新。</p><p>那如何选择属于自己的版本呢：</p><ol><li><p>打开下载的 uboot 目录下的： <code>arch/arm/cpu</code> 目录，确认使用的 cpu 型号是否支持及对应。</p></li><li><p>打开 uboot 目录下的： <code>board</code> 目录，查看相对应的外设是否都支持。eq： <code>board/freescale/mx6ull_board/</code> 。</p></li></ol><p>一般来说，uboot 版本越新支持的开发板和 cpu 就越多，代码量就越多，如果我们的 cpu 和开发板的并没有这么多东西，那我们可以不用新的。而用适合自己产品外设的，通常是根据开发板发行的日期和 uboot 的更新日期来找到合适的 uboot。</p><h1 id="编译验证"><a class="anchor" href="#编译验证">#</a> 编译验证</h1><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[user@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token parameter variable">-s</span></pre></td></tr><tr><td data-num="2"></td><td data-command></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>arm</pre></td></tr><tr><td data-num="3"></td><td data-command></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>arm-none-linux-gnueabihf-</pre></td></tr><tr><td data-num="4"></td><td data-command></td><td><pre><span class="token function">make</span> distclean</pre></td></tr><tr><td data-num="5"></td><td data-command></td><td><pre><span class="token function">make</span> mx6ull_14x14_evk_emmc_defconfig</pre></td></tr><tr><td data-num="6"></td><td data-command></td><td><pre><span class="token function">make</span></pre></td></tr></table></figure><p>编译源码这一步的目的：</p><ul><li><p>一是为了验证编译环境是否正常；</p></li><li><p>二是为了下一步移植过程中的代码分析（一些文件只有在编译后才会生成）。</p></li></ul><p>注意：</p><p>若是提示 <code>make: 未找到命令</code> ，则需要安装 <code>make</code> 工具：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">make</span></pre></td></tr></table></figure><p>若是出现 <code>/bin/sh: 1: cc: not found</code> ，需要安装 gcc 依赖，因为 <code>HOSTCC scripts/basic/fixdep</code> 强制定义使用了 gcc， <code>HOSTCC=gcc</code> ：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> gcc</pre></td></tr></table></figure><p>若是在系统上第一次编译 uboot 源码可能会遇到缺少 <code>bison</code> 、 <code>flex</code> 的报错信息导致编译失败，只需安装相应的工具包后重新执行编译即可：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command></td><td><pre><span class="token comment"># 语法分析工具</span></pre></td></tr><tr><td data-num="2"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> bison</pre></td></tr><tr><td data-num="3"></td><td data-command></td><td><pre><span class="token comment"># 词法分析工具</span></pre></td></tr><tr><td data-num="4"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> flex</pre></td></tr></table></figure><h1 id="移植"><a class="anchor" href="#移植">#</a> 移植</h1><p>下面以命名为 <code>lanjut</code> 的板子为例。</p><h2 id="开发板文件夹"><a class="anchor" href="#开发板文件夹">#</a> 开发板文件夹</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">ls</span> <span class="token parameter variable">-d</span> board/freescale/*6ull*</pre></td></tr><tr><td data-num="2"></td><td data-command></td><td><pre>board/freescale/mx6ullevk     board/freescale/mx6ull_ddr3_val</pre></td></tr><tr><td data-num="3"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">cp</span> <span class="token parameter variable">-r</span> board/freescale/mx6ullevk/ board/freescale/mx6ull_lanjut/</pre></td></tr><tr><td data-num="4"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">mv</span> board/freescale/mx6ull_lanjut/mx6ullevk.c board/freescale/mx6ull_lanjut/mx6ull_lanjut.c</pre></td></tr><tr><td data-num="5"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">ls</span> board/freescale/mx6ull_lanjut/</pre></td></tr><tr><td data-num="6"></td><td data-command></td><td><pre>imximage.cfg         Kconfig      Makefile        plugin.S</pre></td></tr><tr><td data-num="7"></td><td data-command></td><td><pre>imximage_lpddr2.cfg  MAINTAINERS  mx6ull_lanjut.c  README</pre></td></tr></table></figure><p><strong>修改：</strong></p><p>1、 <code>Kconfig</code> 文件：</p><pre><code>gedit board/freescale/mx6ull_lanjut/Kconfig
</code></pre><p>更改内容为（注意该文件 <code>endif</code> 后面必须有换行）：</p><figure class="highlight wiki"><figcaption data-lang="Wiki markup"></figcaption><table><tr><td data-num="1"></td><td><pre>if TARGET_MX6ULL_14X14_LANJUT</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>config SYS_BOARD</pre></td></tr><tr><td data-num="4"></td><td><pre>	default "mx6ull_lanjut"</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>config SYS_VENDOR</pre></td></tr><tr><td data-num="7"></td><td><pre>	default "freescale"</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>config SYS_CONFIG_NAME</pre></td></tr><tr><td data-num="10"></td><td><pre>	default "mx6ull_lanjut"</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>config SYS_TEXT_BASE</pre></td></tr><tr><td data-num="13"></td><td><pre>	default 0x87800000</pre></td></tr><tr><td data-num="14"></td><td><pre>endif</pre></td></tr></table></figure><p>2、 <code>Makefile</code> 文件：</p><pre><code>gedit board/freescale/mx6ull_lanjut/Makefile
</code></pre><p>把 <code>obj-y := mx6ullevk.o</code> 改为 <code>obj-y := mx6ull_lanjut.o</code> 。</p><p>3、 <code>imximage_lpddr2.cfg</code> 和 <code>imximage.cfg</code> 文件：</p><p>该更改受控于 <code>CONFIG_USE_IMXIMG_PLUGIN</code> 宏定义，在配置文件中是没有使能的，改不改都无所谓，但为了统一，把 <code>PLUGIN	board/freescale/mx6ullevk/plugin.bin 0x00907000</code> 改为 <code>PLUGIN	board/freescale/mx6ull_lanjut/plugin.bin 0x00907000</code> 。</p><p>4、 <code>MAINTAINERS</code> 文件：</p><p>是维护者记录文件，作为个人使用，改不改都无所谓；如果是作为 uboot 项目维护者，则需要完整记录好详细的信息，以便更好的发展维护。</p><figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tr><td data-num="1"></td><td><pre>MX6ULL_LANJUT BOARD</pre></td></tr><tr><td data-num="2"></td><td><pre>M:	Arachnid <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xxxx@qq.com</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>S:	Maintained</pre></td></tr><tr><td data-num="4"></td><td><pre>F:	board/freescale/mx6ull_lanjut/</pre></td></tr><tr><td data-num="5"></td><td><pre>F:	include/configs/mx6ull_lanjut.h</pre></td></tr><tr><td data-num="6"></td><td><pre>F:	configs/mx6ull_14x14_lanjut_defconfig</pre></td></tr><tr><td data-num="7"></td><td><pre>F:	configs/mx6ull_14x14_lanjut_plugin_defconfig</pre></td></tr><tr><td data-num="8"></td><td><pre>F:	configs/mx6ulz_14x14_lanjut_defconfig</pre></td></tr></table></figure><p>5、 <code>mx6ull_lanjut.c</code> 文件：</p><ul><li><p><code>board_late_init</code> 函数</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">board_late_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_CMD_BMODE</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token function">add_board_boot_modes</span><span class="token punctuation">(</span>board_boot_modes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token function">env_set</span><span class="token punctuation">(</span><span class="token string">"tee"</span><span class="token punctuation">,</span> <span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_IMX_OPTEE</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token function">env_set</span><span class="token punctuation">(</span><span class="token string">"tee"</span><span class="token punctuation">,</span> <span class="token string">"yes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token function">env_set</span><span class="token punctuation">(</span><span class="token string">"board_name"</span><span class="token punctuation">,</span> <span class="token string">"LANJUT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 决定了后面 findfdt 和 findtee 环境变量的选择</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_mx6ull_9x9_evk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token function">env_set</span><span class="token punctuation">(</span><span class="token string">"board_rev"</span><span class="token punctuation">,</span> <span class="token string">"9X9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token function">env_set</span><span class="token punctuation">(</span><span class="token string">"board_rev"</span><span class="token punctuation">,</span> <span class="token string">"14X14"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_cpu_type</span><span class="token punctuation">(</span>MXC_CPU_MX6ULZ<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token function">env_set</span><span class="token punctuation">(</span><span class="token string">"board_name"</span><span class="token punctuation">,</span> <span class="token string">"ULZ-EVK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token function">env_set</span><span class="token punctuation">(</span><span class="token string">"usb_net_cmd"</span><span class="token punctuation">,</span> <span class="token string">"usb start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token function">setup_lcd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_ENV_IS_IN_MMC</span></span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token function">board_late_mmc_env_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token function">set_wdog_reset</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">wdog_regs</span> <span class="token operator">*</span><span class="token punctuation">)</span>WDOG1_BASE_ADDR<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><code>checkboard</code> 函数</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">checkboard</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_mx6ull_9x9_evk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Board: MX6ULL 9x9 EVK\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_cpu_type</span><span class="token punctuation">(</span>MXC_CPU_MX6ULZ<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Board: MX6ULZ 14x14 EVK\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Board: MX6ULL 14x14 LANJUT\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//uboot 板载信息显示</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ul><h2 id="设备树文件"><a class="anchor" href="#设备树文件">#</a> 设备树文件</h2><p>在新版本 uboot 中，参考 Linux 内核引入了<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGV2aWNldHJlZS5vcmcv">设备树</span>和<span class="exturl" data-url="aHR0cHM6Ly91LWJvb3QucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2RldmVsb3AvZHJpdmVyLW1vZGVsL2luZGV4Lmh0bWw=">驱动模型 (Driver Model)</span>。</p><p>1、 <code>imx6ull-14x14-lanjut-emmc.dts</code> 文件：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">ls</span> arch/arm/dts/*6ull*.dts</pre></td></tr><tr><td data-num="2"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val.dts</pre></td></tr><tr><td data-num="3"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-emmc.dts</pre></td></tr><tr><td data-num="4"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-epdc.dts</pre></td></tr><tr><td data-num="5"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-gpmi-weim.dts</pre></td></tr><tr><td data-num="6"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-lcdif.dts</pre></td></tr><tr><td data-num="7"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-tsc.dts</pre></td></tr><tr><td data-num="8"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-evk.dts</pre></td></tr><tr><td data-num="9"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-evk-emmc.dts</pre></td></tr><tr><td data-num="10"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-evk-gpmi-weim.dts</pre></td></tr><tr><td data-num="11"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-9x9-evk.dts</pre></td></tr><tr><td data-num="12"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-colibri.dts</pre></td></tr><tr><td data-num="13"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-dart-6ul.dts</pre></td></tr><tr><td data-num="14"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-phytec-segin-ff-rdk-emmc.dts</pre></td></tr><tr><td data-num="15"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-somlabs-visionsom.dts</pre></td></tr><tr><td data-num="16"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">cp</span> arch/arm/dts/imx6ull-14x14-evk-emmc.dts arch/arm/dts/imx6ull-14x14-lanjut-emmc.dts</pre></td></tr><tr><td data-num="17"></td><td data-command="[root@localhost] $"></td><td><pre>gedit arch/arm/dts/imx6ull-14x14-lanjut-emmc.dts</pre></td></tr></table></figure><p><strong>修改：</strong></p><p>把 <code>#include &quot;imx6ull-14x14-evk.dts&quot;</code> 更改为 <code>#include &quot;imx6ull-14x14-lanjut.dts&quot;</code> 。</p><p>同时更改以下内容：</p><pre><code>/ &#123;
	model = &quot;i.MX6 ULL 14x14 EVK Board&quot;;
	compatible = &quot;fsl,imx6ull-14x14-evk&quot;, &quot;fsl,imx6ull&quot;;
&#125;;

改为

/ &#123;
	model = &quot;i.MX6 ULL 14x14 LANJUT Board&quot;;
	compatible = &quot;fsl,imx6ull-14x14-lanjut&quot;, &quot;fsl,imx6ull&quot;;
&#125;;
</code></pre><p>2、 <code>imx6ull-14x14-lanjut.dts</code> 文件：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">cp</span> arch/arm/dts/imx6ull-14x14-evk.dts arch/arm/dts/imx6ull-14x14-lanjut.dts</pre></td></tr><tr><td data-num="2"></td><td data-command="[root@localhost] $"></td><td><pre>gedit arch/arm/dts/imx6ull-14x14-lanjut.dts</pre></td></tr></table></figure><p><strong>修改：</strong></p><p>把 <code>#include &quot;imx6ul-14x14-evk.dtsi&quot;</code> 更改为 <code>#include &quot;imx6ul-14x14-lanjut.dtsi&quot;</code> ； <code>#include &quot;imx6ul-14x14-evk-u-boot.dtsi&quot;</code> 更改为 <code>#include &quot;imx6ul-14x14-lanjut-u-boot.dtsi&quot;</code> 。</p><p>3、 <code>imx6ul-14x14-lanjut.dtsi</code> 和 <code>imx6ul-14x14-lanjut-u-boot.dtsi</code> 文件：</p><p>根据 <code>imx6ull-14x14-lanjut.dts</code> 文件的 <code>#include</code> 包含文件，分别添加文件。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">cp</span> arch/arm/dts/imx6ul-14x14-evk.dtsi arch/arm/dts/imx6ul-14x14-lanjut.dtsi</pre></td></tr><tr><td data-num="2"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">cp</span> arch/arm/dts/imx6ul-14x14-evk-u-boot.dtsi arch/arm/dts/imx6ul-14x14-lanjut-u-boot.dtsi</pre></td></tr></table></figure><h2 id="配置文件"><a class="anchor" href="#配置文件">#</a> 配置文件</h2><p>1、 <code>mx6ull_14x14_lanjut_emmc_defconfig</code> 文件：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">ls</span> configs/*6ull*</pre></td></tr><tr><td data-num="2"></td><td data-command></td><td><pre>configs/colibri-imx6ull_defconfig</pre></td></tr><tr><td data-num="3"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_defconfig</pre></td></tr><tr><td data-num="4"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_emmc_defconfig</pre></td></tr><tr><td data-num="5"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_epdc_defconfig</pre></td></tr><tr><td data-num="6"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_nand_defconfig</pre></td></tr><tr><td data-num="7"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_plugin_defconfig</pre></td></tr><tr><td data-num="8"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_qspi1_defconfig</pre></td></tr><tr><td data-num="9"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_spinor_defconfig</pre></td></tr><tr><td data-num="10"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_tsc_defconfig</pre></td></tr><tr><td data-num="11"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_defconfig</pre></td></tr><tr><td data-num="12"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_emmc_defconfig</pre></td></tr><tr><td data-num="13"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_nand_defconfig</pre></td></tr><tr><td data-num="14"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_optee_defconfig</pre></td></tr><tr><td data-num="15"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_plugin_defconfig</pre></td></tr><tr><td data-num="16"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_qspi1_defconfig</pre></td></tr><tr><td data-num="17"></td><td data-command></td><td><pre>configs/mx6ull_9x9_evk_defconfig</pre></td></tr><tr><td data-num="18"></td><td data-command></td><td><pre>configs/mx6ull_9x9_evk_plugin_defconfig</pre></td></tr><tr><td data-num="19"></td><td data-command></td><td><pre>configs/mx6ull_9x9_evk_qspi1_defconfig</pre></td></tr><tr><td data-num="20"></td><td data-command></td><td><pre>configs/somlabs_visionsom_6ull_defconfig</pre></td></tr><tr><td data-num="21"></td><td data-command="[root@localhost] $"></td><td><pre><span class="token function">cp</span> configs/mx6ull_14x14_evk_emmc_defconfig configs/mx6ull_14x14_lanjut_emmc_defconfig</pre></td></tr><tr><td data-num="22"></td><td data-command="[root@localhost] $"></td><td><pre>gedit configs/mx6ull_14x14_lanjut_emmc_defconfig</pre></td></tr></table></figure><p><strong>修改：</strong></p><p>把 <code>CONFIG_TARGET_MX6ULL_14X14_EVK=y</code> 改为 <code>CONFIG_TARGET_MX6ULL_14X14_LANJUT=y</code> ； <code>CONFIG_SYS_EXTRA_OPTIONS=&quot;IMX_CONFIG=board/freescale/mx6ullevk/imximage.cfg&quot;</code> 改为 <code>CONFIG_SYS_EXTRA_OPTIONS=&quot;IMX_CONFIG=board/freescale/mx6ull_lanjut/imximage.cfg&quot;</code> ； <code>CONFIG_DEFAULT_DEVICE_TREE=&quot;imx6ull-14x14-evk-emmc&quot;</code> 改为 <code>CONFIG_DEFAULT_DEVICE_TREE=&quot;imx6ull-14x14-lanjut-emmc&quot;</code> 。</p><p>2、 <code>include/configs/mx6ull_lanjut.h</code> 文件：</p><pre><code>ls include/configs/*6ull*
include/configs/colibri-imx6ull.h  include/configs/mx6ullevk.h
include/configs/mx6ull_ddr3_val.h  include/configs/somlabs_visionsom_6ull.h
cp include/configs/mx6ullevk.h include/configs/mx6ull_lanjut.h
gedit include/configs/mx6ull_lanjut.h
</code></pre><p><strong>修改：</strong></p><p>把 <code>#ifndef __MX6ULLEVK_CONFIG_H</code> 和 <code>#define __MX6ULLEVK_CONFIG_H</code> 改为 <code>#ifndef __MX6ULL_LANJUT_CONFIG_H</code> 和 <code>#define __MX6ULL_LANJUT_CONFIG_H</code> 。</p><p>更改 uboot 默认命令配置值：</p><ul><li><p>findfdt（用于设置 <code>fdt_file</code> 变量，根据 <code>board_name</code> 来指定<strong>传递给内核的设备树</strong>文件名）</p><pre><code>		&quot;findfdt=&quot;\
			&quot;if test $fdt_file = undefined; then &quot; \
				&quot;if test $board_name = ULZ-EVK &amp;&amp; test $board_rev = 14X14; then &quot; \
					&quot;setenv fdt_file imx6ulz-14x14-evk.dtb; fi; &quot; \
				&quot;if test $board_name = EVK &amp;&amp; test $board_rev = 9X9; then &quot; \
					&quot;setenv fdt_file imx6ull-9x9-evk.dtb; fi; &quot; \
				&quot;if test $board_name = EVK &amp;&amp; test $board_rev = 14X14; then &quot; \
					&quot;setenv fdt_file imx6ull-14x14-evk.dtb; fi; &quot; \
				&quot;if test $board_name = LANJUT &amp;&amp; test $board_rev = 14X14; then &quot; \
					&quot;setenv fdt_file imx6ull-14x14-lanjut.dtb; fi; &quot; \
				&quot;if test $fdt_file = undefined; then &quot; \
					&quot;echo WARNING: Could not determine dtb to use; &quot; \
				&quot;fi; &quot; \
			&quot;fi;\0&quot; \
</code></pre></li><li><p>findtee（用于设置 <code>tee_file</code> 变量，根据 <code>board_name</code> 来指定 uboot 设备树文件名）</p><pre><code>		&quot;findtee=&quot;\
			&quot;if test $tee_file = undefined; then &quot; \
				&quot;if test $board_name = ULZ-EVK &amp;&amp; test $board_rev = 14X14; then &quot; \
					&quot;setenv tee_file uTee-6ulzevk; fi; &quot; \
				&quot;if test $board_name = EVK &amp;&amp; test $board_rev = 9X9; then &quot; \
					&quot;setenv tee_file uTee-6ullevk; fi; &quot; \
				&quot;if test $board_name = EVK &amp;&amp; test $board_rev = 14X14; then &quot; \
					&quot;setenv tee_file uTee-6ullevk; fi; &quot; \
				&quot;if test $board_name = LANJUT &amp;&amp; test $board_rev = 14X14; then &quot; \
					&quot;setenv tee_file uTee-6ull_lanjut; fi; &quot; \
				&quot;if test $tee_file = undefined; then &quot; \
					&quot;echo WARNING: Could not determine tee to use; &quot; \
				&quot;fi; &quot; \
			&quot;fi;\0&quot; \
</code></pre></li></ul><h2 id="其它文件"><a class="anchor" href="#其它文件">#</a> 其它文件</h2><p>1、 <code>Makefile</code> 文件：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre>gedit arch/arm/dts/Makefile</pre></td></tr></table></figure><p><strong>修改：</strong></p><figure class="highlight makefile"><figcaption data-lang="makefile"></figcaption><table><tr><td data-num="1"></td><td><pre>dtb-<span class="token variable">$</span><span class="token punctuation">(</span>CONFIG_MX6ULL<span class="token punctuation">)</span> <span class="token operator">+=</span> \</pre></td></tr><tr><td data-num="2"></td><td><pre>	imx6ull-14x14-ddr3-val.dtb \</pre></td></tr><tr><td data-num="3"></td><td><pre>	imx6ull-14x14-ddr3-val-epdc.dtb \</pre></td></tr><tr><td data-num="4"></td><td><pre>	imx6ull-14x14-ddr3-val-emmc.dtb \</pre></td></tr><tr><td data-num="5"></td><td><pre>	imx6ull-14x14-ddr3-val-gpmi-weim.dtb \</pre></td></tr><tr><td data-num="6"></td><td><pre>	imx6ull-14x14-ddr3-val-tsc.dtb \</pre></td></tr><tr><td data-num="7"></td><td><pre>	imx6ull-14x14-evk.dtb \</pre></td></tr><tr><td data-num="8"></td><td><pre>	imx6ull-14x14-evk-emmc.dtb \</pre></td></tr><tr><td data-num="9"></td><td><pre>	imx6ull-14x14-evk-gpmi-weim.dtb \</pre></td></tr><tr><td data-num="10"></td><td><pre>	imx6ull-14x14-lanjut-emmc.dtb \  <span class="token comment"># 将设备树文件添加进编译项</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	imx6ull-9x9-evk.dtb \</pre></td></tr><tr><td data-num="12"></td><td><pre>	imx6ull-colibri.dtb \</pre></td></tr><tr><td data-num="13"></td><td><pre>	imx6ull-phytec-segin-ff-rdk-emmc.dtb \</pre></td></tr><tr><td data-num="14"></td><td><pre>	imx6ull-dart-6ul.dtb \</pre></td></tr><tr><td data-num="15"></td><td><pre>	imx6ull-somlabs-visionsom.dtb \</pre></td></tr><tr><td data-num="16"></td><td><pre>	imx6ulz-14x14-evk.dtb \</pre></td></tr><tr><td data-num="17"></td><td><pre>	imx6ulz-14x14-evk-emmc.dtb \</pre></td></tr><tr><td data-num="18"></td><td><pre>	imx6ulz-14x14-evk-gpmi-weim.dtb</pre></td></tr></table></figure><p>2、 <code>Kconfig</code> 文件：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td data-command="[root@localhost] $"></td><td><pre>gedit arch/arm/mach-imx/mx6/Kconfig</pre></td></tr></table></figure><p><strong>修改：</strong></p><p>在 <code>config TARGET_MX6ULL_14X14_EVK</code> 配置的下方添加：</p><pre><code class="language-makefilema">config TARGET_MX6ULL_14X14_LANJUT
	bool &quot;Support mx6ull_14x14_lanjut&quot;
	select BOARD_LATE_INIT
	select DM
	select DM_THERMAL
	select MX6ULL
	imply CMD_DM
</code></pre><p>在 <code>source &quot;board/freescale/mx6ullevk/Kconfig&quot;</code> 配置的下方添加：</p><figure class="highlight makefile"><figcaption data-lang="makefile"></figcaption><table><tr><td data-num="1"></td><td><pre>source <span class="token string">"board/freescale/mx6ull_lanjut/Kconfig"</span></pre></td></tr></table></figure><h1 id="定制外设"><a class="anchor" href="#定制外设">#</a> 定制外设</h1><p>1、 <code>mx6ull_14x14_lanjut_emmc_defconfig</code> 文件：</p><p>由于开发板上不需要用到 74lv595 芯片，因此取消与其相关的配置：</p><ul><li>找到 <code>CONFIG_DM_74X164=y</code> 改为 <code># CONFIG_DM_74X164 is not set</code> ，官网 EVK 开发板使用了一个 74LV594，这里没有使用所以屏蔽掉。</li><li>找到 <code>CONFIG_SOFT_SPI=y</code> 改为 <code># CONFIG_SOFT_SPI is not set</code> ，屏蔽掉软件模拟的 SPI，这是官方驱动 74LV594 用的，同样也是用不到。</li></ul><div class="tags"><a href="/tags/Linux/" rel="tag"><i class="ic i-tag"></i> Linux</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-06-08 00:33:53" itemprop="dateModified" datetime="2024-06-08T00:33:53+08:00">2024-06-08</time></span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="6ull-uboot-transplant/" class="item leancloud_visitors" data-flag-title="imx-6ULL uboot 移植" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span id="busuanzi_value_page_pv"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 投喂</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.webp" alt="夏沫の浅雨 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.webp" alt="夏沫の浅雨 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>夏沫の浅雨 <i class="ic i-at"><em>@</em></i>命运转轮</li><li class="link"><strong>本文链接：</strong> <a href="https://arachnid.cc/6ull-uboot-transplant/" title="imx-6ULL uboot 移植">https://arachnid.cc/6ull-uboot-transplant/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/virtual-network-setup/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(1).webp" title="vmware 下 ubuntu 双网卡设置"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>vmware 下 ubuntu 双网卡设置</h3></a></div><div class="item right"><a href="/6ull-kernel-transplant/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;arachnid.cc&#x2F;picture&#x2F;(16).webp" title="imx-6ULL kernel 移植"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>imx-6ULL kernel 移植</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">交叉编译器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#uboot-%E6%BA%90%E7%A0%81"><span class="toc-number">1.2.</span> <span class="toc-text">uboot 源码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E9%AA%8C%E8%AF%81"><span class="toc-number">2.</span> <span class="toc-text">编译验证</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%BB%E6%A4%8D"><span class="toc-number">3.</span> <span class="toc-text">移植</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%9D%BF%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">3.1.</span> <span class="toc-text">开发板文件夹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E6%A0%91%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">设备树文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E6%96%87%E4%BB%B6"><span class="toc-number">3.4.</span> <span class="toc-text">其它文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E5%A4%96%E8%AE%BE"><span class="toc-number">4.</span> <span class="toc-text">定制外设</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="夏沫の浅雨" data-src="/images/avatar.webp"><p class="name" itemprop="name">夏沫の浅雨</p><div class="description" itemprop="description">不曾亏欠，不曾辜负，如此足矣</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">77</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">5</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">20</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkLTk3" title="https:&#x2F;&#x2F;github.com&#x2F;Arachnid-97"><i class="ic i-github"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjM2MTA4MzU=" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;23610835"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友人帐</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-info-circle"></i>关于</a></li><li class="item"><a href="/atom.xml" rel="section"><i class="ic i-rss"></i>RSS</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/virtual-network-setup/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/6ull-kernel-transplant/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/modbus/" title="分类于 modbus">modbus</a></div><span><a href="/modbus-family" title="Modbus家族之开篇">Modbus家族之开篇<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/summary-of-keil-tool-use" title="关于 Keil 的一些总结性使用">关于 Keil 的一些总结性使用<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/altium-designer-summary" title="Altium Designer 常用总结">Altium Designer 常用总结<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/dmx512-protocol" title="DMX512 协议">DMX512 协议<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/C-pointer" title="对 C 指针的理解">对 C 指针的理解<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/linux-command-summary" title="Linux 命令简述总结">Linux 命令简述总结<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/linux-system-constitute" title="Linux 系统构成：bootloader、kernel、rootfs">Linux 系统构成：bootloader、kernel、rootfs<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/CPU-Soc-MCU" title="CPU、MPU、MCU、SoC、MCM 介绍">CPU、MPU、MCU、SoC、MCM 介绍<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/arch-linux-install" title="基于官方指导安装 Arch Linux">基于官方指导安装 Arch Linux<i class="ic i-link-alt"></i></a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/jtag-and-swd" title="JTAG 和 SWD 接口定义">JTAG 和 SWD 接口定义<i class="ic i-link-alt"></i></a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">夏沫の浅雨 @ Arachnid's blog</span></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="count"><span class="icon"><i class="ic i-person"></i> <span id="busuanzi_value_site_uv"></span>人 <span class="post-meta-divider">|</span> <span class="icon"><i class="ic i-eye"></i> <span id="busuanzi_value_site_pv"></span>次 <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">557k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">9:28</span></span></span></div><div class="create_time"><span class="icon"><i class="ic i-clock"></i> <span id="timeDate">正在加载</span> <span id="times">...</span><script>function createtime(){var n=new Date("04/28/2022 15:45:50");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML=" 本站存活 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></span></div><div class="powered-by">Powered-by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"6ull-uboot-transplant/",favicon:{show:"ψ(｀∇´)ψ 欢迎回来!",hide:"《原子弹入门及制造》"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',isOutdated:!0,format_year_as_prefix:"{{year}}年",format_month_as_prefix:"{{month}}个月",format_month_as_suffix:"零{{month}}个月",format_day_as_prefix:"{{day}}天",format_day_as_suffix:"零{{day}}天",template:"<div class='note warning'><p><span class='label primary'><strong>文章时效性提示</strong></span><br>这是一篇发布于 <span class='pink'>{{publish}}</span> 前，最后一次更新距今已经 <span class='pink'>{{updated}}</span> 的文章，部分内容可能已经过时，请注意甄别。</p></div>",ignores:[function(a){return a.includes("#")},function(a){return new RegExp(LOCAL.path+"$").test(a)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="/js/combined-file.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->