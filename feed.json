{
    "version": "https://jsonfeed.org/version/1",
    "title": "命运转轮",
    "description": "不曾亏欠, 不曾辜负, 如此足矣",
    "home_page_url": "https://arachnid.cc",
    "items": [
        {
            "id": "https://arachnid.cc/linux_c-exit-and-return/",
            "url": "https://arachnid.cc/linux_c-exit-and-return/",
            "title": "Linux c _exit()、exit(0)、exit(1) 与 return 区别详解",
            "date_published": "2024-07-07T09:14:39.000Z",
            "content_html": "<h1 id=\"功能\"><a class=\"anchor\" href=\"#功能\">#</a> 功能：</h1>\n<ul>\n<li>_exit () ：退出程序。</li>\n<li>exit（0）：运行正常退出程序；</li>\n<li>exit（1）：运行异常退出程序；</li>\n<li>return（）：返回函数，若在主函数中，则会退出函数并返回值。</li>\n</ul>\n<h1 id=\"_exit-和-exit-区别\"><a class=\"anchor\" href=\"#_exit-和-exit-区别\">#</a> _exit () 和 exit () 区别：</h1>\n<ul>\n<li>\n<p>exit () 会将缓冲区的数据写完再结束进程到内核中去（退出进程会清理 I/O 缓冲区）。</p>\n</li>\n<li>\n<p>_exit () 直接结束进程进入到内核中。</p>\n</li>\n<li>\n<p>exit () 函数定义在 stdlib.h 中，_exit () 定义在 unistd.h 中。</p>\n</li>\n<li>\n<p>图示：</p>\n<p><img data-src=\"/linux_c-exit-and-return/91748e224d81a92ab21cf272b5244e21.png\" alt=\"img\"></p>\n</li>\n</ul>\n<p>示例：</p>\n<p><strong>_exit()</strong></p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"OK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">_exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>输出结果：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>hello</pre></td></tr></table></figure><p><strong>exit()</strong></p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"OK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>输出结果：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>hello</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>OK</pre></td></tr></table></figure><p><strong>原因：</strong></p>\n<p>printf 函数使用的是缓冲 I/O 的方式，该函数在遇到  <code>\\n</code>  换行符时自动的从缓冲区中将记录读出。</p>\n<p>exit () 将缓冲区的数据写完后才能退出来，所以调用 exit () 函数后程序并不会马上退出，会把 OK 也输出出来。</p>\n<p>_exit () 是直接退出进入到内核中了。</p>\n<h1 id=\"exit0-和-exit1-区别\"><a class=\"anchor\" href=\"#exit0-和-exit1-区别\">#</a> exit (0) 和 exit (1) 区别：</h1>\n<ul>\n<li>exit (0)：运行正常退出程序。</li>\n<li>exit (1)：运行异常退出程序，返回值 1 是返回给操作系统的。</li>\n</ul>\n<h1 id=\"return-和-exit-区别\"><a class=\"anchor\" href=\"#return-和-exit-区别\">#</a> return 和 exit () 区别：</h1>\n<ul>\n<li>return 是关键字；exit () 是函数。</li>\n<li>return 是语言级别的，表示调用堆栈的返回；而 exit () 是系统调用级别的，表示进程的结束。</li>\n<li>return 是退出（返回）函数，将控制权移交给递归的前一级；exit () 是直接退出进程。</li>\n<li>在最初调用的 main 函数中调用 return 和 exit 的现象很模糊，非主函数中调用 return 和 exit 效果很明显。</li>\n</ul>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/zlist/",
            "url": "https://arachnid.cc/zlist/",
            "title": "zlist 链表分析",
            "date_published": "2024-06-06T12:51:29.000Z",
            "content_html": "<h1 id=\"数据结构定义\"><a class=\"anchor\" href=\"#数据结构定义\">#</a> 数据结构定义</h1>\n<h2 id=\"比较函数指针\"><a class=\"anchor\" href=\"#比较函数指针\">#</a> 比较函数指针</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span>zlist_compare_fn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"析构函数指针\"><a class=\"anchor\" href=\"#析构函数指针\">#</a> 析构函数指针</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">(</span>zlist_free_fn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"节点\"><a class=\"anchor\" href=\"#节点\">#</a> 节点</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_node_t</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">_node_t</span> <span class=\"token operator\">*</span>next<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 指向下一个节点</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item<span class=\"token punctuation\">;</span>             <span class=\"token comment\">// 节点当中的元素</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    zlist_free_fn <span class=\"token operator\">*</span>free_fn<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 元素对应的析构函数</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token class-name\">node_t</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"链表\"><a class=\"anchor\" href=\"#链表\">#</a> 链表</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">_zlist_t</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>head<span class=\"token punctuation\">;</span>                   <span class=\"token comment\">// 头节点</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>tail<span class=\"token punctuation\">;</span>                   <span class=\"token comment\">// 尾节点</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>cursor<span class=\"token punctuation\">;</span>                 <span class=\"token comment\">// 当前访问节点</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">size_t</span> size<span class=\"token punctuation\">;</span>                    <span class=\"token comment\">// 元素数量</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    bool autofree<span class=\"token punctuation\">;</span>                  <span class=\"token comment\">// 如果为真，使用默认析构元素，否则使用节点自带的析构</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    zlist_compare_fn <span class=\"token operator\">*</span>compare_fn<span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 自定义的比较函数回调，用来比较两个元素</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"函数定义\"><a class=\"anchor\" href=\"#函数定义\">#</a> 函数定义</h1>\n<h2 id=\"创建链表对象\"><a class=\"anchor\" href=\"#创建链表对象\">#</a> 创建链表对象</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* List constructor. */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">zlist_new</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token function\">zmalloc</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"销毁链表对象\"><a class=\"anchor\" href=\"#销毁链表对象\">#</a> 销毁链表对象</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* List destructor. */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">zlist_destroy</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>self_p<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self_p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>self_p<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>self_p<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token function\">zlist_purge</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token function\">freen</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token operator\">*</span>self_p <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"访问链表第一个元素\"><a class=\"anchor\" href=\"#访问链表第一个元素\">#</a> 访问链表第一个元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Return the item at the head of list. If the list is empty, returns NULL.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   Leaves cursor pointing at the head item, or NULL if the list is empty. */</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">zlist_first</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 将游标移动到链首位置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 返回链首元素</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>cursor<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> self<span class=\"token operator\">-></span>cursor<span class=\"token operator\">-></span>item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"访问链表下一个元素\"><a class=\"anchor\" href=\"#访问链表下一个元素\">#</a> 访问链表下一个元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Return the next item. If the list is empty, returns NULL. To move to</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   the start of the list call zlist_first (). Advances the cursor. */</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">zlist_next</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 将游标移动到下一个，如果是首次访问，那么设置为首节点</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>cursor<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>cursor<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 如果当前游标非空，那么返回里面的元素</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>cursor<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> self<span class=\"token operator\">-></span>cursor<span class=\"token operator\">-></span>item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"访问链表最后一个元素\"><a class=\"anchor\" href=\"#访问链表最后一个元素\">#</a> 访问链表最后一个元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Return the item at the tail of list. If the list is empty, returns NULL.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   Leaves cursor pointing at the tail item, or NULL if the list is empty. */</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">zlist_last</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 将游标移动到链尾位置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>tail<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 返回链尾元素</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>cursor<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> self<span class=\"token operator\">-></span>cursor<span class=\"token operator\">-></span>item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"访问链表当前元素\"><a class=\"anchor\" href=\"#访问链表当前元素\">#</a> 访问链表当前元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Return current item in the list. If the list is empty, or the cursor</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   passed the end of the list, returns NULL. Does not change the cursor. */</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">zlist_item</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 访问当前游标的元素</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>cursor<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> self<span class=\"token operator\">-></span>cursor<span class=\"token operator\">-></span>item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"添加链尾元素\"><a class=\"anchor\" href=\"#添加链尾元素\">#</a> 添加链尾元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Append an item to the end of the list, return 0 if OK or -1 if this</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   failed for some reason. */</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">int</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">zlist_append</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 构造节点</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>node <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token function\">zmalloc</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">node_t</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 如果支持自动回收，那么按字符串的形式申请内存并拷贝一份</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>autofree<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        item <span class=\"token operator\">=</span> <span class=\"token function\">strdup</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 新节点中保存元素</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    node<span class=\"token operator\">-></span>item <span class=\"token operator\">=</span> item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 当前链尾与新节点进行链接</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>tail<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        self<span class=\"token operator\">-></span>tail<span class=\"token operator\">-></span>next <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// 链尾是空说明是首次操作，链头指向节点</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        self<span class=\"token operator\">-></span>head <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// 新节点设为链尾</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    self<span class=\"token operator\">-></span>tail <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    node<span class=\"token operator\">-></span>next <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token comment\">// 链尾大小 + 1</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    self<span class=\"token operator\">-></span>size<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// 游标重置为空</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"添加链首元素\"><a class=\"anchor\" href=\"#添加链首元素\">#</a> 添加链首元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Push an item to the start of the list, return 0 if OK or -1 if this</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   failed for some reason. */</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">int</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">zlist_push</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>node <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token function\">zmalloc</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">node_t</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 如果支持自动回收，那么按字符串的形式申请内存并拷贝一份</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>autofree<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        item <span class=\"token operator\">=</span> <span class=\"token function\">strdup</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    node<span class=\"token operator\">-></span>item <span class=\"token operator\">=</span> item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 设置新节点的下 1 个节点是链首节点</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    node<span class=\"token operator\">-></span>next <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 链首属性设置为新节点</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    self<span class=\"token operator\">-></span>head <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// 如果链尾属性是空，说明是首次操作，设置为新节点</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>tail <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        self<span class=\"token operator\">-></span>tail <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    self<span class=\"token operator\">-></span>size<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"删除链首元素\"><a class=\"anchor\" href=\"#删除链首元素\">#</a> 删除链首元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Remove item from the beginning of the list, returns NULL if none. */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">zlist_pop</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>node <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 获得链首元素引用</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        item <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 链首指向下 1 个节点（这时节点已从链表中删除）</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        self<span class=\"token operator\">-></span>head <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 若链表里只有 1 个节点，那么链尾也置空</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>tail <span class=\"token operator\">==</span> node<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            self<span class=\"token operator\">-></span>tail <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// 释放已删除的节点</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token function\">freen</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 链表大小 - 1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        self<span class=\"token operator\">-></span>size<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 当前游标置空</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// 返回元素</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">return</span> item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"判断元素是否存在\"><a class=\"anchor\" href=\"#判断元素是否存在\">#</a> 判断元素是否存在</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Checks if an item already is present. Uses compare method to determine if</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   items are equal. If the compare method is NULL the check will only compare</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   pointers. Returns true if item is present else false. */</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>bool</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">zlist_exists</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>node <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 链表有自定义比较函数，那就用它来比较</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>compare_fn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>self<span class=\"token operator\">-></span>compare_fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item<span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token keyword\">return</span> true<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// 否则直接用双等号比较</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item <span class=\"token operator\">==</span> item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">return</span> true<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// 取下 1 个节点比较</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        node <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">return</span> false<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"查找并删除元素\"><a class=\"anchor\" href=\"#查找并删除元素\">#</a> 查找并删除元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Remove the item from the list, if present. Safe to call on items that</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   are not in the list. */</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">zlist_remove</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>node<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>prev <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 首先，我们通过遍历把这个节点找到</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span> node <span class=\"token operator\">!=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span> node <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>compare_fn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>self<span class=\"token operator\">-></span>compare_fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item<span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 找到了就跳出替换</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item <span class=\"token operator\">==</span> item<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// 每次保存遍历的节点，当下次找到，这个节点就是前节点</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        prev <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// 将删的节点已找到</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// 前节点指向节点的下 1 个节点</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            prev<span class=\"token operator\">-></span>next <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// 这里说明链表只有 1 个节点，链头设置为空</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            self<span class=\"token operator\">-></span>head <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">// 这里说明节点在链尾</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>next <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token comment\">// 前节点设置成链尾</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            self<span class=\"token operator\">-></span>tail <span class=\"token operator\">=</span> prev<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// 游标刚好指向节点</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">==</span> node<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 游标设置成前节点</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> prev<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">// 自动删除标志为真</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>autofree<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">// 释放当前节点的元素的内存空间</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token function\">freen</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token comment\">// 不为真就用节点析构函数（如果有）</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>free_fn<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>free_fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token comment\">// 释放节点本身的内存空间</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token function\">freen</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token comment\">// 元素总数减 1</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        self<span class=\"token operator\">-></span>size<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"复制链表对象\"><a class=\"anchor\" href=\"#复制链表对象\">#</a> 复制链表对象</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Make a copy of list. If the list has autofree set, the copied list will</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   duplicate all items, which must be strings. Otherwise, the list will hold</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   pointers back to the items in the original list. If list is null, returns</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   NULL. */</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">zlist_dup</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>copy <span class=\"token operator\">=</span> <span class=\"token function\">zlist_new</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>copy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>autofree<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token function\">zlist_autofree</span><span class=\"token punctuation\">(</span>copy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    copy<span class=\"token operator\">-></span>compare_fn <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>compare_fn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>node<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span> node<span class=\"token punctuation\">;</span> node <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">zlist_append</span> <span class=\"token punctuation\">(</span>copy<span class=\"token punctuation\">,</span> node<span class=\"token operator\">-></span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token function\">zlist_destroy</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>copy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">return</span> copy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"清理链表所有元素\"><a class=\"anchor\" href=\"#清理链表所有元素\">#</a> 清理链表所有元素</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Purge all items from list. */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">void</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">zlist_purge</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>node <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>next <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>self<span class=\"token operator\">-></span>autofree<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token function\">freen</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>free_fn<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>free_fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token function\">freen</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        node <span class=\"token operator\">=</span> next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    self<span class=\"token operator\">-></span>head <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    self<span class=\"token operator\">-></span>tail <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    self<span class=\"token operator\">-></span>cursor <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    self<span class=\"token operator\">-></span>size <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"获得链表大小\"><a class=\"anchor\" href=\"#获得链表大小\">#</a> 获得链表大小</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Return the number of items in the list. */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">size_t</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">zlist_size</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> self<span class=\"token operator\">-></span>size<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"链表排序\"><a class=\"anchor\" href=\"#链表排序\">#</a> 链表排序</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Sort the list. If the compare function is null, sorts the list by</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   ascending key value using a straight ASCII comparison. If you specify</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   a compare function, this decides how items are sorted. The sort is not</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   stable, so may reorder items with the same keys. The algorithm used is</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   combsort, a compromise between performance and simplicity. */</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">void</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">zlist_sort</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">,</span> zlist_compare_fn compare_fn<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    zlist_compare_fn <span class=\"token operator\">*</span>compare <span class=\"token operator\">=</span> compare_fn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>compare<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        compare <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>compare_fn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>compare<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            compare <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>zlist_compare_fn <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> strcmp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// 梳排序算法:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// 1. 算法从两个游标同时开始遍历</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// 2. 两个游标之间存在间隔 (gap)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 3. 第 1 个游标是链头，第 2 个游标按间隔计算</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// 4. 两个游标遍历的同时会交换元素</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 5. 每一轮至少需要交换 1 次</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// 6. 间隔每 1 轮按递减率 1.3 进行缩短</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// 7. 当间隔小于等于 1 或者交换 0 次时算法终止</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token class-name\">size_t</span> gap <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>size<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    bool swapped <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>gap <span class=\"token operator\">></span> <span class=\"token number\">1</span> <span class=\"token operator\">||</span> swapped<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>gap <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            gap <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">size_t</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span> gap <span class=\"token operator\">/</span> <span class=\"token number\">1.3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>base <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>test <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token class-name\">size_t</span> jump <span class=\"token operator\">=</span> gap<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>jump<span class=\"token operator\">--</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            test <span class=\"token operator\">=</span> test<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        swapped <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>base <span class=\"token operator\">&amp;&amp;</span> test<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>compare<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>base<span class=\"token operator\">-></span>item<span class=\"token punctuation\">,</span> test<span class=\"token operator\">-></span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token comment\">// 依据比较函数进行元素交换</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item <span class=\"token operator\">=</span> base<span class=\"token operator\">-></span>item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                base<span class=\"token operator\">-></span>item <span class=\"token operator\">=</span> test<span class=\"token operator\">-></span>item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                test<span class=\"token operator\">-></span>item <span class=\"token operator\">=</span> item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                swapped <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            base <span class=\"token operator\">=</span> base<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            test <span class=\"token operator\">=</span> test<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"设置比较函数\"><a class=\"anchor\" href=\"#设置比较函数\">#</a> 设置比较函数</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Sets a compare function for this list. The function compares two items.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   It returns an integer less than, equal to, or greater than zero if the</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   first item is found, respectively, to be less than, to match, or be</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   greater than the second item.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   This function is used for sorting, removal and exists checking. */</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">void</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">zlist_comparefn</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">,</span> zlist_compare_fn fn<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    self<span class=\"token operator\">-></span>compare_fn <span class=\"token operator\">=</span> fn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"设置元素销毁函数\"><a class=\"anchor\" href=\"#设置元素销毁函数\">#</a> 设置元素销毁函数</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Set a free function for the specified list item. When the item is</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   destroyed, the free function, if any, is called on that item.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   Use this when list items are dynamically allocated, to ensure that</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   you don't have memory leaks. You can pass 'free' or NULL as a free_fn.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   Returns the item, or NULL if there is no such item. */</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">zlist_freefn</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>item<span class=\"token punctuation\">,</span> zlist_free_fn fn<span class=\"token punctuation\">,</span> bool at_tail<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">node_t</span> <span class=\"token operator\">*</span>node <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>head<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// 给链尾设置析构函数，这个标志是为了提高算法效率</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>at_tail<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        node <span class=\"token operator\">=</span> self<span class=\"token operator\">-></span>tail<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 根据元素值遍历找节点并设置析构函数</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>item <span class=\"token operator\">==</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            node<span class=\"token operator\">-></span>free_fn <span class=\"token operator\">=</span> fn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">return</span> item<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        node <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"设置自动销毁状态\"><a class=\"anchor\" href=\"#设置自动销毁状态\">#</a> 设置自动销毁状态</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* Set list for automatic item destruction; item values MUST be strings.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   By default a list item refers to a value held elsewhere. When you set</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   this, each time you append or push a list item, zlist will take a copy</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   of the string value. Then, when you destroy the list, it will free all</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   item values automatically. If you use any other technique to allocate</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   list values, you must free them explicitly before destroying the list.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   The usual technique is to pop list items and destroy them, until the</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   list is empty. */</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">void</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">zlist_autofree</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">zlist_t</span> <span class=\"token operator\">*</span>self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">assert</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    self<span class=\"token operator\">-></span>autofree <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": []
        },
        {
            "id": "https://arachnid.cc/net-tools-vs-proute2/",
            "url": "https://arachnid.cc/net-tools-vs-proute2/",
            "title": "Linux 网络管理套件",
            "date_published": "2024-03-19T11:51:15.783Z",
            "content_html": "<h1 id=\"简述\"><a class=\"anchor\" href=\"#简述\">#</a> 简述</h1>\n<ul>\n<li>\n<p>net-tools 起源于 BSD 的 TCP/IP 工具箱，后来成为老版本 Linux 内核中配置网络功能的工具。但自 2001 年起，Linux 社区已经对其停止维护，甚至一些 Linux 发行版比如 Arch Linux 和 CentOS/RHEL 7 则已经完全抛弃了 net-tools，只支持 iproute2。</p>\n</li>\n<li>\n<p>iproute2 的出现旨在从功能上取代 net-tools，是目前主流 Linux 所配带的网络套件，同时提供 net-tools 下 ifconfig 和 route 命令所不具备的高级特性。</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>net-tools</th>\n<th>iproute2</th>\n<th>note</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ifconfig</td>\n<td>ip link</td>\n<td>Listing interfaces</td>\n</tr>\n<tr>\n<td>ifconfig -a</td>\n<td>ip addr</td>\n<td>Show addresses</td>\n</tr>\n<tr>\n<td>route</td>\n<td>ip route</td>\n<td>Routing tables</td>\n</tr>\n<tr>\n<td>arp</td>\n<td>ip neigh</td>\n<td>Neighbors</td>\n</tr>\n<tr>\n<td>iptunnel</td>\n<td>ip tunnel</td>\n<td>Tunnels</td>\n</tr>\n<tr>\n<td>nameif, ifrename</td>\n<td>ip link set name</td>\n<td>Rename network interfaces</td>\n</tr>\n<tr>\n<td>ipmaddr</td>\n<td>ip maddr</td>\n<td>Multicast</td>\n</tr>\n<tr>\n<td>netstat</td>\n<td>ss</td>\n<td>Show various networking statistics</td>\n</tr>\n<tr>\n<td>brctl</td>\n<td>bridge</td>\n<td>Handle bridge addresses and devices</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"基本对照\"><a class=\"anchor\" href=\"#基本对照\">#</a> 基本对照</h1>\n<h2 id=\"列出-active-网卡接口信息\"><a class=\"anchor\" href=\"#列出-active-网卡接口信息\">#</a> 列出 active 网卡接口信息</h2>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ifconfig</span></pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> <span class=\"token function\">link</span> show up</pre></td></tr></table></figure><h2 id=\"显示网络接口-ip-地址\"><a class=\"anchor\" href=\"#显示网络接口-ip-地址\">#</a> 显示网络接口 ip 地址</h2>\n<p>显示所有接口或指定接口（eg：eth0）的 ip 地址</p>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ifconfig</span> <span class=\"token parameter variable\">-a</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ifconfig</span> eht0</pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> a</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ip</span> addr show dev eth0</pre></td></tr></table></figure><h2 id=\"激活或禁止网络接口\"><a class=\"anchor\" href=\"#激活或禁止网络接口\">#</a> 激活或禁止网络接口</h2>\n<p>启动或关闭某个接口（eg：eth0）</p>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ifconfig</span> eth0 up/down</pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> up/down eth0</pre></td></tr></table></figure><h2 id=\"分配-ipv4ipv6-地址\"><a class=\"anchor\" href=\"#分配-ipv4ipv6-地址\">#</a> 分配 ipv4/ipv6 地址</h2>\n<p>给某个接口（eg：eth0）临时配置 ipv4/ipv6 地址，并加上子掩码</p>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ifconfig</span> eth0 <span class=\"token number\">192.168</span>.1.56 netmask <span class=\"token number\">255.255</span>.255.0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ifconfig</span> eth0 inet6 <span class=\"token function\">add</span> <span class=\"token number\">2002</span>:0db5:0:f102::1/64</pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> addr <span class=\"token function\">add</span> <span class=\"token number\">192.168</span>.1.56/24 dev eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ip</span> <span class=\"token parameter variable\">-6</span> addr <span class=\"token function\">add</span> <span class=\"token number\">2002</span>:0db5:0:f102::1/64 dev eth0</pre></td></tr></table></figure><h2 id=\"删除-ipv4ipv6-地址\"><a class=\"anchor\" href=\"#删除-ipv4ipv6-地址\">#</a> 删除 ipv4/ipv6 地址</h2>\n<p>就 ip 地址的移除而言，除了给接口分配全 0 地址外，net-tools 没有提供任何合适的方法来移除网络接口的 ipv4 地址。</p>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ifconfig</span> eth0 <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ifconfig</span> eth0 inet6 del <span class=\"token number\">2002</span>:0db5:0:f102::1/64</pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> addr del <span class=\"token number\">192.168</span>.1.56/24 dev eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ip</span> <span class=\"token parameter variable\">-6</span> addr del <span class=\"token number\">2002</span>:0db5:0:f102::1/64 dev eth0</pre></td></tr></table></figure><h2 id=\"修改-mac-地址\"><a class=\"anchor\" href=\"#修改-mac-地址\">#</a> 修改 MAC 地址</h2>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ifconfig</span> eth0 hw ether 00:AA:BB:CC:DD:EE</pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> <span class=\"token function\">link</span> <span class=\"token builtin class-name\">set</span> dev eth0 address 00:AA:BB:CC:DD:EE</pre></td></tr></table></figure><h2 id=\"查看套接字统计信息\"><a class=\"anchor\" href=\"#查看套接字统计信息\">#</a> 查看套接字统计信息</h2>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">netstat</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-l</span></pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ss</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ss <span class=\"token parameter variable\">-l</span></pre></td></tr></table></figure><h2 id=\"查看-arp-表\"><a class=\"anchor\" href=\"#查看-arp-表\">#</a> 查看 ARP 表</h2>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>arp <span class=\"token parameter variable\">-an</span></pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> n</pre></td></tr></table></figure><h2 id=\"添加-删除或查看多播地址\"><a class=\"anchor\" href=\"#添加-删除或查看多播地址\">#</a> 添加、删除或查看多播地址</h2>\n<p>对某个接口（eg：eth0）临时操作多播地址及查看</p>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ipmaddr <span class=\"token function\">add</span> <span class=\"token number\">33</span>:44:00:00:00:01 dev eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ipmaddr del <span class=\"token number\">33</span>:44:00:00:00:01 dev eth0</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ipmaddr show dev eth0</pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> maddr <span class=\"token function\">add</span> <span class=\"token number\">33</span>:44:00:00:00:01 dev eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ip</span> maddr del <span class=\"token number\">33</span>:44:00:00:00:01 dev eth0</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">ip</span> maddr list dev eth0</pre></td></tr></table></figure><h2 id=\"查看-ip-路由表\"><a class=\"anchor\" href=\"#查看-ip-路由表\">#</a> 查看 ip 路由表</h2>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>route <span class=\"token parameter variable\">-n</span></pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> route</pre></td></tr></table></figure><h2 id=\"添加或修改默认路由\"><a class=\"anchor\" href=\"#添加或修改默认路由\">#</a> 添加或修改默认路由</h2>\n<p>对某个接口（eg：eth0）添加或修改默认路由</p>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>route add/del default gw <span class=\"token number\">192.168</span>.10.1 eth0</pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> route add/del default via <span class=\"token number\">192.168</span>.10.1 dev eth0</pre></td></tr></table></figure><h2 id=\"添加或删除静态路由\"><a class=\"anchor\" href=\"#添加或删除静态路由\">#</a> 添加或删除静态路由</h2>\n<p>对某个接口（eg：eth0）添加或删除静态路由</p>\n<ul>\n<li>net-tools</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>route <span class=\"token function\">add</span> <span class=\"token parameter variable\">-net</span> <span class=\"token number\">172.14</span>.32.0/24 gw <span class=\"token number\">192.168</span>.1.1 dev eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>route del <span class=\"token parameter variable\">-net</span> <span class=\"token number\">172.14</span>.32.0/24</pre></td></tr></table></figure><ul>\n<li>iproute2</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ip</span> route <span class=\"token function\">add</span> <span class=\"token number\">172.14</span>.32.0/24 via <span class=\"token number\">192.168</span>.1.1 dev eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ip</span> route del <span class=\"token number\">172.14</span>.32.0/24</pre></td></tr></table></figure><h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3Vndml0YWxlLndvcmRwcmVzcy5jb20vMjAxMS8xMi8yMS9kZXByZWNhdGVkLWxpbnV4LW5ldHdvcmtpbmctY29tbWFuZHMtYW5kLXRoZWlyLXJlcGxhY2VtZW50cy8=\">https://dougvitale.wordpress.com/2011/12/21/deprecated-linux-networking-commands-and-their-replacements/</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmF0dXJpbi5vcmcvZG9jcy9pcHJvdXRlMi8=\">https://www.baturin.org/docs/iproute2/</span></p>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/linux-network-config-tool/",
            "url": "https://arachnid.cc/linux-network-config-tool/",
            "title": "Linux 网络一探究竟",
            "date_published": "2024-03-06T12:46:05.793Z",
            "content_html": "<h1 id=\"常见网络配置工具包\"><a class=\"anchor\" href=\"#常见网络配置工具包\">#</a> 常见网络配置工具包</h1>\n<p>配置「Linux 操作系统」的网络有以下几款主流的配置工具可供选择：</p>\n<table>\n<thead>\n<tr>\n<th>配置工具</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW5wYWdlcy5kZWJpYW4ub3JnL2J1c3Rlci9pZnVwZG93bi9pbnRlcmZhY2VzLjUuZW4uaHRtbA==\">ifupdown</span></td>\n<td>用来启动 / 关闭网络的标准工具（Debian 及部分衍生版本特有），配置文件在  <code>/etc/network/interfaces</code> 。</td>\n</tr>\n<tr>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvU3lzdGVtZC1uZXR3b3JrZA==\">systemd-networkd</span></td>\n<td>systemd 是许多发行版默认的 kernel 程序，其中 systemd-networkd 组件可用于网络配置管理，配置文件在  <code>/etc/systemd/network/</code> 。</td>\n</tr>\n<tr>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvTmV0d29ya01hbmFnZXI=\">NetworkManager</span></td>\n<td>一个为桌面版提供的图形化前端工具，也可以使用内嵌的  <code>nmcli</code>  和  <code>nmtui</code>  进行配置。</td>\n</tr>\n<tr>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZXRwbGFuLmlvLw==\">netplan</span></td>\n<td>通过 YAML 文件管理网络配置，支持 systemd-networkd 和 NetworkManager 作为后端程序，配置文件在  <code>/etc/netplan/*.yaml</code> 。</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"ifupdown\"><a class=\"anchor\" href=\"#ifupdown\">#</a> ifupdown</h1>\n<p><code>ifupdown</code>  网络管理器一直以来都是 Debian 默认使用的网络管理器。大多数教程描述的配置  <code>/etc/network/interfaces</code>  文件就是来自于对  <code>ifupdown</code>  网络的管理。</p>\n<p>与早期版本的 Red Hat 发行版类似，Debian 把网络配置写在一个文件内，并从文件内加载配置。</p>\n<p>但与 Red Hat 系发行版不同的是，Red Hat 发行版将不同的网卡配置文件保存在  <code>/etc/sysconfig/network-scripts/</code>  文件夹中，而 Debian 则将网卡配置统一写在  <code>/etc/network/interfaces</code>  文件中。</p>\n<p>同样的，像 Debian 的衍生版本也会延续将网络配置文件统一写在  <code>/etc/network/interfaces</code>  文件中，例如早期的 Ubuntu 系统，而在 Ubuntu 18.04 LTS 后将使用  <code>netplan</code>  命令和基于  <code>/etc/netplan/*.yaml</code>  文件的配置方法；如果在 Ubuntu 18 上打开  <code>/etc/network/interfaces</code>  文件将会看到提示，而 Ubuntu 20 上则已经完全移除了  <code>/etc/network/interfaces</code>  文件。</p>\n<p>对于  <code>ifupdown</code>  的文件配置，虽然系统默认的网络配置文件是在  <code>/etc/network/interfaces</code>  文件中，但 Debian 给出的最佳实现是将网络配置保存到  <code>/etc/network/interface.d/</code>  下；一些常规的配置如下：</p>\n<ul>\n<li>\n<p>使用 DHCP 自动配置接口</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>auto eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>allow-hotplug eth0</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>iface eth0 inet dhcp\t# ipv4 DHCP 模式</pre></td></tr><tr><td data-num=\"4\"></td><td><pre># iface eth0 inet6 dhcp/auto\t# ipv6 DHCP 或 Auto 模式</pre></td></tr></table></figure></li>\n<li>\n<p>使用静态 IP 配置接口</p>\n<p>ipv4：</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>auto eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>iface eth0 inet static</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\taddress 192.0.2.7/24</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tnetmask 255.255.255.0</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tgateway 192.0.2.254</pre></td></tr></table></figure><p>ipv6：</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>auto eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>iface eth0 inet6 static</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\taddress 2001:db8::c0ca:1eaf/64</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tnetmask 64</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tgateway 2001:db8::1ead:ed:beef</pre></td></tr></table></figure></li>\n<li>\n<p>设置 DNS</p>\n<p>如果你要直接 ping 域名就需要开启 DNS 服务，在这里有两种方法：</p>\n<p>一种是修改  <code>/etc/resolv.conf</code>  文件，添加需要配置的 DNS，例如添加两个 DNS 服务：</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nameserver 8.8.8.8</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>nameserver 114.114.114.114</pre></td></tr></table></figure><p>另一种是直接编辑  <code>/etc/network/interfaces</code>  文件，但这种需要  <code>resolvconf</code>  程序的支持：</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>auto eth0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>iface eth0 inet static</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\taddress 192.0.2.7/24</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tnetmask 255.255.255.0</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tgateway 192.0.2.254</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tdns-nameservers 8.8.8.8 114.114.114.114\t# 此行便是用作 DNS 解析，对于多个解析地址，应共用一行并用空格区分</pre></td></tr></table></figure><p>note：这两种方法各有缺点， <code>/etc/resolv.conf</code>  中的 DNS 配置将会被 C 库或其它解析器库所查找并解析 DNS 服务，同时该文件还会被 resolvconf、network-manager 及 DHCP 客户端修改所覆盖；而在  <code>/etc/network/interfaces</code>  上编辑，则需要提供  <code>resolvconf</code>  程序，可以使用  <code>which resolvconf</code>  命令查看是否存在，否者将要进行下载才可使用。</p>\n</li>\n<li>\n<p>网络接口生效</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>systemctl restart networking</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ifdown</span> eth0 <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">ifup</span> eth0</pre></td></tr></table></figure></li>\n</ul>\n<p>tips：</p>\n<p>在  <code>/etc/network/interfaces</code>  文件中一般用  <code>auto</code>  或者  <code>allow-hotplug</code>  来定义接口的启动行为。</p>\n<ul>\n<li>auto：在系统启动的时候启动网络接口，无论网络接口有无连接（插入网线）；如果该接口配置了 DHCP，则无论有无网线，系统都会去执行 DHCP，如果没有插入网线，则等该接口超时后才会继续。</li>\n<li>allow-hotplug：只有当内核从该接口检测到热插拔事件后才启动该接口。如果系统开机时该接口没有插入网线，则系统不会启动该接口，系统启动后，如果插入网线，系统会自动启动该接口（也就是将网络接口设置为热插拔模式），但是值得注意的是，重启  <code>networking</code>  之后网卡不能自动重启。</li>\n</ul>\n<h1 id=\"systemd-networkd\"><a class=\"anchor\" href=\"#systemd-networkd\">#</a> systemd-networkd</h1>\n<p><code>systemd-networkd</code>  网络管理器是  <code>systemd</code>  软件包其中的一个组件，目前一些主流的 Linux 系统都内置着  <code>systemd</code>  包，像 Arch、Debian、Ubuntu 等。</p>\n<ul>\n<li>\n<p>静态 IP 配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 启动 \"ens37\" 接口并配置一个静态地址。 此处设置的网关将被用作默认路由。</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> /etc/systemd/network/10-static-ens37.network <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>[Match]</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>Name=ens37</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>[Network]</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>Address=192.168.0.2/24</pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre>Gateway=192.168.0.1</pre></td></tr><tr><td data-num=\"9\"></td><td data-command></td><td><pre>DNS=192.168.0.1</pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre>EOF</pre></td></tr></table></figure></li>\n<li>\n<p>DHCP 配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 在所有名字以 \"en\" 开头的接口 (也就是以太网接口) 上开启 DHCPv4 与 DHCPv6</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> /etc/systemd/network/10-dhcp-en.network <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>[Match]</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>Name=en*</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>[Network]</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>DHCP=yes</pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre>EOF</pre></td></tr></table></figure></li>\n<li>\n<p>服务启动</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>systemctl start systemd-networkd</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> systemd-networkd</pre></td></tr></table></figure></li>\n</ul>\n<p>剩下的这里就不详细阐述了，说一下值得注意的点吧：</p>\n<ul>\n<li>如果 <em>.network</em> 文件中指定了 DNS 条目，则 <em>systemd-resolved</em> 服务是必需的， <span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvc3lzdGVtZC1yZXNvbHZlZA==\">systemd-resolved</span> 是可选的，它是一个为本地应用程序提供网络名称（DNS）解析服务。</li>\n<li>配置文件位于  <code>/usr/lib/systemd/network</code> ，非持久化的运行时网络配置目录位于  <code>/run/systemd/network</code>  ，本地管理网络配置位于  <code>/etc/systemd/network</code> 。 <code>/etc/systemd/network</code>  中的配置文件具有最高优先级。</li>\n<li>如果某个网络接口既没有配置静态 IPv6 地址、也没有启用 DHCPv6 或 IPv6LL 的话， 将会被视为禁用 IPv6 支持。同时，systemd 将会自动向  <code>/proc/sys/net/ipv6/conf/if_name/disable_ipv6</code>  中写入 &quot;1&quot;，以彻底禁用此接口上的 IPv6 支持。</li>\n</ul>\n<p>ref：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eGNuLm9yZy93aWtpL1N5c3RlbWQtbmV0d29ya2Q=\">https://wiki.archlinuxcn.org/wiki/Systemd-networkd</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmRlYmlhbi5vcmcvU3lzdGVtZE5ldHdvcmtk\">https://wiki.debian.org/SystemdNetworkd</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamluYnVndW8uY29tL3N5c3RlbWQvc3lzdGVtZC5uZXR3b3JrLmh0bWw=\">https://www.jinbuguo.com/systemd/systemd.network.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saXNvbmdtaW4uZ2l0aHViLmlvL29zLXN5c3RlbWQtbmV0d29ya2Qv\">https://lisongmin.github.io/os-systemd-networkd/</span></p>\n<h1 id=\"networkmanager\"><a class=\"anchor\" href=\"#networkmanager\">#</a> NetworkManager</h1>\n<p><code>NetworkManager</code>  是一个为系统提供检测和配置功能以便自动连接到网络的程序。 <code>NetworkManager</code>  的功能对无线和有线网络都很有用。其有两个组件：</p>\n<ol>\n<li>一个以超级用户运行的守护进程（network-manager）；</li>\n<li>一个前端管理程序（network-manager-gnome、network-manager-kde 或者 cnetworkmanager）。</li>\n</ol>\n<p><strong>默认情况下， <code>NetworkManager</code>  不接管任何  <code>/etc/network/interfaces</code>  里配置的网络接口，而对于已经在  <code>/etc/network/interfaces</code>  中声明过的网络接口，在 Desktop 环境上你会看到  <code>NetworkManager</code>  菜单中相应的网络接口显示 “device not managed”，但如果使用  <code>NetworkManager</code>  的  <code>nmcli</code>  或  <code>nmtui</code>  工具去配置  <code>/etc/network/interfaces</code>  中声明过的网络接口，可能会对该网卡造成冲突（包括其它的网络配置服务共存也将导致冲突）。</strong></p>\n<p>如果希望  <code>NetworkManager</code>  接管在  <code>/etc/network/interfaces</code>  配置了的网络接口，则进行以下操作：</p>\n<ol>\n<li>\n<p>在  <code>/etc/NetworkManager/NetworkManager.conf</code>  里把  <code>[ifupdown]</code>  中的  <code>managed</code>  属性修改为此设置  <code>managed=true</code> ；如果有手动改过  <code>/etc/network/interfaces</code> ，那么  <code>NetworkManager</code>  会自行把这行改成： <code>managed=false</code> ；</p>\n</li>\n<li>\n<p>以 root 形式重新启动  <code>NetworkManager</code>  服务： <code>sudo systemctl restart NetworkManager</code> 。</p>\n</li>\n</ol>\n<p><code>NetworkManager</code>  除了给 Desktop 环境带来图形操作，还内置提供了一个命令行界面（nmcli）和一个基于 curses 的界面（nmtui）这两个工具：</p>\n<ul>\n<li>nmcli</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 查看 nmcli 使用说明</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>nmcli <span class=\"token parameter variable\">--help</span></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>Usage: nmcli <span class=\"token punctuation\">[</span>OPTIONS<span class=\"token punctuation\">]</span> OBJECT <span class=\"token punctuation\">&#123;</span> COMMAND <span class=\"token operator\">|</span> <span class=\"token builtin class-name\">help</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre>OPTIONS</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>  -a, <span class=\"token parameter variable\">--ask</span>                                ask <span class=\"token keyword\">for</span> missing parameters</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>  -c, <span class=\"token parameter variable\">--colors</span> auto<span class=\"token operator\">|</span><span class=\"token function\">yes</span><span class=\"token operator\">|</span>no                 whether to use colors <span class=\"token keyword\">in</span> output</pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre>  -e, <span class=\"token parameter variable\">--escape</span> <span class=\"token function\">yes</span><span class=\"token operator\">|</span>no                      escape columns separators <span class=\"token keyword\">in</span> values</pre></td></tr><tr><td data-num=\"9\"></td><td data-command></td><td><pre>  -f, <span class=\"token parameter variable\">--fields</span> <span class=\"token operator\">&lt;</span>field,<span class=\"token punctuation\">..</span>.<span class=\"token operator\">>|</span>all<span class=\"token operator\">|</span>common      specify fields to output</pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre>  -g, --get-values <span class=\"token operator\">&lt;</span>field,<span class=\"token punctuation\">..</span>.<span class=\"token operator\">>|</span>all<span class=\"token operator\">|</span>common  shortcut <span class=\"token keyword\">for</span> <span class=\"token parameter variable\">-m</span> tabular <span class=\"token parameter variable\">-t</span> <span class=\"token parameter variable\">-f</span></pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre>  -h, <span class=\"token parameter variable\">--help</span>                               print this <span class=\"token builtin class-name\">help</span></pre></td></tr><tr><td data-num=\"12\"></td><td data-command></td><td><pre>  -m, <span class=\"token parameter variable\">--mode</span> tabular<span class=\"token operator\">|</span>multiline             output mode</pre></td></tr><tr><td data-num=\"13\"></td><td data-command></td><td><pre>  -o, <span class=\"token parameter variable\">--overview</span>                           overview mode</pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre>  -p, <span class=\"token parameter variable\">--pretty</span>                             pretty output</pre></td></tr><tr><td data-num=\"15\"></td><td data-command></td><td><pre>  -s, --show-secrets                       allow displaying passwords</pre></td></tr><tr><td data-num=\"16\"></td><td data-command></td><td><pre>  -t, <span class=\"token parameter variable\">--terse</span>                              terse output</pre></td></tr><tr><td data-num=\"17\"></td><td data-command></td><td><pre>  -v, <span class=\"token parameter variable\">--version</span>                            show program version</pre></td></tr><tr><td data-num=\"18\"></td><td data-command></td><td><pre>  -w, <span class=\"token parameter variable\">--wait</span> <span class=\"token operator\">&lt;</span>seconds<span class=\"token operator\">></span>                     <span class=\"token builtin class-name\">set</span> <span class=\"token function\">timeout</span> waiting <span class=\"token keyword\">for</span> finishing operations</pre></td></tr><tr><td data-num=\"19\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td data-command></td><td><pre>OBJECT</pre></td></tr><tr><td data-num=\"21\"></td><td data-command></td><td><pre>  g<span class=\"token punctuation\">[</span>eneral<span class=\"token punctuation\">]</span>       NetworkManager<span class=\"token string\">'s general status and operations</span></pre></td></tr><tr><td data-num=\"22\"></td><td data-command></td><td><pre>  n[etworking]    overall networking control</pre></td></tr><tr><td data-num=\"23\"></td><td data-command></td><td><pre>  r[adio]         NetworkManager radio switches</pre></td></tr><tr><td data-num=\"24\"></td><td data-command></td><td><pre>  c[onnection]    NetworkManager's connections</pre></td></tr><tr><td data-num=\"25\"></td><td data-command></td><td><pre>  d<span class=\"token punctuation\">[</span>evice<span class=\"token punctuation\">]</span>        devices managed by NetworkManager</pre></td></tr><tr><td data-num=\"26\"></td><td data-command></td><td><pre>  a<span class=\"token punctuation\">[</span>gent<span class=\"token punctuation\">]</span>         NetworkManager secret agent or polkit agent</pre></td></tr><tr><td data-num=\"27\"></td><td data-command></td><td><pre>  m<span class=\"token punctuation\">[</span>onitor<span class=\"token punctuation\">]</span>       monitor NetworkManager changes</pre></td></tr></table></figure><ul>\n<li>nmtui</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 查看 NetworkManager 是否启动</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>nmcli networking</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>enabled</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre><span class=\"token comment\"># 调出伪图形界面，然后根据选项编辑网络配置，最后启用网络连接。</span></pre></td></tr><tr><td data-num=\"5\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>nmtui</pre></td></tr></table></figure><p><img data-src=\"/linux-network-config-tool/FQ0$U9UCJOL_LF_H%7B5%7D3Z41-1709729923652.jpg\" alt=\"img\"></p>\n<p>note：</p>\n<p>一些  <code>NetworkManager</code>  网络命令处理：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 重启服务</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>systemctl restart NetworkManager</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre><span class=\"token comment\"># 查看开机自启是否启用</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>systemctl list-unit-files <span class=\"token parameter variable\">--type</span> <span class=\"token function\">service</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> NetworkManager</pre></td></tr></table></figure><p>附：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmRlYmlhbi5vcmcvemhfQ04vTmV0d29ya01hbmFnZXI=\">https://wiki.debian.org/zh_CN/NetworkManager</span></p>\n<h1 id=\"netplan\"><a class=\"anchor\" href=\"#netplan\">#</a> netplan</h1>\n<p>netplan 是 Canonical (Ubuntu) 开发的，作为某些 Linux 发行版（主力为 ubuntu Linux 发行版）上默认的网络配置命令行工具。netplan 使用 YAML 描述文件来配置网络，然后，通过这些描述为任何给定的底层呈现工具（主要就是  <code>systemd-networkd</code>  和  <code>networkmanager</code>  二种工具）生成必要的配置选项。在 Ubuntu 17.10 引入 netplan 作为 network 的替代品，Ubuntu 20.04 正式使用 netplan 作为网络配置工具。</p>\n<p><img data-src=\"/linux-network-config-tool/a1a80854-netplan_design_overview.svg\" alt=\"img\"></p>\n<p>A、指定 NetworkManager 接管网络</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cat</span> /etc/systemd/network/xxx.yaml</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre><span class=\"token comment\"># Let NetworkManager manage all devices on this system</span></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>network:</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>  version: <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre>  renderer: NetworkManager</pre></td></tr></table></figure><p>最后就可以使用可视化界面配置网络了，一般像在桌面上使用无线连接就会很方便，而不用使用  <code>iw</code>  等命令搜索 WiFi 然后指定 SSID 这么麻烦。</p>\n<p>B、指定 systemd-networkd 接管网络</p>\n<ul>\n<li>\n<p>ipv4 DHCP</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">network</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">renderer</span><span class=\"token punctuation\">:</span> networkd</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">ethernets</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">ens33</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">dhcp4</span><span class=\"token punctuation\">:</span> yes</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">dhcp4-overrides</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">route-metric</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr></table></figure></li>\n<li>\n<p>单网卡多网段</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">network</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">renderer</span><span class=\"token punctuation\">:</span> networkd</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">ethernets</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">ens33</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> 192.168.1.20/24</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">-</span> 192.168.50.20/24</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     <span class=\"token key atrule\">nameservers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>       <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>8.8.8.8<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">to</span><span class=\"token punctuation\">:</span> 0.0.0.0/0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">via</span><span class=\"token punctuation\">:</span> 192.168.1.1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token key atrule\">metric</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">to</span><span class=\"token punctuation\">:</span> 0.0.0.0/0</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token key atrule\">via</span><span class=\"token punctuation\">:</span> 192.168.50.1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token key atrule\">metric</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span></pre></td></tr></table></figure></li>\n<li>\n<p>桥接</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">network</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">renderer</span><span class=\"token punctuation\">:</span> networkd</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">ethernets</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">enp3s0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">dhcp4</span><span class=\"token punctuation\">:</span> yes</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">bridges</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">br0</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">interfaces</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>enp3s0<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">dhcp4</span><span class=\"token punctuation\">:</span> no</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">-</span> 192.168.1.20/24</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>       <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">to</span><span class=\"token punctuation\">:</span> 0.0.0.0/0</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>         <span class=\"token key atrule\">via</span><span class=\"token punctuation\">:</span> 192.168.1.1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token key atrule\">metric</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">nameservers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token key atrule\">addresses</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>8.8.8.8<span class=\"token punctuation\">]</span></pre></td></tr></table></figure></li>\n</ul>\n<p>命令：</p>\n<ul>\n<li>\n<p>netplan generate</p>\n<p>将  <code>yaml</code>  文件中的设置转换为适合正在使用的渲染器的配置，但不应用它们。</p>\n</li>\n<li>\n<p>netplan apply<br>\n 应用配置，使配置生效；会自动调用  <code>netplan generate</code> 。</p>\n</li>\n<li>\n<p>netplan try<br>\n 测试配置，然后等待用户的确认；如果取消确认或超时退出则自动恢复配置，注意不是恢复配置文件。</p>\n</li>\n</ul>\n<p>note：</p>\n<p><strong>注意在  <code>/etc/netplan</code>  目录下，有多个  <code>yaml</code>  文件存在时，netplan 是根据字母表排序，挨个生效的，后面的  <code>yaml</code>  指定的配置会覆盖前面的  <code>yaml</code>  指定的配置。</strong></p>\n<p><strong> <code>netplan</code>  会一次从以下 3 个位置读取配置文件，并且按照优先级，仅有一个位置的配置文件生效：</strong></p>\n<ul>\n<li><strong> <code>/run/netplan</code>  优先级最高</strong></li>\n<li><strong> <code>/etc/netplan</code>  次优先级</strong></li>\n<li><strong> <code>/lib/netplan</code>  最低优先级</strong></li>\n</ul>\n<p>ref：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC1hdGxhcy5yZWFkdGhlZG9jcy5pby96aC1jbi9sYXRlc3QvbGludXgvdWJ1bnR1X2xpbnV4L25ldHdvcmsvbmV0cGxhbi5odG1s\">https://cloud-atlas.readthedocs.io/zh-cn/latest/linux/ubuntu_linux/network/netplan.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmljc3lzLmNvbS50dy96aC1oYW5zL3RlY2gvdWIvdWItbmV0d29yay5odG1s\">https://www.vicsys.com.tw/zh-hans/tech/ub/ub-network.html</span></p>\n<h1 id=\"other\"><a class=\"anchor\" href=\"#other\">#</a> other</h1>\n<p>其他包含网络配置的重要文件，但我们在这里不会碰到他们：</p>\n<ul>\n<li><code>/etc/hosts</code>  - 操作系统中使用的计算机文件，用于将主机名映射到 IP 地址。 <code>hosts</code>  文件是一个纯文本文件，通常按照惯例命名为  <code>hosts</code> 。</li>\n<li><code>/etc/hostname</code>  - 分配给连接到计算机网络的设备的标签，并用于识别各种形式的电子通信设备。</li>\n<li><code>/etc/resolv.conf</code>  - 各种操作系统中的计算机文件，用于配置域名系统（DNS）解析器库。该文件是纯文本文件，通常由网络管理员或管理系统配置任务的应用创建。因此  <code>/etc/resolv.conf</code>  是依据网络管理产生，修改  <code>resolv.conf</code>  只在本次有作用，重启服务将会重置。</li>\n</ul>\n<h1 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h1>\n<p>桌面环境建议使用 NetworkManager；在服务器上建议使用默认的配置工具 network，或者切换到 systemd-networkd；但是只能选取其一。除了 network 不支持无线配置，其余三个都支持。</p>\n<h2 id=\"关于-networkmanager-与-systemd-networkd-之间的切换\"><a class=\"anchor\" href=\"#关于-networkmanager-与-systemd-networkd-之间的切换\">#</a> 关于 NetworkManager 与 systemd-networkd 之间的切换</h2>\n<p>A、停用 Network Manager 并激活 systemd-networkd</p>\n<ul>\n<li>\n<p>停止并禁用 NetworkManager：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> systemctl stop NetworkManager</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> systemctl disable NetworkManager</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> systemctl mask NetworkManager</pre></td></tr></table></figure></li>\n<li>\n<p>启动和激活 systemd-networkd：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> systemctl unmask systemd-networkd</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> systemd-networkd</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> systemctl start systemd-networkd</pre></td></tr></table></figure></li>\n</ul>\n<p>B、激活 NetworkManager 关闭 systemd-networkd</p>\n<ul>\n<li>\n<p>停止并禁用 systemd-networkd：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> systemctl disable systemd-networkd</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> systemctl mask systemd-networkd</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> systemctl stop systemd-networkd</pre></td></tr></table></figure></li>\n<li>\n<p>启动和激活 NetworkManager：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> systemctl unmask NetworkManager</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> NetworkManager</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> systemctl start NetworkManager</pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"关于-netplan-指定-renderer\"><a class=\"anchor\" href=\"#关于-netplan-指定-renderer\">#</a> 关于 netplan 指定 renderer</h2>\n<p>在  <code>/etc/netplan</code>  目录下将配置文件  <code>.yaml</code>  中的  <code>renderer</code>  字段更改为需要的后端工具：</p>\n<ul>\n<li>\n<p>NetworkManager</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">network</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">renderer</span><span class=\"token punctuation\">:</span> NetworkManager</pre></td></tr></table></figure></li>\n<li>\n<p>systemd-networkd</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">network</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">renderer</span><span class=\"token punctuation\">:</span> networkd</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">ethernets</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    enxx：</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">...</span></pre></td></tr></table></figure></li>\n</ul>\n<p>最后执行： <code>netplan apply</code> ；如果使用  <code>NetworkManager</code>  则不需要编写后面的  <code>ethernets</code>  字段了，完全交由 GUI 界面操作；而如果  <code>renderer</code>  指定  <code>networkd</code>  ，则为  <code>ethernets</code>  编写对应的网卡配置信息，以使  <code>netplan</code>  配置到  <code>systemd-networkd</code>  工具上。</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvTmV0d29ya19jb25maWd1cmF0aW9u\">https://wiki.archlinux.org/title/Network_configuration</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmRlYmlhbi5vcmcvTmV0d29ya0NvbmZpZ3VyYXRpb24=\">https://wiki.debian.org/NetworkConfiguration</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4teGlhby5naXRib29rLmlvL2RlYmlhbi9jb25maWcvbmV0d29yaw==\">https://pan-xiao.gitbook.io/debian/config/network</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9pdGJvb24uZ2l0aHViLmlvL2xpbnV4LTIwL25ldHdvcmsvY29uZmlndXJhdGlvbi8=\">https://itboon.github.io/linux-20/network/configuration/</span></p>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/linux-environment-variables/",
            "url": "https://arachnid.cc/linux-environment-variables/",
            "title": "Linux 环境变量的增删改",
            "date_published": "2024-03-01T12:54:01.000Z",
            "content_html": "<h1 id=\"shell-和-bash\"><a class=\"anchor\" href=\"#shell-和-bash\">#</a> shell 和 bash</h1>\n<p>在计算机科学中，shell 俗称壳（用来区别于核，核是指 “内核”），shell 是指 “提供使用者使用界面” 的软件（命令解析器）。它类似于  <code>DOS</code>  下的  <code>command.com</code>  和后来的  <code>cmd.exe</code> 。它接收用户命令，然后调用相应的应用程序。</p>\n<p>在很多并不正式的场合，这两个名词表达的意思相同，即命令解释器。但从严格的意义上讲，命令行是指供用户输入命令的界面，其本身只是接受输入，然后把命令传递给命令解释器，后者就是 shell，从本质上讲，shell 是一个程序，它在用户和操作系统之间提供了一个面向行的可交互接口，用户在命令行中输入命令，运行在后台的 shell 把命令转换成指令代码发送给操作系统。shell 并非只有命令行这一种形式，例如 GNOME、KDE 等图形界面也是 shell，不过它们是 GUI shell，都是为了解决人机交互的问题。</p>\n<p>目前在 Linux 环境下有几种不同类型的 shell，常用的有 Bourne Shell（sh）、Bourne Again Shell（bash）、Z Shell（zsh）、C Shell（csh）、tcsh（csh 的扩展）、Korn Shell（ksh）、pdksh（ksh 的扩展）。不同的 Shell 提供不同的语法和特性。</p>\n<p>bash 相当于 shell 中的某个，shell 的范围更广。bash 的全称是 Bourne Again Shell。</p>\n<h1 id=\"获取当前环境变量\"><a class=\"anchor\" href=\"#获取当前环境变量\">#</a> 获取当前环境变量</h1>\n<ul>\n<li>\n<p><code>echo $varname</code>  命令输出当前指定的环境变量的值</p>\n<p>使用  <code>echo</code>  命令可以输出指定的环境变量的值，例如： <code>echo $PATH</code> ，该命令会输出当前用户的  <code>PATH</code>  环境变量值。如果你想查看其他环境变量，只需要将上述命令中的  <code>PATH</code>  替换为其他环境变量即可。</p>\n</li>\n<li>\n<p><code>export</code>  命令显示当前系统定义的所有环境变量</p>\n</li>\n<li>\n<p><code>printenv</code>  /  <code>env</code>  命令查看所有已定义环境变量或指定的环境变量</p>\n<p><code>printenv</code>  或  <code>env</code>  都可以输出所有已定义的环境变量及其对应的值。 <code>printenv</code>  命令也可以单独输出当前指定的环境变量的值，例如： <code>printenv SHELL</code> ，该命令会输出已定义的  <code>SHELL</code>  环境变量值。而  <code>env</code>  命令，可以使用  <code>env | grep VARIABLE_NAME</code> ，查看对应的  <code>VARIABLE_NAME</code>  环境变量值。</p>\n</li>\n</ul>\n<p>note： <code>PATH</code>  变量定义了运行命令的查找路径，以冒号  <code>:</code>  分割不同的路径，使用  <code>export</code>  定义的时候可加双引号也可不加。</p>\n<h1 id=\"设置环境变量\"><a class=\"anchor\" href=\"#设置环境变量\">#</a> 设置环境变量</h1>\n<h2 id=\"临时环境变量\"><a class=\"anchor\" href=\"#临时环境变量\">#</a> 临时环境变量</h2>\n<h3 id=\"export-命令\"><a class=\"anchor\" href=\"#export-命令\">#</a> export 命令</h3>\n<p><code>export</code>  命令也可用于设置环境变量。</p>\n<p>在 shell 中执行程序时，shell 会提供一组环境变量。 <code>export</code>  可新增，修改或删除环境变量，供后续执行的程序使用。 <code>export</code>  的效力仅限于该次登陆操作。</p>\n<h3 id=\"set-命令\"><a class=\"anchor\" href=\"#set-命令\">#</a> set 命令</h3>\n<p><code>set</code>  命令作用主要是显示系统中已经存在的 shell 变量，以及设置 shell 变量的新变量值。使用  <code>set</code>  更改 shell 特性时，符号 &quot;+&quot; 和 &quot;-&quot; 的作用分别是打开和关闭指定的模式。 <code>set</code>  命令不能够定义新的 shell 变量。</p>\n<p>具体可看：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ251Lm9yZy9zb2Z0d2FyZS9iYXNoL21hbnVhbC9odG1sX25vZGUvVGhlLVNldC1CdWlsdGluLmh0bWw=\">https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html</span></p>\n<h2 id=\"永久环境变量\"><a class=\"anchor\" href=\"#永久环境变量\">#</a> 永久环境变量</h2>\n<h3 id=\"系统级\"><a class=\"anchor\" href=\"#系统级\">#</a> 系统级</h3>\n<ol>\n<li>\n<p><code>/etc/environment</code>  ：系统在登录时读取的第一个文件，用于为所有进程设置环境变量。系统使用此文件时并不是执行此文件中的命令，而是根据  <code>KEY=VALUE</code>  模式的代码，对  <code>KEY</code>  赋值以  <code>VALUE</code> ，因此文件中如果要定义  <code>PATH</code>  环境变量，只需加入类似如  <code>PATH=$PATH:/xxx/bin</code>  的代码即可。</p>\n</li>\n<li>\n<p><code>/etc/profile</code>  ：是系统登录时执行的第二个文件，可以用于设定针对全系统所有用户的环境变量，并从  <code>/etc/profile.d</code>  目录的配置文件中搜集 shell 的设置；这个文件，是任何用户登陆操作系统以后都会读取的文件（如果用户的 shell 是 csh 、tcsh 、zsh ，则不会读取此文件）。该文件一般是调用  <code>/etc/bash.bashrc</code>  文件。</p>\n</li>\n<li>\n<p><code>/etc/bash.bashrc</code>  ：系统级的  <code>bashrc</code>  文件，为每一个运行 bash shell 的用户执行此文件。此文件会在用户每次打开 bash shell 时执行一次；因此，如果你想让每个使用 bash 的用户每新开一个 bash 和每次登陆都执行某些操作，或者给他们定义一些新的环境变量，就可以在这个里面设置。</p>\n</li>\n</ol>\n<p>note：</p>\n<ul>\n<li>\n<p>生效时间：使用相同的用户打开新的终端时生效，或者手动更新环境变量生效（见更新环境变量）</p>\n</li>\n<li>\n<p>生效期限：永久有效</p>\n</li>\n<li>\n<p>生效范围：<mark>所有用户</mark></p>\n</li>\n</ul>\n<h3 id=\"用户级\"><a class=\"anchor\" href=\"#用户级\">#</a> 用户级</h3>\n<ol>\n<li>\n<p>~/.profile: 是对应当前登录用户的  <code>profile</code>  文件，用于定制当前用户的个人工作环境。每个用户都可使用该文件输入专用于自己使用的 shell 信息，当用户登录时，该文件仅仅执行一次。默认情况下，会设置一些环境变量，执行用户的  <code>.bashrc</code>  文件。</p>\n</li>\n<li>\n<p>~/.bashrc: 是对应当前登录用户的 bash 初始化文件，当用户每次打开 bash shell 时，系统都会执行此文件一次。通常设置环境变量修改这个文件。</p>\n</li>\n</ol>\n<p>note：</p>\n<ul>\n<li>生效时间：使用相同的用户打开新的终端时生效，或者手动更新环境变量生效（见更新环境变量）</li>\n<li>生效期限：永久有效</li>\n<li>生效范围：<mark>仅对当前用户有效</mark></li>\n</ul>\n<p><strong>总结：</strong></p>\n<p>环境变量的分类可以简单的分成用户级别的环境变量以及系统级别的环境变量。</p>\n<p>系统级别环境变量定义文件： <code>/etc/bash.bashrc</code> （部分系统为： <code>/etc/bashrc</code> ）、 <code>/etc/profile</code> （部分系统为： <code>/etc/bash_profile</code> ）、 <code>/etc/environment</code></p>\n<p>用户级别环境变量定义文件： <code>~/.bashrc</code> 、 <code>~/.profile</code> （部分系统为： <code>~/.bash_profile</code> ）</p>\n<p>另外在用户环境变量中，系统会首先读取  <code>~/.profile</code> （或者  <code>~/.bash_profile</code> ）文件，如果没有该文件则读取  <code>~/.bash_login</code> ，根据这些文件中内容再去读取  <code>~/.bashrc</code> 。</p>\n<p>环境变量加载顺序：</p>\n<p><code>/etc/enviroment</code>  –&gt;  <code>/etc/profile</code>  –&gt;  <code>/etc/bash.bashrc</code>  –&gt;  <code>~/.profile</code>  –&gt;  <code>~/.bashrc</code></p>\n<p><strong>tips：</strong></p>\n<p>一般在  <code>/etc/profile.d/</code>  目录下创建一个自定义脚本会是修改环境变量的更好方法，这样无论你在一个终端中如何切换用户，环境变量依然存在。eg：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> /etc/profile.d/test.sh <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>export PATH=<span class=\"token environment constant\">$PATH</span>:/home/arachnid/mysql/bin</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>EOF</pre></td></tr></table></figure><h1 id=\"删除环境变量\"><a class=\"anchor\" href=\"#删除环境变量\">#</a> 删除环境变量</h1>\n<p>如果是临时环境变量，或者是要临时删除一下环境变量，可以使用  <code>unset</code>  命令： <code>unset VARIABLE_NAME</code> ；如果是要永久删除配置文件中的环境变量，需要去相应的配置文件中移除相关的配置项。</p>\n<h1 id=\"更新环境变量\"><a class=\"anchor\" href=\"#更新环境变量\">#</a> 更新环境变量</h1>\n<p>eg：更新  <code>/etc/profile</code>  文件的环境变量</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token builtin class-name\">source</span> /etc/profile</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre><span class=\"token comment\"># or</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token builtin class-name\">.</span> /etc/profile</pre></td></tr></table></figure><h1 id=\"常用环境变量\"><a class=\"anchor\" href=\"#常用环境变量\">#</a> 常用环境变量</h1>\n<table>\n<thead>\n<tr>\n<th>变量</th>\n<th>内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>DISPLAY</td>\n<td>如果你正在运行图形界面环境，那么这个变量就是你显示器的名字。通常，它是 “:0”， 意思是由 X 产生的第一个显示器。</td>\n</tr>\n<tr>\n<td>EDITOR</td>\n<td>文本编辑器的名字。</td>\n</tr>\n<tr>\n<td>SHELL</td>\n<td>shell 程序的名字。</td>\n</tr>\n<tr>\n<td>HOME</td>\n<td>用户家目录。</td>\n</tr>\n<tr>\n<td>LANG</td>\n<td>定义了字符集以及语言编码方式。</td>\n</tr>\n<tr>\n<td>OLD_PWD</td>\n<td>先前的工作目录。</td>\n</tr>\n<tr>\n<td>PAGER</td>\n<td>页输出程序的名字。这经常设置为 /usr/bin/less。</td>\n</tr>\n<tr>\n<td>PATH</td>\n<td>由冒号分开的目录列表，当你输入可执行程序名后，会搜索这个目录列表。</td>\n</tr>\n<tr>\n<td>PS1</td>\n<td>Prompt String 1. 这个定义了你的 shell 提示符的内容。随后我们可以看到，这个变量内容可以全面地定制。</td>\n</tr>\n<tr>\n<td>PWD</td>\n<td>当前工作目录。</td>\n</tr>\n<tr>\n<td>TERM</td>\n<td>终端类型名。类 Unix 的系统支持许多终端协议；这个变量设置你的终端仿真器所用的协议。</td>\n</tr>\n<tr>\n<td>TZ</td>\n<td>指定你所在的时区。大多数类 Unix 的系统按照协调时间时 (UTC) 来维护计算机内部的时钟 ，然后应用一个由这个变量指定的偏差来显示本地时间。</td>\n</tr>\n<tr>\n<td>USER</td>\n<td>你的用户名</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvRW52aXJvbm1lbnRfdmFyaWFibGVz\">https://wiki.archlinux.org/title/Environment_variables</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veW91eW91aS9wLzEwNjgwMzI5Lmh0bWw=\">https://www.cnblogs.com/youyoui/p/10680329.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3J2ZHNkLnRvcC8yMDE4LzA0LzI4L0xpbnV4L0xpbnV4JUU3JThFJUFGJUU1JUEyJTgzJUU1JThGJTk4JUU5JTg3JThGLw==\">http://rvdsd.top/2018/04/28/Linux/Linux 环境变量 /</span></p>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/omv6-install/",
            "url": "https://arachnid.cc/omv6-install/",
            "title": "debian 11 桌面安装 OMV 6",
            "date_published": "2024-01-13T13:04:04.775Z",
            "content_html": "<h1 id=\"debian-安装\"><a class=\"anchor\" href=\"#debian-安装\">#</a> Debian 安装</h1>\n<p>需要注意的几个点是：</p>\n<ol>\n<li>安装语言的时候选择英文安装，否者会造成部分乱码，至于后面想要使用中文，安装完成后再配置就好了。</li>\n<li>配置软件包不需要选择网络镜像，后期再配置镜像源。</li>\n<li>勾选 ssh 服务，以方便远程操作；至于是否选择图形界面，随个人喜好。</li>\n</ol>\n<h2 id=\"基本配置\"><a class=\"anchor\" href=\"#基本配置\">#</a> 基本配置</h2>\n<h3 id=\"添加-sudo-管理组\"><a class=\"anchor\" href=\"#添加-sudo-管理组\">#</a> 添加 sudo 管理组</h3>\n<p><code>your_name is not in the sudoers file. This incident will be reported.</code></p>\n<p>出现这种情况一般是你用普通用户键入  <code>sudo</code>  命令，但这个用户又没有加入  <code>sudo</code>  组上面，导致权限不够。</p>\n<p>解决：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>添加设置默认网关</span></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[your_name@localhost] $\"></td><td><pre><span class=\"token function\">su</span> -</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>Password: </pre></td></tr><tr><td data-num=\"3\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>visudo</pre></td></tr></table></figure><p>然后移动光标，添加  <code>your_name ALL=(ALL:ALL) ALL</code>  在  <code># User privilege specification</code>  下面，根据提示  <code>写入 ^O</code>  ， <code>回车 Enter</code>  确认保存，  <code>退出 ^X</code>   ，得到：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>添加设置默认网关</span></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cat</span> /etc/sudoers</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span>#</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># This <span class=\"token function\">file</span> MUST be edited with the <span class=\"token string\">'visudo'</span> <span class=\"token builtin class-name\">command</span> as root.</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span>#</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># Please consider adding <span class=\"token builtin class-name\">local</span> content <span class=\"token keyword\">in</span> /etc/sudoers.d/ instead of</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># directly modifying this file.</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span>#</pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># See the <span class=\"token function\">man</span> page <span class=\"token keyword\">for</span> details on how to <span class=\"token function\">write</span> a sudoers file.</pre></td></tr><tr><td data-num=\"9\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span>#</pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre>Defaults\tenv_reset</pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre>Defaults\tmail_badpass</pre></td></tr><tr><td data-num=\"12\"></td><td data-command></td><td><pre>Defaults\t<span class=\"token assign-left variable\">secure_path</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># Host <span class=\"token builtin class-name\">alias</span> specification</pre></td></tr><tr><td data-num=\"15\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># User <span class=\"token builtin class-name\">alias</span> specification</pre></td></tr><tr><td data-num=\"17\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># Cmnd <span class=\"token builtin class-name\">alias</span> specification</pre></td></tr><tr><td data-num=\"19\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># User privilege specification</pre></td></tr><tr><td data-num=\"21\"></td><td data-command></td><td><pre>root\t<span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL:ALL<span class=\"token punctuation\">)</span> ALL</pre></td></tr><tr><td data-num=\"22\"></td><td data-command></td><td><pre>your_name\t<span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL:ALL<span class=\"token punctuation\">)</span> ALL</pre></td></tr><tr><td data-num=\"23\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># Allow members of group <span class=\"token function\">sudo</span> to execute any <span class=\"token builtin class-name\">command</span></pre></td></tr><tr><td data-num=\"25\"></td><td data-command></td><td><pre>%sudo\t <span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL:ALL<span class=\"token punctuation\">)</span> ALL</pre></td></tr><tr><td data-num=\"26\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td data-command></td><td><pre><span class=\"token punctuation\">\\</span># See sudoers<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> <span class=\"token function\">more</span> information on <span class=\"token string\">\"@include\"</span> directives:</pre></td></tr><tr><td data-num=\"28\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td data-command></td><td><pre>@includedir /etc/sudoers.d</pre></td></tr></table></figure><p>note：</p>\n<p><code>su</code>  带有  <code>-</code>  ，这和  <code>su</code>  是不同的，在用命令  <code>su</code>  的时候只是切换到 root，但没有把 root 的环境变量传过去，还是当前用户的环境变量，用  <code>su -</code>  命令会将环境变量也一起带过去，就像和  <code>root</code>  登录一样。关于  <code>su -</code>  的分析可参看：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZGJvb2wuY29tL2Rwa2ctcmVjb25maWd1cmUtYmFzaC1jb21tYW5kLW5vdC1mb3VuZC5odG1s\">dpkg-reconfigure 命令找不到问题解决</span></p>\n<h3 id=\"避免提示光盘安装软件包\"><a class=\"anchor\" href=\"#避免提示光盘安装软件包\">#</a> 避免提示光盘安装软件包</h3>\n<p><code>Media change: please insert the disc labeled 'Debian GNU/Linux xxx DVD' Media change: please insert the disc labeled.</code></p>\n<p>在 Debian 系统中，如果您碰巧使用 DVD 安装，当你调用  <code>apt</code>  时，会抛出一个错误消息，表示存储库 cdrom 没有发布文件，并要求插入 Debian 光盘来离线安装软件包，这时候我们需要绕过去掉提示，以便使用网络安装。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/apt/sources.list</pre></td></tr></table></figure><p>得到：</p>\n<figure class=\"highlight wiki\"><figcaption data-lang=\"Wiki markup\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">#</span> deb cdrom:<span class=\"token url\">[Debian GNU/Linux 11.8.0 _Bullseye_ - Official amd64 DVD Binary-1 20231007-14:05]</span>/ bullseye contrib main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>deb cdrom:<span class=\"token url\">[Debian GNU/Linux 11.8.0 _Bullseye_ - Official amd64 DVD Binary-1 20231007-14:05]</span>/ bullseye contrib main</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">#</span> Line commented out by installer because it failed to verify:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">#</span>deb http://security.debian.org/debian-security bullseye-security main contrib</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">#</span> Line commented out by installer because it failed to verify:</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">#</span>deb-src http://security.debian.org/debian-security bullseye-security main contrib</pre></td></tr></table></figure><p>可以看到，默认是先通过  <code>deb cdrom:...</code>  安装软件的。所以在前面加一个  <code>#</code>  把这行注释掉即可；最后  <code>写入 ^O</code>  ， <code>回车 Enter</code>  确认保存，  <code>退出 ^X</code>  。</p>\n<h3 id=\"更换软件包镜像源\"><a class=\"anchor\" href=\"#更换软件包镜像源\">#</a> 更换软件包镜像源</h3>\n<p><code>E: Package 'xxx' has no installation candidate.</code></p>\n<p>这种情况一般是软件包获取不到，可能是网络问题，也可能是因为源的问题，换个好一点的镜像源就行了。</p>\n<p>例如：更换为 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9taXJyb3JzLnR1bmEudHNpbmdodWEuZWR1LmNuL2hlbHAvZGViaWFuLw==\">清华源地址</span></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> /etc/apt/sources.list /etc/apt/sources.list.back</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/apt/sources.list</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update</pre></td></tr></table></figure><p>note：</p>\n<p>先找到镜像源文件并备份，然后使用  <code>nano</code>  编辑，把获取到的镜像源地址全部覆盖替换原有的文本，最后再执行  <code>apt update</code>  更新软件包，至此就可以安装原本装失败的软件了。如果用不习惯  <code>nano</code>  编辑器，可以安装  <code>vim</code>  。</p>\n<h3 id=\"内核编译工具\"><a class=\"anchor\" href=\"#内核编译工具\">#</a> 内核编译工具</h3>\n<p><code>make[n]: *** /lib/modules/kernel_version-amd64/build: No such file or directory.</code></p>\n<p>在编译部署内核模块的时候，如果报这个错误，是因为没有  <code>linux-headers</code>  导致。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> linux-headers-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-r</span><span class=\"token variable\">)</span></span>-amd64</pre></td></tr></table></figure><p>note：</p>\n<p>命令  <code>uname -r</code>  就是用来获取当前内核版本的。</p>\n<p>一般编译驱动会用到  <code>sudo apt-get install build-essential linux-headers-$(uname -r)-amd64</code></p>\n<h3 id=\"网卡驱动添加\"><a class=\"anchor\" href=\"#网卡驱动添加\">#</a> 网卡驱动添加</h3>\n<p>获取网卡型号：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>lspci <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-i</span> net</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>02:00.0 Network controller: Realtek Semiconductor Co., Ltd. RTL8723BE PCIe Wireless Network Adapter</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller <span class=\"token punctuation\">(</span>rev <span class=\"token number\">15</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>其中  <code>Ethernet controller</code>  后面的表示以太网有线网卡，这里是 RTL8111/8168/8411；  <code>Network controller</code>  后面表示无线网卡，这里则是 RTL8723BE。</p>\n<ul>\n<li>\n<p>有线网卡</p>\n<p>一般主板上的有线网卡都是自带驱动的，但不排除驱动不管用或者另类没有，这个时候就需要自己找驱动，当然，如果有现成编译好打好包的驱动，那么只需要用 U 盘 copy 到系统然后进行安装即可，如果没有，那么就需要自己编译驱动了，这是一个很麻烦的事，特别是你完全没网的时候，光是安装一堆依赖都得一个个找。。。</p>\n<p>当然你也可以找个联网的虚拟机，安装一样的系统，编译好再 copy 过去；或者利用  <code>apt-cache depends package_name</code>  获取安装依赖，然后一个个安装；对于  <code>.deb</code>  文件，可以用  <code>dpkg --info path_deb_file</code>  查看。</p>\n</li>\n<li>\n<p>无线网卡</p>\n<p>在 Debian 最小安装中，是不存在无线网卡驱动的，只能自己安装：</p>\n<ul>\n<li>\n<p>intel 的无线网卡驱动：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> firmware-iwlwifi</pre></td></tr></table></figure><p>支持型号：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL2J1bGxzZXllL2Zpcm13YXJlLWl3bHdpZmk=\">https://packages.debian.org/bullseye/firmware-iwlwifi</span></p>\n</li>\n<li>\n<p>realtek（小螃蟹）的无线网卡驱动：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> firmware-realtek</pre></td></tr></table></figure><p>支持型号：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL2J1bGxzZXllL2Zpcm13YXJlLXJlYWx0ZWs=\">https://packages.debian.org/bullseye/firmware-realtek</span></p>\n</li>\n<li>\n<p>高通的无线网卡驱动：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> firmware-atheros</pre></td></tr></table></figure><p>支持型号：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL2J1bGxzZXllL2Zpcm13YXJlLWF0aGVyb3M=\">https://packages.debian.org/bullseye/firmware-atheros</span></p>\n</li>\n<li>\n<p>other：</p>\n<p>当然，如果你像一劳永逸，可以直接安装  <code>firmware-nonfree</code>  整个大包，或者在里面找相应的型号子包安装：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYWNrYWdlcy5kZWJpYW4ub3JnL3NvdXJjZS9idWxsc2V5ZS9maXJtd2FyZS1ub25mcmVlJUVGJUJDJTlCJUU4JTgwJThDJUU1JUFGJUI5JUU0JUJBJThFJUU1JTg1JUI2JUU1JUFFJTgzJUU2JUFGJTk0JUU4JUJFJTgzJUU2JTk2JUIwJUU3JTlBJTg0JUU4JUFFJUJFJUU1JUE0JTg3JUU2JTg4JTk2JUU4JTgwJTg1JUU0JUI4JThEJUU1JTlDJUE4JUU2JUI4JTg1JUU1JThEJTk1JUU0JUI4JThBJUU3JTlBJTg0JUU4JUFFJUJFJUU1JUE0JTg3JUVGJUJDJThDJUU1JThGJUFGJUU0JUJCJUE1JUU1JThFJUJCJUU1JUFFJTk4JUU3JUJEJTkxJUU2JTg4JTk2JUU4JTgwJTg1JUU1JUJDJTgwJUU2JUJBJTkwJUU1JUI5JUJGJUU1JTlDJUJBJUU0JUI4JThBJUU2JTg5JUJFJUVGJUJDJThDJUU0JUJEJTg2JUU1JUE0JUE3JUU5JTgzJUE4JUU1JTg4JTg2JUU5JTlDJTgwJUU4JUE2JTgxJUU4JTg3JUFBJUU1JUI3JUIxJUU3JUJDJTk2JUU4JUFGJTkxJUU5JUE5JUIxJUU1JThBJUE4JUUzJTgwJTgy\">https://packages.debian.org/source/bullseye/firmware-nonfree；而对于其它比较新的设备或者不在清单上的设备，可以去官网或者开源广场上找，但大部分需要自己编译驱动。</span></p>\n</li>\n</ul>\n</li>\n</ul>\n<p>关于网卡驱动安装完后，可以  <code>reboot</code>  重启，然后执行  <code>dmesg -l err</code>  查看日志，看驱动是否生效，如果没有，将会出现 error，然后排查解决就好了。</p>\n<h3 id=\"引导时间修改\"><a class=\"anchor\" href=\"#引导时间修改\">#</a> 引导时间修改</h3>\n<p>如果你是单系统，可以更改引导时间缩短跳转启动系统的时间。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nano</span> /etc/default/grub</pre></td></tr></table></figure><p>更改  <code>GRUB_TIMEOUT</code>  数值为 1，这里建议不要改成 0，留出 1s 的时间，防止以后有用到。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> /etc/default/grub</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># If you change this file, run 'update-grub' afterwards to update</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># /boot/grub/grub.cfg.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># For full documentation of the options in this file, see:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#   info -f grub -n 'Simple configuration'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DEFAULT</span><span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">GRUB_TIMEOUT</span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DISTRIBUTOR</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span>lsb_release <span class=\"token parameter variable\">-i</span> <span class=\"token parameter variable\">-s</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span> /dev/null <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">echo</span> Debian<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">GRUB_CMDLINE_LINUX_DEFAULT</span><span class=\"token operator\">=</span><span class=\"token string\">\"quiet\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">GRUB_CMDLINE_LINUX</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># Uncomment to enable BadRAM filtering, modify to suit your needs</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># This works with Linux (no patch required) and with any kernel that obtains</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#GRUB_BADRAM=\"0x01234567,0xfefefefe,0x89abcdef,0xefefefef\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># Uncomment to disable graphical terminal (grub-pc only)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#GRUB_TERMINAL=console</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># The resolution used on graphical terminal</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># note that you can use only modes which your graphic card supports via VBE</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># you can see them in real GRUB with the command `vbeinfo'</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#GRUB_GFXMODE=640x480</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># Uncomment if you don't want GRUB to pass \"root=UUID=xxx\" parameter to Linux</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#GRUB_DISABLE_LINUX_UUID=true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># Uncomment to disable generation of recovery mode menu entries</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#GRUB_DISABLE_RECOVERY=\"true\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># Uncomment to get a beep at grub start</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#GRUB_INIT_TUNE=\"480 440 1\"</span></pre></td></tr></table></figure><p>最后更新 Grub：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">update-grub</span></pre></td></tr></table></figure><p>note：</p>\n<p>可以通过  <code>systemd-analyze time</code>  查看开机时间，通过  <code>systemd-analyze blame</code>  查看开机服务占用时间。</p>\n<h3 id=\"ssh-配置\"><a class=\"anchor\" href=\"#ssh-配置\">#</a> ssh 配置</h3>\n<p>在安装的时候有勾选 ssh 服务的话，那么只需要配置一下文件即可，否则就需要自己去下载。（当然，这里只是前置使用，后期安装 OMV 后，将由 OMV 接管）</p>\n<h3 id=\"安装中文输入法\"><a class=\"anchor\" href=\"#安装中文输入法\">#</a> 安装中文输入法</h3>\n<p>在 linux 系统中，常见的两大输入法框架：ibus 和 fcitx，而这里使用 Fcitx5，是用来接替 Fcitx 的。</p>\n<blockquote>\n<p>注意： fcitx5 包仅提供基本框架，且仅支持英文。如果要输入其他语言（例如中文或日文），则需要安装输入法引擎（IME）。</p>\n</blockquote>\n<p>Fcitx5 输入法引擎有以下几种：</p>\n<p><strong>中文</strong></p>\n<ul>\n<li>\n<p>fcitx5-chewing 包：是流行的繁体中文注音输入引擎，它基于 libchewing 包。</p>\n</li>\n<li>\n<p>fcitx5-chinese-addons 包：包含与中文相关的 addon，例如拼音、双拼和五笔。</p>\n</li>\n<li>\n<p>fcitx5-rime 包：使用 Rime 引擎。</p>\n</li>\n</ul>\n<p><strong>日文</strong></p>\n<ul>\n<li>\n<p>fcitx5-anthy 包：是流行的日文输入引擎。但是，它已不再受到积极开发。</p>\n</li>\n<li>\n<p>fcitx5-kkc 包：是日文假名输入引擎，它基于 libkkc 包。</p>\n</li>\n<li>\n<p>fcitx5-mozc 包：基于 Mozc（Google 日文输入法的开源版本）。</p>\n</li>\n<li>\n<p>fcitx5-skk 包：是日文假名输入引擎，它基于 libskk 包。</p>\n</li>\n</ul>\n<p><strong>其他语言</strong></p>\n<ul>\n<li>fcitx5-hangul 包：用于输入韩文，基于 libhangul 包。</li>\n<li>fcitx5-unikey 包：可用于输入越南语字符。</li>\n<li>fcitx5-m17n 包：可用于各种语言。</li>\n</ul>\n<p>1、卸载旧版及其余输入法</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> purge fcitx* ibus*</pre></td></tr></table></figure><p>2、安装 Fcitx5 简体中文输入</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> fcitx5 fcitx5-chinese-addons</pre></td></tr></table></figure><p>3、重启配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">reboot</span></pre></td></tr></table></figure><p>开机后查看 fcitx5 是否随桌面环境自动启动，如无，则添加开机自启：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"~/.config/autostart/\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token function\">mkdir</span>  ~/.config/autostart/</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token function\">cp</span> /usr/share/applications/org.fcitx.Fcitx5.desktop ~/.config/autostart/</pre></td></tr></table></figure><p>4、添加拼音输入</p>\n<p>在应用中打开 Fcitx5 配置，然后在输入法中添加中文拼音，同时在全局选项中配置输入法切换快捷键（默认是  <code>Ctrl + 空格键</code>  切换）。</p>\n<p>5、修改全局变量</p>\n<ul>\n<li>使用  <code>im-config</code>  组件配置</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> im-config</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>im-config</pre></td></tr></table></figure><p>进入图形界面选择 Fcitx5 输入法。</p>\n<ul>\n<li>编辑  <code>/etc/environment</code></li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/environment</pre></td></tr></table></figure><p>添加如下全局配置：</p>\n<figure class=\"highlight wiki\"><figcaption data-lang=\"Wiki markup\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GTK_IM_MODULE=fcitx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>QT_IM_MODULE=fcitx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>XMODIFIERS=@im=fcitx</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>SDL_IM_MODULE=fcitx</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>INPUT_METHOD=fcitx</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>GLFW_IM_MODULE=ibus</pre></td></tr></table></figure><p>资料：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eGNuLm9yZy93aWtpL0ZjaXR4NQ==\">https://wiki.archlinuxcn.org/wiki/Fcitx5</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmRlYmlhbi5vcmcvemhfQ04vSTE4bi9GY2l0eDU=\">https://wiki.debian.org/zh_CN/I18n/Fcitx5</span></p>\n<h2 id=\"节电处理\"><a class=\"anchor\" href=\"#节电处理\">#</a> 节电处理</h2>\n<h3 id=\"无线\"><a class=\"anchor\" href=\"#无线\">#</a> 无线</h3>\n<p>软件关闭蓝牙功能：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rfkill block bluetooth</pre></td></tr></table></figure><p>软件关闭 wifi 功能：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rfkill block wifi</pre></td></tr></table></figure><h3 id=\"usb\"><a class=\"anchor\" href=\"#usb\">#</a> USB</h3>\n<p>添加 USB 空闲自动挂起处理，空闲等待时间为 2S， <code>reboot</code>  重启生效：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'ACTION==\"add\", SUBSYSTEM==\"usb\",  ATTR&#123;power/control&#125;=\"auto\", ATTR&#123;power/autosuspend_delay_ms&#125;=\"2000\"'</span> <span class=\"token operator\">></span> /etc/udev/rules.d/50-usb_power_save.rules</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">reboot</span></pre></td></tr></table></figure><p>其它控制：</p>\n<p><code>ATTR&#123;power/control&#125;=&quot;on&quot;</code>  or  <code>ATTR&#123;power/autosuspend_delay_ms&#125;=&quot;-1&quot;</code> ，表示禁用挂起； <code>ATTR&#123;power/wakeup&#125;=&quot;enable&quot;</code> ，表示使能 usb 唤醒，写入  <code>disable</code>  则关闭。</p>\n<p>如果想要单独设置，可以如下查看 usb 设备对应的 udev 字段，eg：查看 Logitech 鼠标：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>lsusb</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Bus 002 Device 001: ID 1d6b:0003 Linux Foundation <span class=\"token number\">3.0</span> root hub</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Bus 001 Device 003: ID 0bda:b728 Realtek Semiconductor Corp. RTL8723B Bluetooth</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Bus 001 Device 002: ID 046d:c52b Logitech, Inc. Unifying Receiver</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Bus 001 Device 001: ID 1d6b:0002 Linux Foundation <span class=\"token number\">2.0</span> root hub</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>lsusb <span class=\"token parameter variable\">-tvv</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>/:  Bus 02.Port <span class=\"token number\">1</span>: Dev <span class=\"token number\">1</span>, <span class=\"token assign-left variable\">Class</span><span class=\"token operator\">=</span>root_hub, <span class=\"token assign-left variable\">Driver</span><span class=\"token operator\">=</span>xhci_hcd/7p, 5000M</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    ID 1d6b:0003 Linux Foundation <span class=\"token number\">3.0</span> root hub</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    /sys/bus/usb/devices/usb2  /dev/bus/usb/002/001</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>/:  Bus 01.Port <span class=\"token number\">1</span>: Dev <span class=\"token number\">1</span>, <span class=\"token assign-left variable\">Class</span><span class=\"token operator\">=</span>root_hub, <span class=\"token assign-left variable\">Driver</span><span class=\"token operator\">=</span>xhci_hcd/9p, 480M</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    ID 1d6b:0002 Linux Foundation <span class=\"token number\">2.0</span> root hub</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    /sys/bus/usb/devices/usb1  /dev/bus/usb/001/001</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token operator\">|</span>__ Port <span class=\"token number\">4</span>: Dev <span class=\"token number\">2</span>, If <span class=\"token number\">1</span>, <span class=\"token assign-left variable\">Class</span><span class=\"token operator\">=</span>Human Interface Device, <span class=\"token assign-left variable\">Driver</span><span class=\"token operator\">=</span>usbhid, 12M</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        ID 046d:c52b Logitech, Inc. Unifying Receiver</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        /sys/bus/usb/devices/1-4  /dev/bus/usb/001/002</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token operator\">|</span>__ Port <span class=\"token number\">4</span>: Dev <span class=\"token number\">2</span>, If <span class=\"token number\">2</span>, <span class=\"token assign-left variable\">Class</span><span class=\"token operator\">=</span>Human Interface Device, <span class=\"token assign-left variable\">Driver</span><span class=\"token operator\">=</span>usbhid, 12M</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        ID 046d:c52b Logitech, Inc. Unifying Receiver</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        /sys/bus/usb/devices/1-4  /dev/bus/usb/001/002</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token operator\">|</span>__ Port <span class=\"token number\">4</span>: Dev <span class=\"token number\">2</span>, If <span class=\"token number\">0</span>, <span class=\"token assign-left variable\">Class</span><span class=\"token operator\">=</span>Human Interface Device, <span class=\"token assign-left variable\">Driver</span><span class=\"token operator\">=</span>usbhid, 12M</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        ID 046d:c52b Logitech, Inc. Unifying Receiver</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        /sys/bus/usb/devices/1-4  /dev/bus/usb/001/002</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token operator\">|</span>__ Port <span class=\"token number\">8</span>: Dev <span class=\"token number\">3</span>, If <span class=\"token number\">0</span>, <span class=\"token assign-left variable\">Class</span><span class=\"token operator\">=</span>Wireless, <span class=\"token assign-left variable\">Driver</span><span class=\"token operator\">=</span>btusb, 12M</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        ID 0bda:b728 Realtek Semiconductor Corp. RTL8723B Bluetooth</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        /sys/bus/usb/devices/1-8  /dev/bus/usb/001/003</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token operator\">|</span>__ Port <span class=\"token number\">8</span>: Dev <span class=\"token number\">3</span>, If <span class=\"token number\">1</span>, <span class=\"token assign-left variable\">Class</span><span class=\"token operator\">=</span>Wireless, <span class=\"token assign-left variable\">Driver</span><span class=\"token operator\">=</span>btusb, 12M</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        ID 0bda:b728 Realtek Semiconductor Corp. RTL8723B Bluetooth</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        /sys/bus/usb/devices/1-8  /dev/bus/usb/001/003</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>udevadm info <span class=\"token parameter variable\">-a</span> /dev/bus/usb/001/002</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>Udevadm info starts with the device specified by the devpath and <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>walks up the chain of parent devices. It prints <span class=\"token keyword\">for</span> every device</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>found, all possible attributes <span class=\"token keyword\">in</span> the udev rules key format.</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>A rule to match, can be composed by the attributes of the device</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>and the attributes from one single parent device.</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  looking at device <span class=\"token string\">'/devices/pci0000:00/0000:00:15.0/usb1/1-4'</span><span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token assign-left variable\">KERNEL</span><span class=\"token operator\">==</span><span class=\"token string\">\"1-4\"</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token assign-left variable\">SUBSYSTEM</span><span class=\"token operator\">==</span><span class=\"token string\">\"usb\"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token assign-left variable\">DRIVER</span><span class=\"token operator\">==</span><span class=\"token string\">\"usb\"</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>authorized<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>avoid_reset_quirk<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bConfigurationValue<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bDeviceClass<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"00\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bDeviceProtocol<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"00\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bDeviceSubClass<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"00\"</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bMaxPacketSize0<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"8\"</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bMaxPower<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"98mA\"</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bNumConfigurations<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bNumInterfaces<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\" 3\"</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bcdDevice<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1211\"</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>bmAttributes<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"a0\"</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>busnum<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>configuration<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"RQR12.11_B0032\"</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>devnum<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"2\"</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>devpath<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"4\"</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>idProduct<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"c52b\"</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>idVendor<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"046d\"</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>ltm_capable<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"no\"</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>manufacturer<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"Logitech\"</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>maxchild<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/active_duration<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"5486884\"</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/async<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"enabled\"</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/autosuspend<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"2\"</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/autosuspend_delay_ms<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"2000\"</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/connected_duration<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"5486884\"</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/control<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"on\"</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/level<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"on\"</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/persist<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/runtime_active_kids<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/runtime_active_time<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"5486602\"</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/runtime_enabled<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"forbidden\"</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/runtime_status<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"active\"</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/runtime_suspended_time<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/runtime_usage<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"enabled\"</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup_abort_count<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup_active<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup_active_count<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup_count<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup_expire_count<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup_last_time_ms<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup_max_time_ms<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>power/wakeup_total_time_ms<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0\"</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>product<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"USB Receiver\"</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>quirks<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"0x0\"</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>removable<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"removable\"</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>rx_lanes<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>speed<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"12\"</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>tx_lanes<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"1\"</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>urbnum<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\"34\"</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    ATTR<span class=\"token punctuation\">&#123;</span>version<span class=\"token punctuation\">&#125;</span><span class=\"token operator\">==</span><span class=\"token string\">\" 2.00\"</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p><strong>参看：</strong></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmtlcm5lbC5vcmcvZHJpdmVyLWFwaS91c2IvcG93ZXItbWFuYWdlbWVudC5odG1s\">https://docs.kernel.org/driver-api/usb/power-management.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvVWRldiNXYWtpbmdfZnJvbV9zdXNwZW5kX3dpdGhfVVNCX2RldmljZQ==\">https://wiki.archlinux.org/title/Udev#Waking_from_suspend_with_USB_device</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5yZWFjdGl2YXRlZC5uZXQvd3JpdGluZ191ZGV2X3J1bGVzLmh0bWwjZXhhbXBsZS1wcmludGVy\">http://www.reactivated.net/writing_udev_rules.html#example-printer</span></p>\n<h3 id=\"cpu-调度\"><a class=\"anchor\" href=\"#cpu-调度\">#</a> cpu 调度</h3>\n<p>一般支持以下几种策略，旧内核可能不支持  <code>schedutil</code>  ：</p>\n<table>\n<thead>\n<tr>\n<th>Governor</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>performance</td>\n<td>Run the CPU at the maximum frequency, obtained from  <code>/sys/devices/system/cpu/cpuX/cpufreq/scaling_max_freq</code> .</td>\n</tr>\n<tr>\n<td>powersave</td>\n<td>Run the CPU at the minimum frequency, obtained from  <code>/sys/devices/system/cpu/cpuX/cpufreq/scaling_min_freq</code> .</td>\n</tr>\n<tr>\n<td>userspace</td>\n<td>Run the CPU at user specified frequencies, configurable via  <code>/sys/devices/system/cpu/cpuX/cpufreq/scaling_setspeed</code> .</td>\n</tr>\n<tr>\n<td>ondemand</td>\n<td>Scales the frequency dynamically according to current load. Jumps to the highest frequency and then possibly back off as the idle time increases.</td>\n</tr>\n<tr>\n<td>conservative</td>\n<td>Scales the frequency dynamically according to current load. Scales the frequency more gradually than ondemand.</td>\n</tr>\n<tr>\n<td>schedutil</td>\n<td>Scheduler-driven CPU frequency selection.</td>\n</tr>\n</tbody>\n</table>\n<p>关于  <code>schedutil</code>  的原理可看：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZWVwaW5vdXQuY29tL2FuZHJvaWQtc3lzdGVtLWFuYWx5c2lzL2FuZHJvaWQtY3B1LXJlbGF0ZWQvcHJpbmNpcGxlLWFuYWx5c2lzLW9mLWNwdS1nb3Zlcm5vci1zY2hlZHV0aWwuaHRtbA==\">https://deepinout.com/android-system-analysis/android-cpu-related/principle-analysis-of-cpu-governor-schedutil.html</span></p>\n<p>查看 cpu 支持的调度策略及当前使用的模式：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conservative ondemand performance schedutil</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">cat</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>schedutil</pre></td></tr></table></figure><p>修改所有 cpu 的策略：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> governor <span class=\"token operator\">|</span> <span class=\"token function\">tee</span> /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>governor</pre></td></tr></table></figure><p>note： <code>governor</code>  为支持的策略之一，选你需要更改的就好了。</p>\n<p><strong>注意，该操作只在当前生效，任何复位或重启后，都将恢复默认操作，因此如果要让每次生效，那么需要编写开机脚本或写入内核。</strong></p>\n<p>查看各 cpu 频率：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> /proc/cpuinfo <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">'^model name|^cpu MHz'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>model name      <span class=\"token builtin class-name\">:</span> Intel<span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span> Pentium<span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span> Silver J5040 CPU @ <span class=\"token number\">2</span>.00GHz</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cpu MHz         <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1029.564</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>model name      <span class=\"token builtin class-name\">:</span> Intel<span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span> Pentium<span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span> Silver J5040 CPU @ <span class=\"token number\">2</span>.00GHz</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>cpu MHz         <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1168.290</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>model name      <span class=\"token builtin class-name\">:</span> Intel<span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span> Pentium<span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span> Silver J5040 CPU @ <span class=\"token number\">2</span>.00GHz</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cpu MHz         <span class=\"token builtin class-name\">:</span> <span class=\"token number\">818.342</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>model name      <span class=\"token builtin class-name\">:</span> Intel<span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span> Pentium<span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span> Silver J5040 CPU @ <span class=\"token number\">2</span>.00GHz</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cpu MHz         <span class=\"token builtin class-name\">:</span> <span class=\"token number\">960.974</span></pre></td></tr></table></figure><p>资料：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvQ1BVX2ZyZXF1ZW5jeV9zY2FsaW5nI1NjYWxpbmdfZ292ZXJub3Jz\">https://wiki.archlinux.org/title/CPU_frequency_scaling#Scaling_governors</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmtlbHUub3JnL3RlY2gvMjAyMS8wNS8xMy9iaW9zLWNvbmZpZy1yZW1hcmsuaHRtbA==\">https://blog.kelu.org/tech/2021/05/13/bios-config-remark.html</span></p>\n<h3 id=\"睡眠与休眠\"><a class=\"anchor\" href=\"#睡眠与休眠\">#</a> 睡眠与休眠</h3>\n<p>关于 Suspend，Linux 内核提供了四种电源模式，如下表：</p>\n<table>\n<thead>\n<tr>\n<th>模式</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>freeze</td>\n<td>冻结 I/O 设备，将它们置于低功耗状态，使处理器进入空闲状态，唤醒最快，耗电比其它 standby, mem, disk 方式高。</td>\n</tr>\n<tr>\n<td>standby</td>\n<td>除了冻结 I/O 设备外，还会暂停系统，唤醒较快，耗电比其它 mem, disk 方式高。</td>\n</tr>\n<tr>\n<td>mem</td>\n<td>将运行状态数据存到内存，并关闭外设，进入等待模式，唤醒较慢，耗电比 disk 方式高。（实际由  <code>/sys/power/mem_sleep</code>  抉择）</td>\n</tr>\n<tr>\n<td>disk</td>\n<td>将运行状态数据存到硬盘，然后关机，唤醒最慢；对于嵌入式系统，由于没有硬盘，所以一般不支持。（实际由  <code>/sys/power/disk</code>  抉择）</td>\n</tr>\n</tbody>\n</table>\n<p>然，虽然 linux 内核支持，但实际上不同的平台，对应的支持也是不一样的；可以使用以下命令查看对 Suspend 支持：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> /sys/power/state</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>freeze mem disk</pre></td></tr></table></figure><p>在这里，就只支持 3 种： <code>freeze</code>  、  <code>mem</code>  、  <code>disk</code>  。</p>\n<p>在 linux 中，有两个比较特殊的 Suspend 管理，那就是  <code>mem</code>  和  <code>disk</code>  ，分别是 <strong>Suspend to RAM（挂起到内存，通称睡眠）</strong> 和 <strong>Suspend to disk（挂起到硬盘，通称休眠）</strong> 这两种电源管理模式，它们默认使用的 ACPI 定义如下：</p>\n<ul>\n<li>\n<p>Suspend to RAM（挂起到内存，通称睡眠）</p>\n<p>ACPI 定义的 <strong>S3</strong> 睡眠状态。通过将机器中大多数和 RAM 不相关的部件断电来工作，RAM 是恢复机器状态所必需的。由于可以节省大量电力，建议笔记本电脑在使用电池运行且盖子关闭时（或用户在一段时间内处于非活动状态）自动进入此模式。</p>\n</li>\n<li>\n<p>Suspend to disk（挂起到硬盘，通称休眠）</p>\n<p>ACPI 定义的 <strong>S4</strong> 睡眠状态。将机器状态保存到交换空间并关闭机器。再次开机后，恢复状态。直到开机前，机器都不会有任何待机功耗。</p>\n</li>\n</ul>\n<p>note：实际上，  <code>mem</code>  和  <code>disk</code>  是由它们对应的配置文件决定的，但一般默认会使用上面的 ACPI 状态。</p>\n<p>对于  <code>mem</code>  和  <code>disk</code>  的控制：</p>\n<p><code>mem</code>  模式的操作由  <code>/sys/power/mem_sleep</code>  抉择，常见以下几种睡眠处理：</p>\n<ul>\n<li>deep：Suspend-To-RAM，对应 ACPI 为 S3；</li>\n<li>shallow：Power-On Suspend，对应 ACPI 为 S1；</li>\n<li>s2idle：Suspend-To-Idle，对应 ACPI 为 S0；</li>\n</ul>\n<p><code>disk</code>  模式的操作则由  <code>/sys/power/disk</code>  抉择，常见以下几种休眠处理：</p>\n<ul>\n<li>platform：使用平台（BIOS 支持）提供的方法将把系统置于超低功耗状态（如 ACPI S4），使得额外的唤醒选项可用，并且让平台固件在唤醒之后可能允许做一个简简的初始化；</li>\n<li>shutdown：顾名思义就是关闭系统设备断电；</li>\n<li>reboot：这个。。。不用说了吧；</li>\n<li>suspend：系统混合挂起，是的没错，可以将睡眠和休眠混合，可以通过在   <code>/etc/systemd/sleep.conf</code>  文件进行配置以达到效果，可参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eGNuLm9yZy93aWtpLyVFNyU5NCVCNSVFNiVCQSU5MCVFNyVBRSVBMSVFNyU5MCU4NiMlRTYlOEMlODIlRTglQjUlQjclRTYlODglOTYlRTQlQkMlOTElRTclOUMlQTAlRTglQUYlQjclRTYlQjElODIlRTYlOTclQjYlRTclOUElODQlRTYlQjclQjclRTUlOTAlODglRTclOUQlQTElRTclOUMlQTA=\">挂起或休眠请求时的混合睡眠</span> ；</li>\n<li>test_resume：诊断操作。先是加载镜像（就好像系统刚从休眠中醒来，当前运行的内核实例是还原内核），然后再恢复整个系统。</li>\n</ul>\n<p>查看支持：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> /sys/power/mem_sleep</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>s2idle <span class=\"token punctuation\">[</span>deep<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">cat</span> /sys/power/disk</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>platform<span class=\"token punctuation\">]</span> <span class=\"token function\">shutdown</span> <span class=\"token function\">reboot</span> <span class=\"token function\">suspend</span> test_resume</pre></td></tr></table></figure><p>如果想要切换相应的控制，只需往写入你要的处理模式就好了；当然，这只是在下一次中生效，当执行完一次后将会恢复；若要设成永久处理，那么可以通过修改内核属性来达到效果。</p>\n<p><strong>自动休眠：</strong></p>\n<p>一般作为服务器，是不需要自动休眠的，但对于一周也用不了多少次的，可能使用自动休眠会省电一点，配合唤醒功能即可达到快速恢复工作环境的效果。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/default/grub</pre></td></tr></table></figure><p>然后添加  <code>GRUB_CMDLINE_LINUX=&quot;mem_sleep_default=deep&quot;</code>  ，然后重新生成  <code>grub.cfg</code>  文件，重启生效：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">grub-mkconfig</span> <span class=\"token parameter variable\">-o</span> /boot/grub/grub.cfg</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">reboot</span></pre></td></tr></table></figure><p>资料：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvUG93ZXJfbWFuYWdlbWVudC9TdXNwZW5kX2FuZF9oaWJlcm5hdGU=\">https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vc2xlZXAuY29uZi5kLjU=\">https://man.archlinux.org/man/sleep.conf.d.5</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvUG93ZXJfbWFuYWdlbWVudCNTdXNwZW5kX2FuZF9oaWJlcm5hdGU=\">https://wiki.archlinux.org/title/Power_management#Suspend_and_hibernate</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudW5peHR1dG9yaWFsLm9yZy9kaXNhYmxlLXNsZWVwLW9uLXVidW50dS1zZXJ2ZXIv\">https://www.unixtutorial.org/disable-sleep-on-ubuntu-server/</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2VybmVsLm9yZy9kb2MvaHRtbC9sYXRlc3QvYWRtaW4tZ3VpZGUvcG0vc2xlZXAtc3RhdGVzLmh0bWw=\">https://www.kernel.org/doc/html/latest/admin-guide/pm/sleep-states.html</span></p>\n<p>更多电源管理：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvUG93ZXJfbWFuYWdlbWVudCNQb3dlcl9zYXZpbmc=\">https://wiki.archlinux.org/title/Power_management#Power_saving</span></p>\n<p>Kernel 参数：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2VybmVsLm9yZy9kb2MvRG9jdW1lbnRhdGlvbi9hZG1pbi1ndWlkZS9rZXJuZWwtcGFyYW1ldGVycy50eHQ=\">https://www.kernel.org/doc/Documentation/admin-guide/kernel-parameters.txt</span></p>\n<h2 id=\"图形环境切换\"><a class=\"anchor\" href=\"#图形环境切换\">#</a> 图形环境切换</h2>\n<p>前提：系统已经安装了桌面环境，需要禁止桌面环境，以纯命令行启动，以节约性能。</p>\n<p>获取当前系统运行的界面模式：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl get-default</pre></td></tr></table></figure><p>纯命令行启动：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl set-default multi-user.target</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">reboot</span></pre></td></tr></table></figure><p>桌面环境启动：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl set-default graphical.target</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">reboot</span></pre></td></tr></table></figure><p>对于多桌面，可以使用下面命令，然后选择对应的桌面系统，输入序号确认：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>update-alternatives <span class=\"token parameter variable\">--config</span> x-session-manager</pre></td></tr></table></figure><p>如果要删除  <code>x-session-manager</code>  的某个选项，可以先通过以下方式列出其路径，然后通过删除选项（eg：gnome-session）：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>update-alternatives <span class=\"token parameter variable\">--list</span> x-session-manager</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>update-alternatives <span class=\"token parameter variable\">--remove</span> x-session-manager /usr/bin/gnome-session</pre></td></tr></table></figure><p>参考：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly91bml4LnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy8zNjcyOTQvaG93LWRvLWktY2hhbmdlLW15LWRlZmF1bHQtc2Vzc2lvbg==\">https://unix.stackexchange.com/questions/367294/how-do-i-change-my-default-session</span></p>\n<h2 id=\"远程唤醒\"><a class=\"anchor\" href=\"#远程唤醒\">#</a> 远程唤醒</h2>\n<p>首先，查看系统主板 BIOS 是否支持 Wake-On-LAN ，要是支持的话，必须先启动它，因为它被默认设禁用。</p>\n<p>然后，需要一个支持 Wake-On-LAN 的网卡；<mark>无线网卡并不支持</mark>。你需要运行  <code>ethtool</code>  命令查看网卡是否支持 Wake-On-LAN ：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token function\">ethtool</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ethtool</span> eno1 <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> Wake-on</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        Supports Wake-on: pumbg</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        Wake-on: d</pre></td></tr></table></figure><p>这条命令输出的  <code>Supports Wake-on</code>  字段会告诉你你的网卡支持哪些功能，同时  <code>Wake-on</code>  指示着当前配置的模式，一般有以下几种选项：</p>\n<ul>\n<li>d -- 禁用（disable）</li>\n<li>p -- 物理活动唤醒（Wake on PHY activity）</li>\n<li>u -- 单播消息唤醒（Wake on unicast activity）</li>\n<li>m -- 多播（组播）消息唤醒（Wake on multicast activity）</li>\n<li>b -- 广播消息唤醒（Wake on broadcast activity）</li>\n<li>a -- ARP 唤醒（Wake on ARP activity）</li>\n<li>g -- 特定数据包唤醒（magic packet activity）</li>\n</ul>\n<p>修改 wol 功能：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ethtool</span> <span class=\"token parameter variable\">-s</span> eno1 wol g</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ethtool</span> eno1 <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> Wake-on</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        Supports Wake-on: pumbg</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        Wake-on: g</pre></td></tr></table></figure><p>此刻已经开启 magic packet 唤醒了，然后执行  <code>ip a</code>  查看网卡的 mac 地址和 ip 并记录，再写入  <code>echo mem &gt; /sys/power/state</code>  ，让系统进入休眠，再在另一台主机测试网络唤醒。</p>\n<ul>\n<li>\n<p>Windows</p>\n<p>可以选择该工具使用：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGVwaWN1cy5jb20vd2FrZS1vbi1sYW4vd2FrZS1vbi1sYW4tY21k\">Wake On Lan Command Line</span> 。</p>\n</li>\n<li>\n<p>Linux</p>\n<p>可以安装对应的 pack 包（eg：etherwake），这里就不多说了。</p>\n</li>\n</ul>\n<p>当你能成功唤醒后，就证明你的主板支持，bios 上的 wol 有启用，系统配置上也打开了。</p>\n<p>最后，对于部分系统，可能有些在设置完显示  <code>Wake-on: g</code>  后，重启会变回默认配置，这时可以编写一个开机启动服务：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/systemd/system/wol@.service</pre></td></tr></table></figure><p>添加如下内容：</p>\n<figure class=\"highlight wiki\"><figcaption data-lang=\"Wiki markup\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token url\">[Unit]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Description=Wake-on-LAN for %i</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Requires=network.target</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>After=network.target</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token url\">[Service]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ExecStart=/usr/bin/ethtool -s %i wol g</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Type=oneshot</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token url\">[Install]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>WantedBy=multi-user.target</pre></td></tr></table></figure><p>然后 [Install] 区块中的  <code>WantedBy</code>  字段，是表示该服务所在的 Target。如  <code>WantedBy=multi-user.target</code>  指的是该服务所属于  <code>multi-user.target</code>  ；当执行  <code>systemctl enable xxx.service</code>  命令时， <code>xxx.service</code>  的符号链接就会被创建在  <code>/etc/systemd/system/multi-user.target</code>  目录下。可以通过  <code>systemctl get-default</code>  命令查看系统默认启动的 target，一般为  <code>multi-user</code>  或者是  <code>graphical</code> 。因此配置好相应的  <code>WantedBy</code>  字段，可以实现服务的开机启动。</p>\n<p><code>multi-user.target</code>  表示多用户命令行状态；  <code>graphical.target</code>  表示图形用户状态，它依赖于  <code>multi-user.target</code>  。官方文档有一张非常清晰的 [Target 依赖关系图](<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWRlc2t0b3Aub3JnL3NvZnR3YXJlL3N5c3RlbWQvbWFuL2Jvb3R1cC5odG1sI1N5c3RlbQ==\">https://www.freedesktop.org/software/systemd/man/bootup.html#System</span> Manager Bootup)。</p>\n<p>嘛，如果你是用图形界面的，也是可以用  <code>multi-user.target</code>  的，因为  <code>graphical.target</code>  依赖  <code>multi-user.target</code>  ，可以利用命令  <code>systemctl list-units --type=target</code>  查看到  <code>multi-user.target</code>  是处于 Active 状态的。</p>\n<p>最后，重新加载所有的 systemd 服务，打开自启动并启动服务，其中  <code>@</code>  后面跟随的是你的 wol 网卡名称：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> systemctl daemon-reload</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> wol@eno1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> systemctl start wol@eno1</pre></td></tr></table></figure><p>note：</p>\n<p>对于 systemd 服务的控制，可以使用如下命令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl <span class=\"token punctuation\">[</span>command<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>unit<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>[command]：</p>\n<ul>\n<li>\n<p>start：立刻启动后面接的 unit。</p>\n</li>\n<li>\n<p>stop：立刻关闭后面接的 unit。</p>\n</li>\n<li>\n<p>restart：立刻关闭后启动后面接的 unit，亦即执行 stop 再 start 的意思。</p>\n</li>\n<li>\n<p>reload：不关闭 unit 的情况下，重新载入配置文件，让设置生效。</p>\n</li>\n<li>\n<p>enable：设置下次开机时，后面接的 unit 会被启动。</p>\n</li>\n<li>\n<p>disable：设置下次开机时，后面接的 unit 不会被启动。</p>\n</li>\n<li>\n<p>status：目前后面接的这个 unit 的状态，会列出有没有正在执行、开机时是否启动等信息。</p>\n</li>\n<li>\n<p>is-active：目前有没有正在运行中。</p>\n</li>\n<li>\n<p>is-enable：开机时有没有默认要启用这个 unit。</p>\n</li>\n<li>\n<p>kill ：不要被 kill 这个名字吓着了，它其实是向运行 unit 的进程发送信号。</p>\n</li>\n<li>\n<p>show：列出 unit 的配置。</p>\n</li>\n<li>\n<p>mask：注销 unit，注销后你就无法启动这个 unit 了。</p>\n</li>\n<li>\n<p>unmask：取消对 unit 的注销。</p>\n</li>\n</ul>\n<p>一些其它命令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl poweroff <span class=\"token comment\"># 系统关机</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>systemctl <span class=\"token function\">reboot</span> <span class=\"token comment\"># 重新开机</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>systemctl <span class=\"token function\">suspend</span> <span class=\"token comment\"># 进入暂停模式</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>systemctl hibernate <span class=\"token comment\"># 进入休眠模式</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>systemctl rescue <span class=\"token comment\"># 强制进入救援模式</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>systemctl emergency <span class=\"token comment\"># 强制进入紧急救援模式</span></pre></td></tr></table></figure><p>资料：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmFyY2hsaW51eC5vcmcvdGl0bGUvV2FrZS1vbi1MQU4=\">https://wiki.archlinux.org/title/Wake-on-LAN</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmRlYmlhbi5vcmcvV2FrZU9uTGFu\">https://wiki.debian.org/WakeOnLan</span></p>\n<h2 id=\"异常记录查看\"><a class=\"anchor\" href=\"#异常记录查看\">#</a> 异常记录查看</h2>\n<p>使用  <code>last -x shutdown reboot</code>  命令可以查看系统的关机和重启记录，包括异常关机。该命令会显示每次关机或重启的时间、持续时间。</p>\n<p>使用  <code>dmesg | grep &quot;shutdown&quot;</code>  命令可以查看内核的消息缓冲区，筛选出关机的相关信息。</p>\n<p>参考：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly91bml4LnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy85ODE5L2hvdy10by1maW5kLW91dC1mcm9tLXRoZS1sb2dzLXdoYXQtY2F1c2VkLXN5c3RlbS1zaHV0ZG93bg==\">https://unix.stackexchange.com/questions/9819/how-to-find-out-from-the-logs-what-caused-system-shutdown</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4MzQ1NjU3L2FydGljbGUvZGV0YWlscy8xMjY4MzMxMzE=\">https://blog.csdn.net/qq_28345657/article/details/126833131</span></p>\n<h2 id=\"系统备份\"><a class=\"anchor\" href=\"#系统备份\">#</a> 系统备份</h2>\n<p>linux 系统说白了就是一个强大的文件系统，既然是文件，哪能不能像日常备份文件那样直接压缩备份呢？答案是可以，只是在备份压缩的时候注意把各个文件的权限都保留下来。</p>\n<p>在备份之前先了解一下 linux 的系统目录结构：</p>\n<table>\n<thead>\n<tr>\n<th>文件夹</th>\n<th>英文全称</th>\n<th>文件夹作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/boot</td>\n<td>Boot</td>\n<td>存放的启动 Linux 时使用的内核文件，包括连接文件以及镜像文件。</td>\n</tr>\n<tr>\n<td>/bin</td>\n<td>Binaries</td>\n<td>存放着最常用的程序和指令，所有用户都可以执行。是  <code>/usr/bin</code>  目录的软连接。</td>\n</tr>\n<tr>\n<td>/sbin</td>\n<td>Super User Binaries</td>\n<td>保存和系统环境设置相关的命令，只有超级用户可以使用这些命令，有些命令可以允许普通用户查看。是  <code>/usr/sbin</code>  目录的软连接。</td>\n</tr>\n<tr>\n<td>/usr</td>\n<td>Unix Software Resources</td>\n<td>用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录。</td>\n</tr>\n<tr>\n<td>/usr/bin</td>\n<td>Unix Software Resources Binaries</td>\n<td>系统用户使用的应用程序与指令。</td>\n</tr>\n<tr>\n<td>/usr/sbin</td>\n<td>Unix Software Resources Superuser Binaries</td>\n<td>超级用户使用的比较高级的管理程序和系统守护程序。</td>\n</tr>\n<tr>\n<td>/usr/local</td>\n<td>Unix Software Resources Local</td>\n<td>安装第三方软件的安装目录，一般是通过编译源码的方式安装的程序。</td>\n</tr>\n<tr>\n<td>/usr/src</td>\n<td>Unix Software Resources Source</td>\n<td>内核源代码默认的放置目录。</td>\n</tr>\n<tr>\n<td>/dev</td>\n<td>Devices</td>\n<td>存放的是 Linux 的外部设备。注意：在 Linux 中访问设备和访问文件的方式是相同的。</td>\n</tr>\n<tr>\n<td>/etc</td>\n<td>Editable Text Configuration Chest</td>\n<td>存放所有的系统需要的配置文件和子目录列表，更改目录下的文件可能会导致系统不能启动。</td>\n</tr>\n<tr>\n<td>/opt</td>\n<td>Optional Application Software Packages</td>\n<td>可选应用软件包，第三方安装的软件保存位置，存放软件安装包。</td>\n</tr>\n<tr>\n<td>/lib</td>\n<td>Library</td>\n<td>存放基本代码库（比如 c++ 库），其作用类似于 Windows 里的 DLL 文件。几乎所有的应用程序都需要用到这些共享库。</td>\n</tr>\n<tr>\n<td>/proc</td>\n<td>Processes</td>\n<td>虚拟文件系统，数据保存在内存中，存放当前进程信息</td>\n</tr>\n<tr>\n<td>/root</td>\n<td>Root</td>\n<td>系统管理员的用户主目录。</td>\n</tr>\n<tr>\n<td>/tmp</td>\n<td>Temporary</td>\n<td>存放临时文件</td>\n</tr>\n<tr>\n<td>/var</td>\n<td>Variable</td>\n<td>存放经常修改的数据，比如程序运行的日志文件（ <code>/var/log</code>  目录下）。</td>\n</tr>\n<tr>\n<td>/home</td>\n<td>Home</td>\n<td>用户缺省宿主目录。</td>\n</tr>\n<tr>\n<td>/lost+found</td>\n<td>Lost And Found</td>\n<td>一般情况下为空的，存放一些系统出错的检查结果</td>\n</tr>\n<tr>\n<td>/srv</td>\n<td>Server</td>\n<td>服务数据目录</td>\n</tr>\n<tr>\n<td>/sys</td>\n<td>System</td>\n<td>这是 linux2.6 内核的一个很大的变化。该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs。sysfs 文件系统集成了下面 3 种文件系统的信息：针对进程信息的 proc 文件系统、针对设备的 devfs 文件系统以及针对伪终端的 devpts 文件系统。该文件系统是内核设备树的一个直观反映。当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中。</td>\n</tr>\n<tr>\n<td>/mnt</td>\n<td>Mount</td>\n<td>挂载目录。临时文件系统的安装点，默认挂载光驱和软驱的目录</td>\n</tr>\n<tr>\n<td>/media</td>\n<td>Media</td>\n<td>挂载目录。 挂载媒体设备，如软盘和光盘</td>\n</tr>\n<tr>\n<td>/misc</td>\n<td>Miscellaneous Device</td>\n<td>挂载目录。 挂载 NFS 服务</td>\n</tr>\n<tr>\n<td>/run</td>\n<td>Run</td>\n<td>里面的东西是系统运行时需要的，不能随便删除。当系统重启时，这个目录下的文件应该被删掉或清除；下次系统运行时重新生成。</td>\n</tr>\n</tbody>\n</table>\n<p>备份系统：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">su</span> -</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zcvpf</span> backup.tgz <span class=\"token parameter variable\">--exclude</span><span class=\"token operator\">=</span>/proc <span class=\"token parameter variable\">--exclude</span><span class=\"token operator\">=</span>/lost+found <span class=\"token parameter variable\">--exclude</span><span class=\"token operator\">=</span>/backup.tgz <span class=\"token parameter variable\">--exclude</span><span class=\"token operator\">=</span>/mnt <span class=\"token parameter variable\">--exclude</span><span class=\"token operator\">=</span>/sys <span class=\"token parameter variable\">--exclude</span><span class=\"token operator\">=</span>/media /</pre></td></tr></table></figure><h1 id=\"安装-openmediavault-6x\"><a class=\"anchor\" href=\"#安装-openmediavault-6x\">#</a> 安装 openmediavault 6.x</h1>\n<p>在操作如下流程前，要进行备份！备份！备份！</p>\n<p>具体安装以 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm9wZW5tZWRpYXZhdWx0Lm9yZy9lbi9sYXRlc3QvaW5zdGFsbGF0aW9uL29uX2RlYmlhbi5odG1s\">https://docs.openmediavault.org/en/latest/installation/on_debian.html</span> 为准。</p>\n<p>1、临时配置环境变量</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">LANG</span></span><span class=\"token operator\">=</span>C.UTF-8</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DEBIAN_FRONTEND</span><span class=\"token operator\">=</span>noninteractive</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">APT_LISTCHANGES_FRONTEND</span><span class=\"token operator\">=</span>none</pre></td></tr></table></figure><p>2、添加软件包存储库</p>\n<p>进入文件编辑：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/apt/sources.list.d/openmediavault.list</pre></td></tr></table></figure><p>然后粘贴以下存储库链接（这里使用的是 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9taXJyb3JzLmJmc3UuZWR1LmNuL2hlbHAvb3Blbm1lZGlhdmF1bHQv\">北外镜像</span>，以加快国内访问速度，当然你也可以使用源链接），保存退出：</p>\n<figure class=\"highlight wiki\"><figcaption data-lang=\"Wiki markup\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>deb https://mirrors.bfsu.edu.cn/OpenMediaVault/public shaitan main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>deb https://mirrors.bfsu.edu.cn/OpenMediaVault/packages shaitan main</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">#</span><span class=\"token punctuation\">#</span> Uncomment the following line to add software from the proposed repository.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">#</span> deb https://mirrors.bfsu.edu.cn/OpenMediaVault/public shaitan-proposed main</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">#</span> deb https://mirrors.bfsu.edu.cn/OpenMediaVault/packages shaitan-proposed main</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">#</span><span class=\"token punctuation\">#</span> This software is not part of OpenMediaVault, but is offered by third-party</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">#</span><span class=\"token punctuation\">#</span> developers as a service to OpenMediaVault users.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">#</span> deb https://mirrors.bfsu.edu.cn/OpenMediaVault/public shaitan partner</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">#</span> deb https://mirrors.bfsu.edu.cn/OpenMediaVault/packages shaitan partner</pre></td></tr></table></figure><p>3、添加 openmediavault 密钥</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">--yes</span> gnupg</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">wget</span> <span class=\"token parameter variable\">--quiet</span> --output-document<span class=\"token operator\">=</span>- https://packages.openmediavault.org/public/archive.key <span class=\"token operator\">|</span> gpg <span class=\"token parameter variable\">--dearmor</span> <span class=\"token parameter variable\">--yes</span> <span class=\"token parameter variable\">--output</span> <span class=\"token string\">\"/usr/share/keyrings/openmediavault-archive-keyring.gpg\"</span></pre></td></tr></table></figure><p>4、更新软件包源并安装 omv</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt-get</span> update</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">--yes</span> --auto-remove --show-upgraded <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    --allow-downgrades --allow-change-held-packages <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    --no-install-recommends <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token parameter variable\">--option</span> DPkg::Options::<span class=\"token operator\">=</span><span class=\"token string\">\"--force-confdef\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token parameter variable\">--option</span> DPkg::Options::<span class=\"token operator\">=</span><span class=\"token string\">\"--force-confold\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token function\">install</span> openmediavault</pre></td></tr></table></figure><p>5、同步系统配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>omv-confdbadm populate</pre></td></tr></table></figure><p>note：</p>\n<p>对于网络服务，现在只解析  <code>/etc/network/interfaces</code>  以获取当前的网络配置。 如果以不同的方式配置网络（例如通过  <code>systemd</code>  或  <code>NetworkManager</code> ），则不会填充数据库，并且不包含使用  <code>netplan for systemd-networkd 和 systemd-resolved</code>  部署网络配置所需的信息。 在这种情况下，请使用  <code>omv-firstaid</code>  命令执行初始网络配置。</p>\n<p>如果想通过 openmediavault 使用的服务重新部署网络配置，则执行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/network/interfaces</pre></td></tr></table></figure><p>然后把里面的网卡配置用  <code>#</code>  注释掉，接着：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rm</span> /etc/systemd/network/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>netplan apply</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>omv-salt deploy run systemd-networkd</pre></td></tr></table></figure><h2 id=\"omv6-基本配置\"><a class=\"anchor\" href=\"#omv6-基本配置\">#</a> omv6 基本配置</h2>\n<h2 id=\"用户账户设置\"><a class=\"anchor\" href=\"#用户账户设置\">#</a> 用户账户设置</h2>\n<p>安装完 omv 后，如果有使用  <code>同步系统配置</code>  操作，那么，在  <code>用户</code>  -&gt;  <code>用户</code>  管理中可以看到前面安装系统时创建的用户，之后，你可以在这里创建或修改各类用户；为了安全你也可以删除掉 root 用户，以避免 root 登录，需要注意权限问题，避免登录 omv web 无法操作。</p>\n<p>note：如果存在多个用户，在众多用户里，至少要有一个用户添加到  <code>openmediavault-admin</code>  的  <code>ssh group</code>  中，这将决定在登录 omv web 后是否拥有配置操作，否则任意用户登录 omv web 上都不存完整的配置操作。具体可看 <strong>omv 登陆后界面只剩仪表盘</strong> 。</p>\n<h2 id=\"配置-ssh\"><a class=\"anchor\" href=\"#配置-ssh\">#</a> 配置 SSH</h2>\n<p>进入  <code>服务</code>  -&gt;  <code>SSH</code> ，选择勾选  <code>已启用</code>  选项，接着按个人需求修改配置，同时为能 SSH 登录操作的用户添加到  <code>ssh group</code>  ；如果你想为了安全，而选择关闭  <code>允许 root 登陆</code>  和  <code>密码验证</code>  选项，那么需要注意的是，至少要为一个用户添加  <code>ssh group</code>  ，否则将没有用户可以登录 SSH，同时为用户配置好 SSH 密钥对。</p>\n<p>note：SSH 密钥对生成，需要先在本机系统中（即需要控制的机器上，一般就是我们的 windows 系统上），输入  <code>ssh-keygen</code>  命令，然后输入存储的路径及命名  <code>~/.ssh/omv-id_rsa</code>  ，如果需要为调用私钥而添加密码认证，则输入密码，否者直接留空回车，不设密码，最后再次确认回车，至此就生成了 SSH 密钥对了；紧接着在 omv web 的  <code>用户</code>  -&gt;  <code>用户</code>  中选择你需要进行 SSH 密钥登录的账户，然后编辑，在  <code>SSH 公钥</code>  中添加刚才生成的密钥对中的公钥（即  <code>omv-id_rsa.pub</code>  ），至此就完成了。</p>\n<h2 id=\"替换更新镜像源\"><a class=\"anchor\" href=\"#替换更新镜像源\">#</a> 替换更新镜像源</h2>\n<p>配置基本链接的镜像源（原因是在你安装完 omv 后，前面配置的软件包存储库链接将会修改为官方默认的链接，此时需要重新设置镜像）：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>omv-env <span class=\"token builtin class-name\">set</span> OMV_APT_REPOSITORY_URL <span class=\"token string\">\"https://mirrors.bfsu.edu.cn/OpenMediaVault/public\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>omv-env <span class=\"token builtin class-name\">set</span> OMV_APT_ALT_REPOSITORY_URL <span class=\"token string\">\"https://mirrors.bfsu.edu.cn/OpenMediaVault/packages\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>omv-env <span class=\"token builtin class-name\">set</span> OMV_APT_KERNEL_BACKPORTS_REPOSITORY_URL <span class=\"token string\">\"https://mirrors.bfsu.edu.cn/debian\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>omv-env <span class=\"token builtin class-name\">set</span> OMV_APT_SECURITY_REPOSITORY_URL <span class=\"token string\">\"https://mirrors.bfsu.edu.cn/debian-security\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>omv-salt stage run all</pre></td></tr></table></figure><p>然后执行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> update</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">reboot</span></pre></td></tr></table></figure><p>重启后回到 omv 网页，你会看到有提示显示可以更新软件。</p>\n<p>note：</p>\n<p>对于使用  <code>omv-env set</code>  更换源，其实是在不同的  <code>openmediavault</code>  文件写入，这些文件可以在  <code>/etc/apt/sources.list.d/</code>  中找到。</p>\n<h2 id=\"安装-omv-extras\"><a class=\"anchor\" href=\"#安装-omv-extras\">#</a> 安装 omv-extras</h2>\n<p>由于国内原因，防 github 解析错误，执行以下操作，如果这时候已经出现网络问题，则使用手动方法，查看 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tLzUyMXh1ZXdlaWhhbi9HaXRIdWI1MjA=\">GitHub520</span> ：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">\"/# GitHub520 Host Start/Q\"</span> /etc/hosts <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">curl</span> https://raw.hellogithub.com/hosts <span class=\"token operator\">>></span> /etc/hosts</pre></td></tr></table></figure><p>根据<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLm9tdi1leHRyYXMub3JnL2Rva3UucGhwP2lkPW9tdjY6bmV3X3VzZXJfZ3VpZGUjb212LWV4dHJhcw==\">官方</span>提供，安装 omv-extras：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">wget</span> <span class=\"token parameter variable\">-O</span> - https://github.com/OpenMediaVault-Plugin-Developers/packages/raw/master/install <span class=\"token operator\">|</span> <span class=\"token function\">bash</span></pre></td></tr></table></figure><p>然后刷新 omv 网页，即可在  <code>系统</code>  中找到 omv-extras。</p>\n<p>如果网络不好可以手动安装：</p>\n<ol>\n<li>进入 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL09wZW5NZWRpYVZhdWx0LVBsdWdpbi1EZXZlbG9wZXJzL3BhY2thZ2Vz\">https://github.com/OpenMediaVault-Plugin-Developers/packages</span> 下载对应的插件包，然后把插件包放到 omv 上，路径自己决定，然后进入该路径执行：</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dpkg <span class=\"token parameter variable\">-i</span> openmediavault-omvextrasorg_xxx.deb</pre></td></tr></table></figure><p>更新 omv-extras 镜像源：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>omv-env <span class=\"token builtin class-name\">set</span> OMV_EXTRAS_APT_REPOSITORY_URL <span class=\"token string\">\"https://mirrors.bfsu.edu.cn/OpenMediaVault/openmediavault-plugin-developers\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>omv-env <span class=\"token builtin class-name\">set</span> OMV_DOCKER_APT_REPOSITORY_URL <span class=\"token string\">\"https://mirrors.bfsu.edu.cn/docker-ce/linux/debian\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>omv-env <span class=\"token builtin class-name\">set</span> OMV_PROXMOX_APT_REPOSITORY_URL <span class=\"token string\">\"https://mirrors.bfsu.edu.cn/proxmox/debian\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>omv-salt stage run all</pre></td></tr></table></figure><h2 id=\"安装-docker\"><a class=\"anchor\" href=\"#安装-docker\">#</a> 安装 docker</h2>\n<p>进入  <code>系统</code>  -&gt;  <code>插件</code> ，搜索  <code>compose</code>  ，点击选择下载，然后等待下载完成；</p>\n<p>进入  <code>系统</code>  -&gt;  <code>omv-extras</code> ，勾选  <code>Docker repo</code> ，点保存；</p>\n<p>最后在  <code>服务</code>  -&gt;  <code>Compose</code>  中可以找到  <code>设置</code> ，查看 Docker 状态是否为  <code>Installed and running</code> ，如果不是，可以尝试重启 Docker 或者重新安装 Docker；再不行就回到第二点先取消勾选接着保存，然后再把   <code>Docker repo</code>  勾选上保存并重复后面操作。</p>\n<p>参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLm9tdi1leHRyYXMub3JnL2Rva3UucGhwP2lkPW9tdjY6ZG9ja2VyX2luX29tdiNkb2t1d2lraV9fdG9w\">https://wiki.omv-extras.org/doku.php?id=omv6:docker_in_omv#dokuwiki__top</span></p>\n<p>如果 Docker 无法运行，输入  <code>systemctl status docker</code>  查看状态，然后再执行  <code>systemctl restart docker</code>  看是否成功，如果显示如下错误：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Job for docker.service failed because the control process exited with error code.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>See \"systemctl status docker.service\" and \"journalctl -xe\" for details.</pre></td></tr></table></figure><p>可以使用命令  <code>journalctl -xe</code>  和  <code>dockerd --debug</code>  来分析无法运行的错误。</p>\n<p>参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTU5MDY1MDMvZG9ja2VyLWhvdy10by1maXgtam9iLWZvci1kb2NrZXItc2VydmljZS1mYWlsZWQtYmVjYXVzZS10aGUtY29udHJvbC1wcm9jZXNzLWV4\">https://stackoverflow.com/questions/55906503/docker-how-to-fix-job-for-docker-service-failed-because-the-control-process-ex</span></p>\n<h3 id=\"docker-换源\"><a class=\"anchor\" href=\"#docker-换源\">#</a> docker 换源</h3>\n<p>编辑  <code>/etc/docker/daemon.json</code>  配置文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/docker/daemon.json</pre></td></tr></table></figure><p>更改为以下信息：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"data-root\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"/var/lib/docker\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//docker 存储路径</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"registry-mirrors\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">\"https://docker.mirrors.ustc.edu.cn\"</span> <span class=\"token comment\">// 更改换源</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>note：如果是在  <code>/etc/docker/daemon.json</code>  文件上指定 Docker 存储路径，那么，在  <code>服务</code>  -&gt;  <code>Compose</code>  -&gt;  <code>设置</code>  -&gt;  <code>Docker</code>  中的  <code>Docker 存储</code>  上留空配置（该下方有备注说明）。</p>\n<p>最后，使用如下命令重启生效：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl restart <span class=\"token function\">docker</span></pre></td></tr></table></figure><p>完成后使用  <code>docker info</code>  命令，查看  <code>Registry Mirrors:</code>  是否为配置的镜像源。</p>\n<h3 id=\"安装管理面板\"><a class=\"anchor\" href=\"#安装管理面板\">#</a> 安装管理面板</h3>\n<p>如果你喜欢敲命令来操作 Docker，那么这点你可以跳过了，否则可以安装 portainer 对 Docker 进行页面管理。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 拉取汉化版镜像</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> pull <span class=\"token number\">6053537</span>/portainer-ce:latest</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 启动容器</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token parameter variable\">--name</span> portainer <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">9000</span>:9000 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /app/portainer_data:/data <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token parameter variable\">--privileged</span><span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token parameter variable\">--restart</span> always <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token number\">6053537</span>/portainer-ce:latest</pre></td></tr></table></figure><p>note：在  <code>docker run</code>  执行后面加入  <code>--restart=always</code>  可以使开机后会自动启动面板，否者还要自己连到设备启动。</p>\n<p>最后通过访问  <code>http://localhost:9000</code>  来访问 portainer 的 Web 界面。</p>\n<h2 id=\"安装-komga-漫画管理\"><a class=\"anchor\" href=\"#安装-komga-漫画管理\">#</a> 安装 komga 漫画管理</h2>\n<p>为你的 komga 存放创建数据和配置目录：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># $PATH 为你存储盘的路径</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/komga/config /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/komga/data</pre></td></tr></table></figure><p>根据官方提示，输入如下命令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /<span class=\"token environment constant\">$PATH</span>/</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> pull gotson/komga:latest</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token parameter variable\">--name</span> komga <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/komga/data:/data <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/komga/config:/config <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">25600</span>:25600 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">TZ</span><span class=\"token operator\">=</span>Asia/Shanghai <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token parameter variable\">--restart</span> always <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token parameter variable\">--user</span> <span class=\"token string\">\"0:0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  gotson/komga</pre></td></tr></table></figure><p>参数解释：</p>\n<ul>\n<li><code>-d</code>  ：以后台模式运行容器。</li>\n<li><code>--name komga</code>  ：设置容器的名称为  <code>komga</code> 。</li>\n<li><code>-v $(pwd)/data:/data</code>  和  <code>-v $(pwd)/config:/config</code>  ：将主机的当前目录下的  <code>data</code>  和  <code>config</code>  目录分别映射到容器的  <code>/data</code>  和  <code>/config</code>  路径，用于数据和配置的持久化。</li>\n<li><code>-p 25600:25600</code>  ：将容器的 25600 端口映射到主机的 25600 端口，使得 Komga 的 Web 界面可以通过主机的端口访问。</li>\n<li><code>-e TZ=Asia/Shanghai</code>  ：设置容器的环境变量  <code>TZ</code> ，用于指定时区。</li>\n<li><code>--restart always</code>  ：确保容器在退出时自动重启。</li>\n<li><code>--user &quot;0:0&quot;</code>  ：以 root 用户运行容器，这对于某些环境的权限管理是必要的。</li>\n<li><code>gotson/komga</code> ：指定使用的 Docker 镜像。</li>\n</ul>\n<p>最后通过访问  <code>http://localhost:25600</code>  来访问 Komga 的 Web 界面。</p>\n<p>note：用 docker 容器安装的话，在  <code>添加库</code>  时选择的根文件夹填写的是容器内部的路径（即上面的  <code>/data</code>  目录下）。</p>\n<p>拓展：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGltaWt1LmNvbS9hcmNoaXZlcy9rb21nYS5odG1s\">https://www.himiku.com/archives/komga.html</span></p>\n<h2 id=\"创建-raid-软阵列\"><a class=\"anchor\" href=\"#创建-raid-软阵列\">#</a> 创建 Raid 软阵列</h2>\n<p>在这里，不选择在 omv 页面上创建，而是使用命令创建。以 Raid 1 为例：</p>\n<ol>\n<li>\n<p>准备两个硬盘，最好使用同型号的不同批次跟产期的，如果选择不同型号的，那么要考虑转速、缓存、容量这些尽可能一致。</p>\n</li>\n<li>\n<p><code>lsblk</code>  获取需要建立 Raid 的磁盘名称  <code>sdx</code>  （sdx 可以为 sda、sdb 等）。</p>\n</li>\n<li>\n<p>使用  <code>fdisk /dev/sdx</code>  分别为两块磁盘创建单一分区。</p>\n<ul>\n<li><code>m</code>  ：查看命令操作。</li>\n<li><code>d</code>  ：删除已有分区。</li>\n<li><code>n</code>  ：创建新的分区。</li>\n<li><code>p</code>  ：查看创建分区。</li>\n<li><code>w</code>  ：应用分区信息。</li>\n</ul>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>按 n 创建新的分区。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>然后按 p 选择主分区。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>接下来选择分区号为 1。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>按两次回车键默认将整个容量分配给它。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>然后，按 p 来打印创建好的分区。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>按 l，列出所有可用的类型。</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>按 t 修改分区类型。</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>键入 29 设置为 Linux 的 RAID 类型，然后按 Enter 确认。</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>然后再次使用 p 查看我们所做的更改。</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>使用 w 保存更改。</pre></td></tr></table></figure></li>\n<li>\n<p>利用  <code>mdadm</code>  命令建立 Raid 软阵列。</p>\n<ul>\n<li>\n<p>检查 sdx 分区并确认 Raid 分区的类型  <code>mdadm -E /dev/sdx</code>  。</p>\n</li>\n<li>\n<p>假设用  <code>dev/sdb1</code>  和  <code>dev/sdc1</code>  两个磁盘创建一个名为  <code>/dev/md0</code>  的 Raid 1 设备  <code>mdadm --create /dev/md0 --level=1 --raid-device=2 /dev/sd[b-c]1</code>  。</p>\n</li>\n<li>\n<p>查看 Raid 同步状态  <code>cat /proc/mdstat</code>  。初次建立构建，需要很长一段时间。可以通过以下命令调整 Raid 同步速度：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sysctl</span> <span class=\"token parameter variable\">-w</span> <span class=\"token assign-left variable\">dev.raid.speed_limit_max</span><span class=\"token operator\">=</span><span class=\"token number\">2000000</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sysctl</span> <span class=\"token parameter variable\">-w</span> <span class=\"token assign-left variable\">dev.raid.speed_limit_min</span><span class=\"token operator\">=</span><span class=\"token number\">100000</span></pre></td></tr></table></figure></li>\n<li>\n<p>使用  <code>mdadm -E /dev/sdx1</code>  分别查看 Raid 设备类型。</p>\n</li>\n<li>\n<p>为  <code>dev/md0</code>  创建 ext4 文件系统  <code>mkfs.ext4 /dev/md0</code>  ，最好等初始化构建完成后操作。</p>\n</li>\n<li>\n<p>检查 Raid 信息  <code>mdadm -D /dev/md0</code>  。</p>\n</li>\n</ul>\n</li>\n</ol>\n<p>常见的 RAID 磁盘阵列：</p>\n<table>\n<thead>\n<tr>\n<th>阵列</th>\n<th>描述</th>\n<th>特点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>JBOD（线性）</td>\n<td>JBOD 不是标准的 RAID 级别，它只是在近几年才被一些厂家提出，并被广泛采用。虽然 JBOD 让多个磁盘看来似乎只有一个，但它是通过把多个驱动器合并成一个大的逻辑磁盘来做到这一点的。</td>\n<td>- 任意一块硬盘损坏，整个 JBOD 都无法使用。&lt;br/&gt;- 未损坏的硬盘上的数据不会丢失，但恢复数据存在门槛。</td>\n</tr>\n<tr>\n<td>RAID 0</td>\n<td>RAID 0 是组建磁盘阵列中最简单的一种形式，只需要 2 块以上的硬盘即可。 RAID 0 是 RAID 磁盘阵列中性能最好的硬盘组合方式，但没有提供冗余或错误修复能力。</td>\n<td>按照一定规则，将文件拆分存储在 RAID 0 中，一旦一块硬盘损坏，整个 RAID 0 的所有数据全部丢失。</td>\n</tr>\n<tr>\n<td>RAID 1（镜像）</td>\n<td>RAID 1 称为磁盘镜像，由至少 2 块硬盘组成。原理是把一个磁盘的数据镜像到另一个磁盘上，也就是说数据在写入一块磁盘的同时，会在另一块闲置的磁盘上生成镜像文件。只要系统中任何一对镜像盘中至少有一块磁盘可以使用，甚至可以在一半数量的硬盘出现问题时系统都可以正常运行。它是 RAID 磁盘阵列中性能最差，数据安全性最佳的。</td>\n<td>会损失一半硬盘容量。</td>\n</tr>\n<tr>\n<td>RAID 5</td>\n<td>RAID 5 被称为 “分布式奇偶校验的独立磁盘结构” ，需最低 3 块硬盘组成。&lt;br/&gt; 每在 RAID 5 中存入一个文件，3 块硬盘中：1 块用于存储该文件；2 块用于生成奇偶校验信息。</td>\n<td>只要 RAID 5 中只有 1 块硬盘损坏，就可以替换该硬盘并恢复数据；会损失 1 块硬盘容量。</td>\n</tr>\n<tr>\n<td>RAID 6</td>\n<td>RAID 6 是对 RAID 5 的扩展，需最低 4 块硬盘组成。&lt;br/&gt; 每在 RAID 6 中存入一个文件，4 块硬盘中：2 块用于存储该文件；2 块用于生成奇偶校验信息。</td>\n<td>只要 RAID 6 中有任意 2 块硬盘损坏，就可以替换这 2 块硬盘并恢复数据；会损失 2 块硬盘容量。</td>\n</tr>\n<tr>\n<td>RAID 10</td>\n<td>RAID 10 需要至少 4 块硬盘组成，每 2 块硬盘组成一个 RAID 1 ，2 个 RAID 1 组成一个 RAID 0 。性能与安全性在 RAID 0 和 RAID 1 中取得了一个平衡。</td>\n<td>性能比 RAID 0 差，比 RAID 1 高；安全性同于 RAID 1 。</td>\n</tr>\n</tbody>\n</table>\n<p>扩展：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZmVsaXgtenAvcC85NzM4NzI0Lmh0bWw=\">https://www.cnblogs.com/felix-zp/p/9738724.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZmx5c2ZlcS5zaXRlL2luZGV4LnBocC9hcmNoaXZlcy82NS8=\">https://www.flysfeq.site/index.php/archives/65/</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vMzd5YW4vcC83NDg5NTk3Lmh0bWw=\">https://www.cnblogs.com/37yan/p/7489597.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbHBmdXR1cmUvcC82Mzg1NjU3Lmh0bWw=\">https://www.cnblogs.com/lpfuture/p/6385657.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC1hdGxhcy5yZWFkdGhlZG9jcy5pby96aC1jbi9sYXRlc3QvbGludXgvc3RvcmFnZS9zb2Z0d2FyZV9yYWlkL3JhaWQtY2hlY2suaHRtbA==\">https://cloud-atlas.readthedocs.io/zh-cn/latest/linux/storage/software_raid/raid-check.html</span></p>\n<h2 id=\"安装-gitea-代码管理\"><a class=\"anchor\" href=\"#安装-gitea-代码管理\">#</a> 安装 gitea 代码管理</h2>\n<p>为你的 gitea 存放创建数据和配置目录：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># $PATH 为你存储盘的路径</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/gitea/data</pre></td></tr></table></figure><p>运行 Docker：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull gitea/gitea:latest</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token parameter variable\">--name</span> gitea <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/gitea/data:/data <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /etc/timezone:/etc/timezone:ro <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /etc/localtime:/etc/localtime:ro <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">3000</span>:3000 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">2220</span>:22 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token parameter variable\">--restart</span> always <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  gitea/gitea</pre></td></tr></table></figure><p>官方安装：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdpdGVhLmNvbS96aC1jbi9pbnN0YWxsYXRpb24vaW5zdGFsbC13aXRoLWRvY2tlcg==\">https://docs.gitea.com/zh-cn/installation/install-with-docker</span></p>\n<h2 id=\"安装-calibre-web-图书管理\"><a class=\"anchor\" href=\"#安装-calibre-web-图书管理\">#</a> 安装 calibre-web 图书管理</h2>\n<p>为你的 calibre-web 存放创建数据和配置目录：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># $PATH 为你存储盘的路径</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/calibre/config /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/calibre/book</pre></td></tr></table></figure><p>运行 Docker：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> pull ghcr.io/gshang2017/calibre-web:latest</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token parameter variable\">--name</span><span class=\"token operator\">=</span>calibre-web <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">PUID</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">PGID</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">TZ</span><span class=\"token operator\">=</span>Asia/Shanghai <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">DOCKER_MODS</span><span class=\"token operator\">=</span>linuxserver/calibre-web:calibre <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8083</span>:8083 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/calibre/config:/config <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /<span class=\"token operator\">&lt;</span><span class=\"token environment constant\">$PATH</span><span class=\"token operator\">></span>/calibre/library:/books <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token parameter variable\">--restart</span> always <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  ghcr.io/gshang2017/calibre-web</pre></td></tr></table></figure><h1 id=\"other\"><a class=\"anchor\" href=\"#other\">#</a> other</h1>\n<h2 id=\"omv-登陆后界面只剩仪表盘\"><a class=\"anchor\" href=\"#omv-登陆后界面只剩仪表盘\">#</a> omv 登陆后界面只剩仪表盘</h2>\n<p>一般会出现这种情况是因为更换了用户，但管理权限没有给过去，或者以非管理员登录等，总之就是登录用户没有足够的权限，如果你还禁止了 root 登录，那么你可以使用如下命令把权限给到你要登录的用户  <code>USER_NAME</code>  上：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> <span class=\"token parameter variable\">-a</span> <span class=\"token parameter variable\">-G</span> openmediavault-admin USER_NAME</pre></td></tr></table></figure><p>参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb3J1bS5vcGVubWVkaWF2YXVsdC5vcmcvaW5kZXgucGhwP3RocmVhZC80NTQ0My1vbXY2LXdlYi1ndWktb25seS13aXRoLWRhc2hib2FyZC1sb3N0LWV2ZXJ5dGhpbmctYW5kLWktbS1hZG1pbi11c2VyLw==\">https://forum.openmediavault.org/index.php?thread/45443-omv6-web-gui-only-with-dashboard-lost-everything-and-i-m-admin-user/</span></p>\n<h2 id=\"devdm-文件系统\"><a class=\"anchor\" href=\"#devdm-文件系统\">#</a> /dev/dm-* 文件系统</h2>\n<p>dm 是 Device Mapper 的缩写，Device Mapper 是 Linux 2.6 内核中提供的一种从逻辑设备到物理设备的映射框架机制，在该机制下，用户可以很方便的根据自己的需要制定实现存储资源的管理策略，当前比较流行的 Linux 下的逻辑卷管理器如 LVM2（Linux Volume Manager 2 version)、EVMS (Enterprise Volume Management System)、dmraid (Device Mapper Raid Tool) 等都是基于该机制实现的。</p>\n<p>既然是映射，那么就有对应关系，那到底对应着什么，可以使用如下命令查看：</p>\n<ol>\n<li><code>dm-*</code>  一般是在  <code>/dev</code>  文件夹里，而且还不止一个，可以使用  <code>ls /dev/dm*</code>  查看所有  <code>dm</code>  设备映射。</li>\n<li>使用命令  <code>dmsetup ls</code>  查看  <code>dm-*</code>  对应的设备，其中  <code>dm</code>  后面的数字对应（xxx， xx）里的第二个数字。如果想详细查看信息，可以使用  <code>dmsetup info</code>  命令，而  <code>Major, minor:</code>  对应 （xxx， xx）。</li>\n<li>输入  <code>more /etc/fstab</code>  命令查找对应关系，如此便能找到映射点。</li>\n</ol>\n<h2 id=\"挂载新硬盘文件系统失败\"><a class=\"anchor\" href=\"#挂载新硬盘文件系统失败\">#</a> 挂载新硬盘文件系统失败</h2>\n<p>这里导致出现的问题是新硬盘替换旧硬盘，然后旧硬盘可能有共享、引用之类的，因此在旧硬盘不存在的情况下，当你为新硬盘建立了文件系统后，并为其挂载保存的的时候，会出现无法保存并挂载成功，这时候就必须先把旧的不存在的硬盘的文件系统卸载掉先，否者会影响新的文件系统挂载；而如果旧的文件系统是有使用共享服务的，那么需要根据其依赖关系（ <code>磁盘</code>  -&gt;  <code>文件系统</code>  -&gt;  <code>共享文件夹</code>  -&gt;  <code>服务(SMB, FTP等)</code> ）逐步解除并保证卸载成功，这样才可以为新的硬盘挂载文件系统。</p>\n<h2 id=\"手动测试硬盘\"><a class=\"anchor\" href=\"#手动测试硬盘\">#</a> 手动测试硬盘</h2>\n<ol>\n<li>使用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vc21hcnRjdGwuOA==\">smartctl</span> 分析硬盘\n<ul>\n<li><code>smartctl -i /dev/sdxy</code>  显示磁盘基本信息。</li>\n<li><code>smartctl -H /dev/sdxy</code>  显示硬盘的健康状况。</li>\n<li><code>smartctl -A /dev/sdxy</code>  显示硬盘的详细信息。</li>\n<li><code>smartctl -t short /dev/sdxy</code>  后台检测硬盘，消耗时间短，用第二条命令查看结果。</li>\n<li><code>smartctl -t long /dev/sdxy</code>  后台检测硬盘，消耗时间长，用第二条命令查看结果。</li>\n<li><code>smartctl -l selftest /dev/sdxy</code>  显示硬盘检测日志。</li>\n<li><code>smartctl -l error /dev/sda</code>  显示硬盘错误汇总。</li>\n</ul>\n</li>\n<li>使用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vYmFkYmxvY2tzLjg=\">badblocks</span> 扫描硬盘\n<ul>\n<li><code>badblocks -sv -o ~/sdxy_blocks.txt /dev/sdxy</code>  前台显示扫描进度，并将结果保存到文档上。</li>\n</ul>\n</li>\n<li>使用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vaGRwYXJtLjg=\">hdparm</span> 测硬盘读速\n<ul>\n<li><code>hdparm -Ttv /dev/sdxy</code>  该命令将显示磁盘的缓存和读性能。</li>\n<li><code>hdparm -tv --direct /dev/sdxy</code>  添加  <code>--direct</code>  选项将绕过硬盘驱动器的缓冲区高速缓存，从而直接从磁盘读取。</li>\n</ul>\n</li>\n<li>使用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW4uYXJjaGxpbnV4Lm9yZy9tYW4vZGQuMQ==\">dd</span> 测硬盘写速\n<ul>\n<li><code>sync; dd if=/dev/zero of=/srv/dev-disk-by-uuid-xxx/tempfile bs=1M count=5120; sync</code>  以 1MByte 为单位，写入 5120 次，即写入往 tempfile 文件写入 5GB 大小的零数据值。</li>\n</ul>\n</li>\n</ol>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/summary-of-keil-tool-use/",
            "url": "https://arachnid.cc/summary-of-keil-tool-use/",
            "title": "关于 Keil 的一些总结性使用",
            "date_published": "2024-01-04T01:28:47.296Z",
            "content_html": "<h1 id=\"for-c51\"><a class=\"anchor\" href=\"#for-c51\">#</a> for C51</h1>\n<h2 id=\"数据存储类型dataidataxdatacode\"><a class=\"anchor\" href=\"#数据存储类型dataidataxdatacode\">#</a> 数据存储类型（data,idata,xdata,code）</h2>\n<p>参考：  <code>Keil &gt; Help &gt; uVision Help &gt; Cx51 Compiler User’s Guide &gt; Language Extensions &gt; Memory Types</code></p>\n<table>\n<thead>\n<tr>\n<th>关键字</th>\n<th>存储空间</th>\n<th>地址范围</th>\n<th>访问方式</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>data</td>\n<td>内部 RAM（最大 128 bytes）</td>\n<td>0x00~0x7F</td>\n<td>直接寻址</td>\n</tr>\n<tr>\n<td>idata</td>\n<td>内部 RAM（最大 256 bytes）</td>\n<td>0x00~0xFF</td>\n<td>间接寻址</td>\n</tr>\n<tr>\n<td>bdata</td>\n<td>内部 RAM（指定 16 bytes）</td>\n<td>0x20~0x2F</td>\n<td>位寻址 / 直接寻址</td>\n</tr>\n<tr>\n<td>pdata</td>\n<td>扩展 RAM（最大 256 bytes）</td>\n<td>0x00~0xFF</td>\n<td>间接寻址</td>\n</tr>\n<tr>\n<td>xdata</td>\n<td>扩展 RAM（最大 64K bytes）</td>\n<td>0x0000~0xFFFF</td>\n<td>间接寻址</td>\n</tr>\n<tr>\n<td>code</td>\n<td>Flash（最大 64K bytes）</td>\n<td>0x0000~0xFFFF</td>\n<td>间接寻址</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>\n<p>data</p>\n<p>data 内存类型只能用于声明变量，不能声明函数。</p>\n<p>该内存使用 8 位地址直接寻址片上 RAM。</p>\n<p>优点是访问速度最快，缺点是数据量的大小受到限制（只有 128 字节或更少）。</p>\n</li>\n<li>\n<p>idata</p>\n<p>idata 内存类型只能用于声明变量，不能声明函数。</p>\n<p>该内存使用 8 位地址间接寻址片上 RAM。</p>\n<p>最大可访问 256 字节，其中低位上的数据空间地址和 data 的相应地址重叠，只是访问方式不同。</p>\n</li>\n<li>\n<p>bdata</p>\n<p>bdata 内存类型只能用于声明变量，不能声明函数。</p>\n<p>bdata 可使用 8 位地址直接访问，属于片上位可寻址 RAM。</p>\n<p>用 bdata 类型声明的变量是位可寻址的，可以使用位指令进行读写。</p>\n</li>\n<li>\n<p>pdata</p>\n<p>pdata 内存类型只能用于声明变量，不能声明函数。</p>\n<p>该内存使用 8 位地址间接寻址以 256 字节为一页的 扩展 RAM。</p>\n<p>pdata 在大小上是有限的（最大 256 字节）。</p>\n</li>\n<li>\n<p>xdata</p>\n<p>xdata 内存类型只能用于声明变量，不能声明函数。</p>\n<p>该内存使用 16 位地址间接寻址扩展 RAM。</p>\n<p>xdata 的容量限制为 64K 或更少。</p>\n</li>\n<li>\n<p>code</p>\n<p>code 内存类型可用于声明常量或函数。</p>\n<p>该存储器使用 16 位地址进行片上或外部扩展访问。</p>\n<p>code 内存限制为 64K。</p>\n<ul>\n<li>\n<p>对于常量 (ROM 变量)。对象限制为 64K，并且不能跨越 64K 边界。代码声明的常量变量位于 code 内存类中。</p>\n</li>\n<li>\n<p>对于程序代码 (函数)。程序函数默认存储在 code 内存类中。代码内存类型说明符不是必需的。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"const-和-code-的修饰使用\"><a class=\"anchor\" href=\"#const-和-code-的修饰使用\">#</a> const 和 code 的修饰使用</h2>\n<p>参考：  <code>Keil &gt; Help &gt; uVision Help &gt; Cx51 Compiler User’s Guide &gt; Language Extensions &gt; Type Qualifiers &gt; const</code></p>\n<p>const：const 关键字所修饰的变量（注意是变量而非常量），是用来表明该变量的操作行为为只读处理，表示其值在程序执行期间不可改变（即程序员向编译器承诺这个变量不会修改），但你说它只读不可修改，用指针指向该变量然后访问修改，它却又可以修改，所以一般严谨的来说它是直接访问不可修改。前面也说了，const 修饰后的并非常量，因此在 C51 中存储在 RAM 上，至于在哪个存储区域 data? idata? xdata? 跟你所指定的分配或基于内存模型配置进行隐式的分配有关。</p>\n<p>code：code 用于声明存储在只读存储器中。code 关键字通常与函数或程序的定义一起使用，也可以用来修饰常量，限制其只能存储在 ROM 中，从而节省了宝贵的 RAM 资源。</p>\n<p>总结：</p>\n<ol>\n<li>const 声明的对象被 Keil C51 存放在数据区 RAM 中 （可以为 data、idatd、xdata，具体看分配）；</li>\n<li>要想将变量存放到代码区 ROM 中以节省 RAM 资源，需更换为 code 关键字去声明对象；</li>\n<li>虽然可以使用指针访问并修改 const 声明的对象，但最好不要这么做，因为 Keil C51 不一定会如程序员预想那样处理代码；</li>\n<li>无论是 const 还是 code 修饰的对象，都具有不可修改的特性，最大的区别可能是一个存放在数据区一个存放在代码区，因此在使用这些修饰符时，需要根据实际需求选择合适的修饰符。</li>\n</ol>\n<h2 id=\"printf-输出打印\"><a class=\"anchor\" href=\"#printf-输出打印\">#</a> printf 输出打印</h2>\n<p>在 C51 上，printf 的转换说明符跟常用的是有区别的，如果配置不当，那么打印输出的结果是错乱的（eg：char 使用 '% d' 转换）；既然不一样，那么对应的数据类型是分别使用哪些转换说明符呢？</p>\n<p>参考：  <code>Keil &gt; Help &gt; uVision Help &gt; Cx51 Compiler User’s Guide &gt; Library Reference &gt; Reference &gt; printf</code></p>\n<table>\n<thead>\n<tr>\n<th>转换说明符</th>\n<th>变量类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>%bd</td>\n<td>char</td>\n<td>带符号字符型</td>\n</tr>\n<tr>\n<td>%hd</td>\n<td>short</td>\n<td>带符号短整型</td>\n</tr>\n<tr>\n<td>%d</td>\n<td>int</td>\n<td>带符号整形</td>\n</tr>\n<tr>\n<td>%ld</td>\n<td>long int</td>\n<td>带符号长整型</td>\n</tr>\n<tr>\n<td>%bu</td>\n<td>unsigned char</td>\n<td>无符号字符型</td>\n</tr>\n<tr>\n<td>%hu</td>\n<td>unsigned short</td>\n<td>无符号短整型</td>\n</tr>\n<tr>\n<td>%u</td>\n<td>unsigned int</td>\n<td>无符号整型</td>\n</tr>\n<tr>\n<td>%lu</td>\n<td>unsigned long int</td>\n<td>无符号长整形</td>\n</tr>\n<tr>\n<td>%bx</td>\n<td>unsigned char</td>\n<td>无符号十六进制字符型</td>\n</tr>\n<tr>\n<td>%hx</td>\n<td>unsigned short</td>\n<td>无符号十六进制短整型</td>\n</tr>\n<tr>\n<td>%x</td>\n<td>unsigned int</td>\n<td>无符号十六进制整型</td>\n</tr>\n<tr>\n<td>%lx</td>\n<td>unsigned long int</td>\n<td>无符号十六进制长整型</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">tst_printf</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">char</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">int</span> b  <span class=\"token operator\">=</span> <span class=\"token number\">12365</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">long</span> c <span class=\"token operator\">=</span> <span class=\"token number\">0x7FFFFFFF</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> x <span class=\"token operator\">=</span> <span class=\"token char\">'A'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> y  <span class=\"token operator\">=</span> <span class=\"token number\">54321</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">long</span> z <span class=\"token operator\">=</span> <span class=\"token number\">0x4A6F6E00</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token keyword\">float</span> f <span class=\"token operator\">=</span> <span class=\"token number\">10.0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token keyword\">float</span> g <span class=\"token operator\">=</span> <span class=\"token number\">22.95</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token keyword\">char</span> buf <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Test String\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token function\">printf</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"char %bd int %d long %ld\\n\"</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token function\">printf</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"Uchar %bu Uint %u Ulong %lu\\n\"</span><span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">,</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token function\">printf</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"xchar %bx xint %x xlong %lx\\n\"</span><span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">,</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token function\">printf</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"String %s is at address %p\\n\"</span><span class=\"token punctuation\">,</span>buf<span class=\"token punctuation\">,</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token function\">printf</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"%f != %g\\n\"</span><span class=\"token punctuation\">,</span> f<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token function\">printf</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"%*f != %*g\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> f<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"内存池\"><a class=\"anchor\" href=\"#内存池\">#</a> 内存池</h2>\n<p>在 C51 中，malloc 等内存管理函数并不能像在 PC 上一样直接调用，这涉及到了内存池的概念。</p>\n<p>要想使用内存管理操作，这里需要 3 个步骤：</p>\n<ol>\n<li>声明一个合适的存储空间；</li>\n<li>利用  <code>init_mempool()</code>  初始化内存池；</li>\n<li>调用相关的内存管理 API。</li>\n</ol>\n<p>参考：  <code>Keil &gt; Help &gt; uVision Help &gt; Cx51 Compiler User’s Guide &gt; Library Reference &gt; Reference &gt; init_mempool</code></p>\n<p>eg：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">char</span> xdata mempool<span class=\"token punctuation\">[</span><span class=\"token number\">512</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">tst_init_mempool</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">char</span> xdata <span class=\"token operator\">*</span>str<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token function\">init_mempool</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>mempool<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>mempool<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 初始化内存池</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  str <span class=\"token operator\">=</span> <span class=\"token function\">malloc</span> <span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 申请内存</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">26</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    str<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token char\">'A'</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  str<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token char\">'\\0'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\\n\"</span><span class=\"token punctuation\">,</span> str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token function\">free</span> <span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 释放内存</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"for-mdk\"><a class=\"anchor\" href=\"#for-mdk\">#</a> for MDK</h1>\n<h2 id=\"设置-noinit\"><a class=\"anchor\" href=\"#设置-noinit\">#</a> 设置 noinit</h2>\n<p>设置 noinit 的 ram 区域有什么用？</p>\n<p>对于 noinit 的 ram，等同于不断电的 EEPROM，可以在非上电复位后，依然保存该值，你可能会说，不是有备用域寄存器吗，但是你是否想到这样操作起来会比较麻烦，需要配置相应的操作寄存器；而对于直接把 ram noinit，那么可以跟以前一样直接读写数据，也不怕非上电复位导致数据清零；常见的例子有 bootloader 带参数信息跳转、强制复位前的信息保留等。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb2N1bWVudGF0aW9uL2thMDAzMDQ2L2xhdGVzdA==\">ARM: Uninialized Variables Get Initialized</span></p>\n<p><strong>1、AC5 编译器</strong></p>\n<p>可以在分散文件中定义  <code>UNINIT</code>  的分区段：</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>LR_IROM1 0x08000000 0x00080000  &#123; ; load region size_region</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  ER_IROM1 0x08000000 0x00080000  &#123; ; load address = execution address</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   *.o (RESET, +First)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   *(InRoot$$Sections)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   .ANY (+RO)</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  RW_IRAM1 0x20000000 UNINIT 0x00000100  &#123; ;no init section</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        *(NO_INIT)</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   &#125;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  RW_IRAM2 0x20000100 0x0000FFF0  &#123; ;all other rw data</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        .ANY(+RW +ZI)</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  &#125;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>&#125;</pre></td></tr></table></figure><p>然后再在 c 代码上面调用指定：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span>  value<span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">__attribute__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">section</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"NO_INIT\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> zero_init<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>2、AC6 编译器</strong></p>\n<p>也可以像下面这样利用 Target 配置指定地址：</p>\n<p><img data-src=\"/summary-of-keil-tool-use/QQ%E6%88%AA%E5%9B%BE20240104152114.png\" alt=\"QQ截图20240104152114\"></p>\n<p><strong>3、区别</strong></p>\n<p>如果使用分散表来设置，那么 AC5 跟 AC6 调用是有不同的：</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// Arm Compiler 5</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>unsigned long NI_longVar __attribute__( ( section( \"NoInit\"),zero_init) ) ;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>// Arm Compiler 6</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>unsigned long NI_longVar __attribute__( ( section( \".bss.NoInit\")) ) ;</pre></td></tr></table></figure><p>而如果是直接指定内存地址：</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// Arm Compiler 5</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>static uint32_t BootFlag __attribute__((section(\".ARM.__at_0x2001FFFC\")));</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>// Arm Compiler 6</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>static uint32_t BootFlag __attribute__((section(\".bss.ARM.__at_0x2001FFFC\")));</pre></td></tr></table></figure><p>这种方法需要在分散表中定义  <code>UNINIT</code>  或在 Target 配置上勾选  <code>NoInit</code>  。</p>\n<h2 id=\"半主机模式\"><a class=\"anchor\" href=\"#半主机模式\">#</a> 半主机模式</h2>\n<p>在嵌入式开发中，少不了  <code>printf</code>  等 C 库函数操作，一般来说，这些都是标准库上的操作，然在资源紧凑的单片机中，能不引入完整的 C 标准库就尽量不引入；而 keil 中，提供紧凑型的 C 库，称之为  <code>MicroLIB</code>  ，因此我们在建项目的时候都会在：工程属性的 “Target “ -&gt; ” Code Generation “ 中勾选 ” Use MicroLIB “ 选项，这样避免在以后中使用了 printf、sprintf 等函数而出现异常，同时由于  <code>MicroLIB</code>  库是由官方亲自进行裁剪过，所以相对于 C 标准库编译出来的大小会小很多。</p>\n<p>虽说可以使用  <code>MicroLIB</code>  库，但由于裁剪的问题，注定它无法实现一些比较高级的功能，或者无法重定义该 I/O 功能，所以在某些时候，必须使用 C 标准库，那么在 keil 中如何实现，这就是下文要讨论的了。</p>\n<p>在应用程序代码中经常使用标准 I/O 库函数，如 printf ()、scanf () 或 fgetc () 来执行输入 / 输出操作。 这些函数在标准 ARM 编译器 c 运行时库中的结构是：</p>\n<p><img data-src=\"/summary-of-keil-tool-use/struct_comp_function.png\" alt></p>\n<p>这样一来，要重新定位输入 / 输出，您可以：</p>\n<ul>\n<li>避免高级库函数。</li>\n<li>重新定义底层库函数。</li>\n<li>重新定义系统 I/O 功能。</li>\n</ul>\n<p>而对于重新定义低级库函数还是系统 I/O 函数是更好的解决方案，这取决于您的用例。例如，UART 每次只写一个字符，而默认的 fputc () 使用缓冲，因此重新定义不带缓冲区的函数可能适合 UART。但是，在可能进行缓冲区操作的地方，重新定义系统 I/O 函数可能更合适。</p>\n<p>半主机：Semihosting 是一种机制，通过调试器使 ARM 目标上运行的代码能够与主机上的输入 / 输出设施通信进行交互。当目标板脱离调试器单独运行时，则需要退出半主机模式，否则使得设备运行时会进入软件中断 BAEB 处。</p>\n<p>为了能让目标板在单独运行时进行输入 / 输出，而不进入软件中断 BAEB 处。因此在 keil 中，可以使用如下操作禁止进入半主机模式：</p>\n<ul>\n<li>\n<p>In C source code：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\">__ARMCC_VERSION <span class=\"token operator\">>=</span> <span class=\"token number\">6000000</span></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">//https://developer.arm.com/documentation/100073/0622/The-Arm-C-and-C---Libraries/Support-for-building-an-application-with-the-C-library/Indirect-semihosting-C-library-function-dependencies</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">__asm</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".global __use_no_semihosting\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">elif</span> <span class=\"token expression\">__ARMCC_VERSION <span class=\"token operator\">>=</span> <span class=\"token number\">5000000</span></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token comment\">// https://developer.arm.com/documentation/dui0475/m/the-arm-c-and-c---libraries/support-for-building-an-application-with-the-c-library/indirect-semihosting-c-library-function-dependencies?lang=en</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\"><span class=\"token function\">import</span><span class=\"token punctuation\">(</span>__use_no_semihosting<span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">error</span> <span class=\"token expression\">Unsupported compiler</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr></table></figure></li>\n<li>\n<p>In armasm assembly language source code：</p>\n<pre><code class=\"language-asm\">IMPORT __use_no_semihosting\n</code></pre>\n</li>\n</ul>\n<p>在禁用半主机模式后，对于标准 C 库一般会重定义实现以下 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb2N1bWVudGF0aW9uL2R1aTAyMzIvYi90aGUtYy1hbmQtYy0tLWxpYnJhcmllcy90YWlsb3JpbmctdGhlLWlucHV0LW91dHB1dC1mdW5jdGlvbnMvZGVwZW5kZW5jaWVzLW9uLWxvdy1sZXZlbC1mdW5jdGlvbnM/bGFuZz1lbg==\">Dependencies on low-level functions</span> 函数：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">__FILE</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> handle<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* Add whatever you need here */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/* </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * Re-implementing the printf family. </pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * The printf family consists of _printf(), printf(), _fprintf(), fprintf(), vprintf(), and vfprintf().</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> */</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// https://www.keil.com/support/man/docs/armlib/armlib_chr1358938930943.htm</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>FILE __stdout<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">ferror</span><span class=\"token punctuation\">(</span>FILE <span class=\"token operator\">*</span>f<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">/* Your implementation of ferror */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token constant\">EOF</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">fputc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> ch<span class=\"token punctuation\">,</span> FILE <span class=\"token operator\">*</span>f<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">/* </span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> * Re-implementing the scanf family. </pre></td></tr><tr><td data-num=\"24\"></td><td><pre> * The scanf() family consists of scanf() and fscanf().</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> */</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">// https://www.keil.com/support/man/docs/armlib/armlib_chr1358938931161.htm</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>FILE __stdin<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">__backspace</span><span class=\"token punctuation\">(</span>FILE <span class=\"token operator\">*</span>f<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">// https://www.keil.com/support/man/docs/armlib/armlib_chr1358938931957.htm</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">fgetc</span><span class=\"token punctuation\">(</span>FILE <span class=\"token operator\">*</span>f<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">_ttywrch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> ch<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%c\"</span><span class=\"token punctuation\">,</span> ch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>ch<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">// https://www.keil.com/support/man/docs/armlib/armlib_chr1359122862227.htm</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">_sys_exit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">;</span> <span class=\"token comment\">/* endless loop */</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\">// https://www.keil.com/support/man/docs/armlib/armlib_chr1359122859512.htm</span></pre></td></tr></table></figure><p>附：</p>\n<p><strong>Indirect Semihosting 依赖函数表：</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Function</th>\n<th>Usage</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>__user_setup_stackheap()</code></td>\n<td>Sets up and returns the locations of the stack and the heap.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>__raise()</code></td>\n<td>Catching, handling, or diagnosing C library exceptions, without C signal support. (Tailoring error signaling, error handling, and program exit.)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>__default_signal_handler()</code></td>\n<td>Catching, handling, or diagnosing C library exceptions, with C signal support. (Tailoring error signaling, error handling, and program exit.)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>__Heap_Initialize()</code></td>\n<td>Choosing or redefining memory allocation. Avoiding the heap and heap-using C library functions supplied by Arm®.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>ferror()</code>  &lt;br/&gt; <code>fputc()</code>  &lt;br/&gt; <code>__stdout</code></td>\n<td>Reimplementing the  <code>printf</code>  family. (Tailoring input/output functions in the C and C++ libraries.).</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>__backspace()</code>  &lt;br/&gt; <code>fgetc()</code>  &lt;br/&gt; <code>__stdin</code></td>\n<td>Reimplementing the  <code>scanf</code>  family. (Tailoring input/output functions in the C and C++ libraries.).</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>fwrite()</code>  &lt;br/&gt; <code>fputs()</code>  &lt;br/&gt; <code>puts()</code>  &lt;br/&gt; <code>fread()</code>  &lt;br/&gt; <code>fgets()</code>  &lt;br/&gt; <code>gets()</code>  &lt;br/&gt; <code>ferror()</code></td>\n<td>Reimplementing the stream output family. (Tailoring input/output functions in the C and C++ libraries.).</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Direct Semihosting 依赖函数表：</strong></p>\n<table>\n<thead>\n<tr>\n<th>Function</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>__user_initial_stackheap()</code></td>\n<td>Sets up and returns the locations of the stack and the heap. If you are using a scatter file at the link stage, you might have to re-implement this function. &lt;br/&gt;The linker issues an error when no semihosting is requested and  <code>__user_initial_stackheap()</code>  is not re-implemented.</td>\n</tr>\n<tr>\n<td><code>_sys_exit()</code>  &lt;br/&gt; <code>_ttywrch()</code></td>\n<td>Error signaling, error handling, and program exit.</td>\n</tr>\n<tr>\n<td><code>_sys_command_string()</code>  &lt;br/&gt; <code>_sys_close()</code>  &lt;br/&gt; <code>_sys_iserror()</code>  &lt;br/&gt; <code>_sys_istty()</code>  &lt;br/&gt; <code>_sys_flen()</code>  &lt;br/&gt; <code>_sys_open()</code>  &lt;br/&gt; <code>_sys_read()</code>  &lt;br/&gt; <code>_sys_seek()</code>  &lt;br/&gt; <code>_sys_write()</code>  &lt;br/&gt; <code>_sys_tmpnam()</code></td>\n<td>Tailoring input/output functions in the C and C++ libraries.</td>\n</tr>\n<tr>\n<td><code>clock()</code>  &lt;br/&gt; <code>_clock_init()</code>  &lt;br/&gt; <code>remove()</code>  &lt;br/&gt; <code>rename()</code>  &lt;br/&gt; <code>system()</code>  &lt;br/&gt; <code>time()</code></td>\n<td>Tailoring other C library functions.</td>\n</tr>\n</tbody>\n</table>\n<p>参考：</p>\n<p>AC5：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb2N1bWVudGF0aW9uL2R1aTA0NzUvbQ==\">https://developer.arm.com/documentation/dui0475/m</span></p>\n<p>AC6：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb2N1bWVudGF0aW9uLzEwMDA3My8wNjIy\">https://developer.arm.com/documentation/100073/0622</span></p>\n",
            "tags": [
                "IDE"
            ]
        },
        {
            "id": "https://arachnid.cc/jtag-and-swd/",
            "url": "https://arachnid.cc/jtag-and-swd/",
            "title": "JTAG 和 SWD 接口定义",
            "date_published": "2023-07-09T06:50:41.515Z",
            "content_html": "<h1 id=\"jtag\"><a class=\"anchor\" href=\"#jtag\">#</a> JTAG</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLnNlZ2dlci5jb20vSlRBRw==\">https://wiki.segger.com/JTAG</span></p>\n<h2 id=\"引脚分布\"><a class=\"anchor\" href=\"#引脚分布\">#</a> 引脚分布</h2>\n<p><img data-src=\"/jtag-and-swd/JTAG_Port.png\" alt=\"img\"></p>\n<h2 id=\"接口定义\"><a class=\"anchor\" href=\"#接口定义\">#</a> 接口定义</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">PIN</th>\n<th style=\"text-align:center\">SIGNAL</th>\n<th style=\"text-align:center\">TYPE</th>\n<th style=\"text-align:center\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><strong>1</strong></td>\n<td style=\"text-align:center\">VTref</td>\n<td style=\"text-align:center\">Input</td>\n<td style=\"text-align:center\">This is the target reference voltage. It is used to check if the target has power, to create the logic-level reference for the input comparators and to control the output logic levels to the target. It is normally fed from VDD of the target board and must not have a series resistor.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>2</strong></td>\n<td style=\"text-align:center\">Not connected</td>\n<td style=\"text-align:center\">NC</td>\n<td style=\"text-align:center\">This pin is not connected.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>3</strong></td>\n<td style=\"text-align:center\">nTRST</td>\n<td style=\"text-align:center\">Output</td>\n<td style=\"text-align:center\">JTAG Reset. Output from J-Link to the Reset signal of the target JTAG port. Typically connected to nTRST of the target CPU. This pin is normally pulled HIGH on the target to avoid unintentional resets when there is no connection.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>5</strong></td>\n<td style=\"text-align:center\">TDI</td>\n<td style=\"text-align:center\">Output</td>\n<td style=\"text-align:center\">JTAG data input of target CPU. It is recommended that this pin is pulled to a defined state on the target board. Typically connected to TDI of the target CPU.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>7</strong></td>\n<td style=\"text-align:center\">TMS</td>\n<td style=\"text-align:center\">Output</td>\n<td style=\"text-align:center\">JTAG mode set input of target CPU. This pin should be pulled up on the target. Typically connected to TMS of the target CPU.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>9</strong></td>\n<td style=\"text-align:center\">TCK</td>\n<td style=\"text-align:center\">Output</td>\n<td style=\"text-align:center\">JTAG clock signal to target CPU. It is recommended that this pin is pulled to a defined state of the target board. Typically connected to TCK of the target CPU.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>11</strong></td>\n<td style=\"text-align:center\">RTCK</td>\n<td style=\"text-align:center\">Input</td>\n<td style=\"text-align:center\">Return test clock signal from the target. Some targets must synchronize the JTAG inputs to internal clocks. To assist in meeting this requirement, you can use a returned, and adjusted, TCK to dynamically control the TCK rate. J-Link supports adaptive clocking, which waits for TCK changes to be echoed correctly before making further changes. Connect to RTCK if available, otherwise to GND.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>13</strong></td>\n<td style=\"text-align:center\">TDO</td>\n<td style=\"text-align:center\">Input</td>\n<td style=\"text-align:center\">JTAG data output from target CPU. Typically connected to TDO of the target CPU.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>15</strong></td>\n<td style=\"text-align:center\">nRESET</td>\n<td style=\"text-align:center\">I/O</td>\n<td style=\"text-align:center\">Target CPU reset signal. Typically connected to the RESET pin of the target CPU, which is typically called &quot;nRST&quot;, &quot;nRESET&quot; or &quot;RESET&quot;. This signal is an active low signal.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>17</strong></td>\n<td style=\"text-align:center\">DBGRQ</td>\n<td style=\"text-align:center\">NC</td>\n<td style=\"text-align:center\">This pin is not connected in J-Link. It is reserved for compatibility with other equipment to be used as a debug request signal to the target system. Typically connected to DBGRQ if available, otherwise left open.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>19</strong></td>\n<td style=\"text-align:center\">5V-Supply</td>\n<td style=\"text-align:center\">Output</td>\n<td style=\"text-align:center\">This pin can be used to supply power to the target hardware. Older J-Links may not be able to supply power on this pin. For more information about how to enable/disable the power supply, please refer to <span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLnNlZ2dlci5jb20vMjAtcGluX0otTGlua19Db25uZWN0b3IjVGFyZ2V0X3Bvd2VyX3N1cHBseQ==\">Target power supply</span>.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>4, 6, 8, 10, 12</strong></td>\n<td style=\"text-align:center\">GND</td>\n<td style=\"text-align:center\">Ground</td>\n<td style=\"text-align:center\">GND pins connected to GND in J-Link. They should also be connected to GND in the target system.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>14, 16, 18, 20</strong></td>\n<td style=\"text-align:center\">Res</td>\n<td style=\"text-align:center\">Reserved</td>\n<td style=\"text-align:center\">On some models like the J-Link ULTRA, these pins are reserved for firmware extension purposes. They can be left open or connected to GND in normal debug environment. They are not essential for JTAG or SWD in general <strong>Please do not assume them to be connected to GND inside J-Link.</strong></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"连接拓扑\"><a class=\"anchor\" href=\"#连接拓扑\">#</a> 连接拓扑</h2>\n<p><img data-src=\"/jtag-and-swd/image-20230709160640502.png\" alt=\"image-20230709160640502\"></p>\n<h2 id=\"引脚概述\"><a class=\"anchor\" href=\"#引脚概述\">#</a> 引脚概述</h2>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>引脚</th>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>9</td>\n<td>TCK</td>\n<td>输出</td>\n<td>目标时钟输入引脚，为目标 CPU 提供时钟逻辑信号。</td>\n</tr>\n<tr>\n<td>5</td>\n<td>TDI</td>\n<td>输出</td>\n<td>目标数据输入引脚，用于发送串行测试指令和数据给目标 CPU。</td>\n</tr>\n<tr>\n<td>7</td>\n<td>TMS</td>\n<td>输出</td>\n<td>目标模式选择引脚，TAP (Test access port) 控制器对接收到的信号进行解码，以控制测试操作。</td>\n</tr>\n<tr>\n<td>13</td>\n<td>TDO</td>\n<td>输入</td>\n<td>目标数据输出引脚，目标 CPU 串行输出测试指令和逻辑数据。</td>\n</tr>\n<tr>\n<td>3</td>\n<td>nTRST</td>\n<td>输出（可选）</td>\n<td>可选的复位输入目标引脚，用来指示 TAP 控制器的异步初始化。</td>\n</tr>\n<tr>\n<td>11</td>\n<td>RTCK</td>\n<td>输入</td>\n<td>目标 CPU 返回的时钟信号，有些目标 CPU 需要同步时钟。</td>\n</tr>\n<tr>\n<td>15</td>\n<td>nRESET</td>\n<td>输入 / 输出</td>\n<td>目标 CPU 复位信号。通常连接到目标 CPU 的 RESET 引脚。</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"swd\"><a class=\"anchor\" href=\"#swd\">#</a> SWD</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLnNlZ2dlci5jb20vU1dE\">https://wiki.segger.com/SWD</span></p>\n<h2 id=\"引脚分布-2\"><a class=\"anchor\" href=\"#引脚分布-2\">#</a> 引脚分布</h2>\n<p><img data-src=\"/jtag-and-swd/SWD_Port.png\" alt=\"img\"></p>\n<h2 id=\"接口定义-2\"><a class=\"anchor\" href=\"#接口定义-2\">#</a> 接口定义</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">PIN</th>\n<th style=\"text-align:center\">SIGNAL</th>\n<th style=\"text-align:center\">TYPE</th>\n<th style=\"text-align:center\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><strong>1</strong></td>\n<td style=\"text-align:center\">VTref</td>\n<td style=\"text-align:center\">Input</td>\n<td style=\"text-align:center\">This is the target reference voltage. It is used to check if the target has power, to create the logic-level reference for the input comparators and to control the output logic levels to the target. It is normally fed from VDD of the target board and must not have a series resistor.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>2</strong></td>\n<td style=\"text-align:center\">Not connected</td>\n<td style=\"text-align:center\">NC</td>\n<td style=\"text-align:center\">This pin is not connected.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>3</strong></td>\n<td style=\"text-align:center\">Not used</td>\n<td style=\"text-align:center\">NC</td>\n<td style=\"text-align:center\">This pin is not used by J-Link when selecting SWD as interface type. If the device may also be accessed via JTAG, this pin may be connected to nTRST, otherwise leave open.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>5</strong></td>\n<td style=\"text-align:center\">Not used</td>\n<td style=\"text-align:center\">NC</td>\n<td style=\"text-align:center\">This pin is not used by J-Link when selecting SWD as interface type. If the device may also be accessed via JTAG, this pin may be connected to TDI, otherwise leave open.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>7</strong></td>\n<td style=\"text-align:center\">SWDIO</td>\n<td style=\"text-align:center\">I/O</td>\n<td style=\"text-align:center\">JTAG mode set input of target CPU. This pin should be pulled up on the target. Typically connected to TMS of the target CPU.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>9</strong></td>\n<td style=\"text-align:center\">SWCLK</td>\n<td style=\"text-align:center\">Output</td>\n<td style=\"text-align:center\">JTAG clock signal to target CPU. It is recommended that this pin is pulled to a defined state of the target board. Typically connected to TCK of the target CPU.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>11</strong></td>\n<td style=\"text-align:center\">Not used</td>\n<td style=\"text-align:center\">NC</td>\n<td style=\"text-align:center\">This pin is not used by J-Link when selecting SWD as interface type. If the device may also be accessed via JTAG, this pin may be connected to RTCK, otherwise leave open.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>13</strong></td>\n<td style=\"text-align:center\">SWO</td>\n<td style=\"text-align:center\">Input</td>\n<td style=\"text-align:center\">Serial Wire Output trace port. (Optional, not required for SWD communication.)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>15</strong></td>\n<td style=\"text-align:center\">nRESET</td>\n<td style=\"text-align:center\">I/O</td>\n<td style=\"text-align:center\">Target CPU reset signal. Typically connected to the RESET pin of the target CPU, which is typically called &quot;nRST&quot;, &quot;nRESET&quot; or &quot;RESET&quot;. This signal is an active low signal.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>17</strong></td>\n<td style=\"text-align:center\">Not used</td>\n<td style=\"text-align:center\">NC</td>\n<td style=\"text-align:center\">This pin is not connected in J-Link.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>19</strong></td>\n<td style=\"text-align:center\">5V-Supply</td>\n<td style=\"text-align:center\">Output</td>\n<td style=\"text-align:center\">This pin can be used to supply power to the target hardware. Older J-Links may not be able to supply power on this pin. For more information about how to enable/disable the power supply, please refer to <span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLnNlZ2dlci5jb20vMjAtcGluX0otTGlua19Db25uZWN0b3IjVGFyZ2V0X3Bvd2VyX3N1cHBseQ==\">Target power supply</span>.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>4, 6, 8, 10, 12</strong></td>\n<td style=\"text-align:center\">GND</td>\n<td style=\"text-align:center\">Ground</td>\n<td style=\"text-align:center\">GND pins connected to GND in J-Link. They should also be connected to GND in the target system.</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>14, 16, 18, 20</strong></td>\n<td style=\"text-align:center\">Res</td>\n<td style=\"text-align:center\">Reserved</td>\n<td style=\"text-align:center\">On some models like the J-Link ULTRA, these pins are reserved for firmware extension purposes. They can be left open or connected to GND in normal debug environment. They are not essential for JTAG or SWD in general <strong>Please do not assume them to be connected to GND inside J-Link.</strong></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"连接拓扑-2\"><a class=\"anchor\" href=\"#连接拓扑-2\">#</a> 连接拓扑</h2>\n<p><img data-src=\"/jtag-and-swd/image-20230709161124811.png\" alt=\"image-20230709161124811\"></p>\n<h2 id=\"引脚概述-2\"><a class=\"anchor\" href=\"#引脚概述-2\">#</a> 引脚概述</h2>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>引脚</th>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>9</td>\n<td>SWCLK</td>\n<td>输出</td>\n<td>时钟信号引脚。</td>\n</tr>\n<tr>\n<td>7</td>\n<td>SWDIO</td>\n<td>输入 / 输出</td>\n<td>双向数据引脚。</td>\n</tr>\n<tr>\n<td>13</td>\n<td>SWO</td>\n<td>输出（可选）</td>\n<td>可选的串行线跟踪输出引脚，允许 CPU 输出自定义数据，如 printf 输出，异步到 SWCLK 和其他调试引脚。</td>\n</tr>\n<tr>\n<td>15</td>\n<td>RESET</td>\n<td>输入 / 输出</td>\n<td>目标 CPU 复位信号。通常连接到目标 CPU 的 RESET 引脚。</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLnNlZ2dlci5jb20vMjAtcGluX0otTGlua19Db25uZWN0b3I=\">https://wiki.segger.com/20-pin_J-Link_Connector</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb2N1bWVudGF0aW9uLzEwMTYzNi8wMTAwL0RlYnVnLWFuZC1UcmFjZS9KVEFHLVNXRC1JbnRlcmZhY2U=\">https://developer.arm.com/documentation/101636/0100/Debug-and-Trace/JTAG-SWD-Interface</span></p>\n<p><img data-src=\"/jtag-and-swd/attach_16ace507bfe3aa34.png\" alt=\"st-link接口定义:stm32f103c8t6 sw接口定义:上图序号swdpcb板上的\"></p>\n<h1 id=\"电路\"><a class=\"anchor\" href=\"#电路\">#</a> 电路</h1>\n<p><img data-src=\"/jtag-and-swd/image-20230709180456489.png\" alt=\"image-20230709180456489\"></p>\n<p>如果是要兼容 SWD，则需要在  <code>JTAG_TMS</code>  引脚的上拉电阻前端增加一个二极管，参照  <code>JTAG_nRESET</code>  上拉。</p>\n<p>关于 J-Link 输出供电问题：</p>\n<ul>\n<li>一次性编程器打开或者关闭  <code>5V-Supply</code>  电源输出指令：<br>\n <code>POWER ON</code>  ：一次性使能编程器电源输出。<br>\n <code>POWER OFF</code>  ：一次性关闭编程器电源输出。</li>\n<li>长期记录编程器打开或者关闭  <code>5V-Supply</code>  电源输出指令：<br>\n <code>POWER ON PERM</code>  ：长期打开编程器电源输出。<br>\n <code>POWER OFF PERM</code>  ：长期关闭编程器电源输出。</li>\n</ul>\n<h1 id=\"附录\"><a class=\"anchor\" href=\"#附录\">#</a> 附录</h1>\n<p><img data-src=\"/jtag-and-swd/f70ab2df53c840afbc9d41234b6cbef8.png\" alt=\"stm32jtag电路设计\"></p>\n",
            "tags": []
        },
        {
            "id": "https://arachnid.cc/diode-parameter-design/",
            "url": "https://arachnid.cc/diode-parameter-design/",
            "title": "二极管常见参数",
            "date_published": "2023-06-30T14:14:04.289Z",
            "content_html": "<blockquote>\n<p>为了更好的描述及参照，以下参数大部分会重复记录，因此不一一重复描述，仅在第一次出现时加以概述。</p>\n</blockquote>\n<h1 id=\"肖特基二极管\"><a class=\"anchor\" href=\"#肖特基二极管\">#</a> 肖特基二极管</h1>\n<p><strong>简称 &quot;SBD&quot;</strong> 。利用<strong>金属和半导体二者的接合面</strong>的 &quot;肖特基效应&quot; 的整流作用。具有正向导通电压较低，导通恢复时间短的特性，但反向漏电流较多，突波耐受度较低。常见应用于<strong>高频整流（低压大电流）</strong>。</p>\n<p><strong>1、主要参数</strong></p>\n<ol>\n<li>重复性峰值反向电压 VRRM（Repetitive peak reverse voltage）：即使没有反向电流，只要不断地提高反向电压，迟早会使肖特基二极管损坏。这种能施加的反向电压，不是瞬时电压，而是反复施加的反向电压。一般在直流电压中相当于最大直流反向耐压，而在交流电压中则用另一个参数 VRMS 表示（下方）。</li>\n<li>平均正向整流电流 IF (AV)（Average forward rectified current）：指肖特基二极管长期运行时，根据允许温升折算出来的平均正向电流峰值。</li>\n<li>浪涌电流 IFSM（Peak forward surge current）：允许流过的过星的正向电流。它不是正常电流，而是瞬间电流，这个值相当大。</li>\n<li>导通压降 VF（Instantaneous forward voltage）：VF 为肖特基二极管正向导通时肖特基二极管两端的压降，选择肖特基二极管是尽量选择 VF 较小的肖特基二极管。</li>\n<li>反向漏电流 IR（DC reverse current）：IR 指在肖特基二极管两端加入反向电压时，流过肖特基二极管的电流，肖特基二极管反向漏电流较大，选择肖特基二极管是尽量选择 IR 较小的肖特基二极管。</li>\n</ol>\n<p><strong>2、辅选参数</strong></p>\n<ol>\n<li>均方根反向电压 VRMS（Root-Mean-Square voltage）：指正弦交流信号的有效电压值， <code>VRMS = (1/2√2) × VRRM ≈ 0.707 × VRRM</code>  ；这里主要是指正常情况下工作的最大有效电压值，可以理解为所能承受的最大反复施加的正反向电压有效值。有一些 datasheet 上可能没有提供该参数，但是会提供 VRRM 的参数，所以可以利用公式来获取数值。</li>\n<li>反向恢复时间 trr（Reverse recovery time）：当工作电压从正向电压变成反向电压时，二极管工作的理想情况是电流能瞬时截止。实际上，一般要延迟一点点时间。决定电流截止延时的量，就是反向恢复时间。虽然它直接影响二极管的开关速度，但不一定说这个值小就好。也即当肖特基二极管由导通突然反向时，反向电流由很大衰减到接近 IR 时所需要的时间。大功率开关管工作在高频开关状态时，此项指标至为重要。</li>\n<li>工作频率 fM：由于 PN 结的结电容存在，当工作频率超过某一值时，它的单向导电性将变差。肖特基二极管的 fM 值相对于其它二极管来说较高，小体积的肖特基二极管最高可工作在 50GHz 的频率，该参数一般没有提供，因为大部分肖特基二极管的工作频率差异不大。</li>\n</ol>\n<p>note：二极管的反向漏电流与反向电压大致呈指数关系，表示为： <code>I = Ir x e^(-Vr/Vt)</code>  ，其中  <code>Ir</code>  为常数，代表二极管在反向饱和状态下的最小漏电流； <code>Vr</code>  为反向电压， <code>Vt</code>  为热电压常数，约为 26mV。</p>\n<p>由于肖特基二极管反向漏电流较大，并且随温度变化较大，因此当出现反向电压时，往往会导致正向极出现电压（反向电压增大或温度升高），导致 “反向导通” 的现象。</p>\n<p><img data-src=\"/diode-parameter-design/chap3-4-2_en.png\" alt=\"图3-6：不同金属的SBD的V&lt;sub&gt;F&lt;/sub&gt;–I&lt;sub&gt;F&lt;/sub&gt;曲线\"></p>\n<h1 id=\"pn-结二极管\"><a class=\"anchor\" href=\"#pn-结二极管\">#</a> PN 结二极管</h1>\n<p><strong>一般也称为 &quot;一般整流二极管&quot;、&quot;普通二极管&quot;</strong> 。通过施加正向偏置，利用半导体中 PN 接合的整流性质来实现单向特性的应用，是最基本的半导体二极管。常见应用于<strong>低频整流</strong>以及<strong>与电感并联保护其他器件</strong>。</p>\n<p><strong>1、主要参数</strong></p>\n<ol>\n<li>重复性峰值反向电压 VRRM（Repetitive peak reverse voltage）</li>\n<li>均方根反向电压 VRMS（Root-Mean-Square voltage）</li>\n<li>平均正向整流电流 IF (AV)（Average forward rectified current）：可以理解为额定工作电流。</li>\n<li>导通压降 VF（Instantaneous forward voltage）</li>\n<li>浪涌电流 IFSM（Peak forward surge current）</li>\n</ol>\n<p><strong>2、辅选参数</strong></p>\n<ol>\n<li>直流阻断电压 VDC（DC blocking voltage）：当直流电压大于该参数电压，将会导致二极管击穿或烧毁。</li>\n<li>反向漏电流 IR（DC reverse current）：当施加安全的反向电压时，二极管处于反向截止状态，但此时会有一个反向的电流泄漏。</li>\n</ol>\n<p><img data-src=\"/diode-parameter-design/diode07.png\" alt=\"img\"></p>\n<h1 id=\"齐纳二极管\"><a class=\"anchor\" href=\"#齐纳二极管\">#</a> 齐纳二极管</h1>\n<p><strong>一般也称为 &quot;稳压二极管&quot;</strong> 。是利用二极管在反向电压作用下的齐纳击穿（崩溃）效应，制造而成的一种具有稳定电压功能的电子技术器件。齐纳二极管的正向偏置和一般二极管相同，但是其反向击穿电压（又称齐纳电压）的范围远大于一般的二极管，能承受比一般二极管更高的电压，而且齐纳二极管的反向电压操作是可逆的；常见的齐纳电压从 3 伏特到 100 伏特。常见应用于<strong>直流稳压</strong>。</p>\n<p><strong>1、主要参数</strong></p>\n<ol>\n<li>稳压值 VZ（Zener voltage range）：理想稳压管的稳压值是一个固定的电压数值，但实际真实稳压管的稳定电压会在一定范围波动，有些型号的稳压管应用手册中会给出标称稳定电压值，最小稳定电压值和最大稳定电压值，但也有些手册中只给出标称稳定电压值。该值一般是一个范围值，并且处在一定的 IZT 条件下才符合，因此大多标识为  <code>VZ@IZT</code>  。</li>\n<li>典型工作电流 IZT（Typical operating current）：也称为额定工作电流；额定工作电流是指稳压管可以长时间稳定工作，并且稳压性能最好时对应的工作电流值。</li>\n<li>功率消耗 PD（Power dissipation）：最大耗散功率是指可以稳定工作的最大功率值，在工作电路中稳压管的功率不应超过这个值。</li>\n<li>动态阻抗 ZZT and ZZK（Dynamic impedance）：由于 IZT 和 IZK 的存在，所以也分成了 ZZT 和 ZZK；一般写成  <code>ZZT@IZT</code>  和  <code>ZZK@IZK</code>  ，分别表示在额定电流工作时的阻抗 ZZT 及在最小稳压电流时的阻抗 ZZK。稳压管的动态电阻等于电压变化与电流变化的比值。动态电阻越小稳压效果越好，这是因为动态电阻小，则相同电流变化引起的电压变化就越小，所以电压就越稳定。从稳压管的反向伏安特性可以看出，稳压管的工作电流越接近最大稳定工作电流则动态电阻越小，越接近最小工作电流则动态电阻越大。所以稳压管工作电流接近最大稳定工作电流时稳压效果才好。</li>\n</ol>\n<p><strong>2、辅选参数</strong></p>\n<ol>\n<li>膝点电流 IZK（Knee-point operating current）：即拐点电流，也称为稳压的最小电流；最小稳定工作电流是指可以使稳压管具有稳压功能的最小工作电流，如果稳压管电流小于这个值，会进入反向截止区，在反向截止区稳压管是没有稳压功能的。</li>\n<li>最大工作电流 IZM（Maximum operating current）：如果稳压管超过该电流则有烧毁危险。</li>\n<li>反向电压 VR（Reverse voltage）：一般是给 IR 值作参考，表示在未进入稳压状态下的最大反向电压，并且小于 VZ。</li>\n<li>反向漏电流 IR（DC reverse current）：一般标识为  <code>IR@VR</code>  ，表示电压处于 VR 时 IR 的值，而此时的 VR 是 小于 VZ 的，因此并不能击穿齐纳管得到恒定的电压，这时就相当于一个反向阻断的普通二极管（可以看作不导通），但还是会有 IR 的漏电流。</li>\n</ol>\n<p><img data-src=\"/diode-parameter-design/zd-ivc.gif\" alt=\"Zener diode I-V Curve\"></p>\n<h1 id=\"开关二极管\"><a class=\"anchor\" href=\"#开关二极管\">#</a> 开关二极管</h1>\n<p><strong>一般也称为 &quot;小信号二极管&quot;</strong> 。它是专门为电路上的 “开” 和 “关” 而设计和制造的，顾名思义，就是指具有开关功能的二极管。该二极管具有在正向施加电压时通过电流 (ON) 和在反向施加电压时停止 (OFF) 电流的性能。与其它二极管相比，反向恢复时间较短，即开关二极管从导通状态到完全关断状态所用的时间较短。常见应用于<strong>开关电路</strong>。</p>\n<p>开关二极管跟肖特基二极管很像，都具有反向恢复时间短的特性；但不同的是：</p>\n<ul>\n<li>\n<p>开关二极管反向漏电流较低，更适用于需要截止状态下的高阻值应用。</p>\n</li>\n<li>\n<p>开关二极管反向耐压相对较高，一般开关二极管反向耐压会在 60 伏特以上至 100 多伏特；而肖特基二极管大部分反向耐压在 60 伏特以下、20 伏特以上。</p>\n</li>\n<li>\n<p>开关二极管峰值正向电流较低，一般都是毫安级别，而肖特基二极管峰值正向电流可达安培级别。</p>\n</li>\n</ul>\n<p><strong>1、主要参数</strong></p>\n<ol>\n<li>重复性峰值反向电压 VRRM（Repetitive peak reverse voltage）</li>\n<li>平均正向整流电流 IF (AV)（Average forward rectified current）</li>\n<li>浪涌电流 IFSM（Peak forward surge current）</li>\n<li>功率消耗 PD（Power dissipation）</li>\n<li>均方根反向电压 VRMS（Root-Mean-Square voltage）</li>\n<li>反向恢复时间 trr（Reverse recovery time）</li>\n</ol>\n<p><strong>2、辅选参数</strong></p>\n<ol>\n<li>导通压降 VF（Instantaneous forward voltage）</li>\n<li>反向漏电流 IR（DC reverse current）</li>\n</ol>\n<p><img data-src=\"/diode-parameter-design/e5ac16c1-e7e0-406d-9e13-1d482ac1d98a.png\" alt=\"Diode ＜Types of Diodes＞ | Electronics Basics | ROHM\"></p>\n<h1 id=\"瞬态抑制二极管\"><a class=\"anchor\" href=\"#瞬态抑制二极管\">#</a> 瞬态抑制二极管</h1>\n<p><strong>一般也称为 &quot;TVS 管&quot;</strong> 。是一种用于过电压保护和 ESD 保护的器件，主要应用于<strong>保护后段的 IC 免受由静电和电源波动引起的意外过电压和浪涌</strong>。</p>\n<p><strong>1、主要参数</strong></p>\n<ol>\n<li>反向峰值工作电压 VRWM（Reverse stand-off voltage）：也称为反向关断电压。指设备可以连续承受的电压，没有雪崩破裂的危险。</li>\n<li>击穿电压 VBR（Breakdown voltage）：完全导通的电压阈值。</li>\n<li>箝位电压 VC（Clamping Voltage）：在脉冲峰值电流 Ipp 作用下器件两端的最大电压。</li>\n<li>峰值脉冲电流 IPP（Peak pulse current）</li>\n<li>反向漏电流 IR（DC reverse current）</li>\n<li>典型结电容 Cj （Typical Junction Capacitance）：一般在图中可找到线性参数。</li>\n</ol>\n<p><strong>2、辅选参数</strong></p>\n<ol>\n<li>测试电流 IT （Test Current）：结合图形查看参考。</li>\n<li>峰值脉冲功耗 PPPM（Peak pulse power dissipation）：定义为设备在给定脉冲条件下消耗的瞬时功率，并且是在给定瞬态事件期间 TVS 结中消耗的功率的度量。它通过以下关系式计算： <code>PPPM = VC x IPP</code> ，其中 PPPM = 峰值脉冲功耗（W），VC = 箝位电压（V），IPP = 峰值脉冲电流（A）。</li>\n</ol>\n<p><img data-src=\"/diode-parameter-design/image-20230702211343539.png\" alt=\"image-20230702211343539\"></p>\n<p>note：挑选 TVS 管先看 <strong>VRWM</strong>，尽可能与<strong>最大工作电压</strong>接近，直流大概是 1.1~1.2 倍的最大工作电压，交流是 1.4~1.5 倍的最大工作电压；一般 <strong>VBR</strong> = VRWM / (0.8~0.9)；然后 <strong>VC</strong> 不高于被保护器件的最大允许安全电压；<strong>Cj</strong> 要尽量小，此值会影响 TVS 的响应时间；<strong>IR</strong> 也要尽量小，避免影响到静态电流及电流倒灌；<strong>交流电压</strong>只能用双向 TVS。</p>\n<h1 id=\"pin-型二极管\"><a class=\"anchor\" href=\"#pin-型二极管\">#</a> PIN 型二极管</h1>\n<p>即在 P 型材料与 N 型材料中间插入一层低掺杂纯度的接近于本征半导体材料所组成的 I （Intrinsic）层。由于 I 层的存在，PIN 型二极管通常比普通的二极管拥有更宽的耗尽层，更大的接面电阻和更小的接面电容。常见应用于 <strong>RF 领域</strong>、<strong>光电探测器</strong>及<strong>高压整流器（如 FRD/SRD）</strong>。</p>\n<p><img data-src=\"/diode-parameter-design/Construction-PIN-Diode-300x121.png\" alt=\"What is PIN Diode? - Structure, Working, Characteristics &amp; Its Applications\"></p>\n<p><strong>常用参数（不同种类参考相应的参数）</strong></p>\n<ul>\n<li>平均正向整流电流 IF (AV)（Average forward rectified current）</li>\n<li>典型结电容 Cj （Typical Junction Capacitance）</li>\n<li>等效串联电阻 RS（Series resistance）：当二极管正向导通时，可以理解为串联了一个电阻，该值则为等效串联电阻阻值。一般出现在 RF 种类中，它可以量化电容对 RF 电流的有效电阻。</li>\n<li>反向电压 VR（Reverse voltage）</li>\n<li>功率消耗 PD（Power dissipation）</li>\n<li>导通压降 VF（Instantaneous forward voltage）</li>\n</ul>\n<h1 id=\"快恢复超快恢复二极管\"><a class=\"anchor\" href=\"#快恢复超快恢复二极管\">#</a> 快恢复 / 超快恢复二极管</h1>\n<p><strong>简称 &quot;FRD/SRD&quot;</strong> 。与常见的二极管不同，它是在 P 型、N 型材料中间增加了基区 I ，构成 P-I-N 结构，属 PIN 型二极管的一种；因基区很薄，反向恢复电荷很小，不仅大大减小了 trr 值，还降低了瞬态正向压降，使管子能承受很高的反向工作电压。常见应用于<strong>开关电源</strong>、<strong>PWM 脉宽调制器</strong>及<strong>变频器</strong>。</p>\n<p><strong>1、主要参数</strong></p>\n<ol>\n<li>重复性峰值反向电压 VRRM（Repetitive peak reverse voltage）</li>\n<li>平均正向整流电流 IF (AV)（Average forward rectified current）</li>\n<li>浪涌电流 IFSM（Peak forward surge current）</li>\n<li>导通压降 VF（Instantaneous forward voltage）</li>\n<li>反向漏电流 IR（DC reverse current）</li>\n<li>反向恢复时间 trr（Reverse recovery time）</li>\n</ol>\n<p><strong>2、辅选参数</strong></p>\n<ol>\n<li>均方根反向电压 VRMS（Root-Mean-Square voltage）</li>\n<li>直流阻断电压 VDC（DC blocking voltage）</li>\n</ol>\n<p><img data-src=\"/diode-parameter-design/frd06_1.png\" alt=\"img\"></p>\n<h1 id=\"功率二极管\"><a class=\"anchor\" href=\"#功率二极管\">#</a> 功率二极管</h1>\n<p>功率二极管由重掺杂纯度的 <strong>N+ 层构成阴极</strong>，其上有一个轻掺杂的 N- 层外延包夹在重掺杂的 <strong>P+ 阳极层</strong>上，它们的交界处形成 PN 结，而这个<strong>外延 N- 层被称为漂移层</strong>。功率二极管与一般的二极管相比，具有更大的 PN 结面积，从而具有高达数百安培 (KA) 的高正向电流能力和高达数千伏 (KV) 的反向阻断电压。</p>\n<p><img data-src=\"/diode-parameter-design/image-20230708003940655.png\" alt=\"image-20230708003940655\"></p>\n<p>主要要求：</p>\n<ul>\n<li>反向电压 VR 越高越好。</li>\n<li>导通压降 VF 尽可能低。</li>\n<li>关闭速度尽可能快。</li>\n<li>反向恢复时间 trr 越低越好。</li>\n</ul>\n<p><strong>1、主要参数</strong></p>\n<ol>\n<li>重复性峰值反向电压 VRRM（Repetitive peak reverse voltage）</li>\n<li>均方根反向电压 VRMS（Root-Mean-Square voltage）</li>\n<li>平均正向整流电流 IF (AV)（Average forward rectified current）</li>\n<li>浪涌电流 IFSM（Peak forward surge current）</li>\n<li>工作温结 TJ（Operating junction temperature）：是指电子设备中半导体的最高工作温度。在操作中，它通常较封装外壳温度（Case temperature）高。</li>\n</ol>\n<p><strong>2、辅选参数</strong></p>\n<ol>\n<li>导通压降 VF（Instantaneous forward voltage）</li>\n<li>反向漏电流 IR（DC reverse current）</li>\n<li>反向恢复时间 trr（Reverse recovery time）</li>\n<li>典型结电容 Cj （Typical Junction Capacitance）</li>\n</ol>\n<p><img data-src=\"/diode-parameter-design/image-13.png\" alt=\"vi characteristics of power diode\"></p>\n<p>参考：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudXYuZXMvbWFyaW5qbC9lbGVjdHJvL2Rpb2RvLmh0bWw=\">https://www.uv.es/marinjl/electro/diodo.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9xdWljay1sZWFybi5pbi9wb3dlci1kaW9kZS1zdHJ1Y3R1cmUtdHlwZXMtY2hhcmFjdGVyaXN0aWNzLw==\">https://quick-learn.in/power-diode-structure-types-characteristics/</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWRjLW9ubGluZS5jb20vdGVjaG5pY2FsX3JlZmVyZW5jZXMvcGRmcy9lbGVjdHJpY2FsX2VuZ2luZWVyaW5nL0NvbnN0cnVjdGlvbmFsX0ZlYXR1cmVzX09wZXJhdGluZ19QcmluY2lwbGVfQ2hhcmFjdGVyaXN0aWNzX2FuZF9TcGVjaWZpY2F0aW9uX29mX1Bvd2VyX1NlbWljb25kdWN0b3JfRGlvZGUucGRm\">https://www.idc-online.com/technical_references/pdfs/electrical_engineering/Constructional_Features_Operating_Principle_Characteristics_and_Specification_of_Power_Semiconductor_Diode.pdf</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGFpd2Fuc2VtaS5jb20vYXNzZXRzL3VwbG9hZHMvcHJvZHVjdGNhdGVnb3J5ZmlsZS9BTi0xMDA2XyVFNSU4QSU5RiVFNyU4RSU4NyVFNCVCQSU4QyVFNiU5RSU4MSVFNyVBRSVBMSVFNSU4RiU4MiVFNiU5NSVCMCVFNSU4RiU4QSVFNyU4OSVCOSVFNiU4MCVBNyVFNCVCQiU4QiVFNyVCQiU4RF9BMjAxMi5wZGY=\">https://www.taiwansemi.com/assets/uploads/productcategoryfile/AN-1006_%E5%8A%9F%E7%8E%87%E4%BA%8C%E6%9E%81%E7%AE%A1%E5%8F%82%E6%95%B0%E5%8F%8A%E7%89%B9%E6%80%A7%E4%BB%8B%E7%BB%8D_A2012.pdf</span></p>\n<h1 id=\"信号二极管\"><a class=\"anchor\" href=\"#信号二极管\">#</a> 信号二极管</h1>\n<p>信号二极管可以说是一种大类型，其实上面的肖特基、普通的 PN、开关这些二极管有部分可称为信号二极管，它们之间存在着交集。因此选择参数只需选取适合的即可，这里就不去阐述了，看以下参考吧：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxlY3Ryb25pY3MtdHV0b3JpYWxzLndzL2Rpb2RlL2Rpb2RlXzQuaHRtbA==\">The Signal Diode</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZW5naW5lZXJzZ2FyYWdlLmNvbS9zaWduYWwtZGlvZGUtY29uc3RydWN0aW9uLWFwcGxpY2F0aW9ucy1zcGVjaWZpY2F0aW9ucy8=\">What are signal diodes?</span></p>\n<ul>\n<li>\n<p><strong>Signal Diode Vs Rectifier Diode</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Signal Diode</th>\n<th style=\"text-align:left\">Rectifier Diode</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Signal diodes are used in lower voltage or lower current lanes of the circuit.</td>\n<td style=\"text-align:left\">Rectifier diodes are used in power supplies.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">These diodes can handle the less forward current.</td>\n<td style=\"text-align:left\">These diodes can handle more forward currents.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">These diodes can be designed with semiconductor materials like Ge, Si, and GaAs.</td>\n<td style=\"text-align:left\">These diodes are made from a silicon material.</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p><strong>Signal Diode Vs Power Diode</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Signal Diode</th>\n<th style=\"text-align:left\">Power Diode</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">It constitutes a simple P-N junction with equal doping of P and N layer.</td>\n<td style=\"text-align:left\">Power Diode consists of heavily doped n+, a lightly doped n– layer which is epitaxially grown on a heavily doped P+ layer.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Signal diode doesn’t block higher reverse voltage due to absence of drift region.</td>\n<td style=\"text-align:left\">Power diode consists of drift region. Presence of drift region makes power diode capable of blocking higher reverse voltage.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">It has lower Voltage, Current and Power rating.</td>\n<td style=\"text-align:left\">It has higher Voltage, Current and Power rating.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">It has lower switching speed.</td>\n<td style=\"text-align:left\">It has higher switching speed.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Signal diodes have a lower forward voltage drop, which makes them more suitable for low-power applications.</td>\n<td style=\"text-align:left\">Power diodes have a higher forward voltage drop than signal diodes. This means that more energy is required to turn them on, and they dissipate more power when conducting.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Signal diodes occupies less space as it comes in smaller sizes.</td>\n<td style=\"text-align:left\">Power diodes are usually larger in size than signal diodes. This is because they need to handle higher current levels, which requires more material and space.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Signal diodes are suitable for low temperature ranges.</td>\n<td style=\"text-align:left\">Power diodes are often rated for higher temperature ranges than signal diodes. This is because they dissipate more power and generate more heat during operation.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Signal diodes are used in low-power applications such as signal detection, clipping, and switching.</td>\n<td style=\"text-align:left\">Power diodes are used in power supplies, rectifiers, and other high-current applications.</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p><strong>Signal Diode Vs Small Signal Diode</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Signal Diode</th>\n<th style=\"text-align:left\">Small Signal Diode</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">The construction of a signal diode is similar to the Mesa diode.</td>\n<td style=\"text-align:left\">The construction of a small signal diode is similar to a PN junction diode.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">It functions on high-voltage signals.</td>\n<td style=\"text-align:left\">It functions on low-voltage signals.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Its junction area is high as compared to the small-signal diode.</td>\n<td style=\"text-align:left\">Its junction area is very small, so it stores less charge and has low capacitance.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Signal diodes are used to operate small currents &amp; high-frequency signals.</td>\n<td style=\"text-align:left\">These diodes also operate the same as a signal diode.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">These diodes are frequently used in TV, radio, switching circuits, and communication applications.</td>\n<td style=\"text-align:left\">These diodes are applicable in parametric amplifiers, high-speed switching &amp; general purpose diode applications.</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<h1 id=\"拓展\"><a class=\"anchor\" href=\"#拓展\">#</a> 拓展</h1>\n<p>VRWM、VRRM、VRSM 及 VBR 参数关系</p>\n<p><img data-src=\"/diode-parameter-design/carac.gif\" alt=\"img\"></p>\n<ul>\n<li>反向峰值工作电压 (VRWM)：设备可以连续承受的电压，没有雪崩破裂的危险。</li>\n<li>重复性峰值反向电压 (VRRM)：它可以在 1 毫秒的峰值内持续，每 10 毫秒连续重复一次。</li>\n<li>非重复性峰值反电压 (VRSM)：也称为浪涌电压；每 10 分钟或更长时间只能支持 10ms 一次。</li>\n<li>击穿电压 (VBR)：如果达到该值，即使只有一次，在 10 毫秒内，二极管可能会破坏或降低其特性。</li>\n<li>通常是 VBR &gt; VRSM &gt; VRRM &gt; VRWM。</li>\n</ul>\n<h1 id=\"相关资料\"><a class=\"anchor\" href=\"#相关资料\">#</a> 相关资料</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxlY3Ryb25pY3NodWIub3JnL2Rpb2Rlcy8=\">https://www.electronicshub.org/diodes/</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxlY3Ryb25pY3MtdHV0b3JpYWxzLndzL2NhdGVnb3J5L2Rpb2Rl\">https://www.electronics-tutorials.ws/category/diode</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucm9obS5jb20uY24vZWxlY3Ryb25pY3MtYmFzaWNzL2Rpb2Rlcw==\">https://www.rohm.com.cn/electronics-basics/diodes</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2hpbmRlbmdlbi5jb20vcHJvZHVjdHMvc2VtaS9jb2x1bW4vYmFzaWMvZGlvZGVzL2Rpb2RlLmh0bWw=\">https://www.shindengen.com/products/semi/column/basic/diodes/diode.html</span></p>\n",
            "tags": [
                "电子",
                "硬件设计"
            ]
        },
        {
            "id": "https://arachnid.cc/isolation-techniques/",
            "url": "https://arachnid.cc/isolation-techniques/",
            "title": "光电隔离、磁隔离和电容式隔离三种常见隔离技术的特性",
            "date_published": "2023-06-29T15:53:51.000Z",
            "content_html": "<p>在一些恶劣的高电压、高功率工作环境中应用传感器传输信号，需要使用隔离器确保信号的完整。</p>\n<p>为了防止高电压和高功率危险，设计中可以使用隔离器 (isolator) 作为系统的隔离屏障，使电压信号在传感器和控制器之间传递而不受共模电压的影响，确保信号完整。</p>\n<p>还有一个关键原因是，现实中一些电信基础设施需要高速地传输数据及信号，会涉及高功率，而使用隔离器可以令系统得到保护。</p>\n<p>电流隔离是电气系统中的一种隔离技术。在传感器和其他电子设备之间提供电流隔离，可以防止直流或不受控制的瞬态电流影响。然而，传感器传递的数据和能量仍然需要通过隔离屏障传送。</p>\n<p>电流隔离屏障有三种常见技术 —— 光电隔离、磁隔离和电容式隔离。虽然这三种技术隔离屏障的介质有所不同，但最终目标都是相同的。</p>\n<h1 id=\"光电隔离成熟易用的技术\"><a class=\"anchor\" href=\"#光电隔离成熟易用的技术\">#</a> 光电隔离：成熟易用的技术</h1>\n<p>光电隔离 (或称光隔离)，是三种技术中使用最早的，并且易于使用。如下图：</p>\n<p><img data-src=\"/isolation-techniques/190403-capacitive-isolation-img3.jpg\" alt=\"img\"></p>\n<p>它利用光将信息传输到隔离栅的另一端。通常由发光二极管 (LED) 将信息传输到光敏接收器（如晶体管）。光隔离的主要优势是应用广泛，对于慢速数字信号传输是公认的低成本隔离解决方案；高速、数字光耦合器则往往较为昂贵。 光耦合器隔离法一般用于信号的直流状态很重要的场合。随着时间的推移，LED 可能会损耗，因此光隔离通常需要补偿和频带防护，以保证在整个寿命期间正常工作。</p>\n<h1 id=\"磁隔离速率高而磁场抗扰度弱\"><a class=\"anchor\" href=\"#磁隔离速率高而磁场抗扰度弱\">#</a> 磁隔离：速率高而磁场抗扰度弱</h1>\n<p>磁耦是基于磁隔离技术的隔离器件，也成为磁隔离器。如下图：</p>\n<p><img data-src=\"/isolation-techniques/190403-capacitive-isolation-img4.jpg\" alt=\"img\"></p>\n<p>变压器隔离利用变压器线圈将信息传输到隔离栅的另一端。隔离栅一端的变压器绕组中的电流发生变化时，会在另一端的变压器绕组中感生相应的电流变化。变压器隔离法一般用于涉及交流信号（例如以太网）、非常适合进行变压器耦合的应用场合。变压器隔离在数据速率较高的系统中具有优势，而且它还可以用来提供隔离电源，但与其它解决方案相比，变压器通常非常庞大。</p>\n<p>我们会发现，有些磁耦可以以高达 100Mbps 速度的脉冲电流通过隔离屏障，磁耦的数据传输速率特性可以在 datasheet 中找到。</p>\n<p>但是要留意的是，磁耦的功耗会随着数据速率增加而增加。它对电磁干扰也很敏感，而在 HVAC 系统和涉及电机的工厂自动化环境中的磁场是很大。</p>\n<h1 id=\"电容式隔离更好的解决方案\"><a class=\"anchor\" href=\"#电容式隔离更好的解决方案\">#</a> 电容式隔离：更好的解决方案</h1>\n<p>与磁隔离一样，电容式隔离具有用于编码和解码输入 AC 信号的数字电路，利用可变的电场在隔离屏障中传输信息。如下图：</p>\n<p><img data-src=\"/isolation-techniques/190403-capacitive-isolation-img6.jpg\" alt=\"img\"></p>\n<p>电容式隔离器无法传递直流信号，因此它们本身就是一个很好的隔离器。电容式隔离器不易受磁场噪声影响，而仍然保持高数据速率和低功耗；这种方法与光耦合器相比具有明显的性能优势，但通常很容易受共模和 ESD 瞬变影响。</p>\n",
            "tags": [
                "电子"
            ]
        },
        {
            "id": "https://arachnid.cc/linux_c-time-configuration/",
            "url": "https://arachnid.cc/linux_c-time-configuration/",
            "title": "Linux c 时间时区配置",
            "date_published": "2023-06-21T15:54:38.000Z",
            "content_html": "<h1 id=\"时间与日期\"><a class=\"anchor\" href=\"#时间与日期\">#</a> 时间与日期</h1>\n<p><strong>GMT 和 UTC</strong></p>\n<p>GMT，即格林尼治标准时间，也就是世界时。GMT 的正午是指当太阳横穿格林尼治子午线（本初子午线）时的时间。但由于地球自转不均匀不规则，导致 GMT 不精确，现在已经不再作为世界标准时间使用。</p>\n<p>UTC，即协调世界时。UTC 是以原子时秒长为基础，在时刻上尽量接近于 GMT 的一种时间计量系统。为确保 UTC 与 GMT 相差不会超过 0.9 秒，在有需要的情况下会在 UTC 内加上正或负闰秒。UTC 现在作为世界标准时间使用。</p>\n<p>所以，UTC 与 GMT 基本上等同，误差不超过 0.9 秒。</p>\n<p><strong>时区</strong></p>\n<p>地球自西向东旋转，东边比西边先看到太阳，东边的时间也比西边的早。为了统一世界的时间，1884 年的国际经度会议规规定将全球划分为 24 个时区（东、西各 12 个时区）。规定英国（格林尼治天文台旧址）为零时区（GMT+00），东 1-12 区，西 1-12 区，中国北京处于东 8 区（GMT+08）。</p>\n<p>若中国当前时间为 8 点整，则英国时间为 0 点整。</p>\n<p><strong>UTC 时间与本地时间</strong></p>\n<p>UTC + 时区差 = 本地时间</p>\n<p>时区差东为正，西为负。在此，把东八区时区差记为  <code>+08</code></p>\n<p>UTC + (+08) = 本地（北京）时间</p>\n<p><strong>UNIX 时间戳</strong></p>\n<p>由 Unix 内核提供的基本时间服务是自国际标准时间公元 1970 年 1 月 1 日 00:00:00 以来的秒数。</p>\n<h1 id=\"时间及时区查看命令\"><a class=\"anchor\" href=\"#时间及时区查看命令\">#</a> 时间及时区查看命令</h1>\n<ul>\n<li>获取 UTC 世界时间</li>\n</ul>\n<p><code>date -u</code></p>\n<ul>\n<li>获取当地时间</li>\n</ul>\n<p><code>date</code></p>\n<ul>\n<li>获取当地时间及时差</li>\n</ul>\n<p><code>date -R</code></p>\n<h1 id=\"时区设置命令\"><a class=\"anchor\" href=\"#时区设置命令\">#</a> 时区设置命令</h1>\n<p><strong>1、对于完整的 Linux 系统</strong></p>\n<ol>\n<li>命令跟描述对不上号的  <code>tzselect</code></li>\n</ol>\n<p>看起来很像一个时区选择的工具，但并非如此。事实上 tzselect 仅仅是一个查看时区表示方式的『向导』程序而已。通过依次询问大洲→国家→城市，最后告诉你如何 TZ 变量的写法，比如北京时间是： <code>Asia/Shanghai</code></p>\n<ol start=\"2\">\n<li>TZ 变量</li>\n</ol>\n<p>根据上面的指导，可以获知通过修改 TZ 变量，直接修改时区信息，例如：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">date</span> <span class=\"token parameter variable\">-R</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre> Tue, <span class=\"token number\">17</span> Jan <span class=\"token number\">2017</span> <span class=\"token number\">13</span>:57:06 +0000</pre></td></tr><tr><td data-num=\"3\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token builtin class-name\">export</span>  <span class=\"token assign-left variable\">TZ</span><span class=\"token operator\">=</span><span class=\"token string\">'Asia/Shanghai'</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">date</span> <span class=\"token parameter variable\">-R</span></pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre> Tue, <span class=\"token number\">17</span> Jan <span class=\"token number\">2017</span> <span class=\"token number\">19</span>:57:18 +0600</pre></td></tr></table></figure><p>但如果不写在环境变量文件配置里的话，一般是会话级的操作，取消重新打开便会失效；因此对于在 shell 中实现更改 TZ 变量，只能做到临时变更时区信息。</p>\n<p>正确做法是到  <code>/etc/profile</code>  里（或用户的  <code>~/.profile</code>  或  <code>~/.bashrc</code>  文件等），直接  <code>export TZ='xxx'</code>  更改时区（时区的名字可以用  <code>tzselect</code>  向导来确定）</p>\n<ol start=\"3\">\n<li><code>/etc/localtime</code>  文件</li>\n</ol>\n<p>默认情况下情况下，TZ 属性是空，这时候是靠  <code>/etc/localtime</code>  文件来确定的时区。而此文件通常又是一个到  <code>/usr/share/zoneinfo/</code>  下各种时区文件的软连接。通过修改  <code>/etc/localtime</code>  指向的软连接，进而修改系统的时区。比如下面的方法，将 localtime 文件设置为了北京时间：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ln</span> <span class=\"token parameter variable\">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</pre></td></tr></table></figure><p><strong>2、对于裁剪的 Linux 系统，如：arm linux</strong></p>\n<ol>\n<li><code>tzselect</code>  命令</li>\n</ol>\n<p>正常情况下，裁剪过的是不支持该命令的，因此相对于上面的 2、3 两点并不适用于此。</p>\n<ol start=\"2\">\n<li>TZ 变量</li>\n</ol>\n<p>与上面一样可通过修改 TZ 变量，直接修改时区信息，但与此不同的是，并不能通过  <code>TZ='Asia/Shanghai'</code>  去修改，只能通过时区偏移量来修改，例如我们中国的北京时间相对于  <code>UTC-0</code>  的偏移量是  <code>UTC+8</code>  ；那么则修改为：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">date</span> <span class=\"token parameter variable\">-R</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre> Tue, <span class=\"token number\">17</span> Jan <span class=\"token number\">2017</span> <span class=\"token number\">13</span>:57:06 +0000</pre></td></tr><tr><td data-num=\"3\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token builtin class-name\">export</span>  <span class=\"token assign-left variable\">TZ</span><span class=\"token operator\">=</span><span class=\"token string\">'CST-8'</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">date</span> <span class=\"token parameter variable\">-R</span></pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre> Tue, <span class=\"token number\">17</span> Jan <span class=\"token number\">2017</span> <span class=\"token number\">19</span>:57:18 +0600</pre></td></tr></table></figure><p>注意，在这里，UTC+、- 是相反的，UTC-8 代表的是相对于 UTC 加八个小时，反之减八个小时......；而 CST 则是对应为北京时区缩写。</p>\n<p>时区表信息可看：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGltZWFuZGRhdGUuY29tL3RpbWUvem9uZXMv\">https://www.timeanddate.com/time/zones/</span></p>\n<ol start=\"3\">\n<li><code>/etc/localtime</code>  文件</li>\n</ol>\n<p>由于裁剪问题，系统中是没有  <code>/usr/share/zoneinfo/</code>  文件夹的，如有需要，将 PC 端的  <code>/usr/share/zoneinfo</code>  整个  <code>zoneinfo</code>  文件夹复制到 rootfs 的  <code>/usr/share</code>  下，这样嵌入式系统中就有了  <code>timezone</code>  。</p>\n<p>最后同样执行：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ln</span> <span class=\"token parameter variable\">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</pre></td></tr></table></figure><p>note：时区信息保存在  <code>/etc/localtime</code>  文件里，如果没有该文件则系统是零时区，有该文件时系统会去读取该文件。具体该文件的内容可以不同关心，在  <code>/usr/share/zoneinfo/</code>  目录下有各个时区对应的文件，只需要拷贝过去就可以。比如我们常用的东八区时间就是对应  <code>/usr/share/zoneinfo/Asia/Shanghai</code>  文件，只需要将该文件指向或拷贝到  <code>/etc/localtime</code>  就将系统时间改为东八区。</p>\n<h1 id=\"常用-api\"><a class=\"anchor\" href=\"#常用-api\">#</a> 常用 API</h1>\n<h2 id=\"时间结构体\"><a class=\"anchor\" href=\"#时间结构体\">#</a> 时间结构体</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_sec<span class=\"token punctuation\">;</span>    <span class=\"token comment\">/* Seconds (0-60) */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_min<span class=\"token punctuation\">;</span>    <span class=\"token comment\">/* Minutes (0-59) */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_hour<span class=\"token punctuation\">;</span>   <span class=\"token comment\">/* Hours (0-23) */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_mday<span class=\"token punctuation\">;</span>   <span class=\"token comment\">/* Day of the month (1-31) */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_mon<span class=\"token punctuation\">;</span>    <span class=\"token comment\">/* Month (0-11) */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_year<span class=\"token punctuation\">;</span>   <span class=\"token comment\">/* Year - 1900 */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_wday<span class=\"token punctuation\">;</span>   <span class=\"token comment\">/* Day of the week (0-6, Sunday = 0) */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_yday<span class=\"token punctuation\">;</span>   <span class=\"token comment\">/* Day in the year (0-365, 1 Jan = 0) */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">int</span> tm_isdst<span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* Daylight saving time */</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">time_t</span>      tv_sec<span class=\"token punctuation\">;</span>     <span class=\"token comment\">/* seconds (秒) */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">suseconds_t</span> tv_usec<span class=\"token punctuation\">;</span>    <span class=\"token comment\">/* microseconds (微秒) */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">timezone</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">int</span> tz_minuteswest<span class=\"token punctuation\">;</span>     <span class=\"token comment\">/* minutes west of Greenwich */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">int</span> tz_dsttime<span class=\"token punctuation\">;</span>         <span class=\"token comment\">/* type of DST correction */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"时间函数归类\"><a class=\"anchor\" href=\"#时间函数归类\">#</a> 时间函数归类</h2>\n<p><strong>1、C99 标准库函数</strong></p>\n<p>需  <code>#include &lt;time.h&gt;</code></p>\n<ul>\n<li>获取时间戳：</li>\n</ul>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* time () 函数，返回一个从 1970 年 1 月 1 日 00:00:00 到现在的 time_t 类型 UTC 时间，当参数为 NULL 时直接返回秒数，当然也会将该值写入 t 指针指向的地址。 */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">time_t</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">time_t</span> <span class=\"token operator\">*</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/* mktime () 会把本地时间转换为 UTC 时间 */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">time_t</span> <span class=\"token function\">mktime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span>tm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//note：两者区别在于传入的参数结构体不同，mktime 存在时区转换；time (t) 等价于 mktime (localtime (time (t)))。</span></pre></td></tr></table></figure><ul>\n<li>获取  <code>struct tm</code>  类型的时间：</li>\n</ul>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* gmtime () 是零时区，把 UTC 时间转换成北京时间的话，需要在年数上加 1900，月份上加 1，小时数加上 8。 */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span><span class=\"token function\">gmtime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">time_t</span> <span class=\"token operator\">*</span>timep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span><span class=\"token function\">gmtime_r</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">time_t</span> <span class=\"token operator\">*</span>timep<span class=\"token punctuation\">,</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/* localtime () 将得到本地时间，该函数与 gmtime () 唯一区别是，在转换成北京时间的小时数不需要加上 8。 */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span><span class=\"token function\">localtime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">time_t</span> <span class=\"token operator\">*</span>timep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span><span class=\"token function\">localtime_r</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">time_t</span> <span class=\"token operator\">*</span>timep<span class=\"token punctuation\">,</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//note：localtime 是将时区考虑在内了，转出的是当前时区的时间。但是注意，有些嵌入式设备上被裁减过的系统，时区没有被设置好，导致二者转出来的时间都是零时区的。在多线程应用里面，应该用后缀不带 `_r` 的函数，如： localtime_r 函数替代 localtime 函数，因为 localtime_r 是线程安全的，例子看第五大点。</span></pre></td></tr></table></figure><ul>\n<li>时间日期格式化：</li>\n</ul>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* 将 tm 结构中的时间信息转换为相应时间的字符串 */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">asctime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span>tm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">asctime_r</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span>tm<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/* 将日历时间参数 timep 转换为一个表示本地当前时间的字符串，函数已经由时区转换成当地时间 */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">ctime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">time_t</span> <span class=\"token operator\">*</span>timep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token function\">ctime_r</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token class-name\">time_t</span> <span class=\"token operator\">*</span>timep<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//note：两者区别在于传入的参数结构体不同，但转换出来的信息格式显示是一样的；asctime 是直接把时间格式化，而 ctime 是经过时区转换后再格式化输出；ctime (t) 等价于 asctime (localtime (t))。</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">/* 常用时间格式化参数看下方描述 */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token class-name\">size_t</span> <span class=\"token function\">strftime</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>s<span class=\"token punctuation\">,</span> <span class=\"token class-name\">size_t</span> max<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>format<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span>tm<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>在使用  <code>strftime</code>  时间格式化函数所涉及的相关参数的含义如下：</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>%F</td>\n<td>将时间格式化为年 - 月 - 日</td>\n</tr>\n<tr>\n<td>%T</td>\n<td>将时间格式化为显示时分秒: hh:mm:ss</td>\n</tr>\n<tr>\n<td>%Y</td>\n<td>将时间格式化为带世纪部分的十制年份</td>\n</tr>\n<tr>\n<td>%m</td>\n<td>将时间格式化为十进制表示的月份</td>\n</tr>\n<tr>\n<td>%d</td>\n<td>将时间格式化为十进制的每月中的第几天</td>\n</tr>\n<tr>\n<td>%H</td>\n<td>将时间格式化为 24 小时制的小时</td>\n</tr>\n<tr>\n<td>%M</td>\n<td>将时间格式化为十进制表示的分钟数</td>\n</tr>\n<tr>\n<td>%S</td>\n<td>将时间格式化为十进制表示的秒数</td>\n</tr>\n</tbody>\n</table>\n<p>更多参数请阅：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9jcHJvZ3JhbW1pbmcvYy1mdW5jdGlvbi1zdHJmdGltZS5odG1s\">https://www.runoob.com/cprogramming/c-function-strftime.html</span></p>\n<ul>\n<li>获取时间差：</li>\n</ul>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">double</span> <span class=\"token function\">difftime</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">time_t</span> time1<span class=\"token punctuation\">,</span> <span class=\"token class-name\">time_t</span> time0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>2、Uinx 系统函数</strong></p>\n<p>需  <code>#include &lt;sys/time.h&gt;</code></p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/time.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>获取 <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> 类型的时间：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/* 相对于 time () 和 mktime () ，gettimeofday () 能获取更精准的微秒级别，及相应的时区信息，需要注意的是 tz 是依赖于系统，不同的系统可能存在获取不到的可能，因此通常设置为 NULL */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">gettimeofday</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> <span class=\"token operator\">*</span>tv<span class=\"token punctuation\">,</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timezone</span> <span class=\"token operator\">*</span>tz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 成功则返回 0，失败返回 －1，错误代码存于 errno</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// EFAULT：指针 tv 或 tz 所指的内存空间无效。</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>设置 <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> 类型的时间：</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">settimeofday</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> <span class=\"token operator\">*</span>tv<span class=\"token punctuation\">,</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timezone</span> <span class=\"token operator\">*</span>tz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 成功则返回 0，失败返回 －1，错误代码存于 errno</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// EPERM：调用进程没有足够权限调用 settimeofday ()，即权限不够。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// EINVAL：时区或其它内容无效，无法正确设置时间。</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//note：settimeofday 的修改时间需要在 root 权限下才能配置成功。</span></pre></td></tr></table></figure><p><strong>3、总结</strong></p>\n<p><code>time</code> 、 <code>gmtime</code> 、 <code>asctime</code>  所表示的时间都是 UTC 时间，只是数据类型不一样，<br>\n而  <code>mktime</code> 、 <code>localtime</code> 、 <code>ctime</code>  的时间都存在时区之间变换。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>传参类型</th>\n<th>返回类型</th>\n<th>时区转换</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>time()</td>\n<td>time_t</td>\n<td>time_t</td>\n<td>UTC+0</td>\n<td>用于获取 UTC 零时区的时间戳格式</td>\n</tr>\n<tr>\n<td>mktime()</td>\n<td>struct tm</td>\n<td>time_t</td>\n<td>UTC-t</td>\n<td>用于获取 UTC 零时区的时间戳格式，但会经过时区转换，把本地时间内部换成 UTC+0</td>\n</tr>\n<tr>\n<td>gmtime()</td>\n<td>time_t</td>\n<td>struct tm</td>\n<td>UTC+0</td>\n<td>用于获取 UTC 零时区的</td>\n</tr>\n<tr>\n<td>localtime()</td>\n<td>time_t</td>\n<td>struct tm</td>\n<td>UTC+t</td>\n<td></td>\n</tr>\n<tr>\n<td>asctime()</td>\n<td>struct tm</td>\n<td>string</td>\n<td>UTC+0</td>\n<td></td>\n</tr>\n<tr>\n<td>ctime()</td>\n<td>time_t</td>\n<td>string</td>\n<td>UTC+t</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"函数应用\"><a class=\"anchor\" href=\"#函数应用\">#</a> 函数应用</h2>\n<p>1、获取当前时区的时间戳偏移量</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">time_t</span> <span class=\"token function\">get_localtime_interval</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">time_t</span> timep_utc<span class=\"token punctuation\">,</span> timep_local<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> tm_utc<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>timep_utc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">gmtime_r</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>timep_utc<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>tm_utc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\ttimep_local <span class=\"token operator\">=</span> <span class=\"token function\">mktime</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>tm_utc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>timep_utc <span class=\"token operator\">-</span> timep_local<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2、获取当前时区的时间戳（带时区的本地时间）</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">time_t</span> <span class=\"token function\">get_time_stamp</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token class-name\">time_t</span> timep<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>timep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\ttimep <span class=\"token operator\">+=</span> <span class=\"token function\">get_localtime_interval</span><span class=\"token punctuation\">(</span>timep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">return</span> timep<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>3、获取时区偏移量</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">time_t</span> <span class=\"token function\">get_time_stamp</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token class-name\">time_t</span> timep_zone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    timep_zone <span class=\"token operator\">=</span> <span class=\"token function\">get_localtime_interval</span><span class=\"token punctuation\">(</span>timep<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">3600</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">return</span> timep_zone<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4、时区设置函数</p>\n<p>时间函数除了 gmttime ()、asctime () 不受环境变量 TZ 的影响外，大部分函数都受到环境变量 TZ 的影响，这几个函数是： localtime、mktime、ctime 和 strftime。如果定义了 TZ，则这些函数将使用其值以代替系统默认时区。</p>\n<p>在 Unix 环境下可以通过改变系统文件修改环境变量，也可以通过函数 setenv () 修改。</p>\n<p>TZ 指定了当前的系统时区。这个时区会影响我们所做的时间转换。例如假设当前的系统时间是 8:00AM，如果我们把当前的时区设置成东八区，则标准时间就是（即 UTC+0）的时间就是 8-8=0:00AM，如果是看成是东六区的话，则标准时间就变成了 8-6=2:00AM。</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span>  </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;time.h></span>  </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span>    </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span> argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">setenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TZ\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"CST-8\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// 北京东八区</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">//setenv (\"TZ\", \"UTC+0\", 1);   // 将当前时区设置成标准区</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">char</span> buf<span class=\"token punctuation\">[</span><span class=\"token number\">64</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">timeval</span> tv<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span><span class=\"token operator\">*</span> tm_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">gettimeofday</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>tv<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    tm_time <span class=\"token operator\">=</span> <span class=\"token function\">gmtime</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>tv<span class=\"token punctuation\">.</span>tv_sec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">strftime</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%a %b %m %H:%M:%S %Z %Y\"</span><span class=\"token punctuation\">,</span> tm_time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GMT time: %s\\n\"</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    tm_time <span class=\"token operator\">=</span> <span class=\"token function\">localtime</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>tv<span class=\"token punctuation\">.</span>tv_sec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token function\">strftime</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%a %b %m %H:%M:%S %Z %Y\"</span><span class=\"token punctuation\">,</span> tm_time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"local time: %s\\n\"</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"localtime-和-localtime_r-区别\"><a class=\"anchor\" href=\"#localtime-和-localtime_r-区别\">#</a> localtime 和 localtime_r 区别</h1>\n<p>示例来源（下方为原文备份记录）：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Rlc3QxMjgwL2FydGljbGUvZGV0YWlscy84MDkxNzk2Mg==\">https://blog.csdn.net/test1280/article/details/80917962</span></p>\n<p><code>localtime</code>  和  <code>localtime_r</code>  的函数功能： converts the calendar time timep to broken-time representation</p>\n<p>在调用  <code>localtime</code>  和  <code>localtime_t</code>  函数时，需特别注意：</p>\n<ul>\n<li>\n<p><code>localtime</code>  是不可重入函数，非线程安全</p>\n</li>\n<li>\n<p><code>localtime_r</code>  是可重入函数，线程安全</p>\n</li>\n</ul>\n<p>1、使用  <code>localtime</code>  时不可重入示范：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;time.h></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">time_t</span> curTime <span class=\"token operator\">=</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">time_t</span> aftTime <span class=\"token operator\">=</span> curTime <span class=\"token operator\">+</span> <span class=\"token number\">3600</span><span class=\"token operator\">*</span><span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span>pTm1 <span class=\"token operator\">=</span> <span class=\"token function\">localtime</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>curTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> <span class=\"token operator\">*</span>pTm2 <span class=\"token operator\">=</span> <span class=\"token function\">localtime</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>aftTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stdout</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%04d%02d%02d%02d%02d%02d\\n\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            pTm1<span class=\"token operator\">-></span>tm_year <span class=\"token operator\">+</span> <span class=\"token number\">1900</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            pTm1<span class=\"token operator\">-></span>tm_mon <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            pTm1<span class=\"token operator\">-></span>tm_mday<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            pTm1<span class=\"token operator\">-></span>tm_hour<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            pTm1<span class=\"token operator\">-></span>tm_min<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            pTm1<span class=\"token operator\">-></span>tm_sec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stdout</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%04d%02d%02d%02d%02d%02d\\n\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            pTm2<span class=\"token operator\">-></span>tm_year <span class=\"token operator\">+</span> <span class=\"token number\">1900</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            pTm2<span class=\"token operator\">-></span>tm_mon <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            pTm2<span class=\"token operator\">-></span>tm_mday<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            pTm2<span class=\"token operator\">-></span>tm_hour<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            pTm2<span class=\"token operator\">-></span>tm_min<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            pTm2<span class=\"token operator\">-></span>tm_sec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>编译 &amp; 运行：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ gcc <span class=\"token parameter variable\">-o</span> main main.c</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>$ ./main</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">20180704225205</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">20180704225205</span></pre></td></tr></table></figure><p>调用  <code>localtime</code>  函数并获取其返回值（一个指向  <code>struct tm</code>  结构类型数据的指针）后，我们并未对返回值进行<strong>显式地释放</strong>。</p>\n<p><strong>这并没有什么问题（不会导致内存泄漏）</strong>。</p>\n<p>因为  <code>localtime</code>  函数返回值是一个指针，指向一个静态变量，这个静态变量是库中的一个  <code>static struct tm</code>  类型数据。</p>\n<p>man localtime：</p>\n<p>The return value points to a <strong>statically allocated struct</strong> which might <strong>be overwritten</strong> by <strong>subsequent calls</strong> to any of the date and time functions.</p>\n<p>这将引出新的问题，<strong>同一进程</strong>多个线程中同时调用（极短时间内连续调用）  <code>localtime</code>  函数，返回值  <code>tm</code>  可能被覆盖。</p>\n<p>举个栗子：</p>\n<p>两个线程 A 和 B 同时调用  <code>localtime</code>  函数：</p>\n<p>时刻 1：线程 A 调用  <code>localtime</code>  函数，得到一个指针，指向  <code>static struct tm</code>  类型变量；（tm 中存储的值更新为 value-a）</p>\n<p>时刻 2：线程 B 调用  <code>localtime</code>  函数，得到一个指针，指向  <code>static struct tm</code>  类型变量；（tm 中存储的值更新为 value-b）</p>\n<p>时刻 3：线程 A 对  <code>localtime</code>  返回的指针进行相关引用操作（例如 printf 输出某字段），此时  <code>static struct tm</code>  中的值实际是 value-b，并非预期的 value-a。</p>\n<p>时刻 4：线程 B 对  <code>localtime</code>  返回的指针进行相关引用操作，此时  <code>static struct tm</code>  中的值实际是 value-b。</p>\n<p>上面的示范代码虽然是在同一线程中，但是已经可以简单模拟这样的多线程执行调用流程。</p>\n<p><strong>如何解决？</strong></p>\n<p><code>localtime_r</code>  是  <code>localtime</code>  的可重入版本（线程安全版本）。</p>\n<p><code>localtime</code>  不可重入是由于  <code>static struct tm</code>  是库中的一个静态变量，如果我们在调用  <code>localtime</code>  时传入一个  <code>struct tm</code>  类型变量（指针）用于存放结果，岂不是实现<strong>可重入</strong>？</p>\n<p>Bingo！</p>\n<p><code>struct tm *localtime(const time_t *timep);</code></p>\n<p><code>struct tm *localtime_r(const time_t *timep, struct tm *result);</code></p>\n<p>调用  <code>localtime</code>  只需要传入指向  <code>time_t</code>  的一个常量指针；</p>\n<p>调用  <code>localtime_t</code>  不仅需要传入指向  <code>time_t</code>  的一个常量指针，还需要传入指向  <code>struct tm</code>  的一个指针，结果将存储在  <code>result</code>  指向的  <code>struct tm</code>  对象中；</p>\n<p>The return value points to a statically allocated struct which might be overwritten by subsequent calls to any of the date and time functions.</p>\n<p>The localtime_r() function does the same, <strong>but stores the data in a user-supplied struct</strong>.</p>\n<p>2、使用  <code>localtime_r</code>  时可重入示范：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;time.h></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">time_t</span> curTime <span class=\"token operator\">=</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">time_t</span> aftTime <span class=\"token operator\">=</span> curTime <span class=\"token operator\">+</span> <span class=\"token number\">3600</span><span class=\"token operator\">*</span><span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> tm1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">struct</span> <span class=\"token class-name\">tm</span> tm2<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token function\">localtime_r</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>curTime<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>tm1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">localtime_r</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>aftTime<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>tm2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stdout</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%04d%02d%02d%02d%02d%02d\\n\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            tm1<span class=\"token punctuation\">.</span>tm_year <span class=\"token operator\">+</span> <span class=\"token number\">1900</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            tm1<span class=\"token punctuation\">.</span>tm_mon <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            tm1<span class=\"token punctuation\">.</span>tm_mday<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            tm1<span class=\"token punctuation\">.</span>tm_hour<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            tm1<span class=\"token punctuation\">.</span>tm_min<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            tm1<span class=\"token punctuation\">.</span>tm_sec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stdout</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%04d%02d%02d%02d%02d%02d\\n\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            tm2<span class=\"token punctuation\">.</span>tm_year <span class=\"token operator\">+</span> <span class=\"token number\">1900</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            tm2<span class=\"token punctuation\">.</span>tm_mon <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            tm2<span class=\"token punctuation\">.</span>tm_mday<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            tm2<span class=\"token punctuation\">.</span>tm_hour<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            tm2<span class=\"token punctuation\">.</span>tm_min<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            tm2<span class=\"token punctuation\">.</span>tm_sec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>编译 &amp; 运行：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ gcc <span class=\"token parameter variable\">-o</span> main main.c</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>$ ./main</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">20180704200531</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">20180704230531</span></pre></td></tr></table></figure><h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vc3VuLWZyZWRlcmljay9wLzQ3NzI1MzUuaHRtbA==\">https://www.cnblogs.com/sun-frederick/p/4772535.html</span><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Rlc3QxMjgwL2FydGljbGUvZGV0YWlscy84MDkxNzk2Mg==\">https://blog.csdn.net/test1280/article/details/80917962</span></p>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/6ull-kernel-transplant/",
            "url": "https://arachnid.cc/6ull-kernel-transplant/",
            "title": "imx-6ULL kernel 移植",
            "date_published": "2023-03-04T15:32:46.000Z",
            "content_html": "<blockquote>\n<p>开发平台：Ubuntu 18.04.6</p>\n<p>目标平台：imx-6ull</p>\n<p>kernel 版本：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvbGludXgtaW14L3RyZWUvaW14XzUuNC43MF8yLjMuMA==\">linux-imx-imx_5.4.70_2.3.0</span></p>\n<p>编译工具链：gcc versions 10.3.1 20210621 (GNU Toolchain for the A-profile Architecture 10.3-2021.07 (arm-10.29))</p>\n</blockquote>\n<h1 id=\"环境搭建\"><a class=\"anchor\" href=\"#环境搭建\">#</a> 环境搭建</h1>\n<h2 id=\"交叉编译器\"><a class=\"anchor\" href=\"#交叉编译器\">#</a> 交叉编译器</h2>\n<p>关于 arm linux 交叉编译工具链的搭建，这里就再不展开说明了，毕竟在此之前如果有移植过 uboot，那么这里就可以省略了，对于没有搭过交叉编译工具链的，可以查看上一篇 <a href=\"https://arachnid.cc/6ull-uboot-transplant/\">imx-6ULL uboot 移植</a> 的交叉编译搭建的环节。</p>\n<h2 id=\"kernel-源码\"><a class=\"anchor\" href=\"#kernel-源码\">#</a> kernel 源码</h2>\n<p>NXP 维护的 kernel 仓库地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvbGludXgtaW14\">https://github.com/nxp-imx/linux-imx</span></p>\n<p>获取 NXP kernel 5.4.70_2.3.0 版本的源码：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 直接拉取 5.4.70_2.3.0 版本源码文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> clone <span class=\"token parameter variable\">-b</span> imx_5.4.70_2.3.0 https://github.com/nxp-imx/linux-imx</pre></td></tr></table></figure><h1 id=\"编译验证\"><a class=\"anchor\" href=\"#编译验证\">#</a> 编译验证</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token parameter variable\">-s</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span>arm</pre></td></tr><tr><td data-num=\"3\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CROSS_COMPILE</span><span class=\"token operator\">=</span>arm-none-linux-gnueabihf-</pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token function\">make</span> distclean</pre></td></tr><tr><td data-num=\"5\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token function\">make</span> imx_v7_defconfig</pre></td></tr><tr><td data-num=\"6\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token function\">make</span></pre></td></tr></table></figure><p>第一次编译可能不会通过，如果出现以下报错：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>HOSTCC  scripts/extract-cert</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>scripts/extract-cert.c:21:10: fatal error: openssl/bio.h: 没有那个文件或目录</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> <span class=\"token comment\">#include &lt;openssl/bio.h></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          ^~~~~~~~~~~~~~~</pre></td></tr></table></figure><p>则需要安装相应的依赖库：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> libssl-dev</pre></td></tr></table></figure><p>最后再次编译验证。</p>\n<h1 id=\"移植\"><a class=\"anchor\" href=\"#移植\">#</a> 移植</h1>\n<h2 id=\"设备树文件\"><a class=\"anchor\" href=\"#设备树文件\">#</a> 设备树文件</h2>\n<p>1、 <code>imx6ull-14x14-lanjut-emmc.dts</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ls</span> arch/arm/boot/dts/*6ull*.dts</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-14x14-evk-btwifi.dts</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-14x14-evk-btwifi-oob.dts</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-14x14-evk.dts</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-14x14-evk-emmc.dts</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-14x14-evk-gpmi-weim.dts</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-9x9-evk-btwifi.dts</pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-9x9-evk-btwifi-oob.dts</pre></td></tr><tr><td data-num=\"9\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-9x9-evk.dts</pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-9x9-evk-ldo.dts</pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-colibri-eval-v3.dts</pre></td></tr><tr><td data-num=\"12\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-colibri-wifi-eval-v3.dts</pre></td></tr><tr><td data-num=\"13\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-phytec-segin-ff-rdk-emmc.dts</pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-phytec-segin-ff-rdk-nand.dts</pre></td></tr><tr><td data-num=\"15\"></td><td data-command></td><td><pre>arch/arm/boot/dts/imx6ull-phytec-segin-lc-rdk-nand.dts</pre></td></tr><tr><td data-num=\"16\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> arch/arm/boot/dts/imx6ull-14x14-evk-emmc.dts arch/arm/boot/dts/imx6ull-14x14-lanjut-emmc.dts</pre></td></tr><tr><td data-num=\"17\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> arch/arm/boot/dts/imx6ull-14x14-lanjut-emmc.dts</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<p>把  <code>#include &quot;imx6ull-14x14-evk.dts&quot;</code>  更改为  <code>#include &quot;imx6ull-14x14-lanjut.dts&quot;</code>  。</p>\n<p>2、 <code>imx6ull-14x14-lanjut.dts</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> arch/arm/boot/dts/imx6ull-14x14-evk.dts arch/arm/boot/dts/imx6ull-14x14-lanjut.dts</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> arch/arm/boot/dts/imx6ull-14x14-lanjut.dts</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<p>把  <code>#include &quot;imx6ul-14x14-evk.dtsi&quot;</code>  更改为  <code>#include &quot;imx6ul-14x14-lanjut.dtsi&quot;</code>  ；</p>\n<p>同时更改以下内容：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/ &#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tmodel = \"i.MX6 ULL 14x14 EVK Board\";</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tcompatible = \"fsl,imx6ull-14x14-evk\", \"fsl,imx6ull\";</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>改为</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>/ &#123;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tmodel = \"i.MX6 ULL 14x14 LANJUT Board\";</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcompatible = \"fsl,imx6ull-14x14-lanjut\", \"fsl,imx6ull\";</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>&#125;;</pre></td></tr></table></figure><p>把两个  <code>status = &quot;okay&quot;;</code>  改为  <code>status = &quot;disable&quot;;</code>  ，这里暂不需要摄像头驱动。</p>\n<p>3、  <code>imx6ul-14x14-lanjut.dtsi</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> arch/arm/boot/dts/imx6ul-14x14-evk.dtsi arch/arm/boot/dts/imx6ul-14x14-lanjut.dtsi</pre></td></tr></table></figure><h2 id=\"配置文件\"><a class=\"anchor\" href=\"#配置文件\">#</a> 配置文件</h2>\n<p>在这里，imx6ull 的 kernel 默认配置文件为  <code>imx_v7_defconfig</code>  ，因此，我们独立一个专属自己的配置文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> arch/arm/configs/imx_v7_defconfig arch/arm/configs/imx_v7_lanjut_defconfig</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>去除其它芯片类型的设备树的生成</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>CONFIG_SOC_IMX50=y</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>CONFIG_SOC_IMX51=y</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>CONFIG_SOC_IMX53=y</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>CONFIG_SOC_IMX6Q=y</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>CONFIG_SOC_IMX6SL=y</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>CONFIG_SOC_IMX6SLL=y</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>CONFIG_SOC_IMX6SX=y</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>CONFIG_SOC_IMX6UL=y</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>CONFIG_SOC_IMX7D=y</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>CONFIG_SOC_IMX7ULP=y</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>CONFIG_SOC_VF610=y</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>改为</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre># CONFIG_SOC_IMX50 is not set</pre></td></tr><tr><td data-num=\"18\"></td><td><pre># CONFIG_SOC_IMX51 is not set</pre></td></tr><tr><td data-num=\"19\"></td><td><pre># CONFIG_SOC_IMX53 is not set</pre></td></tr><tr><td data-num=\"20\"></td><td><pre># CONFIG_SOC_IMX6Q is not set</pre></td></tr><tr><td data-num=\"21\"></td><td><pre># CONFIG_SOC_IMX6SL is not set</pre></td></tr><tr><td data-num=\"22\"></td><td><pre># CONFIG_SOC_IMX6SLL is not set</pre></td></tr><tr><td data-num=\"23\"></td><td><pre># CONFIG_SOC_IMX6SX is not set</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>CONFIG_SOC_IMX6UL=y</pre></td></tr><tr><td data-num=\"25\"></td><td><pre># CONFIG_SOC_IMX7D is not set</pre></td></tr><tr><td data-num=\"26\"></td><td><pre># CONFIG_SOC_IMX7ULP is not set</pre></td></tr><tr><td data-num=\"27\"></td><td><pre># CONFIG_SOC_VF610 is not set</pre></td></tr></table></figure><p>然后，这个配置文件其它东西我们就先不去更改了，因为内核配置太多太复杂了，它们之间的功能关系也很难分清，后面我们使用图形配置操作对需要的功能进行增删。</p>\n<h2 id=\"其它文件\"><a class=\"anchor\" href=\"#其它文件\">#</a> 其它文件</h2>\n<p>为  <code>Makefile</code>  添加新增的文件编译：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> arch/arm/boot/dts/Makefile</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<figure class=\"highlight makefile\"><figcaption data-lang=\"makefile\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dtb-<span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>CONFIG_SOC_IMX6UL<span class=\"token punctuation\">)</span> <span class=\"token operator\">+=</span> \\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\timx6ul-14x14-evk.dtb \\</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\timx6ul-14x14-evk-csi.dtb \\</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\timx6ul-14x14-evk-emmc.dtb \\</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\timx6ul-14x14-evk-btwifi.dtb \\</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\timx6ul-14x14-evk-btwifi-oob.dtb \\</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\timx6ul-14x14-evk-ecspi-slave.dtb \\</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\timx6ul-14x14-evk-ecspi.dtb \\</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\timx6ul-14x14-evk-gpmi-weim.dtb \\</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\timx6ul-9x9-evk.dtb \\</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\timx6ul-9x9-evk-ldo.dtb \\</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\timx6ul-9x9-evk-btwifi.dtb \\</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\timx6ul-9x9-evk-btwifi-oob.dtb \\</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\timx6ul-ccimx6ulsbcexpress.dtb \\</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\timx6ul-ccimx6ulsbcpro.dtb \\</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\timx6ul-geam.dtb \\</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\timx6ul-isiot-emmc.dtb \\</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\timx6ul-isiot-nand.dtb \\</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\timx6ul-kontron-n6310-s.dtb \\</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\timx6ul-kontron-n6310-s-43.dtb \\</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\timx6ul-liteboard.dtb \\</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\timx6ul-opos6uldev.dtb \\</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\timx6ul-pico-hobbit.dtb \\</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\timx6ul-pico-pi.dtb \\</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\timx6ul-phytec-segin-ff-rdk-nand.dtb \\</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\timx6ul-tx6ul-0010.dtb \\</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\timx6ul-tx6ul-0011.dtb \\</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\timx6ul-tx6ul-mainboard.dtb \\</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\timx6ull-14x14-evk.dtb \\</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\timx6ull-14x14-evk-emmc.dtb \\</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\timx6ull-14x14-evk-btwifi.dtb \\</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\timx6ull-14x14-evk-btwifi-oob.dtb \\</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\timx6ull-14x14-evk-gpmi-weim.dtb \\</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\timx6ull-14x14-lanjut-emmc.dtb \\  <span class=\"token comment\"># 将设备树文件添加进编译项</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\timx6ull-9x9-evk.dtb \\</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\timx6ull-9x9-evk-ldo.dtb \\</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\timx6ull-9x9-evk-btwifi.dtb \\</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\timx6ull-9x9-evk-btwifi-oob.dtb \\</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\timx6ull-colibri-eval-v3.dtb \\</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\timx6ull-colibri-wifi-eval-v3.dtb \\</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\timx6ull-phytec-segin-ff-rdk-nand.dtb \\</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\timx6ull-phytec-segin-ff-rdk-emmc.dtb \\</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\timx6ull-phytec-segin-lc-rdk-nand.dtb \\</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\timx6ulz-14x14-evk.dtb \\</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\timx6ulz-14x14-evk-btwifi.dtb \\</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\timx6ulz-14x14-evk-gpmi-weim.dtb \\</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\timx6ulz-14x14-evk-emmc.dtb</pre></td></tr></table></figure><h1 id=\"外设配置\"><a class=\"anchor\" href=\"#外设配置\">#</a> 外设配置</h1>\n<h1 id=\"配置内核\"><a class=\"anchor\" href=\"#配置内核\">#</a> 配置内核</h1>\n<h2 id=\"图形配置\"><a class=\"anchor\" href=\"#图形配置\">#</a> 图形配置</h2>\n<p>需要先  <code>make xxx_config</code>  生成  <code>.config</code>  。</p>\n<p>使用  <code>make menuconfig</code>  调出图形配置界面进行配置；如果  <code>make menuconfig</code>  失败，说明缺少  <code>ncurses</code>  库 ，需要安装  <code>libncurses-dev</code>  ，在安装前则需要加载  <code>libncurses-dev</code>  的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYWNrYWdlcy51YnVudHUuY29tL2ZvY2FsL2FtZDY0L2xpYm5jdXJzZXMtZGV2L2Rvd25sb2Fk\">源镜像</span>，然后通过  <code>apt update</code>  更新，然后再次使用命令  <code>apt install libncurses-dev </code>  安装，若安装后还不行，可能是由于某些库可能没安装好，或者被  <code>auto remove</code>  掉了，可以尝试以下安装：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">apt</span> <span class=\"token function\">install</span> lib32ncurses5 lib32ncurses5-dev lib32ncursesw5 lib32ncursesw5-dev lib32tinfo-dev lib32tinfo5 libcunit1-ncurses libcunit1-ncurses-dev libncurses5 libncurses5-dbg libncurses5-dev libncursesw5 libncursesw5-dbg libncursesw5-dev</pre></td></tr></table></figure><p>当进入图形菜单后，可以通过以下热键进行选择：</p>\n<ul>\n<li><code>Y</code>  显示为 [*] 。模块驱动编译到内核中，启动时自动加载。</li>\n<li><code>N</code>  显示为 [ ] 。移除该模块驱动。</li>\n<li><code>M</code>  显示为 [M] 。模块会被编译，但是不会被编译到内核中，只是生成  <code>.o</code>  /  <code>.ko</code>  文件，通过  <code>insmod</code>  命令实现动态加载。</li>\n</ul>\n<p>note：如果想要 Load 加载原有的配置信息，那么需要先  <code>make zImage</code>  才能获取回来。</p>\n<h1 id=\"添加编译脚本\"><a class=\"anchor\" href=\"#添加编译脚本\">#</a> 添加编译脚本</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">touch</span> build.sh</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> build.sh</pre></td></tr></table></figure><p><strong>写入：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 若之前已经导入到环境变量则不需要</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 若已经在顶层 Makefile 文件中指定则不需要</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span>arm</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 若已经在顶层 Makefile 文件中指定则不需要</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CROSS_COMPILE</span><span class=\"token operator\">=</span>arm-none-linux-gnueabihf-</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">make</span> distclean</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">make</span> mx6ull_14x14_lanjut_emmc_defconfig</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">make</span> zImage -j<span class=\"token variable\"><span class=\"token variable\">$(</span>nproc<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">make</span> dtbs -j<span class=\"token variable\"><span class=\"token variable\">$(</span>nproc<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">make</span> modules -j<span class=\"token variable\"><span class=\"token variable\">$(</span>nproc<span class=\"token variable\">)</span></span></pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/6ull-uboot-transplant/",
            "url": "https://arachnid.cc/6ull-uboot-transplant/",
            "title": "imx-6ULL uboot 移植",
            "date_published": "2023-03-03T12:52:11.803Z",
            "content_html": "<blockquote>\n<p>开发平台：Ubuntu 18.04.6</p>\n<p>目标平台：imx-6ull</p>\n<p>uboot 版本：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvdWJvb3QtaW14L3RyZWUvaW14X3YyMDIwLjA0XzUuNC43MF8yLjMuMA==\">uboot-imx-imx_v2020.04_5.4.70_2.3.0</span></p>\n<p>编译工具链：gcc versions 10.3.1 20210621 (GNU Toolchain for the A-profile Architecture 10.3-2021.07 (arm-10.29))</p>\n</blockquote>\n<h1 id=\"环境搭建\"><a class=\"anchor\" href=\"#环境搭建\">#</a> 环境搭建</h1>\n<h2 id=\"交叉编译器\"><a class=\"anchor\" href=\"#交叉编译器\">#</a> 交叉编译器</h2>\n<p>在 ARM <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb3dubG9hZHMvLS9nbnUtYQ==\">官方链接</span>下载 Arm A-profile architecture 编译工具链，选择自己相应的平台，这里的话是： <code>gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf</code>  。</p>\n<p>解压添加至本地：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 创建存放编译工具链的文件夹</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> /usr/local/arm</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre><span class=\"token comment\"># 移动文件</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf.tar.xz /usr/local/arm/</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre><span class=\"token comment\"># 解压文件</span></pre></td></tr><tr><td data-num=\"6\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xvf</span> /usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf.tar.xz</pre></td></tr></table></figure><p>添加环境变量：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 添加到系统环境变量 (对所有用户有效)</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/profile</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre><span class=\"token comment\"># 添加到用户环境变量 (仅对当前用户有效)</span></pre></td></tr><tr><td data-num=\"5\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> ~/.bashrc </pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre><span class=\"token comment\"># 以上二选一</span></pre></td></tr></table></figure><p>测试命令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 成功打印版本信息则为通过</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[user@localhost] #\"></td><td><pre>arm-none-linux-gnueabihf-gcc <span class=\"token parameter variable\">-v</span></pre></td></tr></table></figure><h2 id=\"uboot-源码\"><a class=\"anchor\" href=\"#uboot-源码\">#</a> uboot 源码</h2>\n<p>NXP 维护的 uboot 仓库地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvdWJvb3QtaW14\">https://github.com/nxp-imx/uboot-imx</span></p>\n<p>获取 NXP uboot 5.4.70_2.3.0 版本的源码：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 拉取源码文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> clone https://github.com/nxp-imx/uboot-imx.git</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 切换到</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">git</span> checkout imx_v2020.04_5.4.70_2.3.0</pre></td></tr></table></figure><p>上面的 clone 操作会拉取所有分支文件及历史提交信息下来，文件比较大，如果网络不太好，可以尝试打开 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvdWJvb3QtaW14L3RyZWUvaW14X3YyMDIwLjA0XzUuNC43MF8yLjMuMA==\">https://github.com/nxp-imx/uboot-imx/tree/imx_v2020.04_5.4.70_2.3.0</span> 只下载 ZIP 压缩包下来，然后利用  <code>unzip</code>  命令解压。</p>\n<p>或者使用  <code>git clone -b imx_v2020.04_5.4.70_2.3.0 https://github.com/nxp-imx/uboot-imx.git</code>  直接下载指定版本。</p>\n<p>note：对于不同分支，有  <code>fslc</code>  和  <code>imx</code>  关键字的区分，以下摘录解释：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>There are two BSPs, the BSP Releases which are supported by NXP and their documentation can be found on the Linux i.MX webpage, and the Community BSP.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>A BSP Release roadmap is not publicly available, but as you may see there are new BSPs every several months. However, it usually lags in respect to the Linux Mainline Kernel as a lot of work is done to ensure that the kernel works correctly on the NXP hardware. The kernel from these BSP Releases (linux-imx) can be found on the following repository and it is indeed an upstream from the Community BSP Kernel.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>https://source.codeaurora.org/external/imx/linux-imx/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>As for the Community BSP, it’s constantly being updated by the Community but due to its nature is hard to predict how fast each branch will be developed.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>You can find more information about the Community BSP on the link below:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>http://freescale.github.io/</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>The Kernel recipes of the community BSP (linux-fslc) would be on the meta-freescale layer:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>http://git.yoctoproject.org/cgit/cgit.cgi/meta-freescale</pre></td></tr></table></figure><p>简单的来讲，就是  <code>imx</code>  是官方发行版，而  <code>fslc</code>  是社区发行版。</p>\n<p>来源：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb21tdW5pdHkubnhwLmNvbS90NS9pLU1YLVByb2Nlc3NvcnMvd2hhdC1pcy10aGUtcHVycG9zZS1vZi1saW51eC1mc2xjLWdpdC9tLXAvMTA0NzYwMg==\">https://community.nxp.com/t5/i-MX-Processors/what-is-the-purpose-of-linux-fslc-git/m-p/1047602</span></p>\n<p>关于 uboot 版本选择：</p>\n<p>随着时间的变化，uboot 的更新也出现了多个的版本，那么到底应该选择哪一个呢？有些人可能会说当然是越新越好啦。其实呢不是这个样子的，虽然 uboot 本身是在不断的开发和进化当中，但对于新版本来说，可能开发者们在某一个版本中加入了一些新的特性，然后呢过了一段时间又发现这个新功能不是很稳定，就有可能会把它删掉或者需要后期继续更新迭代修复；这样一来就会对我们所移植的 uboot 来说就会增加很多不必要的复杂性，因为不排除是否会影响到所使用的功能，所以一般的原则就是够用就可以了，不需要频繁更新。</p>\n<p>那如何选择属于自己的版本呢：</p>\n<ol>\n<li>\n<p>打开下载的 uboot 目录下的： <code>arch/arm/cpu</code>  目录，确认使用的 cpu 型号是否支持及对应。</p>\n</li>\n<li>\n<p>打开 uboot 目录下的： <code>board</code>  目录，查看相对应的外设是否都支持。eq： <code>board/freescale/mx6ull_board/</code>  。</p>\n</li>\n</ol>\n<p>一般来说，uboot 版本越新支持的开发板和 cpu 就越多，代码量就越多，如果我们的 cpu 和开发板的并没有这么多东西，那我们可以不用新的。而用适合自己产品外设的，通常是根据开发板发行的日期和 uboot 的更新日期来找到合适的 uboot。</p>\n<h1 id=\"编译验证\"><a class=\"anchor\" href=\"#编译验证\">#</a> 编译验证</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token parameter variable\">-s</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span>arm</pre></td></tr><tr><td data-num=\"3\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CROSS_COMPILE</span><span class=\"token operator\">=</span>arm-none-linux-gnueabihf-</pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token function\">make</span> distclean</pre></td></tr><tr><td data-num=\"5\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token function\">make</span> mx6ull_14x14_evk_emmc_defconfig</pre></td></tr><tr><td data-num=\"6\"></td><td data-command=\"[root@localhost] #\"></td><td><pre><span class=\"token function\">make</span></pre></td></tr></table></figure><p>编译源码这一步的目的：</p>\n<ul>\n<li>一是为了验证编译环境是否正常；</li>\n<li>二是为了下一步移植过程中的代码分析（一些文件只有在编译后才会生成）。</li>\n</ul>\n<p>note：</p>\n<p><code>make clean</code>  - 清除了目标机器上可以运行的 bin 文件以及目录，还有中间的过程文件和编译日志，但是会保留内核的配置文件 .config 以及编译支持的扩展模块；</p>\n<p><code>make mrproper</code>  - 在 clean 的基础上，清除了交叉编译工具链、menuconfig 的内容；</p>\n<p><code>make distclean</code>  - 在 mrproper 的基础上，删除编辑器备份和补丁文件。</p>\n<p>删除的文件范围从小到大依次为：  <code>make clean</code>  &lt;  <code>make mrproper</code>  &lt;  <code>make distclean</code>  。</p>\n<p>注意：</p>\n<p>若是提示  <code>make: 未找到命令</code>  ，则需要安装  <code>make</code>  工具：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token function\">make</span></pre></td></tr></table></figure><p>若是出现  <code>/bin/sh: 1: cc: not found</code>  ，需要安装 gcc 依赖，因为  <code>HOSTCC  scripts/basic/fixdep</code>  强制定义使用了 gcc， <code>HOSTCC=gcc</code>  ：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> gcc</pre></td></tr></table></figure><p>若是在系统上第一次编译 uboot 源码可能会遇到缺少   <code>bison</code> 、 <code>flex</code>  的报错信息导致编译失败，只需安装相应的工具包后重新执行编译即可：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command></td><td><pre><span class=\"token comment\"># 语法分析工具</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> bison</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre><span class=\"token comment\"># 词法分析工具</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[user@localhost] #\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> flex</pre></td></tr></table></figure><h1 id=\"移植\"><a class=\"anchor\" href=\"#移植\">#</a> 移植</h1>\n<p>下面以命名为  <code>lanjut</code>  的板子为例。</p>\n<h2 id=\"开发板文件夹\"><a class=\"anchor\" href=\"#开发板文件夹\">#</a> 开发板文件夹</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ls</span> <span class=\"token parameter variable\">-d</span> board/freescale/*6ull*</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>board/freescale/mx6ullevk     board/freescale/mx6ull_ddr3_val</pre></td></tr><tr><td data-num=\"3\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> <span class=\"token parameter variable\">-r</span> board/freescale/mx6ullevk/ board/freescale/mx6ull_lanjut/</pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">mv</span> board/freescale/mx6ull_lanjut/mx6ullevk.c board/freescale/mx6ull_lanjut/mx6ull_lanjut.c</pre></td></tr><tr><td data-num=\"5\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ls</span> board/freescale/mx6ull_lanjut/</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>imximage.cfg         Kconfig      Makefile        plugin.S</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>imximage_lpddr2.cfg  MAINTAINERS  mx6ull_lanjut.c  README</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<p>1、 <code>Kconfig</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> board/freescale/mx6ull_lanjut/Kconfig</pre></td></tr></table></figure><p>更改内容为（注意该文件  <code>endif</code>  后面必须有换行）：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>if TARGET_MX6ULL_14X14_LANJUT</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>config SYS_BOARD</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tdefault \"mx6ull_lanjut\"</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>config SYS_VENDOR</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tdefault \"freescale\"</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>config SYS_CONFIG_NAME</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tdefault \"mx6ull_lanjut\"</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>config SYS_TEXT_BASE</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tdefault 0x87800000</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>endif</pre></td></tr></table></figure><p>2、 <code>Makefile</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> board/freescale/mx6ull_lanjut/Makefile</pre></td></tr></table></figure><p>把  <code>obj-y  := mx6ullevk.o</code>  改为  <code>obj-y  := mx6ull_lanjut.o</code>  。</p>\n<p>3、 <code>imximage_lpddr2.cfg</code>  和  <code>imximage.cfg</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> board/freescale/mx6ull_lanjut/imximage_lpddr2.cfg</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> board/freescale/mx6ull_lanjut/imximage.cfg</pre></td></tr></table></figure><p>该更改受控于  <code>CONFIG_USE_IMXIMG_PLUGIN</code>  宏定义，在配置文件中是没有使能的，改不改都无所谓，但为了统一，把  <code>PLUGIN\tboard/freescale/mx6ullevk/plugin.bin 0x00907000</code>  改为  <code>PLUGIN\tboard/freescale/mx6ull_lanjut/plugin.bin 0x00907000</code>  。</p>\n<p>4、 <code>MAINTAINERS</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> board/freescale/mx6ull_lanjut/MAINTAINERS</pre></td></tr></table></figure><p>是维护者记录文件，作为个人使用，改不改都无所谓；如果是作为 uboot 项目维护者，则需要完整记录好详细的信息，以便更好的发展维护。</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>MX6ULL_LANJUT BOARD</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>M:\tArachnid &lt;xxxx@qq.com></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>S:\tMaintained</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>F:\tboard/freescale/mx6ull_lanjut/</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>F:\tinclude/configs/mx6ull_lanjut.h</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>F:\tconfigs/mx6ull_14x14_lanjut_defconfig</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>F:\tconfigs/mx6ull_14x14_lanjut_plugin_defconfig</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>F:\tconfigs/mx6ulz_14x14_lanjut_defconfig</pre></td></tr></table></figure><p>5、 <code>mx6ull_lanjut.c</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> board/freescale/mx6ull_lanjut/mx6ull_lanjut.c</pre></td></tr></table></figure><ul>\n<li>\n<p><code>board_late_init</code>  函数</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">board_late_init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_CMD_BMODE</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token function\">add_board_boot_modes</span><span class=\"token punctuation\">(</span>board_boot_modes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">env_set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tee\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"no\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_IMX_OPTEE</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token function\">env_set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tee\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"yes\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token function\">env_set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"board_name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"LANJUT\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t<span class=\"token comment\">// 决定了后面 findfdt 和 findtee 环境变量的选择</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_mx6ull_9x9_evk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token function\">env_set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"board_rev\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"9X9\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token function\">env_set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"board_rev\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"14X14\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_cpu_type</span><span class=\"token punctuation\">(</span>MXC_CPU_MX6ULZ<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token function\">env_set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"board_name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ULZ-EVK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token function\">env_set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"usb_net_cmd\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"usb start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">setup_lcd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_ENV_IS_IN_MMC</span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token function\">board_late_mmc_env_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token function\">set_wdog_reset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">wdog_regs</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>WDOG1_BASE_ADDR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p><code>checkboard</code>  函数</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">checkboard</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_mx6ull_9x9_evk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token function\">puts</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Board: MX6ULL 9x9 EVK\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_cpu_type</span><span class=\"token punctuation\">(</span>MXC_CPU_MX6ULZ<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token function\">puts</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Board: MX6ULZ 14x14 EVK\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token function\">puts</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Board: MX6ULL 14x14 LANJUT\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t<span class=\"token comment\">//uboot 板载信息显示</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"设备树文件\"><a class=\"anchor\" href=\"#设备树文件\">#</a> 设备树文件</h2>\n<p>在新版本 uboot 中，参考 Linux 内核引入了<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGV2aWNldHJlZS5vcmcv\">设备树</span>和<span class=\"exturl\" data-url=\"aHR0cHM6Ly91LWJvb3QucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2RldmVsb3AvZHJpdmVyLW1vZGVsL2luZGV4Lmh0bWw=\">驱动模型 (Driver Model)</span>。</p>\n<p>1、 <code>imx6ull-14x14-lanjut-emmc.dts</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ls</span> arch/arm/dts/*6ull*.dts</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val.dts</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-emmc.dts</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-epdc.dts</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-gpmi-weim.dts</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-lcdif.dts</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-ddr3-val-tsc.dts</pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-evk.dts</pre></td></tr><tr><td data-num=\"9\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-evk-emmc.dts</pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-14x14-evk-gpmi-weim.dts</pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-9x9-evk.dts</pre></td></tr><tr><td data-num=\"12\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-colibri.dts</pre></td></tr><tr><td data-num=\"13\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-dart-6ul.dts</pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-phytec-segin-ff-rdk-emmc.dts</pre></td></tr><tr><td data-num=\"15\"></td><td data-command></td><td><pre>arch/arm/dts/imx6ull-somlabs-visionsom.dts</pre></td></tr><tr><td data-num=\"16\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> arch/arm/dts/imx6ull-14x14-evk-emmc.dts arch/arm/dts/imx6ull-14x14-lanjut-emmc.dts</pre></td></tr><tr><td data-num=\"17\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> arch/arm/dts/imx6ull-14x14-lanjut-emmc.dts</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<p>把  <code>#include &quot;imx6ull-14x14-evk.dts&quot;</code>  更改为  <code>#include &quot;imx6ull-14x14-lanjut.dts&quot;</code>  。</p>\n<p>2、 <code>imx6ull-14x14-lanjut.dts</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> arch/arm/dts/imx6ull-14x14-evk.dts arch/arm/dts/imx6ull-14x14-lanjut.dts</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> arch/arm/dts/imx6ull-14x14-lanjut.dts</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<p>把  <code>#include &quot;imx6ul-14x14-evk.dtsi&quot;</code>  更改为  <code>#include &quot;imx6ul-14x14-lanjut.dtsi&quot;</code>  ；</p>\n<p>把  <code>#include &quot;imx6ul-14x14-evk-u-boot.dtsi&quot;</code>  更改为  <code>#include &quot;imx6ul-14x14-lanjut-u-boot.dtsi&quot;</code>  。</p>\n<p>同时更改以下内容：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/ &#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tmodel = \"i.MX6 ULL 14x14 EVK Board\";</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tcompatible = \"fsl,imx6ull-14x14-evk\", \"fsl,imx6ull\";</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>改为</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>/ &#123;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tmodel = \"i.MX6 ULL 14x14 LANJUT Board\";</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcompatible = \"fsl,imx6ull-14x14-lanjut\", \"fsl,imx6ull\";</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>&#125;;</pre></td></tr></table></figure><p>3、 <code>imx6ul-14x14-lanjut.dtsi</code>  和  <code>imx6ul-14x14-lanjut-u-boot.dtsi</code>  文件：</p>\n<p>根据  <code>imx6ull-14x14-lanjut.dts</code>  文件的  <code>#include</code>  包含文件，分别添加文件。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> arch/arm/dts/imx6ul-14x14-evk.dtsi arch/arm/dts/imx6ul-14x14-lanjut.dtsi</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> arch/arm/dts/imx6ul-14x14-evk-u-boot.dtsi arch/arm/dts/imx6ul-14x14-lanjut-u-boot.dtsi</pre></td></tr></table></figure><h2 id=\"配置文件\"><a class=\"anchor\" href=\"#配置文件\">#</a> 配置文件</h2>\n<p>1、 <code>mx6ull_14x14_lanjut_emmc_defconfig</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ls</span> configs/*6ull*</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>configs/colibri-imx6ull_defconfig</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_defconfig</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_emmc_defconfig</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_epdc_defconfig</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_nand_defconfig</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_plugin_defconfig</pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_qspi1_defconfig</pre></td></tr><tr><td data-num=\"9\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_spinor_defconfig</pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_ddr3_val_tsc_defconfig</pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_defconfig</pre></td></tr><tr><td data-num=\"12\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_emmc_defconfig</pre></td></tr><tr><td data-num=\"13\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_nand_defconfig</pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_optee_defconfig</pre></td></tr><tr><td data-num=\"15\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_plugin_defconfig</pre></td></tr><tr><td data-num=\"16\"></td><td data-command></td><td><pre>configs/mx6ull_14x14_evk_qspi1_defconfig</pre></td></tr><tr><td data-num=\"17\"></td><td data-command></td><td><pre>configs/mx6ull_9x9_evk_defconfig</pre></td></tr><tr><td data-num=\"18\"></td><td data-command></td><td><pre>configs/mx6ull_9x9_evk_plugin_defconfig</pre></td></tr><tr><td data-num=\"19\"></td><td data-command></td><td><pre>configs/mx6ull_9x9_evk_qspi1_defconfig</pre></td></tr><tr><td data-num=\"20\"></td><td data-command></td><td><pre>configs/somlabs_visionsom_6ull_defconfig</pre></td></tr><tr><td data-num=\"21\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> configs/mx6ull_14x14_evk_emmc_defconfig configs/mx6ull_14x14_lanjut_emmc_defconfig</pre></td></tr><tr><td data-num=\"22\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> configs/mx6ull_14x14_lanjut_emmc_defconfig</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<p>把  <code>CONFIG_TARGET_MX6ULL_14X14_EVK=y</code>  改为  <code>CONFIG_TARGET_MX6ULL_14X14_LANJUT=y</code>  ；</p>\n<p>把  <code>CONFIG_SYS_EXTRA_OPTIONS=&quot;IMX_CONFIG=board/freescale/mx6ullevk/imximage.cfg&quot;</code>  改为  <code>CONFIG_SYS_EXTRA_OPTIONS=&quot;IMX_CONFIG=board/freescale/mx6ull_lanjut/imximage.cfg&quot;</code>  ；</p>\n<p>把  <code>CONFIG_DEFAULT_DEVICE_TREE=&quot;imx6ull-14x14-evk-emmc&quot;</code>  改为  <code>CONFIG_DEFAULT_DEVICE_TREE=&quot;imx6ull-14x14-lanjut-emmc&quot;</code>  。</p>\n<p>2、 <code>include/configs/mx6ull_lanjut.h</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ls</span> include/configs/*6ull*</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>include/configs/colibri-imx6ull.h  include/configs/mx6ullevk.h</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>include/configs/mx6ull_ddr3_val.h  include/configs/somlabs_visionsom_6ull.h</pre></td></tr><tr><td data-num=\"4\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> include/configs/mx6ullevk.h include/configs/mx6ull_lanjut.h</pre></td></tr><tr><td data-num=\"5\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> include/configs/mx6ull_lanjut.h</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<p>把  <code>#ifndef __MX6ULLEVK_CONFIG_H</code>  和  <code>#define __MX6ULLEVK_CONFIG_H</code>  改为  <code>#ifndef __MX6ULL_LANJUT_CONFIG_H</code>  和  <code>#define __MX6ULL_LANJUT_CONFIG_H</code>  。</p>\n<p>更改 uboot 默认命令配置值：</p>\n<ul>\n<li>\n<p>findfdt（用于设置  <code>fdt_file</code>  变量，根据  <code>board_name</code>  来指定<strong>传递给内核的设备树</strong>文件名）</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>\"findfdt=\"\\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t\"if test $fdt_file = undefined; then \" \\</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t\t\"if test $board_name = ULZ-EVK &amp;&amp; test $board_rev = 14X14; then \" \\</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t\t\t\"setenv fdt_file imx6ulz-14x14-evk.dtb; fi; \" \\</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\t\"if test $board_name = EVK &amp;&amp; test $board_rev = 9X9; then \" \\</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t\t\"setenv fdt_file imx6ull-9x9-evk.dtb; fi; \" \\</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t\"if test $board_name = EVK &amp;&amp; test $board_rev = 14X14; then \" \\</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t\t\"setenv fdt_file imx6ull-14x14-evk.dtb; fi; \" \\</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t\"if test $board_name = LANJUT &amp;&amp; test $board_rev = 14X14; then \" \\</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t\t\"setenv fdt_file imx6ull-14x14-lanjut.dtb; fi; \" \\</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\t\"if test $fdt_file = undefined; then \" \\</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\t\t\"echo WARNING: Could not determine dtb to use; \" \\</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t\"fi; \" \\</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\"fi;\\0\" \\</pre></td></tr></table></figure></li>\n<li>\n<p>findtee（用于设置  <code>tee_file</code>  变量，根据  <code>board_name</code>  来指定 uboot 设备树文件名）</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>\"findtee=\"\\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t\"if test $tee_file = undefined; then \" \\</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t\t\"if test $board_name = ULZ-EVK &amp;&amp; test $board_rev = 14X14; then \" \\</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t\t\t\"setenv tee_file uTee-6ulzevk; fi; \" \\</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\t\"if test $board_name = EVK &amp;&amp; test $board_rev = 9X9; then \" \\</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t\t\"setenv tee_file uTee-6ullevk; fi; \" \\</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t\"if test $board_name = EVK &amp;&amp; test $board_rev = 14X14; then \" \\</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t\t\"setenv tee_file uTee-6ullevk; fi; \" \\</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t\"if test $board_name = LANJUT &amp;&amp; test $board_rev = 14X14; then \" \\</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t\t\"setenv tee_file uTee-6ull_lanjut; fi; \" \\</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\t\"if test $tee_file = undefined; then \" \\</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\t\t\"echo WARNING: Could not determine tee to use; \" \\</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t\"fi; \" \\</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\"fi;\\0\" \\</pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"其它文件\"><a class=\"anchor\" href=\"#其它文件\">#</a> 其它文件</h2>\n<p>1、 <code>Makefile</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> arch/arm/dts/Makefile</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<figure class=\"highlight makefile\"><figcaption data-lang=\"makefile\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dtb-<span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>CONFIG_MX6ULL<span class=\"token punctuation\">)</span> <span class=\"token operator\">+=</span> \\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\timx6ull-14x14-ddr3-val.dtb \\</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\timx6ull-14x14-ddr3-val-epdc.dtb \\</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\timx6ull-14x14-ddr3-val-emmc.dtb \\</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\timx6ull-14x14-ddr3-val-gpmi-weim.dtb \\</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\timx6ull-14x14-ddr3-val-tsc.dtb \\</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\timx6ull-14x14-evk.dtb \\</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\timx6ull-14x14-evk-emmc.dtb \\</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\timx6ull-14x14-evk-gpmi-weim.dtb \\</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\timx6ull-14x14-lanjut-emmc.dtb \\  <span class=\"token comment\"># 将设备树文件添加进编译项</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\timx6ull-9x9-evk.dtb \\</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\timx6ull-colibri.dtb \\</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\timx6ull-phytec-segin-ff-rdk-emmc.dtb \\</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\timx6ull-dart-6ul.dtb \\</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\timx6ull-somlabs-visionsom.dtb \\</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\timx6ulz-14x14-evk.dtb \\</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\timx6ulz-14x14-evk-emmc.dtb \\</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\timx6ulz-14x14-evk-gpmi-weim.dtb</pre></td></tr></table></figure><p>2、 <code>Kconfig</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> arch/arm/mach-imx/mx6/Kconfig</pre></td></tr></table></figure><p><strong>修改：</strong></p>\n<p>在  <code>config TARGET_MX6ULL_14X14_EVK</code>  配置的下方添加：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>config TARGET_MX6ULL_14X14_LANJUT</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tbool \"Support mx6ull_14x14_lanjut\"</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tselect BOARD_LATE_INIT</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tselect DM</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tselect DM_THERMAL</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tselect MX6ULL</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\timply CMD_DM</pre></td></tr></table></figure><p>在  <code>source &quot;board/freescale/mx6ullevk/Kconfig&quot;</code>  配置的下方添加：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>source \"board/freescale/mx6ull_lanjut/Kconfig\"</pre></td></tr></table></figure><h1 id=\"定制外设\"><a class=\"anchor\" href=\"#定制外设\">#</a> 定制外设</h1>\n<h2 id=\"移除-74lv595-芯片相关配置\"><a class=\"anchor\" href=\"#移除-74lv595-芯片相关配置\">#</a> 移除 74lv595 芯片相关配置</h2>\n<p>1、 <code>mx6ull_14x14_lanjut_emmc_defconfig</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> configs/mx6ull_14x14_lanjut_emmc_defconfig</pre></td></tr></table></figure><p>由于开发板上不需要用到 74lv595 芯片，因此取消与其相关的配置：</p>\n<ul>\n<li>找到  <code>CONFIG_DM_74X164=y</code>  改为  <code># CONFIG_DM_74X164 is not used</code>  ，官网 EVK 开发板使用了一个 74LV594，这里没有使用所以屏蔽掉。</li>\n<li>找到  <code>CONFIG_SOFT_SPI=y</code>  改为  <code># CONFIG_SOFT_SPI is not used</code>  ，屏蔽掉软件模拟的 SPI，这是官方驱动 74LV594 用的，同样也是用不到。</li>\n</ul>\n<p>2、 <code>imx6ul-14x14-lanjut.dtsi</code>  文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> arch/arm/dts/imx6ul-14x14-lanjut.dtsi</pre></td></tr></table></figure><p>在  <code>configs/mx6ull_14x14_lanjut_emmc_defconfig</code>  文件中，我们有屏蔽掉  <code>74LV594</code>  和  <code>软件模拟的 SPI</code>  的定义使用，因此在设备树操作这里同样把其相关的配置屏蔽掉，从它们的调用关系可以得到以下需要屏蔽：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/ &#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t// aliases &#123;</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t// \tspi5 = &amp;&#123;/spi4&#125;;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t// &#125;;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t// reg_can_3v3: regulator-can-3v3 &#123;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t// \tcompatible = \"regulator-fixed\";</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t// \tregulator-name = \"can-3v3\";</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t// \tregulator-min-microvolt = &lt;3300000>;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t// \tregulator-max-microvolt = &lt;3300000>;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t// \tgpios = &lt;&amp;gpio_spi 3 GPIO_ACTIVE_LOW>;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t// &#125;;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t// spi4 &#123;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t// \tcompatible = \"spi-gpio\";</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t// \tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t// \tpinctrl-0 = &lt;&amp;pinctrl_spi4>;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t// \tstatus = \"okay\";</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t// \tpinctrl-assert-gpios = &lt;&amp;gpio5 8 GPIO_ACTIVE_LOW>;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t// \tgpio-sck = &lt;&amp;gpio5 11 0>;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t// \tgpio-mosi = &lt;&amp;gpio5 10 0>;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t// \tcs-gpios = &lt;&amp;gpio5 7 0>;</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t// \tnum-chipselects = &lt;1>;</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t// \t#address-cells = &lt;1>;</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t// \t#size-cells = &lt;0>;</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t// \tgpio_spi: gpio@0 &#123;</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t// \t\tcompatible = \"fairchild,74hc595\";</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t// \t\tgpio-controller;</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t// \t\t#gpio-cells = &lt;2>;</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t// \t\treg = &lt;0>;</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t// \t\tregisters-number = &lt;1>;</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t// \t\tregisters-default = /bits/ 8 &lt;0x57>;</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t// \t\tspi-max-frequency = &lt;100000>;</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t// \t&#125;;</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t// &#125;;</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>&amp;can1 &#123;</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\tpinctrl-0 = &lt;&amp;pinctrl_flexcan1>;</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t// xceiver-supply = &lt;&amp;reg_can_3v3>;</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\tstatus = \"okay\";</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>&amp;can2 &#123;</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\tpinctrl-0 = &lt;&amp;pinctrl_flexcan2>;</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t// xceiver-supply = &lt;&amp;reg_can_3v3>;</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\tstatus = \"okay\";</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>&amp;iomuxc &#123;</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t// pinctrl_spi4: spi4grp &#123;</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t// \tfsl,pins = &lt;</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t// \t\tMX6UL_PAD_BOOT_MODE0__GPIO5_IO10\t0x70a1</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t// \t\tMX6UL_PAD_BOOT_MODE1__GPIO5_IO11\t0x70a1</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t// \t\tMX6UL_PAD_SNVS_TAMPER7__GPIO5_IO07\t0x70a1</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t// \t\tMX6UL_PAD_SNVS_TAMPER8__GPIO5_IO08\t0x80000000</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t// \t>;</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t// &#125;;</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>&#125;;</pre></td></tr></table></figure><h2 id=\"修改网络接口配置\"><a class=\"anchor\" href=\"#修改网络接口配置\">#</a> 修改网络接口配置</h2>\n<p>打开你的设备树文件  <code>arch/arm/dts/imx6ull-14x14-lanjut-emmc.dts</code>  ，可以看到相应的引用关系： <code>imx6ull-14x14-lanjut-emmc.dts</code>  -&gt;  <code>imx6ull-14x14-lanjut.dts</code>  -&gt;  <code>imx6ull.dtsi</code>  -&gt;  <code>imx6ul-14x14-lanjut.dtsi</code>  -&gt;  <code>imx6ul-14x14-lanjut-u-boot.dtsi</code>  。而一般来说，  <code>.dtsi</code>  是系列芯片的公共部分，如同 C 语言上的头文件一般，  <code>.dts</code>  则用于定义特定部分；同样的，对于已经在  <code>.dtsi</code>  定义过的节点，可以在  <code>.dts</code>  中重新定义并覆盖。</p>\n<p>在 imx6ull 中，共提供了两组 ETH 网络接口引脚，在这里只需要配置一组就好了，多了没必要；可能你也会觉得 uboot 阶段只是为了引导 kernel 启动，何必多此一举呢，毕竟真正执行的配置是在 kernel 中的属性配置，但你是否想过后期如果需要修改 kernel，那么在此操作前，你能进行的 kernel 更新就只有 OTG 烧录及 SD Card 更新，并且需要拨码，相对于网络更新，稍微复杂一点，而且像 SD Card 你也未必携带有；因此，既然在 uboot 中存在一个如此便捷的升级方式，为何不好好应用起来呢？</p>\n<p>前面讲了 imx6ull 提供了两组 ETH 网络接口引脚，因此，只要有引出 ETH 接口，那么它们必定成组配置，所以无论你是用  <code>eth0</code>  或是  <code>eth1</code>  或想两组都用，在官方 demo 中一般都存在着对应组的设备树节点，可能唯一区别是  <code>eth0</code>  或  <code>eth1</code>  对应哪一组、PHY 地址不一样及网络芯片复位引脚所关联 GPIO 之类的；而且，对于用户设计来讲，一般都是跟官方的设计大同小异，没必要大改动以至于重新适配调试整个设备树配置及驱动修改，对此在这里以  <code>eth1</code> 、PHY 地址为 0x01 为例：</p>\n<p><strong>1、查阅关联信息</strong></p>\n<p>翻看芯片参考手册，找到与网络相关的章节，可以看到官方主要命名为 ENET；接下来在设备树中，包括引用的设备树头文件  <code>.dtsi</code>  里面搜索  <code>enet</code>  ，能找到名为  <code>&amp;fecx</code>  的设备树节点，这些节点信息就是对网络接口的配置。</p>\n<p><strong>2、节点属性</strong></p>\n<p>网络设备树节点属性，在这里可以根据自己所使用的 uboot 版本日期，去 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGV2aWNldHJlZS5vcmcvc3BlY2lmaWNhdGlvbnM=\">https://www.devicetree.org/specifications</span> 里找附近时期的文档查看；还有一种方式是在  <code>doc/device-tree-bindings/net/</code>  路径下查找相关的信息；不过不管是以上哪种方式，大部分也只是给出参考，实际需根据设备树函数处理来分析具体参数效果。</p>\n<p><strong>3、功能配置修改</strong></p>\n<p>在简单了解相关的信息后，然后就可以开始操刀修改配置了。</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>...</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>&amp;fec1 &#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tpinctrl-0 = &lt;&amp;pinctrl_enet1>;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tphy-mode = \"rmii\";</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tphy-handle = &lt;&amp;ethphy0>;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tstatus = \"okay\";</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>&amp;fec2 &#123;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tpinctrl-0 = &lt;&amp;pinctrl_enet2>;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tphy-mode = \"rmii\";</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tphy-handle = &lt;&amp;ethphy1>;</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tstatus = \"okay\";</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tmdio &#123;</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t#address-cells = &lt;1>;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t#size-cells = &lt;0>;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tethphy0: ethernet-phy@2 &#123;</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\treg = &lt;2>;</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\tmicrel,led-mode = &lt;1>;</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\tclocks = &lt;&amp;clks IMX6UL_CLK_ENET_REF>;</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\tclock-names = \"rmii-ref\";</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t&#125;;</pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\tethphy1: ethernet-phy@1 &#123;</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\treg = &lt;1>;</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\tmicrel,led-mode = &lt;1>;</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\tclocks = &lt;&amp;clks IMX6UL_CLK_ENET2_REF>;</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\tclock-names = \"rmii-ref\";</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t&#125;;</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t&#125;;</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>...</pre></td></tr></table></figure><p>以上是相关的原有功能配置，然后  <code>eth0</code>  对应  <code>&amp;fec1</code>  、  <code>eth1</code>  对应  <code>&amp;fec2</code>  ，在这里只应用  <code>eth1</code>  ，因此在  <code>&amp;fec1</code>  中把  <code>status</code>  参数改成  <code>disable</code>  以关闭该项功能；紧接着如果你的 PHY 芯片复位引脚是引接到芯片上控制而非复位按键上，那么你应该需要添加对 PHY 芯片复位的控制：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>&amp;fec2 &#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tpinctrl-0 = &lt;&amp;pinctrl_enet2>;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tphy-mode = \"rmii\";</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tphy-handle = &lt;&amp;ethphy1>;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tphy-reset-gpios = &lt;&amp;gpio5 8 GPIO_ACTIVE_LOW>;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tphy-reset-duration = &lt;10>;</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tphy-reset-post-delay = &lt;10>;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tstatus = \"okay\";</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t...</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>&#125;;</pre></td></tr></table></figure><p>在  <code>&amp;fec2</code>  节点中，加入  <code>phy-reset-gpios</code>  参数指定 PHY 的复位引脚且说明低电平复位， <code>phy-reset-duration</code>  指定复位的持续时间， <code>phy-reset-post-delay</code>  指定复位延迟时间。</p>\n<p>在官方设备树里面， <code>eth0</code>  的 PHY 地址配置为 2、  <code>eth</code>  的 PHY 地址配置为 1，如果需要修改 PHY 地址，则可以在  <code>mdio</code>  里的  <code>ethphyx</code>  中的  <code>reg</code>  属性里更改为硬件设计上的 PHY 地址，然后为了统一标准，把  <code>ethernet-phy@x</code>  中  <code>@x</code>  的  <code>x</code>  改为  <code>reg</code>  上的数值（当然，你也可以选择不改，这并不会影响什么功能，只是设备树作为一份适合人类阅读的文本文件，影响到的是后期的阅读分析），在这里因为设计地址跟官方一样， <code>eth1</code>  的 PHY 地址为 1，因此不需要修改：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>&amp;fec2 &#123;</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t...</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tmdio &#123;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t#address-cells = &lt;1>;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t#size-cells = &lt;0>;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\tethphy0: ethernet-phy@2 &#123;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\treg = &lt;2>;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\tmicrel,led-mode = &lt;1>;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\tclocks = &lt;&amp;clks IMX6UL_CLK_ENET_REF>;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\tclock-names = \"rmii-ref\";</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t&#125;;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\tethphy1: ethernet-phy@1 &#123;\t// 标识 PHY 地址为 1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\treg = &lt;1>;\t// PHY 地址设置为 1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\tmicrel,led-mode = &lt;1>;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\tclocks = &lt;&amp;clks IMX6UL_CLK_ENET2_REF>;</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\tclock-names = \"rmii-ref\";</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t&#125;;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t&#125;;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>&#125;;</pre></td></tr></table></figure><p><strong>4、复位引脚配置</strong></p>\n<p>A、配置分析</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>...</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>&amp;iomuxc &#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t...</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tpinctrl_enet1: enet1grp &#123;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tfsl,pins = &lt;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\tMX6UL_PAD_ENET1_RX_EN__ENET1_RX_EN\t0x1b0b0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\tMX6UL_PAD_ENET1_RX_ER__ENET1_RX_ER\t0x1b0b0</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\tMX6UL_PAD_ENET1_RX_DATA0__ENET1_RDATA00\t0x1b0b0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\tMX6UL_PAD_ENET1_RX_DATA1__ENET1_RDATA01\t0x1b0b0</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\tMX6UL_PAD_ENET1_TX_EN__ENET1_TX_EN\t0x1b0b0</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\tMX6UL_PAD_ENET1_TX_DATA0__ENET1_TDATA00\t0x1b0b0</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\tMX6UL_PAD_ENET1_TX_DATA1__ENET1_TDATA01\t0x1b0b0</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\tMX6UL_PAD_ENET1_TX_CLK__ENET1_REF_CLK1\t0x4001b031</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t>;</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t&#125;;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tpinctrl_enet2: enet2grp &#123;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tfsl,pins = &lt;</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\tMX6UL_PAD_GPIO1_IO07__ENET2_MDC\t\t0x1b0b0</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\tMX6UL_PAD_GPIO1_IO06__ENET2_MDIO\t0x1b0b0</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\tMX6UL_PAD_ENET2_RX_EN__ENET2_RX_EN\t0x1b0b0</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\tMX6UL_PAD_ENET2_RX_ER__ENET2_RX_ER\t0x1b0b0</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\tMX6UL_PAD_ENET2_RX_DATA0__ENET2_RDATA00\t0x1b0b0</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\tMX6UL_PAD_ENET2_RX_DATA1__ENET2_RDATA01\t0x1b0b0</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\tMX6UL_PAD_ENET2_TX_EN__ENET2_TX_EN\t0x1b0b0</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\tMX6UL_PAD_ENET2_TX_DATA0__ENET2_TDATA00\t0x1b0b0</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\tMX6UL_PAD_ENET2_TX_DATA1__ENET2_TDATA01\t0x1b0b0</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\tMX6UL_PAD_ENET2_TX_CLK__ENET2_REF_CLK2\t0x4001b031</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t>;</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t&#125;;</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t...</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>...</pre></td></tr></table></figure><p>在功能配置里为  <code>eth1</code>  的 PHY 芯片添加了复位引脚的操作，因此我们必须对其 IO 进行初始化配置；由于以下修改主要涉及到设备树的引脚配置，因此在修改前先了解一下该芯片设备树中引脚定义规则和解析：</p>\n<p>在手册上，一个引脚一般支持 n 个可选功能（Alternate 缩写为 ALT）， 通过 IOMUX Controller 的控制器进行选择，IOMUX Controller 由两个子模块组成：</p>\n<ul>\n<li>IOMUXC_REGISTERS 包括所有的 IOMUXC 寄存器。</li>\n<li>IOMUXC_LOGIC 包括所有的 IOMUXC 组合逻辑（IP 接口控制、地址解码器、可观察性互斥器）。</li>\n</ul>\n<p>而 IOMUXC_REGISTERS 主要通过两个寄存器进行引脚的配置（note：XXX 表示为某一个 PAD 的名称，eg：GPIO1_IO07）：</p>\n<ul>\n<li>\n<p>IOMUXC_SW_MUX_CTL_PAD_XXX：用于配置引脚 MUX 的输入功能，包括 UART，GPIO，CSI 等功能。</p>\n<p><img data-src=\"/6ull-uboot-transplant/image-20240728182215737.png\" alt=\"image-20240728182215737\"></p>\n</li>\n<li>\n<p>IOMUXC_SW_PAD_CTL_PAD__XXX：用于配置具体功能的特性，包括上拉 / 下拉，速度，等特性。</p>\n<p><img data-src=\"/6ull-uboot-transplant/image-20240728182843672.png\" alt=\"image-20240728182843672\"></p>\n</li>\n</ul>\n<p>在设备树上 imx6u 系列的引脚定义在  <code>arch/arm/dts/imx6ul-pinfunc.h</code>  ，6ull 在此基础上追加  <code>imx6ull-pinfunc.h</code>  和  <code>imx6ull-pinfunc-snvs.h</code>  定义的扩展性功能引脚，而对于 GPIO1_IO07 的定义涵盖以下几项：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__ENET1_MDC</span>\t\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0000</span> <span class=\"token number\">0</span> <span class=\"token number\">0</span></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__ENET2_MDC</span>\t\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0000</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__USB_OTG_HOST_MODE</span>\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0000</span> <span class=\"token number\">2</span> <span class=\"token number\">0</span></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__CSI_PIXCLK</span>\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0528</span> <span class=\"token number\">3</span> <span class=\"token number\">0</span></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__USDHC2_CD_B</span>\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0674</span> <span class=\"token number\">4</span> <span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__GPIO1_IO07</span>\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0000</span> <span class=\"token number\">5</span> <span class=\"token number\">0</span></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__CCM_STOP</span>\t\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0000</span> <span class=\"token number\">6</span> <span class=\"token number\">0</span></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__UART1_DCE_RTS</span>\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0620</span> <span class=\"token number\">8</span> <span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MX6UL_PAD_GPIO1_IO07__UART1_DTE_CTS</span>\t\t<span class=\"token expression\"><span class=\"token number\">0x0078</span> <span class=\"token number\">0x0304</span> <span class=\"token number\">0x0000</span> <span class=\"token number\">8</span> <span class=\"token number\">0</span></span></span></pre></td></tr></table></figure><p>可以看到 MX6UL_PAD_GPIO1_IO07 是这个引脚的寄存器名称，后面 ENET1_MDC 部分则是对应这个引脚的可选功能（ALTn），然后所定义的参数有 4 个值，而这 4 个值可以在该头文件顶部看到说明：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * The pin function ID is a tuple of</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * &lt;mux_reg conf_reg input_reg mux_mode input_val></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> */</pre></td></tr></table></figure><p>因此，像  <code>MX6UL_PAD_GPIO1_IO07__ENET2_MDC</code>  这个宏，其定义数值分别表示：</p>\n<ul>\n<li>mux_reg：IOMUXC_SW_MUX_CTL_PAD_GPIO1_IO07 - 偏移地址 <strong>0x0078</strong></li>\n<li>conf_reg：IOMUXC_SW_PAD_CTL_PAD_GPIO1_IO07 - 偏移地址 <strong>0x0304</strong></li>\n<li>input_reg：无寄存器（若有一般为 xxx_SELECT_INPUT） - 偏移地址 <strong>0x0000</strong></li>\n<li>mux_reg：IOMUXC_SW_MUX_CTL_PAD_GPIO1_IO07[3:0] - <strong>1</strong>（配置成 ALT0 - ENET2_MDC）</li>\n<li>input_val：由 input_reg 决定是否存在，依据 mux_reg 选择复用 - <strong>0</strong>（无 input_reg，此处为 0）</li>\n</ul>\n<p>而对于在  <code>dts</code>  中的  <code>MX6UL_PAD_GPIO1_IO07__ENET2_MDC 0x1b0b0</code>  主要是对 conf_reg 的配置，即 IOMUXC_SW_PAD_CTL_PAD_GPIO1_IO07 的值为  <code>0x1b0b0</code>  。这些数据的处理可以在  <code>drivers/pinctrl/nxp/pinctrl-imx.c</code>  中查到。至此，得到这样的一个配置关系：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">mux_reg_ofs</th>\n<th style=\"text-align:center\">conf_reg_ofs</th>\n<th style=\"text-align:center\">input_reg_ofs</th>\n<th style=\"text-align:center\">mux_mode</th>\n<th style=\"text-align:center\">input_val</th>\n<th style=\"text-align:center\">config_val</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">0x0078</td>\n<td style=\"text-align:center\">0x0304</td>\n<td style=\"text-align:center\">0x0000</td>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\">0</td>\n<td style=\"text-align:center\">0x1b0b0</td>\n</tr>\n</tbody>\n</table>\n<p>B、追加配置</p>\n<p>在了解完如何配置后，然后来配置一个  <code>GPIO5_IO08</code>  引脚的复位操作，草鸡简单，在  <code>pinctrl_enet2</code>  节点上追加  <code>MX6UL_PAD_SNVS_TAMPER8__GPIO5_IO08</code>  引脚的配置：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>...</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>&amp;iomuxc &#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tpinctrl-names = \"default\";</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t...</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tpinctrl_enet2: enet2grp &#123;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tfsl,pins = &lt;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t...</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\tMX6UL_PAD_SNVS_TAMPER8__GPIO5_IO08\t0x898\t/* ENET2 NRST */</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t>;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t&#125;;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t...</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>&#125;;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>...</pre></td></tr></table></figure><h1 id=\"uboot-裁剪\"><a class=\"anchor\" href=\"#uboot-裁剪\">#</a> uboot 裁剪</h1>\n<p>不管是购买的板子还是自己设计的板子，基本都是参考半导体厂商的 demo 板，而半导体厂商会在他们自己的开发板上移植好 uboot、linux kernel 和 rootfs 等，最终制作好 BSP 包提供给用户。我们只需在官方提供的 BSP 包的基础上，修改适应于自己的板子的外设配置，也就是俗称的移植。</p>\n<p>一般对 uboot 的移植裁剪。只需要解决串口、NAND、EMMC 或 SD 卡、网络和 LCD 驱动，因为 uboot 的主要目的就是启动 Linux 内核，所以不需要考虑太多的外设驱动，剩下的交给 linux kernel 进行详细配置。</p>\n<p>如果以单片机思维来讲，Linux 的 uboot 类似于 bootloader ，因此，在 uboot 上不需要过多的配置，只需要确保能正常进入 linux kernel 即可，毕竟进入到 linux kernel 后将会重新根据 linux kernel 的配置再次初始化一遍。</p>\n<p>前面讲了，除非必要的外设，把其余的功能移除掉，这便是裁剪；因此像 IIC、SPI、USB 这些等都可以屏蔽掉（或者确认以存储介质启动把网络也禁掉都是可以的），以减少编译生成使得缩少文件大小。</p>\n<p>裁剪方式很简单：</p>\n<p>1、在  <code>configs/</code>  文件夹中，找到你的板子配置文件，eg：  <code>mx6ull_14x14_lanjut_emmc_defconfig</code>  对不需要的功能进行屏蔽操作：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>CONFIG_ARM=y</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CONFIG_ARCH_MX6=y</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>CONFIG_TARGET_MX6ULL_14X14_LANJUT=y</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>CONFIG_ENV_SIZE=0x2000</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>CONFIG_ENV_OFFSET=0xE0000</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>CONFIG_DM_GPIO=y</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>CONFIG_NR_DRAM_BANKS=1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>CONFIG_SYS_EXTRA_OPTIONS=\"IMX_CONFIG=board/freescale/mx6ull_lanjut/imximage.cfg\"</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>CONFIG_BOOTDELAY=1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre># CONFIG_CONSOLE_MUX is not set</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>CONFIG_SYS_CONSOLE_IS_IN_ENV=y</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>CONFIG_SUPPORT_RAW_INITRD=y</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>CONFIG_BOUNCE_BUFFER=y</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>CONFIG_BOARD_EARLY_INIT_F=y</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>CONFIG_HUSH_PARSER=y</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>CONFIG_CMD_BOOTZ=y</pre></td></tr><tr><td data-num=\"17\"></td><td><pre># CONFIG_CMD_IMLS is not set</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>CONFIG_CMD_MEMTEST=y</pre></td></tr><tr><td data-num=\"19\"></td><td><pre># CONFIG_CMD_GPIO=y</pre></td></tr><tr><td data-num=\"20\"></td><td><pre># CONFIG_CMD_I2C=y</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>CONFIG_CMD_MMC=y</pre></td></tr><tr><td data-num=\"22\"></td><td><pre># CONFIG_CMD_SF=y</pre></td></tr><tr><td data-num=\"23\"></td><td><pre># CONFIG_CMD_USB=y</pre></td></tr><tr><td data-num=\"24\"></td><td><pre># CONFIG_CMD_DHCP=y</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>CONFIG_CMD_PING=y</pre></td></tr><tr><td data-num=\"26\"></td><td><pre># CONFIG_CMD_BMP=y</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>CONFIG_CMD_CACHE=y</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>CONFIG_CMD_NET=y</pre></td></tr><tr><td data-num=\"29\"></td><td><pre># CONFIG_CMD_EXT2=y</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>CONFIG_CMD_EXT4=y</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>CONFIG_CMD_EXT4_WRITE=y</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>CONFIG_CMD_FAT=y</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>CONFIG_CMD_FS_GENERIC=y</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>CONFIG_OF_CONTROL=y</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>CONFIG_DEFAULT_DEVICE_TREE=\"imx6ull-14x14-lanjut-emmc\"</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>CONFIG_ENV_IS_IN_MMC=y</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>CONFIG_SYS_RELOC_GD_ENV_ADDR=y</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>CONFIG_NET_RANDOM_ETHADDR=y</pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre># CONFIG_DM_74X164 is not used</pre></td></tr><tr><td data-num=\"42\"></td><td><pre># CONFIG_DM_I2C=y</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>CONFIG_DM_MMC=y</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>CONFIG_FSL_USDHC=y</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>CONFIG_MTD=y</pre></td></tr><tr><td data-num=\"46\"></td><td><pre># CONFIG_DM_SPI_FLASH=y</pre></td></tr><tr><td data-num=\"47\"></td><td><pre># CONFIG_SF_DEFAULT_MODE=0</pre></td></tr><tr><td data-num=\"48\"></td><td><pre># CONFIG_SF_DEFAULT_SPEED=40000000</pre></td></tr><tr><td data-num=\"49\"></td><td><pre># CONFIG_SPI_FLASH_STMICRO=y</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>CONFIG_PHYLIB=y</pre></td></tr><tr><td data-num=\"51\"></td><td><pre># CONFIG_PHY_MICREL=y</pre></td></tr><tr><td data-num=\"52\"></td><td><pre># CONFIG_PHY_MICREL_KSZ8XXX=y</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>CONFIG_DM_ETH=y</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>CONFIG_DM_ETH_PHY=y</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>CONFIG_FEC_MXC=y</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>CONFIG_MII=y</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>CONFIG_PINCTRL=y</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>CONFIG_PINCTRL_IMX6=y</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>CONFIG_DM_REGULATOR=y</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>CONFIG_DM_REGULATOR_FIXED=y</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>CONFIG_DM_REGULATOR_GPIO=y</pre></td></tr><tr><td data-num=\"62\"></td><td><pre># CONFIG_SPI=y</pre></td></tr><tr><td data-num=\"63\"></td><td><pre># CONFIG_DM_SPI=y</pre></td></tr><tr><td data-num=\"64\"></td><td><pre># CONFIG_SOFT_SPI is not used</pre></td></tr><tr><td data-num=\"65\"></td><td><pre># CONFIG_FSL_QSPI=y</pre></td></tr><tr><td data-num=\"66\"></td><td><pre># CONFIG_USB=y</pre></td></tr><tr><td data-num=\"67\"></td><td><pre># CONFIG_DM_USB=y</pre></td></tr><tr><td data-num=\"68\"></td><td><pre># CONFIG_USB_STORAGE=y</pre></td></tr><tr><td data-num=\"69\"></td><td><pre># CONFIG_USB_HOST_ETHER=y</pre></td></tr><tr><td data-num=\"70\"></td><td><pre># CONFIG_USB_ETHER_ASIX=y</pre></td></tr><tr><td data-num=\"71\"></td><td><pre># CONFIG_DM_VIDEO=y</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>CONFIG_SYS_WHITE_ON_BLACK=y</pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre># CONFIG_USB_GADGET=y</pre></td></tr><tr><td data-num=\"75\"></td><td><pre># CONFIG_USB_GADGET_DOWNLOAD=y</pre></td></tr><tr><td data-num=\"76\"></td><td><pre># CONFIG_USB_GADGET_MANUFACTURER=\"FSL\"</pre></td></tr><tr><td data-num=\"77\"></td><td><pre># CONFIG_USB_GADGET_VENDOR_NUM=0x0525</pre></td></tr><tr><td data-num=\"78\"></td><td><pre># CONFIG_USB_GADGET_PRODUCT_NUM=0xa4a5</pre></td></tr><tr><td data-num=\"79\"></td><td><pre># CONFIG_CI_UDC=y</pre></td></tr><tr><td data-num=\"80\"></td><td><pre></pre></td></tr><tr><td data-num=\"81\"></td><td><pre># CONFIG_CMD_FASTBOOT=y</pre></td></tr><tr><td data-num=\"82\"></td><td><pre># CONFIG_USB_FUNCTION_FASTBOOT=y</pre></td></tr><tr><td data-num=\"83\"></td><td><pre># CONFIG_FASTBOOT_UUU_SUPPORT=y</pre></td></tr><tr><td data-num=\"84\"></td><td><pre># CONFIG_FASTBOOT=y</pre></td></tr><tr><td data-num=\"85\"></td><td><pre># CONFIG_FASTBOOT_BUF_ADDR=0x83800000</pre></td></tr><tr><td data-num=\"86\"></td><td><pre># CONFIG_FASTBOOT_BUF_SIZE=0x40000000</pre></td></tr><tr><td data-num=\"87\"></td><td><pre># CONFIG_FASTBOOT_FLASH=y</pre></td></tr><tr><td data-num=\"88\"></td><td><pre># CONFIG_EFI_PARTITION=y</pre></td></tr></table></figure><p>以上操作主要是裁切不需要的命令行、USB 操作、IIC 功能、SPI 功能、video  功能；当然你也可以通过先  <code>make xxx_defconfig</code>  生成  <code>.config</code>  文件，然后进行  <code>make meunconfig</code>  进入图型交互界面，对不需要的配置进行移除，在这里修改的目的是为了通过执行  <code>make xxx_defconfig</code>  后生成的默认  <code>.config</code>  文件即为裁剪好的配置，而不需要再进行  <code>make meunconfig</code>  选择移除。</p>\n<p>2、修改单板配置文件，eg：  <code>include/configs/mx6ull_lanjut.h</code>  ；该文件主要是配置 uboot env 环境及启动初始化。</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* SPDX-License-Identifier: GPL-2.0+ */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/*</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * Copyright (C) 2016 Freescale Semiconductor, Inc.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * Copyright 2017 NXP</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * Configuration settings for the Freescale i.MX6UL 14x14 EVK board.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">__MX6ULL_LANJUT_CONFIG_H</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">__MX6ULL_LANJUT_CONFIG_H</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;asm/arch/imx-regs.h></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/sizes.h></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"mx6_common.h\"</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;asm/mach-imx/gpio.h></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"imx_env.h\"</span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name function\">is_mx6ull_9x9_evk</span><span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\t<span class=\"token function\">CONFIG_IS_ENABLED</span><span class=\"token punctuation\">(</span>TARGET_MX6ULL_9X9_EVK<span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_TARGET_MX6ULL_9X9_EVK</span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">PHYS_SDRAM_SIZE</span>\t\t<span class=\"token expression\">SZ_256M</span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">BOOTARGS_CMA_SIZE</span>   <span class=\"token string\">\"cma=96M \"</span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">PHYS_SDRAM_SIZE</span>\t\t<span class=\"token expression\">SZ_512M</span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">BOOTARGS_CMA_SIZE</span>   <span class=\"token string\">\"\"</span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">/* DCDC used on 14x14 EVK, no PMIC */</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">undef</span> <span class=\"token expression\">CONFIG_LDO_BYPASS_CHECK</span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">/* Size of malloc() pool */</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_MALLOC_LEN</span>\t\t<span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> SZ_1M<span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_MXC_UART</span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_MXC_UART_BASE</span>\t\t<span class=\"token expression\">UART1_BASE</span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">/* MMC Configs */</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_FSL_USDHC</span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_FSL_ESDHC_ADDR</span>\t<span class=\"token expression\">USDHC2_BASE_ADDR</span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">/* NAND pin conflicts with usdhc2 */</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_NAND_MXS</span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_FSL_USDHC_NUM</span>\t<span class=\"token expression\"><span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_FSL_USDHC_NUM</span>\t<span class=\"token expression\"><span class=\"token number\">2</span></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">/* I2C configs */</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_CMD_I2C</span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_I2C_MXC</span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_I2C_MXC_I2C1</span>\t\t<span class=\"token comment\">/* enable I2C bus 1 */</span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_I2C_MXC_I2C2</span>\t\t<span class=\"token comment\">/* enable I2C bus 2 */</span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_I2C_SPEED</span>\t\t<span class=\"token expression\"><span class=\"token number\">100000</span></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_MMC_IMG_LOAD_PART</span>\t<span class=\"token expression\"><span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_NAND_BOOT</span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MFG_NAND_PARTITION</span> <span class=\"token string\">\"mtdparts=gpmi-nand:64m(nandboot),16m(nandkernel),16m(nanddtb),16m(nandtee),-(nandrootfs)\"</span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">MFG_NAND_PARTITION</span> <span class=\"token string\">\"\"</span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_CMD_READ</span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SERIAL_TAG</span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_FASTBOOT_USB_DEV</span> <span class=\"token expression\"><span class=\"token number\">0</span></span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_MFG_ENV_SETTINGS</span> <span class=\"token punctuation\">\\</span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t<span class=\"token expression\">CONFIG_MFG_ENV_SETTINGS_DEFAULT </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t<span class=\"token string\">\"initrd_addr=0x86800000\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>\t<span class=\"token string\">\"initrd_high=0xffffffff\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t<span class=\"token string\">\"emmc_dev=1\\0\"</span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>\t<span class=\"token string\">\"emmc_ack=1\\0\"</span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\t<span class=\"token string\">\"sd_dev=1\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t<span class=\"token string\">\"mtdparts=\"</span> <span class=\"token expression\">MFG_NAND_PARTITION </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>\t<span class=\"token string\">\"\\0\"</span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>CONFIG_NAND_BOOT<span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_EXTRA_ENV_SETTINGS</span> <span class=\"token punctuation\">\\</span></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\t<span class=\"token expression\">CONFIG_MFG_ENV_SETTINGS </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>\t<span class=\"token expression\">TEE_ENV </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>\t<span class=\"token string\">\"splashimage=0x8c000000\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\t<span class=\"token string\">\"fdt_addr=0x83000000\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\t<span class=\"token string\">\"fdt_high=0xffffffff\\0\"</span>\t  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>\t<span class=\"token string\">\"tee_addr=0x84000000\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>\t<span class=\"token string\">\"console=ttymxc0\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>\t<span class=\"token string\">\"bootargs=console=ttymxc0,115200 ubi.mtd=nandrootfs \"</span>  <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>\t\t<span class=\"token string\">\"root=ubi0:rootfs rootfstype=ubifs \"</span>\t\t     <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>\t\t<span class=\"token expression\">BOOTARGS_CMA_SIZE </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>\t\t<span class=\"token expression\">MFG_NAND_PARTITION </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>\t\t<span class=\"token string\">\"\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>\t<span class=\"token string\">\"bootcmd=nand read $&#123;loadaddr&#125; 0x4000000 0xc00000;\"</span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>\t\t<span class=\"token string\">\"nand read $&#123;fdt_addr&#125; 0x5000000 0x100000;\"</span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>\t\t<span class=\"token string\">\"if test $&#123;tee&#125; = yes; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>\t\t\t<span class=\"token string\">\"nand read $&#123;tee_addr&#125; 0x6000000 0x400000;\"</span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>\t\t\t<span class=\"token string\">\"bootm $&#123;tee_addr&#125; - $&#123;fdt_addr&#125;;\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>\t\t\t<span class=\"token string\">\"bootz $&#123;loadaddr&#125; - $&#123;fdt_addr&#125;;\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>\t\t<span class=\"token string\">\"fi\\0\"</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">else</span></span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_EXTRA_ENV_SETTINGS</span> <span class=\"token punctuation\">\\</span></span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>\t<span class=\"token expression\">CONFIG_MFG_ENV_SETTINGS </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>\t<span class=\"token expression\">TEE_ENV </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>\t<span class=\"token string\">\"script=boot.scr\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>\t<span class=\"token string\">\"image=zImage\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>\t<span class=\"token string\">\"console=ttymxc0\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>\t<span class=\"token string\">\"fdt_high=0xffffffff\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>\t<span class=\"token string\">\"initrd_high=0xffffffff\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>\t<span class=\"token string\">\"fdt_file=undefined\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>\t<span class=\"token string\">\"fdt_addr=0x83000000\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>\t<span class=\"token string\">\"tee_addr=0x84000000\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>\t<span class=\"token string\">\"tee_file=undefined\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>\t<span class=\"token string\">\"boot_fdt=try\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>\t<span class=\"token string\">\"ip_dyn=no\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>\t<span class=\"token string\">\"splashimage=0x8c000000\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>\t<span class=\"token string\">\"mmcdev=\"</span><span class=\"token expression\"><span class=\"token function\">__stringify</span><span class=\"token punctuation\">(</span>CONFIG_SYS_MMC_ENV_DEV<span class=\"token punctuation\">)</span></span><span class=\"token string\">\"\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>\t<span class=\"token string\">\"mmcpart=\"</span> <span class=\"token expression\"><span class=\"token function\">__stringify</span><span class=\"token punctuation\">(</span>CONFIG_SYS_MMC_IMG_LOAD_PART<span class=\"token punctuation\">)</span> </span><span class=\"token string\">\"\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>\t<span class=\"token string\">\"mmcroot=\"</span> <span class=\"token expression\">CONFIG_MMCROOT </span><span class=\"token string\">\" rootwait rw\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>\t<span class=\"token string\">\"mmcautodetect=yes\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>\t<span class=\"token string\">\"mmcargs=setenv bootargs console=$&#123;console&#125;,$&#123;baudrate&#125; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>\t\t<span class=\"token expression\">BOOTARGS_CMA_SIZE </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>\t\t<span class=\"token string\">\"root=$&#123;mmcroot&#125;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>\t<span class=\"token string\">\"loadbootscript=\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>\t\t<span class=\"token string\">\"fatload mmc $&#123;mmcdev&#125;:$&#123;mmcpart&#125; $&#123;loadaddr&#125; $&#123;script&#125;;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>\t<span class=\"token string\">\"bootscript=echo Running bootscript from mmc ...; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>\t\t<span class=\"token string\">\"source\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>\t<span class=\"token string\">\"loadimage=fatload mmc $&#123;mmcdev&#125;:$&#123;mmcpart&#125; $&#123;loadaddr&#125; $&#123;image&#125;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>\t<span class=\"token string\">\"loadfdt=fatload mmc $&#123;mmcdev&#125;:$&#123;mmcpart&#125; $&#123;fdt_addr&#125; $&#123;fdt_file&#125;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>\t<span class=\"token string\">\"loadtee=fatload mmc $&#123;mmcdev&#125;:$&#123;mmcpart&#125; $&#123;tee_addr&#125; $&#123;tee_file&#125;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>\t<span class=\"token string\">\"mmcboot=echo Booting from mmc ...; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>\t\t<span class=\"token string\">\"run mmcargs; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>\t\t<span class=\"token string\">\"if test $&#123;tee&#125; = yes; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>\t\t\t<span class=\"token string\">\"run loadfdt; run loadtee; bootm $&#123;tee_addr&#125; - $&#123;fdt_addr&#125;; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>\t\t\t<span class=\"token string\">\"if test $&#123;boot_fdt&#125; = yes || test $&#123;boot_fdt&#125; = try; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if run loadfdt; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"bootz $&#123;loadaddr&#125; - $&#123;fdt_addr&#125;; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"if test $&#123;boot_fdt&#125; = try; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>\t\t\t\t\t\t<span class=\"token string\">\"bootz; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>\t\t\t\t\t\t<span class=\"token string\">\"echo WARN: Cannot load the DT; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>\t\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"bootz; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>\t\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>\t\t<span class=\"token string\">\"fi;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>\t<span class=\"token string\">\"netargs=setenv bootargs console=$&#123;console&#125;,$&#123;baudrate&#125; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>\t\t<span class=\"token expression\">BOOTARGS_CMA_SIZE </span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>\t\t<span class=\"token string\">\"root=/dev/nfs \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>\t\t<span class=\"token string\">\"ip=dhcp nfsroot=$&#123;serverip&#125;:$&#123;nfsroot&#125;,v3,tcp\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>\t<span class=\"token string\">\"netboot=echo Booting from net ...; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>\t\t<span class=\"token string\">\"$&#123;usb_net_cmd&#125;; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>\t\t<span class=\"token string\">\"run netargs; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>\t\t<span class=\"token string\">\"if test $&#123;ip_dyn&#125; = yes; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>\t\t\t<span class=\"token string\">\"setenv get_cmd dhcp; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>\t\t\t<span class=\"token string\">\"setenv get_cmd tftp; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>\t\t<span class=\"token string\">\"$&#123;get_cmd&#125; $&#123;image&#125;; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre>\t\t<span class=\"token string\">\"if test $&#123;tee&#125; = yes; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>\t\t\t<span class=\"token string\">\"$&#123;get_cmd&#125; $&#123;tee_addr&#125; $&#123;tee_file&#125;; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>\t\t\t<span class=\"token string\">\"$&#123;get_cmd&#125; $&#123;fdt_addr&#125; $&#123;fdt_file&#125;; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>\t\t\t<span class=\"token string\">\"bootm $&#123;tee_addr&#125; - $&#123;fdt_addr&#125;; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>\t\t\t<span class=\"token string\">\"if test $&#123;boot_fdt&#125; = yes || test $&#123;boot_fdt&#125; = try; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if $&#123;get_cmd&#125; $&#123;fdt_addr&#125; $&#123;fdt_file&#125;; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"bootz $&#123;loadaddr&#125; - $&#123;fdt_addr&#125;; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"if test $&#123;boot_fdt&#125; = try; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>\t\t\t\t\t\t<span class=\"token string\">\"bootz; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre>\t\t\t\t\t\t<span class=\"token string\">\"echo WARN: Cannot load the DT; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>\t\t\t<span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"bootz; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>\t\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre>\t\t<span class=\"token string\">\"fi;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>\t\t<span class=\"token string\">\"findfdt=\"</span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>\t\t\t<span class=\"token string\">\"if test $fdt_file = undefined; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $board_name = ULZ-EVK &amp;&amp; test $board_rev = 14X14; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"setenv fdt_file imx6ulz-14x14-evk.dtb; fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $board_name = EVK &amp;&amp; test $board_rev = 9X9; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"setenv fdt_file imx6ull-9x9-evk.dtb; fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $board_name = EVK &amp;&amp; test $board_rev = 14X14; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"setenv fdt_file imx6ull-14x14-evk.dtb; fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $board_name = LANJUT &amp;&amp; test $board_rev = 14X14; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"setenv fdt_file imx6ull-14x14-lanjut.dtb; fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $fdt_file = undefined; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"echo WARNING: Could not determine dtb to use; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>\t\t\t<span class=\"token string\">\"fi;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre>\t\t<span class=\"token string\">\"findtee=\"</span><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>\t\t\t<span class=\"token string\">\"if test $tee_file = undefined; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $board_name = ULZ-EVK &amp;&amp; test $board_rev = 14X14; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"setenv tee_file uTee-6ulzevk; fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $board_name = EVK &amp;&amp; test $board_rev = 9X9; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"setenv tee_file uTee-6ullevk; fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $board_name = EVK &amp;&amp; test $board_rev = 14X14; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"setenv tee_file uTee-6ullevk; fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $board_name = LANJUT &amp;&amp; test $board_rev = 14X14; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"setenv tee_file uTee-6ull_lanjut; fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"if test $tee_file = undefined; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>\t\t\t\t\t<span class=\"token string\">\"echo WARNING: Could not determine tee to use; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre>\t\t\t\t<span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>\t\t\t<span class=\"token string\">\"fi;\\0\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre></pre></td></tr><tr><td data-num=\"211\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_BOOTCOMMAND</span> <span class=\"token punctuation\">\\</span></span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre>\t   <span class=\"token string\">\"run findfdt;\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre>\t   <span class=\"token string\">\"run findtee;\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre>\t   <span class=\"token string\">\"mmc dev $&#123;mmcdev&#125;;\"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre>\t   <span class=\"token string\">\"mmc dev $&#123;mmcdev&#125;; if mmc rescan; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre>\t\t   <span class=\"token string\">\"if run loadbootscript; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre>\t\t\t   <span class=\"token string\">\"run bootscript; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre>\t\t   <span class=\"token string\">\"else \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"219\"></td><td><pre>\t\t\t   <span class=\"token string\">\"if run loadimage; then \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre>\t\t\t\t   <span class=\"token string\">\"run mmcboot; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre>\t\t\t   <span class=\"token string\">\"else run netboot; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre>\t\t\t   <span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre>\t\t   <span class=\"token string\">\"fi; \"</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre>\t   <span class=\"token string\">\"else run netboot; fi\"</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre></pre></td></tr><tr><td data-num=\"227\"></td><td><pre><span class=\"token comment\">/* Miscellaneous configurable options */</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_MEMTEST_START</span>\t<span class=\"token expression\"><span class=\"token number\">0x80000000</span></span></span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_MEMTEST_END</span>\t\t<span class=\"token expression\"><span class=\"token punctuation\">(</span>CONFIG_SYS_MEMTEST_START <span class=\"token operator\">+</span> <span class=\"token number\">0x8000000</span><span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre></pre></td></tr><tr><td data-num=\"231\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_LOAD_ADDR</span>\t\t<span class=\"token expression\">CONFIG_LOADADDR</span></span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_HZ</span>\t\t\t<span class=\"token expression\"><span class=\"token number\">1000</span></span></span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre></pre></td></tr><tr><td data-num=\"234\"></td><td><pre><span class=\"token comment\">/* Physical Memory Map */</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">PHYS_SDRAM</span>\t\t\t<span class=\"token expression\">MMDC0_ARB_BASE_ADDR</span></span></pre></td></tr><tr><td data-num=\"236\"></td><td><pre></pre></td></tr><tr><td data-num=\"237\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_SDRAM_BASE</span>\t\t<span class=\"token expression\">PHYS_SDRAM</span></span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_INIT_RAM_ADDR</span>\t<span class=\"token expression\">IRAM_BASE_ADDR</span></span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_INIT_RAM_SIZE</span>\t<span class=\"token expression\">IRAM_SIZE</span></span></pre></td></tr><tr><td data-num=\"240\"></td><td><pre></pre></td></tr><tr><td data-num=\"241\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_INIT_SP_OFFSET</span> <span class=\"token punctuation\">\\</span></span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre>\t<span class=\"token expression\"><span class=\"token punctuation\">(</span>CONFIG_SYS_INIT_RAM_SIZE <span class=\"token operator\">-</span> GENERATED_GBL_DATA_SIZE<span class=\"token punctuation\">)</span></span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_INIT_SP_ADDR</span> <span class=\"token punctuation\">\\</span></span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre>\t<span class=\"token expression\"><span class=\"token punctuation\">(</span>CONFIG_SYS_INIT_RAM_ADDR <span class=\"token operator\">+</span> CONFIG_SYS_INIT_SP_OFFSET<span class=\"token punctuation\">)</span></span></pre></td></tr><tr><td data-num=\"245\"></td><td><pre></pre></td></tr><tr><td data-num=\"246\"></td><td><pre><span class=\"token comment\">/* environment organization */</span></pre></td></tr><tr><td data-num=\"247\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_MMC_ENV_DEV</span>\t\t<span class=\"token expression\"><span class=\"token number\">1</span>\t</span><span class=\"token comment\">/* USDHC2 */</span></span></pre></td></tr><tr><td data-num=\"248\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_MMC_ENV_PART</span>\t\t<span class=\"token expression\"><span class=\"token number\">0</span>\t</span><span class=\"token comment\">/* user area */</span></span></pre></td></tr><tr><td data-num=\"249\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_MMCROOT</span>\t\t\t<span class=\"token string\">\"/dev/mmcblk1p2\"</span>  <span class=\"token comment\">/* USDHC2 */</span></span></pre></td></tr><tr><td data-num=\"250\"></td><td><pre></pre></td></tr><tr><td data-num=\"251\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_IOMUX_LPSR</span></span></pre></td></tr><tr><td data-num=\"252\"></td><td><pre></pre></td></tr><tr><td data-num=\"253\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_FSL_QSPI</span></span></pre></td></tr><tr><td data-num=\"254\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_FSL_QSPI_AHB</span></span></pre></td></tr><tr><td data-num=\"255\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">FSL_QSPI_FLASH_NUM</span>\t\t<span class=\"token expression\"><span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"256\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">FSL_QSPI_FLASH_SIZE</span>\t\t<span class=\"token expression\">SZ_32M</span></span></pre></td></tr><tr><td data-num=\"257\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"258\"></td><td><pre></pre></td></tr><tr><td data-num=\"259\"></td><td><pre><span class=\"token comment\">/* NAND stuff */</span></pre></td></tr><tr><td data-num=\"260\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_NAND_MXS</span></span></pre></td></tr><tr><td data-num=\"261\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_MAX_NAND_DEVICE</span>\t<span class=\"token expression\"><span class=\"token number\">1</span></span></span></pre></td></tr><tr><td data-num=\"262\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_NAND_BASE</span>\t\t<span class=\"token expression\"><span class=\"token number\">0x40000000</span></span></span></pre></td></tr><tr><td data-num=\"263\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_NAND_5_ADDR_CYCLE</span></span></pre></td></tr><tr><td data-num=\"264\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_NAND_ONFI_DETECTION</span></span></pre></td></tr><tr><td data-num=\"265\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SYS_NAND_USE_FLASH_BBT</span></span></pre></td></tr><tr><td data-num=\"266\"></td><td><pre></pre></td></tr><tr><td data-num=\"267\"></td><td><pre><span class=\"token comment\">/* DMA stuff, needed for GPMI/MXS NAND support */</span></pre></td></tr><tr><td data-num=\"268\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"269\"></td><td><pre></pre></td></tr><tr><td data-num=\"270\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>CONFIG_ENV_IS_IN_SPI_FLASH<span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"271\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_ENV_SPI_BUS</span>\t\t<span class=\"token expression\">CONFIG_SF_DEFAULT_BUS</span></span></pre></td></tr><tr><td data-num=\"272\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_ENV_SPI_CS</span>\t\t<span class=\"token expression\">CONFIG_SF_DEFAULT_CS</span></span></pre></td></tr><tr><td data-num=\"273\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_ENV_SPI_MODE</span>\t\t<span class=\"token expression\">CONFIG_SF_DEFAULT_MODE</span></span></pre></td></tr><tr><td data-num=\"274\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_ENV_SPI_MAX_HZ</span>\t\t<span class=\"token expression\">CONFIG_SF_DEFAULT_SPEED</span></span></pre></td></tr><tr><td data-num=\"275\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"276\"></td><td><pre></pre></td></tr><tr><td data-num=\"277\"></td><td><pre><span class=\"token comment\">/* USB Configs */</span></pre></td></tr><tr><td data-num=\"278\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">CONFIG_CMD_USB</span></span></pre></td></tr><tr><td data-num=\"279\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_EHCI_HCD_INIT_AFTER_RESET</span></span></pre></td></tr><tr><td data-num=\"280\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_MXC_USB_PORTSC</span>  <span class=\"token expression\"><span class=\"token punctuation\">(</span>PORT_PTS_UTMI <span class=\"token operator\">|</span> PORT_PTS_PTW<span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"281\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_MXC_USB_FLAGS</span>   <span class=\"token expression\"><span class=\"token number\">0</span></span></span></pre></td></tr><tr><td data-num=\"282\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_USB_MAX_CONTROLLER_COUNT</span> <span class=\"token expression\"><span class=\"token number\">2</span></span></span></pre></td></tr><tr><td data-num=\"283\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"284\"></td><td><pre></pre></td></tr><tr><td data-num=\"285\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_FEC_XCV_TYPE</span>             <span class=\"token expression\">RMII</span></span></pre></td></tr><tr><td data-num=\"286\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_ETHPRIME</span>\t\t\t<span class=\"token string\">\"eth1\"</span></span></pre></td></tr><tr><td data-num=\"287\"></td><td><pre></pre></td></tr><tr><td data-num=\"288\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_IMX_THERMAL</span></span></pre></td></tr><tr><td data-num=\"289\"></td><td><pre></pre></td></tr><tr><td data-num=\"290\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">CONFIG_SPL_BUILD</span></span></pre></td></tr><tr><td data-num=\"291\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">if</span> <span class=\"token expression\"><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span>CONFIG_DM_VIDEO<span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"292\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_VIDEO_MXS</span></span></pre></td></tr><tr><td data-num=\"293\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_VIDEO_LINK</span></span></pre></td></tr><tr><td data-num=\"294\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_VIDEO_LOGO</span></span></pre></td></tr><tr><td data-num=\"295\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SPLASH_SCREEN</span></span></pre></td></tr><tr><td data-num=\"296\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SPLASH_SCREEN_ALIGN</span></span></pre></td></tr><tr><td data-num=\"297\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_BMP_16BPP</span></span></pre></td></tr><tr><td data-num=\"298\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_VIDEO_BMP_RLE8</span></span></pre></td></tr><tr><td data-num=\"299\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_VIDEO_BMP_LOGO</span></span></pre></td></tr><tr><td data-num=\"300\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"301\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr><tr><td data-num=\"302\"></td><td><pre></pre></td></tr><tr><td data-num=\"303\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_MODULE_FUSE</span></span></pre></td></tr><tr><td data-num=\"304\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_OF_SYSTEM_SETUP</span></span></pre></td></tr><tr><td data-num=\"305\"></td><td><pre></pre></td></tr><tr><td data-num=\"306\"></td><td><pre><span class=\"token comment\">/* Network Configs */</span></pre></td></tr><tr><td data-num=\"307\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_IPADDR</span>          <span class=\"token expression\"><span class=\"token number\">192.168</span><span class=\"token number\">.137</span><span class=\"token number\">.234</span>      </span><span class=\"token comment\">/* board ip */</span></span></pre></td></tr><tr><td data-num=\"308\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_SERVERIP</span>     <span class=\"token expression\"><span class=\"token number\">192.168</span><span class=\"token number\">.137</span><span class=\"token number\">.1</span>      </span><span class=\"token comment\">/* server ip */</span></span></pre></td></tr><tr><td data-num=\"309\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_GATEWAYIP</span>    <span class=\"token expression\"><span class=\"token number\">192.168</span><span class=\"token number\">.137</span><span class=\"token number\">.1</span>        </span><span class=\"token comment\">/* board gateway ip */</span></span></pre></td></tr><tr><td data-num=\"310\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CONFIG_NETMASK</span>      <span class=\"token expression\"><span class=\"token number\">255.255</span><span class=\"token number\">.255</span><span class=\"token number\">.0</span>       </span><span class=\"token comment\">/* board netmask */</span></span></pre></td></tr><tr><td data-num=\"311\"></td><td><pre></pre></td></tr><tr><td data-num=\"312\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr></table></figure><p>以上添加了网络信息配置，因为在  <code>mx6ull_14x14_lanjut_emmc_defconfig</code>  中，我们有移除 DHCP 命令操作，因此如果使用到网络，那么必然需要配置静态网络  <code>setenv ipaddr</code>  这些，而在这里我们直接先配置好默认 ip（即  <code>/* Network Configs */</code>  下的操作）。同样，在这里可以找到与 NAND、IIC、SPI、VIDEO 这些不需要的功能，部分通过  <code>#ifdef</code>  宏来启用，那么如果在  <code>mx6ull_14x14_lanjut_emmc_defconfig</code>  中有屏蔽相应的宏则不要处理，否则对于一些没有在  <code>mx6ull_14x14_lanjut_emmc_defconfig</code>  中出现的并且想要裁切的功能，可以直接屏蔽对应的宏（例如是对  <code>board/freescale/mx6ull_lanjut/mx6ull_lanjut.c</code>  中的操作选择）。</p>\n<h1 id=\"添加编译脚本\"><a class=\"anchor\" href=\"#添加编译脚本\">#</a> 添加编译脚本</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">touch</span> build.sh</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> build.sh</pre></td></tr></table></figure><p><strong>写入：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 若之前已经导入到环境变量则不需要</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:/usr/local/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 若已经在顶层 Makefile 文件中指定则不需要</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span>arm</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 若已经在顶层 Makefile 文件中指定则不需要</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CROSS_COMPILE</span><span class=\"token operator\">=</span>arm-none-linux-gnueabihf-</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">LCPU</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-c</span> processor /proc/cpuinfo<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">make</span> clean</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">make</span> mx6ull_14x14_lanjut_emmc_defconfig</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">make</span> -j<span class=\"token variable\">$&#123;LCPU&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/mfgtool-is-used/",
            "url": "https://arachnid.cc/mfgtool-is-used/",
            "title": "mfgtool 工具烧写使用",
            "date_published": "2023-02-25T14:07:57.000Z",
            "content_html": "<blockquote>\n<p>这里以基于 IMX6_L4.1.15_2.1.0_MFG_TOOL 修改后的文件为说明，官方下载可以去 NXP 官网直接搜。</p>\n</blockquote>\n<h1 id=\"mfgtool-工具\"><a class=\"anchor\" href=\"#mfgtool-工具\">#</a> mfgtool 工具</h1>\n<p>mfgtool 工具是 freescale 为 <span class=\"exturl\" data-url=\"aHR0cDovL2kuTVg=\">i.MX</span> 系列处理器打造的 Linux Firmware (uboot/kernel) 烧录工具，被收购后由 NXP 维护，其工具支持单独烧录某一系统分区，支持烧录 spi flash、 nor flash、sd card、nand flash、emmc 等存储介质，只需简单的配置，即可将编译好的镜像文件和文件系统烧录到完整的板上。同时 mfgtool 工具也作为一个可量产性的工具，它支持多通道的烧录。</p>\n<p>最新版的 mfgtool 工具可看：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL254cC1pbXgvbWZndG9vbHM=\">https://github.com/nxp-imx/mfgtools</span></p>\n<p>对于官方 L4.1.15_2.1.0 版本，解压后里面有两个压缩包，两个压缩包的区别在名字上已经写的很详细了。 “without-rootfs” 和 “with-rootfs”，一个是没有文件系统和一个是具有文件系统，对比可以看到 without-rootfs 中的 rootfs 是个空的包。</p>\n<h1 id=\"配置文件\"><a class=\"anchor\" href=\"#配置文件\">#</a> 配置文件</h1>\n<p>在该版本中，主要用到的配置 UICfg.ini、cfg.ini 以及 ucl2.xml。</p>\n<h2 id=\"uicfgini\"><a class=\"anchor\" href=\"#uicfgini\">#</a> UICfg.ini</h2>\n<p>UICfg.ini 文件用于配置端口数量，表示同时支持多少个单板。</p>\n<p>UICfg.ini 文件的格式如下：</p>\n<figure class=\"highlight ini\"><figcaption data-lang=\"ini\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">UICfg</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">PortMgrDlg</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1</span></pre></td></tr></table></figure><p>例如，如果一次只支持一个单板，则应该设置  <code>PortMgrDlg=1</code> 。目前最多支持 4 块单板，所以  <code>PortMgrDlg</code>  可以设置为 1 - 4，默认为 1。</p>\n<h2 id=\"cfgini\"><a class=\"anchor\" href=\"#cfgini\">#</a> cfg.ini</h2>\n<p>cfg.ini 文件用于配置目标芯片配置文件和目标操作列表。</p>\n<p>该文件的格式如下所示：</p>\n<figure class=\"highlight ini\"><figcaption data-lang=\"ini\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">profiles</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">chip</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">Linux</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">platform</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key attr-name\">board</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">SabreSD</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">LIST</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">SDCard</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">variable</span><span class=\"token punctuation\">]</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key attr-name\">board</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">sabresd</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">mmc</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">0</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key attr-name\">bootimx</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">14x14evk</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key attr-name\">bootdtb</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">14x14-evk</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key attr-name\">6uluboot</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">14x14ddr3arm2</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key attr-name\">6uldtb</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">14x14-ddr3-arm2</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key attr-name\">lite</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">l</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token key attr-name\">initramfs</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">fsl-image-mfgtool-initramfs-imx_mfgtools.cpio.gz.u-boot</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key attr-name\">seek</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">1</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key attr-name\">rootfs</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">rootfs</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key attr-name\">6ulnor</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">qspi1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key attr-name\">part_nor</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">0</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token key attr-name\">part_uboot</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">0</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key attr-name\">part_kernel</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">1</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token key attr-name\">part_dtb</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">2</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token key attr-name\">part_rootfs</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">3</span></pre></td></tr></table></figure><ul>\n<li>\n<p><code>profiles/chip</code>  为目标配置文件名称（不区分大小写）。</p>\n</li>\n<li>\n<p><code>LIST/name</code>  为目标操作列表名称（区分大小写），可在  <code>profiles/CHIP_PROFILE/OS Firmware/ucl2.xml</code>  文件中找到。 <code>ucl2.xml</code>  内容在后续说明。</p>\n</li>\n<li>\n<p><code>platform/board</code>  目前预留，未使用，请忽略。</p>\n</li>\n<li>\n<p><code>variable</code>  为  <code>ucl2.xml</code>  文件中的引用变量，其引用的方式为  <code>%…%</code> 。</p>\n</li>\n</ul>\n<h2 id=\"ucl2xml\"><a class=\"anchor\" href=\"#ucl2xml\">#</a> ucl2.xml</h2>\n<p>以下为个人自用修改后的版本，适用于 6UL 和 6ULL：</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!--</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>* Copyright (C) 2012, Freescale Semiconductor, Inc. All Rights Reserved.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>* The CFG element contains a list of recognized usb devices.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>*  DEV elements provide a name, class, vid and pid for each device.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>*</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>* Each LIST element contains a list of update instructions.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>*  \"Install\" - Erase media and install firmware.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>*  \"Update\" - Update firmware only.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>*</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>* Each CMD element contains one update instruction of attribute type.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>*  \"pull\" - Does UtpRead(body, file) transaction.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>*  \"push\" - Does UtpWrite(body, file) transaction.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*  \"drop\" - Does UtpCommand(body) then waits for device to disconnect.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>*  \"boot\" - Finds configured device, forces it to \"body\" device and downloads \"file\".</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*  \"find\" - Waits for \"timeout\" seconds for the \"body\" device to connect.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>*  \"show\" - Parse and show device info in \"file\".  </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>--></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>UCL</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CFG</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>STATE</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">vid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>15A2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">pid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>007D<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>STATE</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6ULL<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">vid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>15A2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">pid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0080<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>STATE</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span>   <span class=\"token attr-name\">dev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MSC<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">vid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>066F<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">pid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>37FF<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CFG</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LIST</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>eMMC<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">desc</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Choose eMMC as media<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>boot<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/u-boot-imx6ul%lite%%bootimx%_emmc.imx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Loading U-boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/zImage<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x80800000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading Kernel.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/%initramfs%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x83800000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading Initramfs.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/zImage-imx6ul%lite%-%bootdtb%-emmc.dtb<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x83000000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading device tree.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jump<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span> Jumping to OS image. <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- create partition --></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mksdcard.sh.tar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending partition shell<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ tar xf $FILE <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> Partitioning...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 使用 mksdcard.sh 脚本为设备 \"/dev/mmcblk% mmc%\" 创建分区 --></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ sh mksdcard.sh /dev/mmcblk%mmc%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> Partitioning...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- burn uboot --></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ while [ ! -e /dev/mmcblk%mmc% ]; do sleep 1; echo \\<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">waiting...\\\";</span> <span class=\"token attr-name\">done</span> <span class=\"token attr-name\">\"</span><span class=\"token punctuation\">></span></span>Waiting for the partition ready<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 清除 uboot env, 总大小 8*1K，并且跳过了前面 768 blocks, 这里是 User Data Area（UDA） 区域，并不是 Boot Area Patition（boot） 区域 --></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ dd if=/dev/zero of=/dev/mmcblk%mmc% bs=1k seek=768 conv=fsync count=8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>clear u-boot arg<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- access boot partition --></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 使 emmc 的 boot0 分区变为可读写 --></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ echo 0 > /sys/block/mmcblk%mmc%boot0/force_ro<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>access boot partition 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 将 uboot 烧录到 emmc 的 boot0 分区，在系统盘符里分区的序号是从 0 开始，也就是 boot0 --></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/u-boot-imx6ul%lite%%6uluboot%_emmc%board%.imx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending u-boot.bin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ dd if=$FILE of=/dev/mmcblk%mmc%boot0 bs=512 seek=2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>write U-Boot to sd card<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 使 emmc 的 boot0 分区变为只读 --></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ echo 1 > /sys/block/mmcblk%mmc%boot0/force_ro<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> re-enable read-only access <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 将 boot0 分区使能，那么启动的时候就会从 emmc 的 boot1 区域启动。</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\temmc boot 序号是从 1 开始的，这里的 enable 1 指的是选择 emmc boot 分区的第一个分区进行引导，是针对 emmc 的 PARTITION_CONFIG 寄存器而言的。</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t而上面的 /sys/block/mmcblk% mmc% boot0 指是针对 linux 系统而言的，其实指的都是统一个分区，就是 emmc boot 的最开始的分区。 --></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mmc bootpart enable 1 1 /dev/mmcblk%mmc%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>enable boot partion 1 to boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- create fat partition --></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ while [ ! -e /dev/mmcblk%mmc%p1 ]; do sleep 1; echo \\<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">waiting...\\\";</span> <span class=\"token attr-name\">done</span> <span class=\"token attr-name\">\"</span><span class=\"token punctuation\">></span></span>Waiting for the partition ready<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 对 /dev/mmcblk% mmc% p1 分区 1 进行格式化 --></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mkfs.vfat -F 32 /dev/mmcblk%mmc%p1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Formatting rootfs partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 挂载 /dev/mmcblk% mmc% p1 分区 1 --></span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mkdir -p /mnt/mmcblk%mmc%p1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mount -t vfat /dev/mmcblk%mmc%p1 /mnt/mmcblk%mmc%p1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- burn kernel --></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/zImage<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending kernel zImage<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ cp $FILE /mnt/mmcblk%mmc%p1/zImage<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>write kernel image to sd card<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- burn dtb --></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/zImage-imx6ul%lite%-%6uldtb%%board%-emmc.dtb<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending Device Tree file<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ cp $FILE /mnt/mmcblk%mmc%p1/imx6ul%lite%-%6uldtb%%board%.dtb<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>write device tree to sd card<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 取消对 /dev/mmcblk% mmc% p1 分区的挂载 --></span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ umount /mnt/mmcblk%mmc%p1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Unmounting fat partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- create rootfs partition --></span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ while [ ! -e /dev/mmcblk%mmc%p2 ]; do sleep 1; echo \\<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">waiting...\\\";</span> <span class=\"token attr-name\">done</span> <span class=\"token attr-name\">\"</span><span class=\"token punctuation\">></span></span>Waiting for the partition ready<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 对 /dev/mmcblk% mmc% p2 分区 2 进行格式化 --></span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mkfs.ext3 -F -E nodiscard /dev/mmcblk%mmc%p2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Formatting rootfs partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 挂载 /dev/mmcblk% mmc% p2 分区 2 --></span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mkdir -p /mnt/mmcblk%mmc%p2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mount -t ext3 /dev/mmcblk%mmc%p2 /mnt/mmcblk%mmc%p2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- burn rootfs --></span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pipe tar -jxv -C /mnt/mmcblk%mmc%p2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/%rootfs%.tar.bz2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending and writting rootfs<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>frf<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Finishing rootfs write<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 取消对 /dev/mmcblk% mmc% p2 分区的挂载 --></span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ umount /mnt/mmcblk%mmc%p2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Unmounting rootfs partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ echo Update Complete!<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Done<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LIST</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre></pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  <span class=\"token comment\">&lt;!-- burn uboot only because spi-nor flash is small (4M). kernel is beyond 5M now --></span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LIST</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Nor Flash<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">desc</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Choose Nor flash as media<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>boot<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/u-boot-imx6ul%lite%%bootimx%_sd.imx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Loading U-boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/zImage<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x80800000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading Kernel.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/%initramfs%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x83800000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading Initramfs.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/zImage-imx6ul%lite%-%bootdtb%.dtb<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x83000000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading device tree.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jump<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span> Jumping to OS image. <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre></pre></td></tr><tr><td data-num=\"121\"></td><td><pre></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ flash_erase /dev/mtd%part_nor% 0 0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Erasing Boot partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/u-boot-imx6ul%lite%%6uluboot%_%nor%.imx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending u-boot.bin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ dd if=$FILE of=/dev/mtd%part_nor% bs=1k seek=%seek%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>write U-Boot to NOR flash<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ echo Update Complete!<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Done<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LIST</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre></pre></td></tr><tr><td data-num=\"129\"></td><td><pre></pre></td></tr><tr><td data-num=\"130\"></td><td><pre></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LIST</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Quad Nor Flash<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">desc</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Choose Quad Nor flash as media<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>boot<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/u-boot-imx6ul%lite%%bootimx%_%6ulnor%.imx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Loading U-boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/zImage<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x80800000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading Kernel.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/%initramfs%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x83800000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading Initramfs.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/zImage-imx6ul%lite%-%bootdtb%.dtb<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x83000000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading device tree.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jump<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span> Jumping to OS image. <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre></pre></td></tr><tr><td data-num=\"145\"></td><td><pre></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ flash_erase /dev/mtd0 0 20<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Erasing Boot partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/u-boot-imx6ul%lite%%6uluboot%_%6ulnor%.imx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending u-boot.bin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ dd if=$FILE of=/dev/mtd0 bs=1k seek=4<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>write U-Boot to NOR flash<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>\t<span class=\"token comment\">&lt;!--QSPI header--></span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>qspi-header.sh.tar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending qspi header shell<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ tar xf $FILE <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> Extracting...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/%norconfig%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending QSPI header config file<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ sh qspi-header.sh $FILE<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> Generating the ascii value header<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>\t<span class=\"token comment\">&lt;!--hexdump to convert ascii value to hex file--></span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ busybox hexdump -R qspi-tmp > qspi-header<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Converting ascii value to hex file<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ dd if=qspi-header of=/dev/mtd0 bs=1k seek=1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Writing header to NOR flash<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>\t<span class=\"token comment\">&lt;!--delete temporary files--></span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ rm qspi-tmp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Deleting temporary file<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ rm qspi-header<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Deleting temporary file<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ echo Update Complete!<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Done<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LIST</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre></pre></td></tr><tr><td data-num=\"165\"></td><td><pre></pre></td></tr><tr><td data-num=\"166\"></td><td><pre></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LIST</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>NAND Flash<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">desc</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Choose NAND as media<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>boot<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/u-boot-imx6ul%lite%%bootimx%_%nand%.imx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Loading U-boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/zImage<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x80800000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading Kernel.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/%initramfs%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x83800000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>\t\t\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading Initramfs.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre></pre></td></tr><tr><td data-num=\"176\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>firmware/zImage-imx6ul%lite%-%bootdtb%-%nanddtb%.dtb<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">address</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0x83000000<span class=\"token punctuation\">\"</span></span></span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre>\t\t<span class=\"token attr-name\">loadSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">setSection</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OTH<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">HasFlashHeader</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>FALSE<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span>Loading device tree.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BootStrap<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>jump<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span> Jumping to OS image. <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre></pre></td></tr><tr><td data-num=\"181\"></td><td><pre></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>\t<span class=\"token comment\">&lt;!--burn the uboot to NAND: --></span>\t</pre></td></tr><tr><td data-num=\"183\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mount -t debugfs debugfs /sys/kernel/debug<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Mounting debugfs<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ flash_erase /dev/mtd%part_uboot% 0 0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Erasing Boot partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/u-boot-imx6ul%lite%%6uluboot%_%nand%.imx<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending u-boot.bin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ kobs-ng init -x -v --chip_0_device_path=/dev/mtd%part_uboot% $FILE<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Flashing Bootloader<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>\t<span class=\"token comment\">&lt;!--burn the kernel to NAND: --></span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ flash_erase /dev/mtd%part_kernel% 0 0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Erasing Kernel partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/zImage<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending kernel zImage<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ nandwrite -p /dev/mtd%part_kernel% -p $FILE<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Flashing Kernel<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>\t<span class=\"token comment\">&lt;!--burn the dtb to NAND: --></span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ flash_erase /dev/mtd%part_dtb% 0 0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Erasing dtb partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/zImage-imx6ul%lite%-%6uldtb%-%nanddtb%.dtb<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending Device Tree file<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ nandwrite -p /dev/mtd%part_dtb% -p $FILE<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Flashing dtb<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre></pre></td></tr><tr><td data-num=\"198\"></td><td><pre>\t<span class=\"token comment\">&lt;!--burn the rootfs to NAND: --></span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ flash_erase /dev/mtd%part_rootfs% 0 0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Erasing rootfs partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ ubiformat /dev/mtd%part_rootfs%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ ubiattach /dev/ubi_ctrl -m %part_rootfs%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Attaching UBI partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ ubimkvol /dev/ubi0 -Nrootfs -m<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mkdir -p /mnt/mtd%part_rootfs%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ mount -t ubifs ubi0:rootfs /mnt/mtd%part_rootfs%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pipe tar -jxv -C /mnt/mtd%part_rootfs%<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files/%rootfs%.tar.bz2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ifdev</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MX6UL MX6ULL<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending and writting rootfs<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>frf<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Finishing rootfs write<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ umount /mnt/mtd%part_rootfs%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Unmounting rootfs partition<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ echo Update Complete!<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Done<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LIST</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre></pre></td></tr><tr><td data-num=\"212\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>UCL</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>这是一个 xml 文件，所以遵循 xml 语法，根元素  <code>&lt;UCL&gt; &lt;UCL/&gt;</code> ，它表示更新命令列表（Update Command List，UCL）；标签  <code>&lt;CFG&gt; &lt;/CFG&gt;</code> ，元素中包含可识别 usb 设备的列表；标签  <code>&lt;LIST&gt; &lt;/LIST&gt;</code> ，元素  <code>name</code>  用于匹配  <code>cfg.ini</code>  文件中的  <code>LIST/name</code>  参数或脚本输入参数，元素  <code>desc</code>  用于描述说明；标签  <code>&lt;CMD&gt; &lt;/CMD&gt;</code>  嵌套于  <code>&lt;LIST&gt; &lt;/LIST&gt;</code>  下，属于命令标签，在不同的阶段下命令是不一样的（大致分为两个阶段 BootStrap 和 Updater），mfgtool 工具的命令分为主机特定命令（Host Specific Commands）与固件特定命令（Firmware Specific Commands），其中主机特定命令是由 mfgtool 工具解析和执行，而固件特定命令由目标设备上的固件运行解析和执行。</p>\n<p>note：拓展一下，关于  <code>mmc bootpart enable 1 1 &lt;device&gt;</code>  命令，是用于修改 emmc 启动使能位  <code>BOOT_PARTITION_ENABLE</code>  ：</p>\n<p><img data-src=\"/mfgtool-is-used/1083701-20190424104619529-166617225.png\" alt=\"img\"></p>\n<p>关于该命令的解释：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mmc bootpart enable &lt;boot_partition> &lt;send_ack> &lt;device></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    Enable the boot partition for the &lt;device>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    Disable the boot partition for the &lt;device> if &lt;boot_partition> is set to 0.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    To receive acknowledgment of boot from the card set &lt;send_ack></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    to 1, else set it to 0</pre></td></tr></table></figure><p>即第一个数值用于选定所引导的分区，第二个数值是决定是否要接收来自卡的引导确认。</p>\n<h1 id=\"分区处理\"><a class=\"anchor\" href=\"#分区处理\">#</a> 分区处理</h1>\n<h2 id=\"mksdcardshtar\"><a class=\"anchor\" href=\"#mksdcardshtar\">#</a> mksdcard.sh.tar</h2>\n<p>该文件主要是用于烧录前对存储介质进行分区，在  <code>ucl2.xml</code>  上可以找到如下操作：</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- create partition --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>send<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">file</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mksdcard.sh.tar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Sending partition shell<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ tar xf $FILE <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> Partitioning...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>CMD</span> <span class=\"token attr-name\">state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Updater<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>push<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">body</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$ sh mksdcard.sh /dev/mmcblk%mmc%<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> Partitioning...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>CMD</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>从上面可以看到它的处理流程：</p>\n<ol>\n<li>先发送该文件到 RAM 运行中；</li>\n<li>解压该文件；</li>\n<li>利用 shell 命令执行解压出来的文件。</li>\n</ol>\n<p>然后我们打开压缩包，查看里面的 shell 脚本：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/sh</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># partition size in MB</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">BOOT_ROM_SIZE</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># wait for the SD/MMC device node ready</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-e</span> <span class=\"token variable\">$1</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">sleep</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">echo</span> “wait <span class=\"token keyword\">for</span> <span class=\"token variable\">$1</span> appear”</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># call sfdisk to create partition table</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># destroy the partition table</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token assign-left variable\">node</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>/dev/zero <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;node&#125;</span> <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span><span class=\"token number\">1024</span> <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>sfdisk <span class=\"token parameter variable\">--force</span> <span class=\"token variable\">$&#123;node&#125;</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token variable\">$&#123;BOOT_ROM_SIZE&#125;</span>M,120M,0c</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>200M,,83</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>EOF</pre></td></tr></table></figure><p>接着根据里面的分段，把它分为 4 个处理分析：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">BOOT_ROM_SIZE</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># note：这里定义的是启动 ROM 10MB，给后面引用。</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"><span>l</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-e</span> <span class=\"token variable\">$1</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">do</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sleep</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">echo</span> “wait <span class=\"token keyword\">for</span> <span class=\"token variable\">$1</span> appear”</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">done</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># note：$1 - 为命令行第一个传递的参数，结合 \"$ sh mksdcard.sh/dev/mmcblk% mmc%\"，所以 $1 实际为 /dev/mmcblk% mmc% 。</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">node</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>/dev/zero <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;node&#125;</span> <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span><span class=\"token number\">1024</span> <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># note：将 /dev/mmcblk% mmc% 分区的前导 1024 (1KB) 字节大小设 0，也就是擦除。</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sfdisk <span class=\"token parameter variable\">--force</span> <span class=\"token variable\">$&#123;node&#125;</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$&#123;BOOT_ROM_SIZE&#125;</span>M,120M,0c</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>200M,,83</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>EOF</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># note：利用 sfdisk 对 /dev/mmcblk% mmc% 进行分区，共划分为两部分：从起始地址 10MB 开始至 120M 为一个分区，文件类型为 0c（W95 FAT32 (LBA)）；从地址 200MB 以后为一个分区，文件类型为 83（Linux）。关于对应的文件类型码，可以使用 \"sfdisk -T\" 查看。</span></pre></td></tr></table></figure><p>这里的分区信息，可以在 uboot 引导中，使用  <code>mmc part</code>  命令查看分区信息（更多具体 uboot 启动信息可看 <a href=\"https://arachnid.cc/uboot-starting\">uboot 引导启动分析</a> ），例如以上的分区操作，可以得到：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">=</span><span class=\"token operator\">></span> mmc part</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Partition Map <span class=\"token keyword\">for</span> MMC device <span class=\"token number\">1</span>  --   Partition Type: DOS</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Part    Start Sector    Num Sectors     UUID            Type</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token number\">1</span>     <span class=\"token number\">20480</span>           <span class=\"token number\">245760</span>          00000000-01     0c</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token number\">2</span>     <span class=\"token number\">409600</span>          <span class=\"token number\">14860288</span>        00000000-02     <span class=\"token number\">83</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">ls</span> mmc <span class=\"token number\">1</span>:1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token number\">6577568</span>   zImage</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token number\">36093</span>   imx6ull-14x14-lanjut.dtb</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">ls</span> mmc <span class=\"token number\">1</span>:2</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> <span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>      <span class=\"token number\">16384</span> lost+found</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> bin</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> dev</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> etc</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> home</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> lib</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> media</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> mnt</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> proc</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> run</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> sbin</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> sys</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token operator\">&lt;</span>SYM<span class=\"token operator\">></span>          <span class=\"token number\">8</span> tmp</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> usr</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token operator\">&lt;</span>DIR<span class=\"token operator\">></span>       <span class=\"token number\">4096</span> var</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token operator\">=</span><span class=\"token operator\">></span> mmc info</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>Device: FSL_SDHC</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>Manufacturer ID: <span class=\"token number\">15</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>OEM: <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>Name: 8GTF4 </pre></td></tr><tr><td data-num=\"37\"></td><td><pre>Bus Speed: <span class=\"token number\">52000000</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>Mode: MMC High Speed <span class=\"token punctuation\">(</span>52MHz<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>Rd Block Len: <span class=\"token number\">512</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>MMC version <span class=\"token number\">5.1</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>High Capacity: Yes</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>Capacity: <span class=\"token number\">7.3</span> GiB</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>Bus Width: <span class=\"token number\">8</span>-bit</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>Erase Group Size: <span class=\"token number\">512</span> KiB</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>HC WP Group Size: <span class=\"token number\">8</span> MiB</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>User Capacity: <span class=\"token number\">7.3</span> GiB WRREL</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>Boot Capacity: <span class=\"token number\">4</span> MiB ENH</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>RPMB Capacity: <span class=\"token number\">512</span> KiB ENH</pre></td></tr></table></figure><p>可以看到 emmc 有 2 个分区</p>\n<p>分区 1 是扇区：20480 ~ 245760 =&gt;  第 1 个分区存放 Linux 镜像文件和设备树，容量为  <code>245760*512/1024/1025 = 120MB</code>  ，从   <code>20480*512/1024/1025 = 10MB</code>  开始。</p>\n<p>分区 2 是扇区：409600 ~ 14860288 =&gt;  第 2 个分区存放根文件系统容量为  <code>14860288*512/1024/1025 = 7256MB</code>  ，从  <code>409600*512/1024/1025 = 200MB</code>  开始。</p>\n<p>因此总大小为：10MB（预留） + 120MB + 80MB（分割预留） + 7256MB = 7466 MB = 7.291015625 GB，而在这里实际使用的是 8G emmc 内存，所以除去 BOOT、RPMB 和 GPP（如果厂商设有 GPP）的分区，实际 UDA 分区的容量跟现在算出的差不多，具体以 datasheet 为准。</p>\n<p><img data-src=\"/mfgtool-is-used/21.1%E5%88%86%E5%8C%BA%E7%A4%BA%E4%BE%8B.png\" alt=\"分区示例\"></p>\n<h1 id=\"烧录文件\"><a class=\"anchor\" href=\"#烧录文件\">#</a> 烧录文件</h1>\n<p>mfgtool 文件目录下的文件夹和文件非常多，除了上面的配置文件外，还有烧录脚本文件（.vbs）和烧录所需文件（uboot、kernel、dtb、rootfs）</p>\n<h2 id=\"烧录脚本文件\"><a class=\"anchor\" href=\"#烧录脚本文件\">#</a> 烧录脚本文件</h2>\n<p>在 win 平台下，目录下的  <code>MfgTool2.exe</code>  就是烧写工具，以  <code>.vbs</code>  结尾的文件就是烧写的配置文件；而在 Linux 平台下， <code>mfgtoolcli</code>  是该平台的烧写工具，可以通过执行  <code>linux-cvbs.sh</code>  脚本转换  <code>.vbs</code>  文件为 Linux 平台下的脚本。</p>\n<p>该烧写工具能支持多款 <span class=\"exturl\" data-url=\"aHR0cDovL2kuTVg=\">i.MX</span> 系统的 SoC 系统烧写，还能支持 Nand Flash、eMMC 和 SD 卡等存储介质的烧写；因此，在对每一款 SoC 进行系统烧写之前，需要进行配置并指定好需要烧写的芯片以及存储介质等，然后通过执行相应的脚本文件运行；一般常用的脚本有如下几个：</p>\n<table>\n<thead>\n<tr>\n<th>脚本文件名</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>mfgtool2-yocto-mx-evk-emmc</td>\n<td>EMMC 烧写脚本</td>\n</tr>\n<tr>\n<td>mfgtool2-yocto-mx-evk-nand</td>\n<td>Nand 烧写脚本</td>\n</tr>\n<tr>\n<td>mfgtool2-yocto-mx-evk-qspi-nor-n25q256a</td>\n<td>QSPI Flash 烧写脚本，型号为 n25q256a</td>\n</tr>\n</tbody>\n</table>\n<p>关于烧写脚本命令参数，其烧写工具命令行的格式如下：</p>\n<p><code>MfgTool2.exe [-c] [chip profile folder name] [-l] [list name] [-p] [number] [-s] [variable=value]</code></p>\n<p>一般我们只用到：</p>\n<ul>\n<li>-c：指定目标配置文件的名称。如果不指定则读取  <code>cfg.ini</code>  中  <code>profiles/chip</code>  的值。</li>\n<li>-l：指示目标操作列表名称。如果不指定则读取  <code>cfg.ini</code>  中  <code>LIST/name</code>  的值。</li>\n<li>-p：表示同时支持的单板数量。如果不指定则读取  <code>UICfg.ini</code>  中  <code>UICfg/PortMgrDlg</code>  的值。</li>\n<li>-s：设置  <code>ucl2.xml</code>  中的变量值；支持多变量配置。如果不指定则读取  <code>cfg.ini</code>  中所需的  <code>variable</code>  引用变量值。</li>\n</ul>\n<p>更多格式可看目录下的  <code>~\\Document\\V2\\Manufacturing Tool V2 Quick Start Guide.docx</code>  文档。</p>\n<p>例如，自定义一个烧录脚本：</p>\n<pre><code>Set wshShell = CreateObject(&quot;WScript.shell&quot;)\nwshShell.run &quot;mfgtool2.exe -c &quot;&quot;linux&quot;&quot; -l &quot;&quot;eMMC&quot;&quot; -s &quot;&quot;board=-lanjut&quot;&quot; -s &quot;&quot;mmc=1&quot;&quot; -s &quot;&quot;6uluboot=14x14&quot;&quot; -s &quot;&quot;6uldtb=14x14&quot;&quot;&quot;\nSet wshShell = Nothing\n</code></pre>\n<p>note：</p>\n<p>可能会想，为什么没有列出 SD Card 烧写脚本，是因为用 SD Card 作烧写，用命令操作会好一点。</p>\n<h2 id=\"烧录所需文件\"><a class=\"anchor\" href=\"#烧录所需文件\">#</a> 烧录所需文件</h2>\n<p>前面说到，在执行  <code>ucl2.xml</code>  的一系列操作中，存在两个阶段：</p>\n<ul>\n<li>\n<p>第一阶段（把系统烧写到 DRAM 中，然后 Jumping to OS image，以此为运行平台）</p>\n<p>其所需的文件有：（以  <code>ucl2.xml</code>  中  <code>eMMC</code>  标签为例）</p>\n<table>\n<thead>\n<tr>\n<th>运行固件</th>\n<th>下载文件</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>uboot</td>\n<td>firmware/u-boot-imx6ul%lite%%bootimx%_emmc.imx</td>\n</tr>\n<tr>\n<td>kernel</td>\n<td>firmware/zImage</td>\n</tr>\n<tr>\n<td>initramfs</td>\n<td>firmware/%initramfs%</td>\n</tr>\n<tr>\n<td>dtb</td>\n<td>firmware/zImage-imx6ul%lite%-%bootdtb%-emmc.dtb</td>\n</tr>\n</tbody>\n</table>\n<p>结合上面图表中可以看出来，存放第一阶段所需的固件路径是  <code>profiles/CHIP_PROFILE/OS Firmware/firmware</code>  ， <code>CHIP_PROFILE</code>  是由  <code>cfg.ini</code>  中的  <code>profiles/chip</code>  参数或  <code>mfgtool2-yocto-mx-evk-emmc</code>  脚本里  <code>-c</code>  所带参数决定，不区分大小写；对应的文件也依据  <code>ucl2.xml</code>  中  <code>BootStrap</code>  状态下的  <code>file</code>  元素定义的文件名为基准。</p>\n<p>tips：一般这里是不需要改动了，因为只是为了引导实际烧写而提供一个运行平台而已。</p>\n</li>\n<li>\n<p>第二阶段（通过从 DRAM 中启动的运行平台将目标镜像固化到存储介质中）</p>\n<p>其所需的文件有：（以  <code>ucl2.xml</code>  中  <code>eMMC</code>  标签为例）</p>\n<table>\n<thead>\n<tr>\n<th>目标固件</th>\n<th>下载文件</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>uboot</td>\n<td>files/u-boot-imx6ul%lite%%6uluboot%_emmc.imx</td>\n</tr>\n<tr>\n<td>kernel</td>\n<td>files/zImage</td>\n</tr>\n<tr>\n<td>dtb</td>\n<td>files/zImage-imx6ul%lite%-%6uldtb%-emmc.dtb</td>\n</tr>\n<tr>\n<td>rootfs</td>\n<td>files/%rootfs%.tar.bz2</td>\n</tr>\n</tbody>\n</table>\n<p>同样的，在第二阶段存放所需的固件路径是  <code>profiles/CHIP_PROFILE/OS Firmware/files</code> ，对应的文件则依据  <code>ucl2.xml</code>  中  <code>Updater</code>  状态下的  <code>file</code>  元素定义的文件名为基准。</p>\n</li>\n</ul>\n<p>总结一下烧录流程：</p>\n<p>第一步：烧录  <code>profiles/CHIP_PROFILE/OS Firmware/firmware</code>  路径下的 uboot、kernel、initramfs、dtb 到 DRAM 中；然后执行 Jumping to OS image，这时候在已运行的系统中去执行第二个步骤。</p>\n<p>第二步：通过从 DRAM 中已经启动的系统上，将  <code>profiles/CHIP_PROFILE/OS Firmware/files</code>  路径下的目标固件 uboot、kernel、dtb、rootfs 烧写到存储介质中上，如 eMMC、Nand 等。因此在实际使用中，当需要更新系统或设备树时，真正需要更改的是这几个文件。</p>\n",
            "tags": []
        },
        {
            "id": "https://arachnid.cc/virtual-network-setup/",
            "url": "https://arachnid.cc/virtual-network-setup/",
            "title": "vmware 下 ubuntu 双网卡设置",
            "date_published": "2023-02-25T09:28:19.345Z",
            "content_html": "<blockquote>\n<p>背景：主机电脑通过 WiFi 上网，网口用于跟开发板等设备有线连接；为此需要实现虚拟机内对系统可以进行外网访问网页或下载工具包等（避免切换主机操作），同时具备通过网线访问内网设备机器进行控制调试等操作。</p>\n<p>环境：VMware® Workstation 15 Pro</p>\n<p>平台：Ubuntu 18.04.6</p>\n</blockquote>\n<h1 id=\"step-1添加网卡\"><a class=\"anchor\" href=\"#step-1添加网卡\">#</a> step 1：添加网卡</h1>\n<p>在虚拟机窗口栏，依次点击  <code>编辑</code>  -&gt;  <code>虚拟网络编辑器</code>  ，可以看到原有默认的 VMnet 接口：</p>\n<p><img data-src=\"/virtual-network-setup/image-20230225172822709.png\" alt=\"image-20230225172822709\"></p>\n<p>它们分别对应主机 ip 地址。</p>\n<p>然后我们建立一个桥接模式的 VMnet 虚拟网络，并指定响应网卡（如出现灰屏无法设置，需要<strong>以管理员身份打开</strong> VMware，或在当前窗口点击  <code>更改设置</code>  来赋予权限），然后选择对应需要进行桥接的网卡（即网口网卡）：</p>\n<p><img data-src=\"/virtual-network-setup/image-20230225193931835.png\" alt=\"image-20230225193931835\"></p>\n<h1 id=\"setp-2配置网络设备器\"><a class=\"anchor\" href=\"#setp-2配置网络设备器\">#</a> setp 2：配置网络设备器</h1>\n<p>在 ubuntu 虚拟机右键点击  <code>设置</code>  -&gt;  <code>添加</code>  -&gt;  <code>网络适配器</code>  ，然后指定上面配置为桥接模式的  VMnet 虚拟网络：</p>\n<p><img data-src=\"/virtual-network-setup/image-20230225194908857.png\" alt=\"image-20230225194908857\"></p>\n<h2 id=\"拓展\"><a class=\"anchor\" href=\"#拓展\">#</a> 拓展</h2>\n<p>关于 NAT（网络地址转换模式）、Host-only（主机模式）及 bridged（桥接模式）：</p>\n<p><img data-src=\"/virtual-network-setup/Perbedaan-NAT-Bridge-Dan-Host-Only-Di-Vmware-Dan-Virtualbox-1170x731.jpg\" alt=\"Perbedaan NAT Bridge Dan Host Only\"></p>\n<ul>\n<li>\n<p>NAT 模式：使用 NAT 模式，就是让虚拟机借助 NAT （网络地址转换）功能，通过宿主机器所在的网络来访问外部网络，即：使用 NAT 模式可以实现在虚拟系统里访问互联网。</p>\n<p>优点：是从虚拟机访问外部网络的最简单方法；通常，它会自动设置网络地址转换到虚拟机上，不需要在宿主机器的网络信息上配置或通过访客操作系统上进行配置。</p>\n<p>缺点：就像路由器后面的专用网络一样，虚拟机是不可见的，无法从外部网络访问。</p>\n<p><img data-src=\"/virtual-network-setup/Virtual_network_switch_in_nat_mode.png\" alt=\"vmware-network-nat\"></p>\n</li>\n<li>\n<p>Host-only 模式：构建一个与外界断开连接的内部网络，只允许使用 host-only 方法的虚拟机才能通信，因此无法与外部网络或其他 PC 主机通信，只能相互通信。</p>\n<p>优点：与内部网络一样，其不需要存在物理网络接口，相当于使用 host-only 方法的虚拟机通过双绞线直连形成网络节点进行通讯；由于无法访问外部网络，因此对于安全性来讲，比其余两种相对要高。</p>\n<p>缺点：如其名，无法与主机外部的网络通信，同时外部网络设备也无法与其通讯。</p>\n<p><img data-src=\"/virtual-network-setup/Virtual_network_switch_in_host-only_mode.png\" alt=\"vmware-network-hostonly\"></p>\n</li>\n<li>\n<p>bridged 模式：在这种模式下，虚拟系统就像是局域网中的一台独立的主机，具有自己的 MAC 和 IP 地址；由于虚拟机和宿主机器分配了相同网段的 IP，因此宿主机器和虚拟机被识别为同一级别的物理主机。</p>\n<p>优点：虚拟机就像是一台独立的主机，拥有正常主机的网络功能，可以对外部网络进行访问，而外部网络也可以访问进来。</p>\n<p>缺点：由于外部网络可以访问，其安全性比其余两种相对要低；因与宿主机器平等的存在于网络中，需要进行分配网络地址、子网掩码、网关等操作。</p>\n<p><img data-src=\"/virtual-network-setup/Virtual_network_switch_in_bridged_mode.png\" alt=\"vmware-network-bridged\"></p>\n</li>\n</ul>\n<p>示例：</p>\n<p>一些 VMnet 虚拟机具有特定功能：VMnet0 专用于 bridged 模式，VMnet1 专用于 host-only 模式，而 VMnet8 专用于 NAT 模式；其他的 VMnet2 等，可供虚拟机使用自定义网络模式。如图分析各模式作用：</p>\n<p><img data-src=\"/virtual-network-setup/workstation-networking_thumb1.jpg\" alt=\"工作站网络\"></p>\n<ul>\n<li>\n<p>VM-1 可以与 host PC 通信，并连接到外部 LAN or internet，但不能与 NAT 和 host-only 网络通信。</p>\n</li>\n<li>\n<p>VM-2 和 VM-3 可以相互通信，也可以与 NAT 网络中的其他 VM 通信，也可以与 host PC 通信。</p>\n</li>\n<li>\n<p>VM-5 和 VM-4 可以相互通信，但不能与主机操作系统和 host-only 网络中的其他 VM 通信。</p>\n</li>\n<li>\n<p>VM-6 和 VM-7 无法相互通信。</p>\n</li>\n</ul>\n<p>参考：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBlcnVzZXIuY29tL3F1ZXN0aW9ucy8yMjc1MDUvd2hhdC1pcy10aGUtZGlmZmVyZW5jZS1iZXR3ZWVuLW5hdC1icmlkZ2VkLWhvc3Qtb25seS1uZXR3b3JraW5n\">What is the difference between NAT / Bridged / Host-Only networking?</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9waWJ5dGVzLndvcmRwcmVzcy5jb20vMjAxMi8xMS8xNi92bXdhcmUtd29ya3N0YXRpb24tbmV0d29ya2luZy1iYXNpY3Mv\">VMware Workstation Networking Basics</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZ3Vzc2FzLndvcmRwcmVzcy5jb20vMjAxNS8xMC8yOC92bXdhcmUtbmV0d29ya2luZy1jb25jZXB0LWJyaWRnZWQtbmF0LWhvc3Qtb25seS1sYW4tc2VnbWVudC8=\">VMWare Networking Concept [Bridged, NAT, Host Only, LAN Segment]</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubW9uaXRvcnRla25vbG9naS5jb20vcGVyYmVkYWFuLW5hdC1icmlkZ2UtZGFuLWhvc3Qtb25seS8=\">Perbedaan NAT Bridge Dan Host Only Di VMware Dan VirtualBox</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmxpYnZpcnQub3JnL1ZpcnR1YWxOZXR3b3JraW5nLmh0bWw=\">Virtual Networking</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudW5hbWUuaW4vNjA=\">Vmware Host-Only, NAT, Bridge 차이</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kaWFybXVpZG1jY2FydGh5LndvcmRwcmVzcy5jb20vMjAxMS8wMi8xNS9oZWxsby13b3JsZC8=\">Intro to Virtual Machine Networking</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yeWFuaXNhZ29vZGd1eS5ibG9nc3BvdC5jb20vMjAxOS8wNi92bXdhcmVuZXR3b3JrLXR5cGVicmlkZ2VkaG9zdC1vbmx5LW5hdC5odG1s\">VMware 虛擬機器上網路連線 (Network type) 的三種模式</span></p>\n<h1 id=\"setp-3网络信息配置\"><a class=\"anchor\" href=\"#setp-3网络信息配置\">#</a> setp 3：网络信息配置</h1>\n<p>从上一步可以知道我们目前有两个网络适配器，分别是 NAT 和 桥接模式，然后针对这几个模式的作用也在上面作了介绍了；因此在这里，实际只需要在虚拟机系统中配置桥接模式对应的网卡网络信息就好了；至于 NAT 模式对应的网卡网络信息将由虚拟机借助 NAT （网络地址转换）功能实现自动配置即可实现访问外网功能。</p>\n<ol>\n<li>\n<p>查看所有网卡信息：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ifconfig</span> <span class=\"token parameter variable\">-a</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>ens33: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">416</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class=\"token operator\">></span>  mtu <span class=\"token number\">1500</span></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>        inet <span class=\"token number\">192.168</span>.154.133  netmask <span class=\"token number\">255.255</span>.255.0  broadcast <span class=\"token number\">192.168</span>.154.255</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>        inet6 fe80::b52c:a0e6:1419:116b  prefixlen <span class=\"token number\">64</span>  scopeid 0x2<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>link<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre>        ether 00:0c:29:f0:76:35  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>以太网<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>        RX packets <span class=\"token number\">102259</span>  bytes <span class=\"token number\">150687397</span> <span class=\"token punctuation\">(</span><span class=\"token number\">150.6</span> MB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre>        TX packets <span class=\"token number\">13950</span>  bytes <span class=\"token number\">938511</span> <span class=\"token punctuation\">(</span><span class=\"token number\">938.5</span> KB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td data-command></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre>ens36: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">416</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class=\"token operator\">></span>  mtu <span class=\"token number\">1500</span></pre></td></tr><tr><td data-num=\"12\"></td><td data-command></td><td><pre>        inet <span class=\"token number\">192.168</span>.17.218  netmask <span class=\"token number\">255.255</span>.255.0  broadcast <span class=\"token number\">192.168</span>.17.255</pre></td></tr><tr><td data-num=\"13\"></td><td data-command></td><td><pre>        inet6 240e:47c:680:2899:56c0:dff:d5fe:b1aa  prefixlen <span class=\"token number\">64</span>  scopeid 0x<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>global<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre>        inet6 240e:47c:680:2899:18e7:3cfa:5fad:bbe  prefixlen <span class=\"token number\">64</span>  scopeid 0x<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>global<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td data-command></td><td><pre>        inet6 fe80::a25b:a66f:67e7:3e67  prefixlen <span class=\"token number\">64</span>  scopeid 0x2<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>link<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"16\"></td><td data-command></td><td><pre>        ether 00:0c:29:f0:76:3f  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>以太网<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td data-command></td><td><pre>        RX packets <span class=\"token number\">426</span>  bytes <span class=\"token number\">474569</span> <span class=\"token punctuation\">(</span><span class=\"token number\">474.5</span> KB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td data-command></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"19\"></td><td data-command></td><td><pre>        TX packets <span class=\"token number\">403</span>  bytes <span class=\"token number\">44762</span> <span class=\"token punctuation\">(</span><span class=\"token number\">44.7</span> KB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td data-command></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"21\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td data-command></td><td><pre>lo: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">7</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class=\"token operator\">></span>  mtu <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"23\"></td><td data-command></td><td><pre>        inet <span class=\"token number\">127.0</span>.0.1  netmask <span class=\"token number\">255.0</span>.0.0</pre></td></tr><tr><td data-num=\"24\"></td><td data-command></td><td><pre>        inet6 ::1  prefixlen <span class=\"token number\">128</span>  scopeid 0x1<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>host<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"25\"></td><td data-command></td><td><pre>        loop  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>本地环回<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td data-command></td><td><pre>        RX packets <span class=\"token number\">308</span>  bytes <span class=\"token number\">26853</span> <span class=\"token punctuation\">(</span><span class=\"token number\">26.8</span> KB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td data-command></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"28\"></td><td data-command></td><td><pre>        TX packets <span class=\"token number\">308</span>  bytes <span class=\"token number\">26853</span> <span class=\"token punctuation\">(</span><span class=\"token number\">26.8</span> KB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td data-command></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr></table></figure></li>\n<li>\n<p>启用网卡（如已启用则跳过该步骤），其中  <code>ens36</code>  是设置 bridged 模式的网卡。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">ifconfig</span> ens36 up</pre></td></tr></table></figure></li>\n<li>\n<p>修改网络信息配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">cp</span> /etc/netplan/01-network-manager-all.yaml /etc/netplan/01-network-manager-all.yaml.back <span class=\"token comment\"># 备份</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">vim</span> /etc/netplan/01-network-manager-all.yaml</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre><span class=\"token comment\"># Let NetworkManager manage all devices on this system</span></pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>network:</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre>  ethernets:</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre>    ens33:</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>      dhcp4: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre>      dhcp4-overrides:</pre></td></tr><tr><td data-num=\"9\"></td><td data-command></td><td><pre>        route-metric: <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre>      <span class=\"token comment\"># addresses: [192.168.1.110/24]</span></pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre>      <span class=\"token comment\"># gateway4: 192.168.1.1</span></pre></td></tr><tr><td data-num=\"12\"></td><td data-command></td><td><pre>      <span class=\"token comment\"># nameservers:</span></pre></td></tr><tr><td data-num=\"13\"></td><td data-command></td><td><pre>       <span class=\"token comment\"># addresses: [192.168.1.1]</span></pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre>    ens36:</pre></td></tr><tr><td data-num=\"15\"></td><td data-command></td><td><pre>      dhcp4: <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td data-command></td><td><pre>  version: <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"17\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td data-command></td><td><pre>  bridges:</pre></td></tr><tr><td data-num=\"19\"></td><td data-command></td><td><pre>    br0:</pre></td></tr><tr><td data-num=\"20\"></td><td data-command></td><td><pre>     interfaces: <span class=\"token punctuation\">[</span>ens36<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td data-command></td><td><pre>     dhcp4: no</pre></td></tr><tr><td data-num=\"22\"></td><td data-command></td><td><pre>     addresses:</pre></td></tr><tr><td data-num=\"23\"></td><td data-command></td><td><pre>      - <span class=\"token number\">192.168</span>.1.110/24</pre></td></tr><tr><td data-num=\"24\"></td><td data-command></td><td><pre>     nameservers:</pre></td></tr><tr><td data-num=\"25\"></td><td data-command></td><td><pre>       addresses: <span class=\"token punctuation\">[</span><span class=\"token number\">8.8</span>.8.8<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td data-command></td><td><pre>     routes:</pre></td></tr><tr><td data-num=\"27\"></td><td data-command></td><td><pre>      - to: <span class=\"token number\">0.0</span>.0.0/0</pre></td></tr><tr><td data-num=\"28\"></td><td data-command></td><td><pre>        via: <span class=\"token number\">192.168</span>.1.1</pre></td></tr><tr><td data-num=\"29\"></td><td data-command></td><td><pre>        metric: <span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"30\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td data-command></td><td><pre><span class=\"token comment\">#  renderer: NetworkManager</span></pre></td></tr><tr><td data-num=\"32\"></td><td data-command></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td data-command></td><td><pre>netplan apply</pre></td></tr><tr><td data-num=\"34\"></td><td data-command></td><td><pre><span class=\"token function\">reboot</span></pre></td></tr></table></figure></li>\n<li>\n<p>重启后查看验证网路</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route <span class=\"token parameter variable\">-n</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>内核 IP 路由表</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>目标            网关            子网掩码        标志  跃点   引用  使用 接口</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre><span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.154.2   <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">100</span>    <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre><span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.1.1     <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">1000</span>   <span class=\"token number\">0</span>        <span class=\"token number\">0</span> br0</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre><span class=\"token number\">192.168</span>.1.0     <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> br0</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre><span class=\"token number\">192.168</span>.154.0   <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr><tr><td data-num=\"8\"></td><td data-command></td><td><pre><span class=\"token number\">192.168</span>.154.2   <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.255 UH    <span class=\"token number\">100</span>    <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr><tr><td data-num=\"9\"></td><td data-command=\"[root@localhost] $\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ping</span> baidu.com</pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"12\"></td><td data-command=\"[root@localhost] $\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td data-command=\"[root@localhost] $\"></td><td><pre><span class=\"token function\">ping</span> <span class=\"token function\">host</span> <span class=\"token function\">ip</span></pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure></li>\n</ol>\n<h1 id=\"关于双网卡无法上网问题\"><a class=\"anchor\" href=\"#关于双网卡无法上网问题\">#</a> 关于双网卡无法上网问题</h1>\n<p>当在虚拟机网络中设置完 VMnet0 桥接的 IP 地址等信息，打开网络后，发现网络不通。</p>\n<p>但如果关闭 VMnet0，只保留 VMnet8，网络又是可行的，由此考虑到可能是网卡优先级的配置问题。</p>\n<p>通过上面可以发现  <code>br0</code>  的跃点比  <code>ens33</code>  的 metric 要高，而 metric 越低，其优先级越高，因此按上面操作来一般没问题的；如果这两个网卡的 metric 值反过来，那么会造成无法上网的问题，因为本身我们的有线网口是没有联网的，但优先级又比联网的网卡优先级高，所以会出现 ping 不通外网的情况。</p>\n<p>假设需要临时调整 ip /gateway/metric 等，可以使用  <code>route</code>  命令，而避免更改网络配置表文件，关于  <code>route</code>  命令使用可看 <a href=\"http://arachnid.cc/linux-routing-table\">Linux 路由表说明</a> 。</p>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/uboot-starting/",
            "url": "https://arachnid.cc/uboot-starting/",
            "title": "uboot 引导启动分析",
            "date_published": "2023-02-22T13:19:51.653Z",
            "content_html": "<h1 id=\"uboot-命令\"><a class=\"anchor\" href=\"#uboot-命令\">#</a> uboot 命令</h1>\n<h2 id=\"命令支持\"><a class=\"anchor\" href=\"#命令支持\">#</a> 命令支持</h2>\n<p>当不清楚 uboot 支持什么命令时， 可输入  <code>help</code>  或  <code>?</code>  可查看 uboot 支持的命令列表；当需要具体使用哪个命令时，可使用  <code>help [命令]</code>  或  <code>? [命令]</code>  的方式查看具体命令的使用说明，eg： <code>help printenv</code>  。</p>\n<p>具体可以使用什么命令，实际跟 uboot 中的  <code>CONFIG_CMD_xxx</code>  宏的使能有关，因此，如果无法使用某些命令，可能是因为把特定的  <code>CONFIG_CMD_xxx</code>  宏去掉了；而对于这些命令的开关，可以在  <code>configs/xxx_defconfig</code>  中定义，或者使用  <code>make menuconfig</code>  选择使能相应命令的支持。</p>\n<h2 id=\"常用命令行命令\"><a class=\"anchor\" href=\"#常用命令行命令\">#</a> 常用命令行命令</h2>\n<p><strong>A、环境变量操作</strong></p>\n<ol>\n<li>\n<p>printenv</p>\n<p>功能：打印环境变量。</p>\n<p>用法： <code>printenv &lt;name&gt;</code>  ，其中 name 为相应的环境变量名，不填则打印所有环境变量配置。</p>\n</li>\n<li>\n<p>setenv</p>\n<p>功能：设置环境变量。</p>\n<p>用法： <code>setenv &lt;key&gt; &lt;value&gt;</code>  ，其中 key 是变量名，value 是变量值。如果 value 为空，则表示删除对应的环境变量。</p>\n</li>\n<li>\n<p>saveenv</p>\n<p>功能：保存环境变量修改，使用 setenv 设置环境变量后不会掉电保存，需要保存后才不会丢失。</p>\n<p>用法： <code>saveenv</code>  。</p>\n</li>\n<li>\n<p>run</p>\n<p>功能：执行指定的环境变量里的语句。</p>\n<p>用法： <code>run &lt;var&gt;</code>  ，其中 key 是指定的环境变量。</p>\n</li>\n</ol>\n<p><strong>B、存储介质操作</strong></p>\n<ol>\n<li>\n<p>mmc &amp; SD</p>\n<p>功能：对 mmc 存储介质进行操作，包括 EMMC 和 SD 卡。</p>\n<p>用法：</p>\n<ul>\n<li><code>mmc list</code>  ，用于查看板子上 mmc 设备。</li>\n<li><code>mmc dev &lt;dev&gt; &lt;part&gt;</code>  ，用于切换当前 mmc 设备，其中 dev 用来设置要切换的 mmc 设备号，part 是分区号（可以不写，默认为分区 0）。</li>\n<li><code>mmc info</code>  ，查看当前 mmc 设备信息。</li>\n<li><code>mmc part</code>  ，查看当前 mmc 设备分区。</li>\n<li><code>mmc read / write &lt;addr&gt; &lt;blk#&gt; &lt;cnt&gt;</code>  ，读取 / 写入当前 mmc 设备数据，其中 addr 是数据写入 / 读取到 DRAM 中的地址 (十六进制)， blk# 是要读取 / 写入到 emmc 的块起始地址 (十六进制)，一个块是 512 字节，这里的块和扇区是一个意思，在 mmc 设备中我们通常说扇区， cnt 是要读取 / 写入的块数量 (十六进制)。</li>\n<li><code>mmc erase &lt;blk#&gt; &lt;cnt&gt;</code>  ，擦除当前 mmc 设备数据，其中 blk# 为要擦除的起始块 (十六进制)， cnt 是要擦除的数量 (十六进制)。</li>\n<li><code>mmc rescan</code>  ，令用于扫描设备上所有的 mmc 设备，包括 EMMC 和 SD 卡。</li>\n</ul>\n</li>\n<li>\n<p>nand</p>\n<p>功能：对 nand flash 存储介质进行操作。</p>\n<p>用法：</p>\n<ul>\n<li><code>nand info</code>  ，查看当前 nand flash 信息。</li>\n<li><code>nand dev &lt;dev&gt; &lt;part&gt;</code>  ，用于切换当前 nand flash 设备，其中 dev 用来设置要切换的 nand 设备号，part 是分区号（可以不写，默认为分区 0）。</li>\n<li><code>nand read / write &lt;addr&gt; &lt;off&gt; &lt;size&gt;</code>  ，读取 / 写入当前 nand flash 设备数据，其中 addr 是数据写入 / 读取到 DRAM 中的地址 (十六进制)， off 是要读取 / 写入 nand flash 的起始地址 (十六进制)，size 是要读取 / 写入的数据大小 (十六进制)。</li>\n<li><code>mmc erase &lt;addr&gt; &lt;size&gt;</code>  ，擦除当前 nand flash 设备数据，其中 addr 为要擦除的起始地址 (十六进制)， size 是要擦除的数据大小 (十六进制)。</li>\n</ul>\n</li>\n</ol>\n<p><strong>C、网络操作</strong></p>\n<ol>\n<li>\n<p>ping</p>\n<p>功能：发送 ICMP_ECHO 请求到网络主机。</p>\n<p>用法： <code>ping &lt;hostaddr&gt;</code>  ，其中 hostaddr 是目标发送请求主机 IP。</p>\n</li>\n<li>\n<p>dhcp</p>\n<p>功能：获取 ip 地址及通过 tftp 下载到内存。</p>\n<p>用法：</p>\n<ul>\n<li><code>dhcp</code>  ，单纯用于自动获取 ip 地址。</li>\n<li><code>dhcp &lt;loadaddr&gt; &lt;[hostIPaddr:]filename&gt;</code>  ，其中 loadaddr 是加载内存地址，hostIPaddr 是获取链接的主机 IP，filename 是要下载的文件名。</li>\n</ul>\n</li>\n<li>\n<p>nfs</p>\n<p>功能：通过 nfs (Network File System) 下载到内存。</p>\n<p>用法： <code>nfs &lt;loadaddr&gt; &lt;[hostIPaddr:]filename&gt;</code>  ，其中 loadaddr 是加载内存地址，hostIPaddr 是获取链接的主机 ip，filename 是要下载的文件名。</p>\n</li>\n<li>\n<p>tftp / tftpboot</p>\n<p>功能：通过 tftp 下载到内存。</p>\n<p>用法： <code>tftp / tftpboot &lt;loadaddr&gt; &lt;[hostIPaddr:]filename&gt;</code>  ，其中 loadaddr 是加载内存地址，hostIPaddr 是获取链接的主机 ip，filename 是要下载的文件名。</p>\n</li>\n</ol>\n<p><strong>D、文件系统操作</strong></p>\n<ol>\n<li>\n<p>fatinfo</p>\n<p>功能：查询指定 mmc 设置指定分区的文件系统信息。</p>\n<p>用法： <code>fatinfo &lt;interface&gt; &lt;dev&gt;:&lt;part&gt;</code>  ，其中 interface 表示接口（mmc 等），dev 是查询的设备号， part 是要查询的分区。</p>\n</li>\n<li>\n<p>fatls / ext4ls</p>\n<p>功能：查询 FAT /ext4 格式设备的目录和文件信息。</p>\n<p>用法： <code>fatls / ext4ls &lt;interface&gt; &lt;dev&gt;:&lt;part&gt; &lt;directory&gt;</code>  ，其中 interface 表示接口（mmc 等），dev 是查询的设备号， part 是要查询的分区，directory 是要查询的目录（默认为根目录  <code>/</code>  ）。</p>\n</li>\n<li>\n<p>fatload / ext4load</p>\n<p>功能：查询 FAT /ext4 格式设备的目录和文件信息。</p>\n<p>用法： <code>fatload / ext4load &lt;interface&gt; &lt;dev&gt;:&lt;part&gt; &lt;addr&gt; &lt;filename&gt; &lt;bytes&gt; &lt;pos&gt;</code>  ，其中 interface 表示接口（mmc 等），dev 是查询的设备号， part 是要查询的分区，addr 是保存在 DRAM 中的起始地址， filename 是要读取的文件名字，bytes 表示读取多少字节的数据（0 或者省略表示读取整个文件），pos 是要读的文件相对于文件首地址的偏移（0 或者省略表示从文件首地址开始读取）。</p>\n</li>\n</ol>\n<p><strong>E、内存操作</strong></p>\n<ol>\n<li>\n<p>md</p>\n<p>功能：用于显示内存值。</p>\n<p>用法： <code>md[.b, .w, .l] address [# of objects]</code>  ，其中，[.b, .w, .l] 对应 byte、word 和 long，也就是分别以 1 个字节、2 个字节、4 个字节来显示内存值。address 就是要查看的内存起始地址，[# of objects] 表示要查看的数据长度，这个数据长度单位不是字节，而是跟你所选择的显示格式有关；其数值皆为十六进制。</p>\n</li>\n<li>\n<p>nm</p>\n<p>功能：用于修改指定地址的内存值。</p>\n<p>用法： <code>mw [.b, .w, .l] address value [count]</code>  ，同样以 [.b, .w, .l] 对应 byte、word 和 long，也就是分别以 1 个字节、2 个字节、4 个字节来指定操作格式，ddress 表示要填充的内存起始地址，value 为要填充的数据，count 是填充的长度（与选择的操作格式有关）；其数值皆为十六进制。</p>\n</li>\n<li>\n<p>cp</p>\n<p>功能：用于将数据从一段内存拷贝到另一段内存中。</p>\n<p>用法： <code>cp [.b, .w, .l] source target count</code>  ，[.b, .w, .l] 对应 byte、word 和 long 来指定操作格式，source 为源地址，target 为目的地址，count 为拷贝的长度（与选择的操作格式有关）；其数值皆为十六进制。</p>\n</li>\n<li>\n<p>cmp</p>\n<p>功能：用于将数据从一段内存拷贝到另一段内存中。</p>\n<p>用法： <code>cmp [.b, .w, .l] addr1 addr2 count</code>  ，[.b, .w, .l] 对应 byte、word 和 long 来指定操作格式，addr1 为第一段内存首地址，addr2 为第二段内存首地址，count 为要比较的长度（与选择的操作格式有关）；其数值皆为十六进制。</p>\n</li>\n</ol>\n<p><strong>F、启动内核</strong></p>\n<ol>\n<li>\n<p>bootz</p>\n<p>功能：从指定内存位置加载启动 <strong>zImage 镜像文件</strong> 。</p>\n<p>用法： <code>bootm &lt;zImageaddr&gt; - &lt;fdtaddr&gt;</code>  ，其中，kerneladdr 是 zImage 镜像地址，fdtaddr 是设备树文件地址。</p>\n</li>\n<li>\n<p>bootm</p>\n<p>功能：从指定内存位置加载启动 <strong>uImage 镜像文件</strong> 。</p>\n<p>用法： <code>bootm &lt;uImageaddr&gt; &lt;- arg...&gt;</code>  ，其中，kerneladdr 是 uImage 镜像地址，arg 是为可选子命令，具体可看  <code>? bootm</code>  。</p>\n</li>\n<li>\n<p>boot</p>\n<p>功能：通过读取环境变量  <code>bootcmd</code>  来启动 linux 系统。</p>\n<p>用法： <code>boot</code>  。</p>\n</li>\n</ol>\n<p><strong>G、other</strong></p>\n<ol>\n<li>\n<p>reset</p>\n<p>功能：重启 uboot。</p>\n</li>\n<li>\n<p>env default -a</p>\n<p>功能：获取默认 env 环境变量，即  <code>include/env_default.h</code>  中  <code>default_environment</code>  数组中的变量。</p>\n</li>\n<li>\n<p>ls</p>\n<p>功能：查看当前 mmc 介质里的文件。eg： <code>ls mmc 1:1</code>  可以获取到设备 1 的分区 1 中存放着内核和设备树； <code>ls mmc 1:2</code>  可以获取到系统中的文件系统根目录所存在的文件及文件夹；如果  <code>ls mmc 1:0</code>  ，你会发现提示文件系统未知或错误，这是因为分区 0 存放的是 uboot，并且分区 0 没有格式化，所以文件系统格式未知。</p>\n</li>\n</ol>\n<h1 id=\"环境变量\"><a class=\"anchor\" href=\"#环境变量\">#</a> 环境变量</h1>\n<p>需要注意的是，环境变量的名字并不是统一的，除部分重要变量名外，主要是由芯片厂商或开发者自行协定的。</p>\n<h2 id=\"默认环境变量\"><a class=\"anchor\" href=\"#默认环境变量\">#</a> 默认环境变量</h2>\n<p>默认环境变量可以在  <code>include/configs/</code>  文件夹中找到对应的芯片配置头文件及在  <code>include/env_default.h</code>  文件中查看定义。一般其主要环境变量参数整体被定义在  <code>CONFIG_EXTRA_ENV_SETTINGS</code>  宏参数中，在 README 文件中可找到说明：</p>\n<figure class=\"highlight markdown\"><figcaption data-lang=\"markdown\"><span>README</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token list punctuation\">-</span> Default Environment:</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\tCONFIG_EXTRA_ENV_SETTINGS</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token code keyword\">\t\tDefine this to contain any number of null terminated</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\tstrings (variable = value pairs) that will be part of</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\tthe default environment compiled into the boot image.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token code keyword\">\t\tFor example, place something like this in your</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tboard's config file:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token code keyword\">\t\t#define CONFIG_EXTRA_ENV_SETTINGS \\</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\"myvar1=value1\\0\" \\</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\"myvar2=value2\\0\"</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token code keyword\">\t\tWarning: This method is based on knowledge about the</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\tinternal format how the environment is stored by the</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\tU-Boot code. This is NOT an official, exported</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\tinterface! Although it is unlikely that this format</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\twill change soon, there is no guarantee either.</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\tYou better know what you are doing here.</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token code keyword\">\t\tNote: overly (ab)use of the default environment is</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\tdiscouraged. Make sure to check other ways to preset</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\tthe environment like the \"source\" command or the</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\tboot command first.</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token code keyword\">\t\tCONFIG_DELAY_ENVIRONMENT</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token code keyword\">\t\tNormally the environment is loaded when the board is</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\tinitialised so that it is available to U-Boot. This inhibits</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\tthat so that the environment is not available until</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\texplicitly loaded later by U-Boot code. With CONFIG_OF_CONTROL</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\tthis is instead controlled by the value of</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t/config/load-environment.</pre></td></tr></table></figure><h2 id=\"常用环境变量\"><a class=\"anchor\" href=\"#常用环境变量\">#</a> 常用环境变量</h2>\n<p>在  <code>include/env_default.h</code>  文件定义的环境变量，可通过读取宏来配置相应值，及从  <code>CONFIG_EXTRA_ENV_SETTINGS</code>  宏参数追加自定义环境变量，其中有几个变量是比较重要，这里结合 NXP 厂商的定义进行如下参考分析：</p>\n<p><strong>1、console 变量（固有）</strong></p>\n<p>功能：表示控制台输出设备。</p>\n<p><strong>2、baudrate 变量（固有）</strong></p>\n<p>功能：指定 linux 系统启动过程中串口控制台打印的波特率。</p>\n<p><strong>3、bootdelay 变量（固有）</strong></p>\n<p>功能：设置 uboot 启动时等待用户输入的延时，单位是秒。</p>\n<p><strong>4、fdt_addr 变量（私人）</strong></p>\n<p>功能：设备树加载启动的地址。</p>\n<p><strong>5、fdt_file 变量（私人）</strong></p>\n<p>功能：设备树加载显示的名称，如果 uboot 中配置的名称对应不上获取的设备树文件，将显示 undefined。</p>\n<p><strong>6、image 变量（私人）</strong></p>\n<p>功能：内核加载启动读取的文件名。</p>\n<p><strong>7、loadaddr 变量（固有）</strong></p>\n<p>功能：内核加载启动的地址。</p>\n<p><strong>8、ipaddr/serverip/gatewayip/netmask 变量（固有）</strong></p>\n<p>功能：用于设置网络信息，分别对应开发板 ip、服务器 ip、网关、子网掩码；设置完成后可用 ping 命令测试网络连通性。</p>\n<p><strong>9、bootcmd 变量（固有）</strong></p>\n<p>功能： <code>bootcmd</code>  变量是用来存储启动命令的环境变量，它定义了 uboot 启动 linux 系统的具体步骤。当 uboot 倒计时结束以后就会执行  <code>bootcmd</code>  中的命令。这些命令一般都是用来启动 linux 内核的，比如读取 EMMC 或者 NAND Flash 中的 linux 内核镜像文件和设备树文件到 DRAM 中，然后启动 linux 内核。</p>\n<p>也可以在 uboot 启动以后进入命令行设置  <code>bootcmd</code>  环境变量的值。如果 EMMC 或者 NAND 中没有保存  <code>bootcmd</code>  的值，那么 uboot 就会使用默认的值。</p>\n<p>应用： <code>bootcmd</code>  变量的内容通常是一系列 uboot 命令和参数的组合，例如：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">bootcmd</span><span class=\"token operator\">=</span>run load_kernel<span class=\"token punctuation\">;</span> run load_dtb<span class=\"token punctuation\">;</span> bootz <span class=\"token variable\">$&#123;kernel_addr_r&#125;</span> - <span class=\"token variable\">$&#123;fdt_addr_r&#125;</span></pre></td></tr></table></figure><p>上述  <code>bootcmd</code>  变量定义了两个命令： <code>load_kernel</code>  和  <code>load_dtb</code> ，并最后执行了  <code>bootz</code>  命令来启动 linux 内核。这里的  <code>run</code>  命令表示执行一个之前定义好的环境变量，例如：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">load_kernel</span><span class=\"token operator\">=</span>mmc dev <span class=\"token variable\">$&#123;mmc_dev&#125;</span><span class=\"token punctuation\">;</span> fatload mmc <span class=\"token variable\">$&#123;mmc_dev&#125;</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$&#123;mmc_part&#125;</span> <span class=\"token variable\">$&#123;kernel_addr&#125;</span> zImage</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">load_dtb</span><span class=\"token operator\">=</span>fatload mmc <span class=\"token variable\">$&#123;mmc_dev&#125;</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$&#123;mmc_part&#125;</span> <span class=\"token variable\">$&#123;fdt_addr&#125;</span> devicetree.dtb</pre></td></tr></table></figure><p>在上述命令中， <code>load_kernel</code>  和  <code>load_dtb</code>  分别使用  <code>fatload</code>  命令从 mmc 设备  <code>$&#123;mmc_dev&#125;</code>  的  <code>$&#123;mmc_part&#125;</code>  分区（ <code>mmc $&#123;mmc_dev&#125;:$&#123;mmc_part&#125;</code> ）中加载内核和设备树； <code>$&#123;kernel_addr&#125;</code>  和  <code>$&#123;fdt_addr&#125;</code>  是在 uboot 中预定义的环境变量，分别表示内核和设备树在内存中的地址。</p>\n<p>在实际应用中， <code>bootcmd</code>  变量的内容需要根据硬件平台和具体应用场景来设置，以确保系统能够正确启动。可以使用  <code>printenv bootcmd</code>  命令来查看当前的  <code>bootcmd</code>  命令，使用  <code>setenv bootcmd &lt;cmd&gt;</code>  命令来手动设置  <code>bootcmd</code>  变量，例如，把上述命令定义并保存到  <code>bootcmd</code>  变量中：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>setenv bootcmd <span class=\"token string\">'run load_kernel; run load_dtb; run load_rootfs; bootm'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>saveenv</pre></td></tr></table></figure><p><strong>10、bootargs 变量（固有）</strong></p>\n<p>功能： <code>bootargs</code>  变量是用来存储内核启动参数的环境变量，它在启动 linux 内核时会被传递给内核。bootargs 变量可以在 uboot 命令行中手动设置，也可以通过脚本自动设置。下面是一些常见的  <code>bootargs</code>  参数：</p>\n<ul>\n<li>\n<p>console：指定内核输出信息的终端设备，可以是串口、LCD 显示屏等。</p>\n</li>\n<li>\n<p>root：指定根文件系统所在的设备和分区。</p>\n</li>\n<li>\n<p>rootfstype：指定根文件系统的文件系统类型，例如  <code>ext4</code> 、 <code>jffs2</code> 、 <code>nfs</code>  等。</p>\n</li>\n<li>\n<p>ip：指定 IP 地址和网络参数，用于网络启动。</p>\n</li>\n<li>\n<p>mem：指定系统可用内存的大小，用于系统启动时内存的自适应分配。</p>\n</li>\n<li>\n<p>quiet：设置内核启动时不显示冗长的信息。</p>\n</li>\n<li>\n<p>debug：开启内核调试模式，用于调试内核代码。</p>\n</li>\n</ul>\n<p>应用：在设置  <code>bootargs</code>  变量时，需要根据硬件平台和具体应用场景来选择合适的参数，并确保参数的正确性。例如， <code>console</code>  参数需要根据硬件平台的串口地址和波特率来设置， <code>root</code>  参数需要根据具体的文件系统类型和分区来设置。例如：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>setenv bootargs <span class=\"token assign-left variable\">console</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;console&#125;</span>,<span class=\"token variable\">$&#123;baudrate&#125;</span> <span class=\"token assign-left variable\">root</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;mmc_root&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>saveenv</pre></td></tr></table></figure><h2 id=\"环境变量设置\"><a class=\"anchor\" href=\"#环境变量设置\">#</a> 环境变量设置</h2>\n<p>环境变量的设置有两种方法，一种方法是通过修改静态配置，即通过修改 uboot 的文件中相关环境变量的配置。不过此类方法在实际中显然非常不实际，每次需要修改一次环境变量都需要重新编译整个 uboot。</p>\n<p>另一种方法是利用 uboot 提供的  <code>setenv</code>  动态修改环境变量的设置，当设置完成后再通过  <code>saveenv</code>  把相应的环境变量设置保存到 Flash 等非易失性存储设备上。</p>\n<p>在更改多次环境变量后，如果想恢复成 uboot 的文件中默认环境变量的配置，可以通过  <code>env default -a</code>  重新读取，最后通过  <code>saveenv</code>  保存。</p>\n<p>uboot 的环境参数，在 uboot 启动过程中，会去校验 CRC 存放环境变量的一段空间，若 CRC 有效则使用该空间里的环境变量，无效则用默认的环境变量；因此在初次移植烧录 uboot 的时候，由于没有使用  <code>saveenv</code>  存储过，所以读不出 CRC 校验，而使用的默认环境变量（可通过  <code>printenv</code>  输出对比文件里环境变量的配置），同样的在信息打印中也会输出  <code>*** Warning - bad CRC, using default environment</code>  。</p>\n<h1 id=\"启动方式\"><a class=\"anchor\" href=\"#启动方式\">#</a> 启动方式</h1>\n<p>uboot 有两种启动 linux 内核和 rootfs 的方法，一种是直接从 flash (nand 或 emmc) 启动，一种是从网络启动。这里面用到了两个非常重要的环境变量  <code>bootcmd</code>  和  <code>bootargs</code>  。</p>\n<h2 id=\"从-emmc-启动\"><a class=\"anchor\" href=\"#从-emmc-启动\">#</a> 从 EMMC 启动</h2>\n<p>从 EMMC 启动也就是将编译出来的 linux 镜像文件 zImage 和设备树文件保存在 EMMC 中， uboot 从 EMMC 中读取这两个文件并启动。</p>\n<p>以 NXP 的 imx-6ull 为例：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>setenv bootargs <span class=\"token string\">'console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw'</span> <span class=\"token comment\"># 设置控制台输出设备为 ttymxc0、波特率为 115200；指明根文件系统存放在 mmcblk1 设备的分区 2 中，EMMC 版本的核心板启动 linux 以后会存在 /dev/mmcblk0、/dev/mmcblk1、 /dev/mmcblk0p1、/dev/mmcblk0p2、 /dev/mmcblk1p1 和 /dev/mmcblk1p2 这样的文件，其中 /dev/mmcblkx (x=0~ n) 表示 mmc 设备，而 /dev/mmcblkxpy (x=0~ n,y=1~ n) 表示 mmc 设备 x 的分区 y；rootwait 表示等待 mmc 设备初始化完成以后再挂载，否则的话 mmc 设备还没初始化完成就挂载根文件系统会出错的，rw 表示根文件系统是可以读写的，不加 rw 的话可能无法在根文件系统中进行写操作，只能进行读操作。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mmc dev <span class=\"token number\">1</span> <span class=\"token comment\"># 切换到 EMMC</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>fatload mmc <span class=\"token number\">1</span>:1 0x80800000 zImage <span class=\"token comment\"># 读取 zImage 到 0x80800000 处</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>fatload mmc <span class=\"token number\">1</span>:1 0x83000000 imx6ull-14x14-evk.dtb <span class=\"token comment\"># 读取设备树到 0x83000000 处</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>bootz 0x80800000 - 0x83000000 <span class=\"token comment\"># 启动内核</span></pre></td></tr></table></figure><h2 id=\"从网络启动\"><a class=\"anchor\" href=\"#从网络启动\">#</a> 从网络启动</h2>\n<p>从网络启动最主要的是用来调试，试想，假设你更改了部分 linux 驱动，如果是使用 EMMC 进行烧录下载，那么就得每次都对其镜像烧写到 EMMC 中，这样就太麻烦，因此我们可以使用网络对其进行烧录替换镜像。其前提条件是必须配置好网络设备及设备树，能正常连通，否者一切都是扯淡。</p>\n<p>以 NXP 的 imx-6ull 为例：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>setenv ipaddr <span class=\"token number\">192.168</span>.1.xxx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>setenv gatewayip <span class=\"token number\">192.168</span>.1.1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>setenv netmask <span class=\"token number\">255.255</span>.255.0</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>setenv serverip <span class=\"token number\">192.168</span>.1.xxx</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>setenv bootargs <span class=\"token string\">'console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw'</span> <span class=\"token comment\"># 解释同上</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>tftp <span class=\"token number\">80800000</span> zImage</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>tftp <span class=\"token number\">83000000</span> imx6ull-14x14-evk.dtb</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>bootz <span class=\"token number\">80800000</span> - <span class=\"token number\">83000000</span></pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/gcc-compiler-collection/",
            "url": "https://arachnid.cc/gcc-compiler-collection/",
            "title": "GCC 编译器套件说明",
            "date_published": "2023-02-10T15:28:36.577Z",
            "content_html": "<h1 id=\"gcc-简述\"><a class=\"anchor\" href=\"#gcc-简述\">#</a> GCC 简述</h1>\n<p>The GNU Compiler Collection，通常简称 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9nY2MuZ251Lm9yZy8=\">GCC</span> ，是一套由 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ251Lm9yZy8=\">GNU</span> 开发的编译器集合。</p>\n<p>为什么是编辑器集合而不是编译器呢？</p>\n<p>那是因为 GNU 编译器集合包括 C、C++、Objective-C，Fortran，Ada、Go 和 D 等，以及这些语言的库 （libstdc++,...）。 GCC 最初是作为 GNU 操作系统的编译器编写的。 GNU 系统被开发为 100% 的<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ251Lm9yZy9waGlsb3NvcGh5L2ZyZWUtc3cuaHRtbA==\">自由软件</span> ，即从某种意义上说它是自由的，尊重用户的自由。另外 GCC 对硬件平台的支持，可以说无所不在，它不仅支持 x86 处理器架构，还支持 ARM, Motorola 68000, Motorola 8800，AtmelAVR，MIPS 等处理器架构。</p>\n<h1 id=\"gcc-主要构成\"><a class=\"anchor\" href=\"#gcc-主要构成\">#</a> GCC 主要构成</h1>\n<ol>\n<li>gcc-core：顾明之意是 GCC 的核心部分，这部分是只包含 c 的编译器及公共部分，而对其他语言（C++、Ada 等）的支持包需要另外安装，这也是 GCC 为何如此强大的重要原因 。gcc-core 依赖于 Binutils。</li>\n<li>Binutils：它是一组开发工具，包括连接器，汇编器和其他用于目标文件和档案的工具。关于 Binutils 的介绍可以参考官方的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ251Lm9yZy9zb2Z0d2FyZS9iaW51dGlscy8=\">Binutils</span> 介绍。这个软件包依赖于不同的目标机平台，因为不同目标机的指令集是不一样的，比如 arm 跟 x86 就不一样。<br>\n常用的工具有：\n<ul>\n<li>as：汇编器，把汇编语言代码转换为机器码（目标文件）。</li>\n<li>ld：链接器，把编译生成的多个目标文件组织成最终的可执行程序文件。</li>\n<li>readelf：可用于查看目标文件或可执行程序文件的信息。</li>\n<li>objcopy： 可用于目标文件格式转换，如  <code>.elf</code>  转换成  <code>.bin</code>  。</li>\n<li>objdump：可用于查看目标文件的信息，最主要的作用是反汇编。</li>\n<li>addr2line：可用于将程序指令地址转换为所对应的函数名、以及函数所在的源文件名和行号。</li>\n</ul>\n</li>\n<li>Glibc：包含了主要的 c 库，这个库提供了基本的例程，用于分配内存，搜索目录，读写文件，字符串处理等等。</li>\n</ol>\n<h1 id=\"arm-编译工具链\"><a class=\"anchor\" href=\"#arm-编译工具链\">#</a> ARM 编译工具链</h1>\n<p>编译器主要用来编译源文件，而在编译一个源文件时需要经过以下 4 步：</p>\n<ol>\n<li>预处理：为把头文件的代码、宏之类的内容转换成生成的  <code>.i</code>  文件，还是 C 代码。</li>\n<li>编译：把预处理后的  <code>.i</code>  文件通过编译成  <code>.s</code>  文件，汇编语言。</li>\n<li>汇编：将汇编语言文件生成目标文件  <code>.o</code>  文件，机器码。</li>\n<li>链接：将每个源文件对应的  <code>.o</code>  文件链接起来，就生成一个可执行程序文件。</li>\n</ol>\n<p>交叉编译器：如果我们希望编译器运行在 x86 架构平台上，然后编译生成 ARM 架构的可执行程序，这种编译器和目标程序运行在不同架构的编译过程，被称为 “交叉编译”，而对应使用的编译工具就成为交叉编译器。</p>\n<p>GNU 交叉编译器的命名规则：</p>\n<p><code>arch [-vendor] [-os] [-(gnu)abi] [-language]</code></p>\n<ul>\n<li>arch：体系架构，如  <code>arm</code>  、  <code>aarch64</code>  或者  <code>mips</code>  等；</li>\n<li>vendor：工具链提供商，没有 vendor 时，用  <code>none</code>  代替；</li>\n<li>os：目标操作系统，没有 os 支持时，用  <code>none</code>  代替；</li>\n<li>abi：应用二进制接口（Application Binary Interface），对于嵌入式平台命名为  <code>eabi</code>  ，  <code>e</code>  表示 Embedded；</li>\n<li>language：编译器支持的语言，如： <code>gcc</code>  、  <code>g++</code>  。</li>\n</ul>\n<p>note：如果同时没有 vendor 和 os 支持，则只用一个 none 代替。例如 arm-none-eabi 中的 none 表示既没有 vendor 也没有 os 支持。</p>\n<p><strong>关于 ABI 和 EABI 的区别</strong></p>\n<p>ABI：应用二进制接口（Application Binary Interface）。在计算机中，应用二进制接口描述了应用程序（或者其他类型）和操作系统之间或其他应用程序的低级接口。</p>\n<p>EABI：嵌入式应用二进制接口（Embedded Application Binary Interface）。嵌入式应用二进制接口指定了文件格式、数据类型、寄存器使用、堆积组织优化和在一个嵌入式软件中的参数的标准约定。开发者使用自己的汇编语言也可以使用 EABI 作为与兼容的编译器生成的汇编语言的接口。</p>\n<p>两者主要区别是：ABI 是计算机上的，EABI 是嵌入式平台上（如 ARM，MIPS 等）的；EABI 去掉了用户代码和系统内核之间的抽象，可以让用户代码直接访问硬件，提高了性能。</p>\n<p><strong>关于 gcc 和 g++ 的区别</strong></p>\n<p>实际上，只要是 gcc 编译器支持的语言都可以使用 gcc 编译器完成编译，而 g++ 编译器只会按照 C++ 的风格编译代码。虽然很多情况下我们都认为 C++ 是对 C 语言兼容的，但是实际上在一些具体的语法规则上，C++ 在编译过程中的语法检查会更加严格。此外，C++ 语言本身在编译 过程中也会引入 C++ 的标准库，如果使用 gcc 编译器直接编译 C++ 语言会在编译过程中添加额外的参数，这样会显得编译过程较为繁琐（因为大部分情况下我们希望标准库可以直接引入，而不是再需要手动指定，否则对于初级使用者会带来额外的学习负担）。为了更方便使用编译器，我们选择 g++ 来编译 C++ 代码。总结一下，gcc 可以完成 C++ 语言的编译，但是使用过程会较为繁琐，而 g++ 就是简化后的编译指令。</p>\n<p><strong>与 gnueabi 相关的 gnueabi 和 gnueabihf 的区别</strong></p>\n<p><code>gcc-arm-linux-gnueabi – The GNU C compiler for armel architecture</code></p>\n<p>AND</p>\n<p><code>gcc-arm-linux-gnueabihf – The GNU C compiler for armhf architecture</code></p>\n<p>这两个交叉编译器分别适用于 armel 和 armhf 两个不同的架构，armel 和 armhf 这两种架构在对待浮点运算采取了不同的策略（有 fpu 的 ARM 才能支持这两种浮点运算策略）。</p>\n<p>这两个交叉编译器是 gcc 的选项  <code>-mfloat-abi</code>  的默认值不同；该选项有三种值 soft、softfp、hard（其中后两者都要求 ARM 里有 fpu 浮点运算单元，soft 与后两者是兼容的，但 softfp 和 hard 两种模式互不兼容）：</p>\n<ul>\n<li>\n<p>soft： 不用 fpu 进行浮点计算，即使有 fpu 浮点运算单元也不用，而是使用软件模式。</p>\n</li>\n<li>\n<p>softfp： armel 架构（对应的编译器为 arm-linux-gnueabi-gcc ）采用的默认值，用 fpu 计算，但是传参数用普通寄存器传，这样中断的时候，只需要保存普通寄存器，中断负荷小，但是参数需要转换成浮点的再计算。</p>\n</li>\n<li>\n<p>hard： armhf 架构（对应的编译器 arm-linux-gnueabihf-gcc ）采用的默认值，用 fpu 计算，传参数也用 fpu 中的浮点寄存器传，省去了转换，性能最好，但是中断负荷高。</p>\n</li>\n</ul>\n<p>几种常见的编译 ARM 的交叉编译器：</p>\n<p>arm-none-eabi：用于编译裸机程序或系统，这个是没有操作系统的，不支持那些系统调用等系列接口，可调用  <code>newlib</code>  库，适用于 ARM7/Cortex-M/Cortex-R。</p>\n<p>arm-none-linux-gnueabi：用于编译 ARM 架构的 u-boot、Linux 内核、Linux 应用等，使用  <code>glibc</code>  库，适用于 ARM9/ARM11/Cortex-A。</p>\n<p>arm-eabi： 用于安卓程序编译。</p>\n<p>armcc：早期 Keil 软件公司（现已被 ARM 公司收购）出品的支持<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2VpbC5jb20vZGQv\">相应器件</span>的编译工具，可以编译裸机程序，一般和 ARM 开发工具一起，Keil MDK 内置。</p>\n<h1 id=\"基于-gcc-的-arm-编译工具链提供商\"><a class=\"anchor\" href=\"#基于-gcc-的-arm-编译工具链提供商\">#</a> 基于 GCC 的 ARM 编译工具链提供商</h1>\n<p>目前，为 ARM 平台提供交叉编译工具链的提供商，本人所找到的只有两家：ARM 官方和 Linaro 公司。</p>\n<h2 id=\"arm-gnu-toolchain\"><a class=\"anchor\" href=\"#arm-gnu-toolchain\">#</a> Arm GNU Toolchain</h2>\n<p>ARM 除了有自己的专用编译器之外，还维护了一套基于 GCC 的交叉编译工具链，被称为 Arm GNU Toolchain。截至于 2022 年，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb3dubG9hZHMvLS9hcm0tZ251LXRvb2xjaGFpbi1kb3dubG9hZHM=\">Arm GNU Toolchain</span> 被分为了 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb3dubG9hZHMvLS9nbnUtYQ==\">A family</span>（GNU Toolchain for the Cortex-A Family） 和 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYXJtLmNvbS9kb3dubG9hZHMvLS9nbnUtcm0=\">R &amp; M family</span>（GNU Arm Embedded Toolchain）两大类，但是自 2022 年开始，ARM 对其进行了统一。</p>\n<p>编译器的目标平台：</p>\n<ul>\n<li>AArch32 bare-metal target：32 位纯裸机平台</li>\n<li>AArch64 ELF bare-metal target：64 位纯裸机平台</li>\n<li>AArch64 ELF bare-metal, big-endian target：64 位纯裸机平台（大端模式）</li>\n<li>AArch64 GNU/Linux target：64 位 Linux 平台</li>\n<li>AArch64 GNU/Linux big-endian target：64 位 Linux 平台（大端模式）</li>\n<li>AArch32 target with soft float：32 位带软件模式浮点运算</li>\n<li>AArch32 target with hard float：32 位带硬件模式浮点运算</li>\n</ul>\n<h2 id=\"linaro-toolchain\"><a class=\"anchor\" href=\"#linaro-toolchain\">#</a> Linaro Toolchain</h2>\n<p>Linaro 是一间非营利性质的开放源代码软件工程公司，主要的目标在于开发不同半导体公司系统单片机（SoC）平台的共通软件。其维护的工具链下载地址为：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zbmFwc2hvdHMubGluYXJvLm9yZy9nbnUtdG9vbGNoYWluLw==\">https://snapshots.linaro.org/gnu-toolchain/</span> 。另外，从 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGluYXJvLm9yZy9kb3dubG9hZHMv\">https://www.linaro.org/downloads/</span> 的描述上看，目前 Linaro 仅针对于 Cortex-A 内核的编译工具链进行维护，而对用于 ARM 嵌入式处理器的 Cortex-R 和 Cortex-M 裸机编译工具链，则需要去 ARM 官网下载！</p>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veGlhb3RsaWxpL3AvMzMwNjEwMC5odG1s\">https://www.cnblogs.com/xiaotlili/p/3306100.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pDU2hvdUNTRE4vYXJ0aWNsZS9kZXRhaWxzLzg5NTUzMzIz\">https://blog.csdn.net/ZCShouCSDN/article/details/89553323</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb21tdW5pdHkuYXJtLmNvbS9hcm0tY29tbXVuaXR5LWJsb2dzL2IvZW1iZWRkZWQtYmxvZy9wb3N0cy9zaHJpbmsteW91ci1tY3UtY29kZS1zaXplLXdpdGgtZ2NjLWFybS1lbWJlZGRlZC00LTc=\">https://community.arm.com/arm-community-blogs/b/embedded-blog/posts/shrink-your-mcu-code-size-with-gcc-arm-embedded-4-7</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTQ3MzcxMDQvd2hhdC1pcy10aGUtZGVmYXVsdC1jLXN0ZC1zdGFuZGFyZC12ZXJzaW9uLWZvci10aGUtY3VycmVudC1nY2MtZXNwZWNpYWxseS1vbi11\">https://stackoverflow.com/questions/14737104/what-is-the-default-c-std-standard-version-for-the-current-gcc-especially-on-u</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly91YnVudHVxYS5jb20vYXJ0aWNsZS8xMDQzMi5odG1s\">https://ubuntuqa.com/article/10432.html</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW1vYmJzLmNvbS9mb3J1bS5waHA/bW9kPXZpZXd0aHJlYWQmYW1wO3RpZD01NzA5NDAw\">https://www.amobbs.com/forum.php?mod=viewthread&amp;tid=5709400</span></p>\n<h1 id=\"附\"><a class=\"anchor\" href=\"#附\">#</a> 附</h1>\n<p>GNU win：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9nbnV3aW4zMi5zb3VyY2Vmb3JnZS5uZXQv\">https://gnuwin32.sourceforge.net/</span></p>\n<p>GNU software：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ251Lm9yZy9zb2Z0d2FyZS9zb2Z0d2FyZS56aC1jbi5odG1s\">https://www.gnu.org/software/software.zh-cn.html</span></p>\n",
            "tags": []
        },
        {
            "id": "https://arachnid.cc/linux-routing-table/",
            "url": "https://arachnid.cc/linux-routing-table/",
            "title": "Linux 路由表说明",
            "date_published": "2023-02-05T06:32:47.036Z",
            "content_html": "<h1 id=\"route-命令\"><a class=\"anchor\" href=\"#route-命令\">#</a> route 命令</h1>\n<p>选项：</p>\n<ul>\n<li>\n<p><code>-v</code>  ：显示详细信息。</p>\n</li>\n<li>\n<p><code>-n</code>  ：不执行 DNS 反向查找（即不解析名称），直接显示数字形式的 IP 地址。</p>\n</li>\n<li>\n<p><code>-e</code>  ：netstat 格式显示路由表。</p>\n</li>\n<li>\n<p><code>-C</code>  ：打印 Linux 内核的路由缓存。</p>\n</li>\n<li>\n<p><code>add</code>  ：增加路由记录 /  <code>del</code>  ：删除路由记录</p>\n<ul>\n<li><code>-net</code>  ：目的地址是一个网络。</li>\n<li><code>-host</code>  ：目的地址是一台主机。</li>\n<li><code>netmask</code>  ：目的地址的网络掩码。</li>\n<li><code>gw</code>  ：路由数据包通过的网关。</li>\n<li><code>metric</code>  ：设置路由跃点。</li>\n</ul>\n</li>\n</ul>\n<p>eg：</p>\n<p>1、添加主机路由</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>添加主机路由</span></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route <span class=\"token function\">add</span> <span class=\"token parameter variable\">-net</span> <span class=\"token number\">10.0</span>.0.10 netmask <span class=\"token number\">255.255</span>.255.255 gw <span class=\"token number\">10.139</span>.128.1 dev eth0</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route <span class=\"token parameter variable\">-n</span></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre><span class=\"token number\">10.0</span>.0.10       <span class=\"token number\">10.139</span>.128.1    <span class=\"token number\">255.255</span>.255.255 UGH   <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>2、添加网络路由</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>添加网络路由</span></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route <span class=\"token function\">add</span> <span class=\"token parameter variable\">-net</span> <span class=\"token number\">10.0</span>.0.0 netmask <span class=\"token number\">255.255</span>.255.0 gw <span class=\"token number\">10.139</span>.128.1 dev eth0</pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route <span class=\"token parameter variable\">-n</span></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre><span class=\"token number\">10.0</span>.0.0        <span class=\"token number\">10.139</span>.128.1    <span class=\"token number\">255.255</span>.255.0   UG    <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>3、添加设置默认网关跃点为 80</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>添加设置默认网关</span></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route <span class=\"token function\">add</span> default gw <span class=\"token number\">192.168</span>.1.1 metric <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"2\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route <span class=\"token parameter variable\">-n</span></pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre><span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.1.1     <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>4、删除路由</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>删除路由</span></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route del default gw <span class=\"token number\">192.168</span>.1.1 metric <span class=\"token number\">80</span></pre></td></tr></table></figure><h1 id=\"字段分析\"><a class=\"anchor\" href=\"#字段分析\">#</a> 字段分析</h1>\n<p>使用  <code>route</code>  or  <code>route -n</code>  命令查看内核路由表：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>命令行提示符</span></figcaption><table><tr><td data-num=\"1\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route</pre></td></tr><tr><td data-num=\"2\"></td><td data-command></td><td><pre>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</pre></td></tr><tr><td data-num=\"3\"></td><td data-command></td><td><pre>default         _gateway        <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">100</span>    <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr><tr><td data-num=\"4\"></td><td data-command></td><td><pre>default         _gateway        <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">1000</span>   <span class=\"token number\">0</span>        <span class=\"token number\">0</span> br0</pre></td></tr><tr><td data-num=\"5\"></td><td data-command></td><td><pre><span class=\"token number\">192.168</span>.10.0    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> br0</pre></td></tr><tr><td data-num=\"6\"></td><td data-command></td><td><pre><span class=\"token number\">192.168</span>.29.0    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr><tr><td data-num=\"7\"></td><td data-command></td><td><pre>_gateway        <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.255 UH    <span class=\"token number\">100</span>    <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr><tr><td data-num=\"8\"></td><td data-command=\"[root@localhost] $\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td data-command=\"[root@localhost] $\"></td><td><pre>route <span class=\"token parameter variable\">-n</span></pre></td></tr><tr><td data-num=\"10\"></td><td data-command></td><td><pre>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</pre></td></tr><tr><td data-num=\"11\"></td><td data-command></td><td><pre><span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.29.2    <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">100</span>    <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr><tr><td data-num=\"12\"></td><td data-command></td><td><pre><span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.10.1    <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">1000</span>   <span class=\"token number\">0</span>        <span class=\"token number\">0</span> br0</pre></td></tr><tr><td data-num=\"13\"></td><td data-command></td><td><pre><span class=\"token number\">192.168</span>.10.0    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> br0</pre></td></tr><tr><td data-num=\"14\"></td><td data-command></td><td><pre><span class=\"token number\">192.168</span>.29.0    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr><tr><td data-num=\"15\"></td><td data-command></td><td><pre><span class=\"token number\">192.168</span>.29.2    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.255 UH    <span class=\"token number\">100</span>    <span class=\"token number\">0</span>        <span class=\"token number\">0</span> ens33</pre></td></tr></table></figure><p>字段分类说明：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">字段</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Destination</td>\n<td style=\"text-align:left\">目标网络或目标主机。Destination 为 default（ <code>0.0.0.0</code> ）时，表示这个是默认网关，所有数据都发到这个网关（这里是  <code>10.139.128.1</code> ）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Gateway</td>\n<td style=\"text-align:left\">网关地址， <code>0.0.0.0</code>  表示当前记录对应的 Destination 跟本机在同一个网段，通信时不需要经过网关（同一个局域网内 2 台主机通信不需要经过网关）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Genmask</td>\n<td style=\"text-align:left\">Destination 字段的网络掩码，Destination 是主机时需要设置为  <code>255.255.255.255</code>  ，是默认路由时会设置为  <code>0.0.0.0</code>  。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Flags</td>\n<td style=\"text-align:left\">见下文说明。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Metric</td>\n<td style=\"text-align:left\">跃点，指到达指定网络所需的中转数，是大型局域网和广域网设置所必需的 （不在 Linux 内核中使用）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Ref</td>\n<td style=\"text-align:left\">路由项引用次数 （不在 Linux 内核中使用）。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Use</td>\n<td style=\"text-align:left\">此路由项被路由软件查找的次数。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Iface</td>\n<td style=\"text-align:left\">网卡名字，例如  <code>eth0</code>  ；要去往这个网段需要使用哪一个网络接口。也就是  <code>eth0</code>  这张网卡。</td>\n</tr>\n</tbody>\n</table>\n<p>可以看到 Flags 下面有许多字母组合，他们分别的含义是：</p>\n<ul>\n<li>\n<p><strong>U (route is up)</strong> ：该路由处于活跃；</p>\n</li>\n<li>\n<p><strong>H (target is a host)</strong> ：目标是一部主机 (IP) 而非网域（子网掩码是 255.255.255.255）；</p>\n</li>\n<li>\n<p><strong>G (use gateway)</strong> ：需要透过外部的主机 (gateway) 来转递封包（一般指向默认网关）；</p>\n</li>\n<li>\n<p><strong>R (reinstate route for dynamic routing)</strong> ：使用动态路由时，恢复路由资讯的旗标；</p>\n</li>\n<li>\n<p><strong>D (dynamically installed by daemon or redirect)</strong> ：已经由服务或转 port 功能设定为动态路由</p>\n</li>\n<li>\n<p><strong>M (modified from routing daemon or redirect)</strong> ：路由已经被修改了；</p>\n</li>\n<li>\n<p><strong>! (reject route)</strong> ：这个路由将不会被接受（用来抵挡不安全的网域）。</p>\n</li>\n</ul>\n<h1 id=\"路由种类\"><a class=\"anchor\" href=\"#路由种类\">#</a> 路由种类</h1>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">路由类型</th>\n<th style=\"text-align:left\">子网掩码</th>\n<th style=\"text-align:left\">Flag 字段</th>\n<th style=\"text-align:left\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">主机路由</td>\n<td style=\"text-align:left\">255.255.255.255</td>\n<td style=\"text-align:left\">UH</td>\n<td style=\"text-align:left\">指向单个 IP 地址或主机名的路由记录</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">网络路由</td>\n<td style=\"text-align:left\">255.255.255.0</td>\n<td style=\"text-align:left\">U</td>\n<td style=\"text-align:left\">代表主机可以到达的网络，比如说目的地址是  <code>192.168.10.xxx</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">默认路由</td>\n<td style=\"text-align:left\">0.0.0.0</td>\n<td style=\"text-align:left\">UG</td>\n<td style=\"text-align:left\">当主机不能在路由表中查找到目标主机的 IP 时，数据包就发到默认路由上</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "https://arachnid.cc/sqlite-summarize/",
            "url": "https://arachnid.cc/sqlite-summarize/",
            "title": "SQLite 知识整理",
            "date_published": "2023-02-03T12:44:39.504Z",
            "content_html": "<h1 id=\"sqlite-类型\"><a class=\"anchor\" href=\"#sqlite-类型\">#</a> SQLite 类型</h1>\n<p><strong>1、存储类</strong></p>\n<p>SQLite 存储类属性划分为以下几种类型：</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NULL</td>\n<td>表示该值为 NULL 值。</td>\n</tr>\n<tr>\n<td>INTEGER</td>\n<td>无符号整型值，根据值的大小存储在 1、2、3、4、6 或 8 字节中。</td>\n</tr>\n<tr>\n<td>REAL</td>\n<td>浮点值，存储为 8 字节的 IEEE 浮点数字。</td>\n</tr>\n<tr>\n<td>TEXT</td>\n<td>文本字符串，使用 UTF-8、UTF-16BE 或 UTF-16LE 编码方式存储。</td>\n</tr>\n<tr>\n<td>BLOB</td>\n<td>存储 Blob 数据，该类型数据和输入数据完全相同。</td>\n</tr>\n</tbody>\n</table>\n<p><strong>2、数据类型</strong></p>\n<ul>\n<li>\n<p>布尔数据类型：<br>\nSQLite 并没有提供专门的布尔存储类型，取而代之的是存储整型 1 表示 true，0 表示 false。</p>\n</li>\n<li>\n<p>日期和时间数据类型：<br>\n和布尔类型一样，SQLite 也同样没有提供专门的日期时间存储类型，而是以 TEXT、REAL 和 INTEGER 类型分别不同的格式表示该类型，如：<br>\n<strong>TEXT</strong> : &quot;YYYY-MM-DD HH:MM:SS.SSS&quot;。<br>\n<strong>REAL</strong> ：以 Julian 日期格式存储。<br>\n<strong>INTEGER</strong> ：以 Unix 时间形式保存数据值，即从 1970-01-01 00:00:00 到当前时间所流经的秒数。</p>\n</li>\n</ul>\n<p><strong>3、类型亲缘性（Type Affinity）</strong></p>\n<p>为了最大限度地提高 SQLite 和其他数据库引擎之间的兼容性，SQLite 支持 “类型亲缘性” 的概念。使其它 SQL 数据库引擎能在 SQLite 上运行；在表字段被声明之后，SQLite 都会根据该字段声明时的类型为其选择一种亲缘类型，当数据插入时，该字段的数据将会优先采用亲缘类型作为该值的存储方式，除非亲缘类型不匹配或无法转换当前数据到该亲缘类型，这样 SQLite 才会考虑其它更适合该值的类型存储该值。</p>\n<p>SQLite 3 数据库中支持分配的类型关联：</p>\n<ul>\n<li>TEXT</li>\n<li>NUMERIC</li>\n<li>INTEGER</li>\n<li>REAL</li>\n<li>BLOB</li>\n</ul>\n<p>决定规则：</p>\n<ol>\n<li>如果声明的类型包含字符串 “INT”，则它分配为  <code>INTEGER</code>  。</li>\n<li>如果声明的类型包含任意字符串 “CHAR”、“CLOB” 或 “TEXT” 的关键字，则被分配为  <code>TEXT</code>  。请注意，VARCHAR 类型包含字符串 “CHAR”，因此被分配为  <code>TEXT</code>  。</li>\n<li>如果声明的类型包含字符串 “BLOB”，或者如果未指定类型，则被分配为  <code>BLOB</code>  。</li>\n<li>如果声明的类型包含任意字符串 “REAL”、“FLOA” 或 “DOUB” 的关键字，则被分配为  <code>REAL</code>  。</li>\n<li>其余情况下，归类为  <code>NUMERIC</code>  。</li>\n</ol>\n<p>note：请注意，确定类型亲缘性的规则顺序很重要。声明类型为 “CHARINT” 的字段将同时匹配规则 1 和 2，但第一条规则采用优先权，所以会被分配为  <code>INTEGER</code>  。</p>\n<p>示例：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">声明的类型</th>\n<th style=\"text-align:left\">类型亲缘性</th>\n<th>规则优先级</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">INT &lt;br/&gt;INTEGER &lt;br/&gt;TINYINT &lt;br/&gt;SMALLINT &lt;br/&gt;MEDIUMINT &lt;br/&gt;BIGINT &lt;br/&gt;UNSIGNED &lt;br/&gt;BIG &lt;br/&gt;INT &lt;br/&gt;INT2 &lt;br/&gt;INT8</td>\n<td style=\"text-align:left\">INTEGER</td>\n<td>1</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">CHARACTER(20) &lt;br/&gt;VARCHAR(255) &lt;br/&gt;VARYING &lt;br/&gt;CHARACTER(255) &lt;br/&gt;NCHAR(55) &lt;br/&gt;NATIVE &lt;br/&gt;CHARACTER(70) &lt;br/&gt;NVARCHAR(100) &lt;br/&gt;TEXT &lt;br/&gt;CLOB</td>\n<td style=\"text-align:left\">TEXT</td>\n<td>2</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">BLOB &lt;br/&gt;<em>no datatype specified</em></td>\n<td style=\"text-align:left\">BLOB</td>\n<td>3</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">REAL &lt;br/&gt;DOUBLE &lt;br/&gt;DOUBLE &lt;br/&gt;PRECISION &lt;br/&gt;FLOAT</td>\n<td style=\"text-align:left\">REAL</td>\n<td>4</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">NUMERIC &lt;br/&gt;DECIMAL(10,5) &lt;br/&gt;BOOLEAN &lt;br/&gt;DATE &lt;br/&gt;DATETIME</td>\n<td style=\"text-align:left\">NUMERIC</td>\n<td>5</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"数据表查询\"><a class=\"anchor\" href=\"#数据表查询\">#</a> 数据表查询</h1>\n<p><strong>1、查看所有表名</strong></p>\n<p><code>SELECT * FROM sqlite_master WHERE type='table' ORDER BY name;</code></p>\n<p>sqlite_master 是一个特殊表，属于系统表；存放在根页中，每一个数据库的  <code>.db</code>  文件都有一个 sqlite_master 表。该表存放了  <code>.db</code>  中所有表的相关信息，并只有只读权限，写操作由系统自动执行，使用者没有写的执行权限；其结构如下：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>CREATE TABLE <span class=\"token function\">sqlite_master</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    type TEXT<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 记录项目的类型，如：表 (table), 索引 (index), 视图 (view), 触发器 (trigger)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    name TEXT<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 记录项目的名称，如表名、索引名等</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    tbl_name TEXT<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 记录所从属的表名，如索引所在的表名。对于表来说，该列就是表名本身</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    rootpage INTEGER<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 记录项目在数据库页中存储的编号。对于视图和触发器，该列值为 0 或者 NULL</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    sql TEXT <span class=\"token comment\">// 记录创建该项目的 SQL 语句</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>2、查看表的字段</strong></p>\n<p><code>PRAGMA table_info(table_name);</code></p>\n<p>其中 [table_name] 为待查数据表名。</p>\n<p><strong>3、查看整表数据</strong></p>\n<p><code>SELECT * FROM table_name;</code></p>\n<p>其中 [table_name] 为待查数据表名。</p>\n<p>note：参数传入，字符串用单引号包括。</p>\n<h1 id=\"c-c-接口函数\"><a class=\"anchor\" href=\"#c-c-接口函数\">#</a> C / C++ 接口函数</h1>\n<h2 id=\"errors-码\"><a class=\"anchor\" href=\"#errors-码\">#</a> Errors 码</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_OK</span>           <span class=\"token expression\"><span class=\"token number\">0</span>   </span><span class=\"token comment\">/* 成功 */</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/* 错误码 */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_ERROR</span>        <span class=\"token expression\"><span class=\"token number\">1</span>   </span><span class=\"token comment\">/* sql 错误或丢失的数据库，SQL error or missing database */</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_INTERNAL</span>     <span class=\"token expression\"><span class=\"token number\">2</span>   </span><span class=\"token comment\">/* sqlite 内部逻辑错误，Internal logic error in SQLite */</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_PERM</span>         <span class=\"token expression\"><span class=\"token number\">3</span>   </span><span class=\"token comment\">/* 拒绝访问，Access permission denied */</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_ABORT</span>        <span class=\"token expression\"><span class=\"token number\">4</span>   </span><span class=\"token comment\">/* 回调函数请求取消操作，Callback routine requested an abort */</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_BUSY</span>         <span class=\"token expression\"><span class=\"token number\">5</span>   </span><span class=\"token comment\">/* 数据库文件被锁定，The database file is locked */</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_LOCKED</span>       <span class=\"token expression\"><span class=\"token number\">6</span>   </span><span class=\"token comment\">/* 数据库的一个表被锁定，A table in the database is locked */</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_NOMEM</span>        <span class=\"token expression\"><span class=\"token number\">7</span>   </span><span class=\"token comment\">/* 某次 malloc 函数调用失败，A malloc () failed */</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_READONLY</span>     <span class=\"token expression\"><span class=\"token number\">8</span>   </span><span class=\"token comment\">/* 尝试写入一个只读数据库，Attempt to write a readonly database */</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_INTERRUPT</span>    <span class=\"token expression\"><span class=\"token number\">9</span>   </span><span class=\"token comment\">/* 操作 sqlite3_interrupt 函数被中断，Operation terminated by sqlite3_interrupt ()*/</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_IOERR</span>       <span class=\"token expression\"><span class=\"token number\">10</span>   </span><span class=\"token comment\">/* 发生磁盘 I/O 错误，Some kind of disk I/O error occurred */</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_CORRUPT</span>     <span class=\"token expression\"><span class=\"token number\">11</span>   </span><span class=\"token comment\">/* 数据库磁盘映像不正确，The database disk image is malformed */</span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_NOTFOUND</span>    <span class=\"token expression\"><span class=\"token number\">12</span>   </span><span class=\"token comment\">/* 找不到表或记录，NOT USED. Table or record not found */</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_FULL</span>        <span class=\"token expression\"><span class=\"token number\">13</span>   </span><span class=\"token comment\">/* 数据库满而插入失败，Insertion failed because database is full */</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_CANTOPEN</span>    <span class=\"token expression\"><span class=\"token number\">14</span>   </span><span class=\"token comment\">/* 无法打开数据库，Unable to open the database file */</span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_PROTOCOL</span>    <span class=\"token expression\"><span class=\"token number\">15</span>   </span><span class=\"token comment\">/* 数据库锁定协议错误，NOT USED. Database lock protocol error */</span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_EMPTY</span>       <span class=\"token expression\"><span class=\"token number\">16</span>   </span><span class=\"token comment\">/* 数据库为空，Database is empty */</span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_SCHEMA</span>      <span class=\"token expression\"><span class=\"token number\">17</span>   </span><span class=\"token comment\">/* 数据库结构发生改变，The database schema changed */</span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_TOOBIG</span>      <span class=\"token expression\"><span class=\"token number\">18</span>   </span><span class=\"token comment\">/* 数据大小超限，String or BLOB exceeds size limit */</span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_CONSTRAINT</span>  <span class=\"token expression\"><span class=\"token number\">19</span>   </span><span class=\"token comment\">/* 约束违反，Abort due to constraint violation */</span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_MISMATCH</span>    <span class=\"token expression\"><span class=\"token number\">20</span>   </span><span class=\"token comment\">/* 数据类型不匹配，Data type mismatch */</span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_MISUSE</span>      <span class=\"token expression\"><span class=\"token number\">21</span>   </span><span class=\"token comment\">/* 库使用不正确，Library used incorrectly */</span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_NOLFS</span>       <span class=\"token expression\"><span class=\"token number\">22</span>   </span><span class=\"token comment\">/* 使用了操作系统不支持的功能，Uses OS features not supported on host */</span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_AUTH</span>        <span class=\"token expression\"><span class=\"token number\">23</span>   </span><span class=\"token comment\">/* 授权失败，Authorization denied */</span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_FORMAT</span>      <span class=\"token expression\"><span class=\"token number\">24</span>   </span><span class=\"token comment\">/* 附加数据库格式错误，Auxiliary database format error */</span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_RANGE</span>       <span class=\"token expression\"><span class=\"token number\">25</span>   </span><span class=\"token comment\">/* sqlite3_bind 的第 2 给参数超出范围，2nd parameter to sqlite3_bind out of range */</span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_NOTADB</span>      <span class=\"token expression\"><span class=\"token number\">26</span>   </span><span class=\"token comment\">/* 不是数据库文件，File opened that is not a database file */</span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_NOTICE</span>      <span class=\"token expression\"><span class=\"token number\">27</span>   </span><span class=\"token comment\">/* Notifications from sqlite3_log() */</span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_WARNING</span>     <span class=\"token expression\"><span class=\"token number\">28</span>   </span><span class=\"token comment\">/* Warnings from sqlite3_log() */</span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_ROW</span>         <span class=\"token expression\"><span class=\"token number\">100</span>  </span><span class=\"token comment\">/* sqlite3_step 产生一个就绪行，sqlite3_step () has another row ready */</span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SQLITE_DONE</span>        <span class=\"token expression\"><span class=\"token number\">101</span>  </span><span class=\"token comment\">/* sqlite3_step 执行完成，sqlite3_step () has finished executing */</span></span></pre></td></tr></table></figure><h2 id=\"api-函数\"><a class=\"anchor\" href=\"#api-函数\">#</a> API 函数</h2>\n<p>以下只列举嵌入式环境下常用的 API：</p>\n<h3 id=\"sqlite3_open\"><a class=\"anchor\" href=\"#sqlite3_open\">#</a> sqlite3_open</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_open</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>filename<span class=\"token punctuation\">,</span>   <span class=\"token comment\">/* Database filename (UTF-8) */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  sqlite3 <span class=\"token operator\">*</span><span class=\"token operator\">*</span>ppDb          <span class=\"token comment\">/* OUT: SQLite db handle */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>该函数用于打开由  <code>filename</code>  参数指定的 SQLite 数据库文件，并返回一个  <code>*ppDb</code>  数据库连接句柄，即使发生错误； <code>filename</code>  为 UTF-8 编码，如果 SQLite 无法分配内存来保存 sqlite3 对象，则会在  <code>*ppDb</code>  中写入一个 NULL，而不是指向 sqlite3 对象的指针。如果数据库成功打开，则返回 SQLITE_OK。否则返回错误代码。sqlite3_errmsg () 可用于获取任何 sqlite3_open () 执行失败后错误的英文描述。</p>\n<p>如果  <code>filename</code>  参数是  <code>':memory:'</code>  ，那么 sqlite3_open () 将会在 RAM 中创建一个内存数据库，这只会在数据库连接关闭前持续。</p>\n<p>如果  <code>filename</code>  参数是  <code>''</code>  （空字符串），则将创建一个专用的临时磁盘数据库；一旦数据库连接关闭，此专用数据库将被自动删除。</p>\n<h3 id=\"sqlite3_close\"><a class=\"anchor\" href=\"#sqlite3_close\">#</a> sqlite3_close</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_close</span><span class=\"token punctuation\">(</span>sqlite3<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>该函数与 sqlite3_open 函数相对应，用于关闭之前调用 sqlite3_open () 打开的数据库连接，此时所有与连接相关的语句都应在连接关闭之前完成。</p>\n<p>如果还有查询没有完成，sqlite3_close () 将返回 SQLITE_BUSY 禁止关闭的错误消息；当成功执行，将销毁 sqlite3 对象并释放所有关联资源时返回 SQLITE_OK。</p>\n<h3 id=\"sqlite3_exec\"><a class=\"anchor\" href=\"#sqlite3_exec\">#</a> sqlite3_exec</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_exec</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  sqlite3<span class=\"token operator\">*</span><span class=\"token punctuation\">,</span>                                  <span class=\"token comment\">/* An open database */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>sql<span class=\"token punctuation\">,</span>                           <span class=\"token comment\">/* SQL to be evaluated */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">/* Callback function */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span>                                    <span class=\"token comment\">/* 1st argument to callback */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>errmsg                              <span class=\"token comment\">/* Error msg written here */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>sqlite3_exec () 提供了一个执行 SQL 命令的快捷方式，SQL 命令由  <code>*sql</code>  参数提供；它是 sqlite3_prepare_v2 () 、sqlite3_step () 和 sqlite3_finalize () 的包装函数，允许应用程序运行多个 SQL 语句，而无需编写大量 C 代码。</p>\n<p>sqlite3_exec () 程序解析并执行由  <code>*sql</code>  参数所给的每个命令，直到字符串结束或者遇到错误为止。此参数等同于使用 shell 实现所有的 sqlite 功能命令，所以这个  <code>*sql</code>  就是对应 sqlite 功能命令的 “字符串”。</p>\n<p><code>callback</code>  是执行  <code>*sql</code>  对应的功能命令后，所调取的函数，即回调函数；用于将执行结果进行分析处理。其原型如下：</p>\n<p><code>typedef int (*sqlite3_callback)(void *data, int argc, char **argv, char **azColName);</code></p>\n<p><strong>sqlite3_callback</strong> 参数：</p>\n<ul>\n<li>data：由 sqlite3_exec 传入的参数  <code>void*</code>  ，或者说是指针参数。</li>\n<li>argc：查询到的这一条记录由多少个字段（多少列）。</li>\n<li>argv：该参数是双指针，查询出来的数据都保存在这里，它是一个一维数组，每一个元素都是一个  <code>char*</code>   , 是一个字段内容，所以这个参数就可以不是单字节，而是可以为字符串等不定长度的数值，用字符串表示，以  <code>'\\0'</code>  结尾。</li>\n<li>azColName：该参数是双指针，与  <code>argv</code>  是对应的，表示这个字段的字段名称。</li>\n</ul>\n<p>note：除  <code>data</code>  传入参数外，回调函数的其它参数一定是 SQL 命令执行结果的进一步处理；此外，需要特别注意的是：回调函数多数时候不是执行 1 次，而是会循环执行 n 次，例如当我们执行 SELECT 命令时，往往输出的结果会是多行，假设有 n 行，那么就会执行 n 次回调函数。</p>\n<p>实例：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sqlite3.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>NotUsed<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>argv<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>azColName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>argc<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s = %s\\n\"</span><span class=\"token punctuation\">,</span> azColName<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">?</span> argv<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"NULL\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  sqlite3 <span class=\"token operator\">*</span>db<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>zErrMsg <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token keyword\">int</span> rc<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> argc<span class=\"token operator\">!=</span><span class=\"token number\">3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Usage: %s DATABASE SQL-STATEMENT\\n\"</span><span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  rc <span class=\"token operator\">=</span> <span class=\"token function\">sqlite3_open</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> rc <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Can't open database: %s\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">sqlite3_errmsg</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token function\">sqlite3_close</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  rc <span class=\"token operator\">=</span> <span class=\"token function\">sqlite3_exec</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>zErrMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> rc<span class=\"token operator\">!=</span>SQLITE_OK <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SQL error: %s\\n\"</span><span class=\"token punctuation\">,</span> zErrMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token function\">sqlite3_free</span><span class=\"token punctuation\">(</span>zErrMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token function\">sqlite3_close</span><span class=\"token punctuation\">(</span>db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"sqlite3_get_table\"><a class=\"anchor\" href=\"#sqlite3_get_table\">#</a> sqlite3_get_table</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_get_table</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  sqlite3 <span class=\"token operator\">*</span>db<span class=\"token punctuation\">,</span>          <span class=\"token comment\">/* An open database */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>zSql<span class=\"token punctuation\">,</span>     <span class=\"token comment\">/* SQL to be evaluated */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span>pazResult<span class=\"token punctuation\">,</span>    <span class=\"token comment\">/* Results of the query */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>pnRow<span class=\"token punctuation\">,</span>           <span class=\"token comment\">/* Number of result rows written here */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">int</span> <span class=\"token operator\">*</span>pnColumn<span class=\"token punctuation\">,</span>        <span class=\"token comment\">/* Number of result columns written here */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>pzErrmsg       <span class=\"token comment\">/* Error msg written here */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>在最新的文档中，表明这该函数是一个传统的 API，保留该 API 是为了向后兼容；因此，不建议使用此接口。</p>\n<p>输入参数：</p>\n<ul>\n<li>\n<p>db：打开数据库文件后返回的句柄。</p>\n</li>\n<li>\n<p>zSql：需要执行的 SQL 命令字符串。</p>\n</li>\n<li>\n<p>pazResult：对字符串数组的引用。使用此引用传回查询结果。传回的值必须通过调用  <code>sqlite3_free_table()</code>  。</p>\n</li>\n<li>\n<p>pnRow：查询返回的行数，不包括列名。</p>\n</li>\n<li>\n<p>pnColumn：查询返回的列数。</p>\n</li>\n<li>\n<p>pzErrmsg：对字符串的可选引用。如果发生错误，引用将被设置为一条错误消息。该应用程序负责 释放的消息  <code>sqlite3_free()</code>  。如果没有错误发生，引用将被设置为 NULL。引用可能为 NULL。</p>\n</li>\n</ul>\n<p>和 sqlite3_exec () 这种使用回调函数的方式不同，sqlite3_get_table () 的功能要显得更加简便。它通过控制语句的传入，直接将参数赋值给指针传出。</p>\n<p>note：虽然 sqlite3_get_table () 的使用较于 sqlite3_exec () 更为简便，但官方不推荐使用的，在实际当中它更趋于用作测试 API，并且根据官方建议，推荐使用 sqlite3_prepare_v2 ()、sqlite3_column_xxx () 这些 API 组合。</p>\n<h3 id=\"sqlite3_free_table\"><a class=\"anchor\" href=\"#sqlite3_free_table\">#</a> sqlite3_free_table</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">void</span> <span class=\"token function\">sqlite3_free_table</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>该函数与 sqlite3_get_table 函数相对应，在应用程序完成 sqlite3_get_table 的结果使用后，它必须将查询结果的指针  <code>pazResult</code>  传递给 sqlite3_free_table () 以释放分配的内存。</p>\n<h3 id=\"sqlite3_prepare_v2\"><a class=\"anchor\" href=\"#sqlite3_prepare_v2\">#</a> sqlite3_prepare_v2</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_prepare_v2</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  sqlite3 <span class=\"token operator\">*</span>db<span class=\"token punctuation\">,</span>            <span class=\"token comment\">/* Database handle */</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>zSql<span class=\"token punctuation\">,</span>       <span class=\"token comment\">/* SQL statement, UTF-8 encoded */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">int</span> nByte<span class=\"token punctuation\">,</span>              <span class=\"token comment\">/* Maximum length of zSql in bytes. */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  sqlite3_stmt <span class=\"token operator\">*</span><span class=\"token operator\">*</span>ppStmt<span class=\"token punctuation\">,</span>  <span class=\"token comment\">/* OUT: Statement handle */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>pzTail     <span class=\"token comment\">/* OUT: Pointer to unused portion of zSql */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>输入参数：</p>\n<ul>\n<li>db：从先前成功调用 sqlite3_open（）、sqlite3_open v2（）或 sqlite3_open16（）获得的 SQLite 数据库。</li>\n<li>zSql：要执行的 SQL 语句（可以包含未赋值的变量）</li>\n<li>nByte：如果  <code>nByte</code>  参数为负，则  <code>zSql</code>  被读取到第一个空结束终止符。如果  <code>nByte</code>  为正，则它是从  <code>zSql</code>  读取的字节数。</li>\n<li>ppStmt：解析编译出的 SQL 语句实例。</li>\n<li>pzTail：如果  <code>pzTail</code>  不为空，那么  <code>*pzTail</code>  将指向  <code>zSql</code>  中第一个 SQL 语句结束后的第一个字节。</li>\n</ul>\n<h3 id=\"sqlite3_bind_xxx\"><a class=\"anchor\" href=\"#sqlite3_bind_xxx\">#</a> sqlite3_bind_xxx</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_blob</span><span class=\"token punctuation\">(</span>      sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span>          val<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span>            bytes<span class=\"token punctuation\">,</span> mem_callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_blob64</span><span class=\"token punctuation\">(</span>    sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span>          val<span class=\"token punctuation\">,</span> sqlite3_uint64 bytes<span class=\"token punctuation\">,</span> mem_callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_double</span><span class=\"token punctuation\">(</span>    sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">double</span>               val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_int</span><span class=\"token punctuation\">(</span>       sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span>                  val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_int64</span><span class=\"token punctuation\">(</span>     sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> sqlite3_int64        val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_null</span><span class=\"token punctuation\">(</span>      sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_text</span><span class=\"token punctuation\">(</span>      sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span>          val<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span>            bytes<span class=\"token punctuation\">,</span> mem_callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_text16</span><span class=\"token punctuation\">(</span>    sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span>          val<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span>            bytes<span class=\"token punctuation\">,</span> mem_callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_text64</span><span class=\"token punctuation\">(</span>    sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span>          val<span class=\"token punctuation\">,</span> sqlite3_uint64 bytes<span class=\"token punctuation\">,</span> mem_callback<span class=\"token punctuation\">,</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> encoding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_value</span><span class=\"token punctuation\">(</span>     sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> sqlite3_value<span class=\"token operator\">*</span> val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// SQLITE_API int sqlite3_bind_pointer(   sqlite3_stmt*, int, void*, const char*,void(*)(void*));</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_zeroblob</span><span class=\"token punctuation\">(</span>  sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span>                           <span class=\"token keyword\">int</span>            bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_bind_zeroblob64</span><span class=\"token punctuation\">(</span>sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> pidx<span class=\"token punctuation\">,</span>                           sqlite3_uint64 bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">mem_callback</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span> ptr <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>用于绑定任何参数值。</p>\n<ul>\n<li>stmt：指向一个被 sqlite3_prepare_v2 () 等接口编译的语句句柄，它可被 sqlite3_step () 执行。最后用 sqlite3_finalize () 来释放它。</li>\n<li>pidx：SQL 参数（每列元素）的索引值，参数索引值从 1 开始。</li>\n<li>val：要绑定的数据值。</li>\n<li>bytes：数据值的大小，以字节（不是字符）为单位。通常，长度不包括任何空结束符。如果  <code>val</code>  是一个以空结束的字符串，把该值设为为负值（-1），则会自动计算长度。</li>\n<li>mem_callback：一个指向内存释放函数的函数指针。此函数用于在 SQLite 处理完 BLOB 或 string 之后对其进行处理，主要用来释放  <code>val</code>  的内存缓冲区；如果缓冲区是用 sqlite3_malloc () 分配的，则可以直接传递对 sqlite3_free () 的引用。也可以使用特殊标志  <code>SQLITE_STATIC</code>  和  <code>SQLITE_TRANSIENT</code>  ； <code>SQLITE_STATIC</code>  说明数据值为常量，位于静态的非托管空间中，不需要释放，而  <code>SQLITE_TRANSIENT</code>  会使得对   <code>val</code>  数据做一份拷贝。</li>\n</ul>\n<h3 id=\"sqlite3_step\"><a class=\"anchor\" href=\"#sqlite3_step\">#</a> sqlite3_step</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_step</span><span class=\"token punctuation\">(</span>sqlite3_stmt<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>在调用 sqlite3_prepare_v2 () 等接口编译的语句句柄后，必须调用此函数一次或多次以计算语句。</p>\n<p>返回值：</p>\n<ul>\n<li>\n<p>SQLITE_BUSY：忙碌，数据库引擎无法锁定数据去完成其工作。可以重试该语句。</p>\n</li>\n<li>\n<p>SQLITE_DONE：意味着 SQL 语句执行完成且成功。一旦执行成功后，sqlite3_step () 就不应该被再次调用执行，除非我们使用 sqlite3_reset () 重置  <code>sqlite3_stmt</code>  数据。</p>\n</li>\n<li>\n<p>SQLITE_ROW：当返回的行数据较多时会出现，代表获得了一条有效数据行，此时可以通过 sqlite3_column_xxx 函数来取得数据；再次调用 sqlite3_step () 可取得下一条查询结果，直至返回  <code>SQLITE_DONE</code>  。</p>\n</li>\n<li>\n<p>SQLITE_ERROR：表示发生了运行时错误（例如约束冲突），此时可以通过 sqlite3_errmmsg () 取得相关的错误信息，并且不应再次调用 sqlite3_step () 。</p>\n</li>\n<li>\n<p>SQLITE_MISUSE：意味着这个例程被不适当地调用。可能是在已完成的准备好的语句上调用的，也可能是在以前返回  <code>SQLITE_ERROR</code>  或  <code>SQLITE_DONE</code>  的语句上调用的。或者可能是同一数据库连接同时被两个或多个线程使用。</p>\n</li>\n</ul>\n<h3 id=\"sqlite3_column_xxx\"><a class=\"anchor\" href=\"#sqlite3_column_xxx\">#</a> sqlite3_column_xxx</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span>          <span class=\"token function\">sqlite3_column_blob</span><span class=\"token punctuation\">(</span>  sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>SQLITE_API <span class=\"token keyword\">double</span>               <span class=\"token function\">sqlite3_column_double</span><span class=\"token punctuation\">(</span> sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span>                  <span class=\"token function\">sqlite3_column_int</span><span class=\"token punctuation\">(</span>    sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>SQLITE_API sqlite3_int64        <span class=\"token function\">sqlite3_column_int64</span><span class=\"token punctuation\">(</span>  sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>SQLITE_API <span class=\"token keyword\">const</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> <span class=\"token function\">sqlite3_column_text</span><span class=\"token punctuation\">(</span>  sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>SQLITE_API <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span>          <span class=\"token function\">sqlite3_column_text16</span><span class=\"token punctuation\">(</span>sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>SQLITE_API sqlite3_value<span class=\"token operator\">*</span>       <span class=\"token function\">sqlite3_column_value</span><span class=\"token punctuation\">(</span> sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span>                  <span class=\"token function\">sqlite3_column_bytes</span><span class=\"token punctuation\">(</span>  sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span>                  <span class=\"token function\">sqlite3_column_bytes16</span><span class=\"token punctuation\">(</span>sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span>                  <span class=\"token function\">sqlite3_column_type</span><span class=\"token punctuation\">(</span>   sqlite3_stmt<span class=\"token operator\">*</span> stmt<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> cidx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>用于从当前结果行中提取列值。</p>\n<ul>\n<li>stmt：指向一个被 sqlite3_prepare_v2 () 等接口编译的语句句柄，它可被 sqlite3_step () 执行。最后用 sqlite3_finalize () 来释放它。</li>\n<li>cidx：SQL 参数（每列元素）的索引值，参数索引值从 0 开始。</li>\n</ul>\n<p>返回结果：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">API 函数</th>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:left\">结果值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_blob</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">BLOB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_double</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">REAL</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_int</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">32 位 INTEGER</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_int64</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">64 位 INTEGER</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_text</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">UTF-8 TEXT</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_text16</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">UTF-16 TEXT</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_value</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">作为 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3FsaXRlLm9yZy9jM3JlZi92YWx1ZS5odG1s\">未受保护的 sqlite3_value</span> 对象</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_bytes</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">BLOB 或 UTF-8 TEXT 的字节大小</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_bytes16</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">UTF-16 TEXT 的字节大小</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>sqlite3_column_type</strong></td>\n<td style=\"text-align:center\">→</td>\n<td style=\"text-align:left\">默认数据的类型</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"sqlite3_reset\"><a class=\"anchor\" href=\"#sqlite3_reset\">#</a> sqlite3_reset</h3>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>SQLITE_API <span class=\"token keyword\">int</span> <span class=\"token function\">sqlite3_reset</span><span class=\"token punctuation\">(</span>sqlite3_stmt <span class=\"token operator\">*</span>pStmt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>用于重置  <code>sqlite3_stmt</code>  数据，然后准备被重新执行。任何使用 sqlite3_bind_xxx 函数将值绑定到它们的 SQL 语句变量都将保留它们的值。使用 sqlite3_clear_bindings () 重置绑定。</p>\n<p>返回值：</p>\n<ul>\n<li>SQLITE_BUSY</li>\n<li>SQLITE_DONE</li>\n<li>SQLITE_ROW</li>\n</ul>\n<h2 id=\"操作流程\"><a class=\"anchor\" href=\"#操作流程\">#</a> 操作流程</h2>\n<p>使用 SQLite 数据库，最典型的函数操作流程（伪代码）：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"><span>伪代码</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* create a statement from an SQL string */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>sqlite3_stmt <span class=\"token operator\">*</span>stmt <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">sqlite3_prepare_v2</span><span class=\"token punctuation\">(</span> db<span class=\"token punctuation\">,</span> sql_str<span class=\"token punctuation\">,</span> sql_str_len<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>stmt<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> SQLITE_OK <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">/* use the statement as many times as required */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">/* bind any parameter values */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token function\">sqlite3_bind_xxx</span><span class=\"token punctuation\">(</span> stmt<span class=\"token punctuation\">,</span> param_idx<span class=\"token punctuation\">,</span> param_value<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">/* execute statement and step over each row of the result set */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">sqlite3_step</span><span class=\"token punctuation\">(</span> stmt <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> SQLITE_ROW <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token comment\">/* extract column values from the current result row */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            col_val <span class=\"token operator\">=</span> <span class=\"token function\">sqlite3_column_xxx</span><span class=\"token punctuation\">(</span> stmt<span class=\"token punctuation\">,</span> col_index <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">/* reset the statement so it may be used again */</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token function\">sqlite3_reset</span><span class=\"token punctuation\">(</span> stmt <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token function\">sqlite3_clear_bindings</span><span class=\"token punctuation\">(</span> stmt <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* optional */</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">/* destroy and release the statement */</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token function\">sqlite3_finalize</span><span class=\"token punctuation\">(</span> stmt <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>a、sqlite3_prepare 创建一个预处理对象。</p>\n<p>b、sqlite3_bind_xxx 绑定参数。</p>\n<p>c、循环执行 sqlite3_step 获取数据。</p>\n<p>d、sqlite3_column 从数据中取出每一段。</p>\n<p>e、释放 sqlite3_finalize 。</p>\n<p><strong>1、插入</strong></p>\n<p>sqlite3_open -&gt; sqlite3_prepare_v2 -&gt; sqlite3_bind_xxx -&gt; sqlite3_step -&gt; sqlite3_reset -&gt; sqlite3_finalize -&gt; sqlite3_close</p>\n<p><strong>2、查询</strong></p>\n<p>sqlite3_open -&gt; sqlite3_prepare_v2 -&gt; sqlite3_step -&gt; sqlite3_column_xxx -&gt; sqlite3_finalize -&gt; sqlite3_close</p>\n<p><strong>3、例子</strong></p>\n<p>略略略</p>\n<h1 id=\"常用命令\"><a class=\"anchor\" href=\"#常用命令\">#</a> 常用命令</h1>\n<p>If you use an auto-increment field, you can easily write this to delete the oldest 100 records:</p>\n<pre><code>DELETE FROM mytable WHERE id IN (SELECT id FROM mytable ORDER BY id ASC LIMIT 100)\n</code></pre>\n<p>Or, if no such field is present, use  <code>ROWID</code>  :</p>\n<pre><code>DELETE FROM mytable WHERE ROWID IN (SELECT ROWID FROM mytable ORDER BY ROWID ASC LIMIT 100)\n</code></pre>\n<p>Or, to leave only the latest 1000 records:</p>\n<pre><code>DELETE FROM mytable WHERE ROWID IN (SELECT ROWID FROM mytable ORDER BY ROWID DESC LIMIT -1 OFFSET 1000)\n</code></pre>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcWxpdGUub3JnL2NpbnRyby5odG1s\">An Introduction To The SQLite C/C++ Interface</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcWxpdGUub3JnL2NhcGkzcmVmLmh0bWw=\">C-language Interface Specification for SQLite</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3FsaXRlLm9yZy9kYXRhdHlwZTMuaHRtbA==\">Datatypes In SQLite</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3JlaWxseS5jb20vbGlicmFyeS92aWV3L3VzaW5nLXNxbGl0ZS85NzgxNDQ5Mzk0NTkyL3JlMjI5Lmh0bWw=\">Using sqlite3_bind_xxx()</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3JlaWxseS5jb20vbGlicmFyeS92aWV3L3VzaW5nLXNxbGl0ZS85NzgxNDQ5Mzk0NTkyL3JlMjQ0Lmh0bWw=\">Using sqlite3_column_xxx()</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcWxpdGUub3JnL3F1aWNrc3RhcnQuaHRtbA==\">Write Programs That Use SQLite</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTEyNjk5NjEzODEyMDk3MDMxI2hlYWRpbmctMjE=\">SQLite 常用 API (C)</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzY2NzA4NS9kZWxldGUtb2xkZXN0LXJlY29yZHMtZnJvbS1kYXRhYmFzZQ==\">Delete oldest records from database</span></p>\n",
            "tags": [
                "SQL"
            ]
        },
        {
            "id": "https://arachnid.cc/linux-system-constitute/",
            "url": "https://arachnid.cc/linux-system-constitute/",
            "title": "Linux 系统构成：bootloader、kernel、rootfs",
            "date_published": "2023-02-02T11:34:26.713Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<p>完整的 linux 系統需要以下部分：</p>\n<ul>\n<li>Bootloader\n<ul>\n<li>boot.img</li>\n</ul>\n</li>\n<li>Linux Kernel（Linux 内核）\n<ul>\n<li>Device tree blob</li>\n</ul>\n</li>\n<li>Root Filesystem（根目录文件系統）</li>\n</ul>\n<h1 id=\"bootloader\"><a class=\"anchor\" href=\"#bootloader\">#</a> bootloader</h1>\n<p>bootloader（引导装载程序）就是在操作系统内核运行之前运行的一段小程序。通过这段小程序，我们可以初始化硬件设备、建立内存空间的映射图，从而将系统的软硬件环境设置成一个合适的状态，以便为最终调用操作系统内核准备好正确的环境。</p>\n<p>常见的 bootloader 有 PC 平台的 Grub；嵌入式平台的 vivi, RedBoot, u-boot 等，其中 u-boot 在使用上最广泛，因此在嵌入式中又常称 linux 系统构成为 u-boot、kernel、rootfs。</p>\n<p>bootloader 是严重地依赖于硬件而实现的，特别是在嵌入式系统。因此，在嵌入式系统里建立一个通用的 bootloader 几乎是不可能的。尽管如此，我们仍然可以对 bootloader 归纳出一些通用的概念来，以指导用户进行特定的 bootloader 设计与实现。</p>\n<p>在嵌入式系统中，bootloader 的意义与作用相当于 PC 平台中的 BIOS + Grub，它对开发板上的主要部件如 CPU、SDRAM、FLASH、串口等进行了初始化，可以使用 bootloader 下载文件到开发板，可以浏览目录，可以烧录 flash，可以启动系统等，实际上，一个功能比较强大的 bootloader 已经相当于一个微型的操作系统了。</p>\n<p>总体上 bootloader 需要完成以下工作：</p>\n<ul>\n<li>\n<p>初始化 CPU 速度；</p>\n</li>\n<li>\n<p>初始化内存，包括初始化内存配置寄存器等；</p>\n</li>\n<li>\n<p>初始化中断控制器，在系统启动时，关闭中断，关闭看门狗；</p>\n</li>\n<li>\n<p>初始化串行端口（如果在目标上有的话）；</p>\n</li>\n<li>\n<p>启用指令 / 数据高速缓存；</p>\n</li>\n<li>\n<p>设置堆栈指针；</p>\n</li>\n<li>\n<p>设置参数区域并构造参数结构和标记（这是重要的一步，因为内核在标识根设备、页面大小、内存大小以及更多内容时可能需要使用引导参数）；</p>\n</li>\n<li>\n<p>执行 POST（加电自检）来标识存在的设备并报告有何问题；</p>\n</li>\n<li>\n<p>为电源管理提供挂起 / 恢复支持；</p>\n</li>\n<li>\n<p>传输操作系统内核镜像文件到目标机。也可以将操作系统内核镜像文件事先存放在 Flash 中，这样就不需要 bootLoader 和主机传输操作系统内核镜像文件，这通常是在做成产品的情况下使用。而一般在开发过程中，为了调试内核的方便，不将操作系统内核镜像文件固化在 Flash 中，这就需要主机和目标机进行文件传输；</p>\n</li>\n<li>\n<p>跳转到内核的开始，在此又分为 ROM 启动和 RAM 启动。所谓 ROM 启动就是用 XIP 技术直接在 Flash 中执行操作系统镜像文件；所谓 RAM 启动就是指把内核镜像从 Flash 复制到 RAM 中，然后再将 PC 指针跳转到 RAM 中的操作系统启动地址。</p>\n</li>\n</ul>\n<p>目前使用的主流<strong>嵌入式平台</strong>，几乎都是用 u-boot 作为启动引导，u-boot 有哪些突出的优点呢？</p>\n<p>① 开放源码：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3UtYm9vdC91LWJvb3QlRUYlQkMlOUI=\">https://github.com/u-boot/u-boot；</span></p>\n<p>② 支持多种嵌入式操作系统内核，如 Linux、NetBSD, VxWorks, QNX, RTEMS, ARTOS, LynxOS, android；</p>\n<p>③ 支持多个处理器系列，如 PowerPC、ARM、x86、MIPS；</p>\n<p>④ 较高的可靠性和稳定性；</p>\n<p>⑤ 高度灵活的功能设置，适合 u-boot 调试、操作系统不同引导要求、产品发布等；</p>\n<p>⑥ 丰富的设备驱动源码，如串口、以太网、SDRAM、FLASH、LCD、NVRAM、EEPROM、RTC、键盘等；</p>\n<p>⑦ 较为丰富的开发调试文档与强大的网络技术支持。</p>\n<h1 id=\"kernel\"><a class=\"anchor\" href=\"#kernel\">#</a> kernel</h1>\n<p>kernel 即 linux 内核。内核源代码可以免费从<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2VybmVsLm9yZy8=\">官网</span>获取，这是一个通用的内核，里面包含着内核支持的所有的硬件平台及驱动的所有代码，是一个大而全的内核源代码。</p>\n<p>在使用层面上，当嵌入式平台使用 linux 系统，那么最重要的就是 kernel 中驱动的移植；一般都不会从一个纯净的 kernel 中去进行移植操作，而是根据芯片厂商提供的 kernel 对特定的硬件平台及设备进行各种外设驱动相关的适配工作。</p>\n<h2 id=\"device-tree\"><a class=\"anchor\" href=\"#device-tree\">#</a> Device Tree</h2>\n<p>设备树（Device Tree）是描述计算机的特定硬件设备信息的数据结构，以便于操作系统的内核可以管理和使用这些硬件，包括 CPU 或 CPU，内存，总线和其他一些外设。</p>\n<p>老版本的 linux kernel 是没有设备树概念的，后来因为 SOC 的发展，kernel 中需要对这些新增的 SOC 进行支持，而这些代码都会编译到 kernel 中，会导致 kernel 日渐臃肿，于是后面就引入了在 PowerPC 等架构就已经采用的设备树。</p>\n<p><strong>1、dts (device tree source 设备树源文件)</strong><br>\n dts 文件是一种 ASCII 文本格式的设备树描述文件，此文件适合人类阅读主要是给用户看的。一个  <code>.dts</code>  文件对应一个 ARM 的设备，一般放置在  <code>arch/arm/boot/dts/</code>  中。</p>\n<p><strong>2、dtsi (device tree source include 设备树头文件)</strong><br>\n 由于  <code>.dts</code>  中包含了很多公共部分，linux 内核为了简化，将 Soc 公共部分提炼为  <code>.dtsi</code>  文件，类似 c 语言中的  <code>.h</code>  文件。当然，和 C 语言的头文件类似，.dtsi 也可以 include 其他的  <code>.dtsi</code>  ，譬如几乎所有的 ARM SoC 的  <code>.dtsi</code>  都引用了 <code>skeleton.dtsi</code>  。对于同一个节点的设置情况， <code>.dts</code>  中的配置会覆盖  <code>.dtsi</code>  中的配置；因此， <code>.dtsi</code>  一般写 Soc 共性部分，而  <code>.dts</code>  一般写目标单板特性部分，所以一般  <code>.dts</code>  包含并重写部分  <code>.dtsi</code> 。</p>\n<p><strong>3、dtb (device tree blob 设备树二进制文件)</strong><br>\n <code>.dts</code>  通过 dtc 编译工具编译成  <code>.dtb</code>  文件，被编译后的设备树文件与内核一同放入到存储介质中，当内核启动时读取设备树文件，就可以动态的将板级信息写入到内核中。</p>\n<h1 id=\"rootfs\"><a class=\"anchor\" href=\"#rootfs\">#</a> rootfs</h1>\n<p>rootfs（Root Filesystem）即根目录文件系统，是 kernel 启动后挂载的第一个文件系统。rootfs 和 kernel 是分开的，但单独的 kernel 没有 rootfs 是没法正常工作的。在系统终端执行  <code>cd /</code>  即可看到当前的文件系统内容了。</p>\n<p>现在有许多制作 rootfs 的工具，如 busybox，buildroot，Yocto 等。其中 buildroot 中包含了 busybox 的功能，只需要简单的操作就可以生成一个 rootfs 了。</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9xMjQ4MjY5NjczLnBpeG5ldC5uZXQvYmxvZy9wb3N0LzY5NTcwMjc5\">完整的 linux 系統：bootloader、linux kernel（linux 內核）、rootfile（根文件系統）</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5lbWJlZGRlZGxpbnV4Lm9yZy5jbi9lbWJsaW51eGFwcGRldi8=\">嵌入式 linux 应用开发</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrbWQuaW8vQGEyOTY1NDA2OC9ISjF1VVlFOHI=\">Linux 筆記 2</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNDg0MjAxMjYvd2hhdC1pcy10aGUtZGlmZmVyZW5jZS1iZXR3ZWVuLWR0cy1maWxlLWFuZC1kdHNpLWZpbGU=\">What is the difference between .dts file and .dtsi file?</span></p>\n",
            "tags": [
                "Linux"
            ]
        }
    ]
}