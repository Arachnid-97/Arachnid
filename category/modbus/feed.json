{
    "version": "https://jsonfeed.org/version/1",
    "title": "命运转轮 • All posts by \"modbus\" category",
    "description": "不曾亏欠, 不曾辜负, 如此足矣",
    "home_page_url": "https://arachnid.cc",
    "items": [
        {
            "id": "https://arachnid.cc/modbus-ascii-protocol/",
            "url": "https://arachnid.cc/modbus-ascii-protocol/",
            "title": "Modbus家族之 ASCII",
            "date_published": "2022-03-20T07:42:45.000Z",
            "content_html": "<blockquote>\n<p>嗨，相信在上一篇经过我的兄弟 RTU 的介绍之后，已经对 Modbus 有了一定的了解了吧；那么本篇就跟紧我的脚步一起学习新的知识吧。</p>\n</blockquote>\n<h1 id=\"描述\"><a class=\"anchor\" href=\"#描述\">#</a> 描述</h1>\n<p>Modbus 在串行设备中通过实现主从模型结构，解决了电子设备之间的数据通讯问题；在采用 Modbus 协议时，它有两种主要的原始传输方式 ---- Modbus RTU 和 Modbus ASCII。而 Modbus RTU 已经在上一篇介绍了，那么就在本篇中瞅瞅 ASCII 吧。</p>\n<h1 id=\"通讯方式\"><a class=\"anchor\" href=\"#通讯方式\">#</a> 通讯方式</h1>\n<h2 id=\"帧格式\"><a class=\"anchor\" href=\"#帧格式\">#</a> 帧格式</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Name</th>\n<th style=\"text-align:center\">Length (bytes)</th>\n<th style=\"text-align:center\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Start</td>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\">Starts with colon : (ASCII hex value is 3A)&lt;br/&gt;（以冒号  <code>:</code>  开头，ASCII 十六进制值为 3A）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Address</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">Node address in hex&lt;br/&gt;（十六进制节点地址，字符表示）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Function</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">Function code in hex&lt;br/&gt;（十六进制功能码，字符表示）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Data</td>\n<td style=\"text-align:center\">n x 2</td>\n<td style=\"text-align:center\">n is the number of data bytes, it depends on function&lt;br/&gt;（n 是数据字节数，它取决于功能码）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">LRC</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">Longitudinal redundancy check&lt;br/&gt;（LRC 校验码）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">End</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">CR / LF</td>\n</tr>\n</tbody>\n</table>\n<p>注：地址、功能、数据和 LRC 都是表示 8 位值 (0-255) 的<strong>大写</strong>十六进制可读字符对；即：在 Modbus ASCII 中，每个数据字节被分割成表示十六进制值中的两个 ASCII 字符的两个字节。</p>\n<p>在 ASCII 模式下，消息以冒号  <code>:</code>  字符开头（ASCII 表示为 0x3A），以回车换行对  <code>\\r\\n</code>  （ASCII 表示为 0x0D 和 0x0A）结尾；所有其他字段传输的数据所允许的十六进制表示字符为的  <code>0-9</code> 、 <code>A-F</code> 。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">START</th>\n<th style=\"text-align:center\">ADDRESS</th>\n<th style=\"text-align:center\">FUNCTION</th>\n<th style=\"text-align:center\">DATA</th>\n<th style=\"text-align:center\">LRC CHECK</th>\n<th style=\"text-align:center\">END</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">1 CHAR&lt;br/&gt;:</td>\n<td style=\"text-align:center\">2 CHARS</td>\n<td style=\"text-align:center\">2 CHARS</td>\n<td style=\"text-align:center\">n CHARS</td>\n<td style=\"text-align:center\">2 CHARS</td>\n<td style=\"text-align:center\">2 CHARS&lt;br/&gt;CRLF</td>\n</tr>\n</tbody>\n</table>\n<p><img data-src=\"image-20220326235527004.png\" alt=\"image-20220326235527004\" /></p>\n<h2 id=\"功能码\"><a class=\"anchor\" href=\"#功能码\">#</a> 功能码</h2>\n<p>ASCII 最常用的功能代码跟 RTU 的功能代码定义是一样的，这里就不多说了，可以去查看 《<a href=\"https://arachnid.cc/modbus-rtu-protocol/\">Modbus 家族之 RTU</a>》篇章的功能码部分，这里只是格式上有所不同而已，<s>下一篇会对这两个原始传输方式进行对比的。</s> 嘛，还是直接合并到本篇，对 RTU 和 ASCII 进行对比分析吧，顺便回顾一下 RTU 协议。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">访问地址：address</th>\n<th style=\"text-align:center\">映射地址</th>\n<th style=\"text-align:center\">描述</th>\n<th style=\"text-align:center\">功能</th>\n<th style=\"text-align:center\">R/W</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">1 ~ 10000</td>\n<td style=\"text-align:center\">address-1</td>\n<td style=\"text-align:center\">Coils</td>\n<td style=\"text-align:center\">01/05/15</td>\n<td style=\"text-align:center\">R/W</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10001 ~ 20000</td>\n<td style=\"text-align:center\">address-10001</td>\n<td style=\"text-align:center\">Discrete Inputs</td>\n<td style=\"text-align:center\">02</td>\n<td style=\"text-align:center\">R</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">30001 ~ 40000</td>\n<td style=\"text-align:center\">address-30001</td>\n<td style=\"text-align:center\">Input Registers</td>\n<td style=\"text-align:center\">04</td>\n<td style=\"text-align:center\">R</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">40001 ~ 50000</td>\n<td style=\"text-align:center\">address-40001</td>\n<td style=\"text-align:center\">Holding Registers</td>\n<td style=\"text-align:center\">03/06/16</td>\n<td style=\"text-align:center\">R/W</td>\n</tr>\n</tbody>\n</table>\n<p>在这里，简单的举个 ASCII 传输例子：</p>\n<p>例如，要读取 VAR1，你需要从地址 0x20C1 读取 2 个寄存器，所以你需要发送以下 ASCII 消息：</p>\n<p><code>:010420C1000218&lt;CRLF&gt;</code></p>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Name</th>\n<th style=\"text-align:center\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">‘:’</td>\n<td style=\"text-align:center\">Start of message - 0x3A</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘0’ ‘1’</td>\n<td style=\"text-align:center\">Node address – 0x01</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘0’ ‘4’</td>\n<td style=\"text-align:center\">Function code (Read Input Registers) – 0x04</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘2’ ‘0’ ‘C’ ‘1’</td>\n<td style=\"text-align:center\">Register address for reading VAR1 – 0x20C1</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘0’ ‘0’ ‘0’ ‘2’</td>\n<td style=\"text-align:center\">Length of registers to be read (must be 2) – 0x0002</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘1’ ‘8’</td>\n<td style=\"text-align:center\">LRC</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;CRLF&gt;</td>\n<td style=\"text-align:center\">End of message, carriage return and line feed – 0x0D0A</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p>此消息的响应如下：</p>\n<p><code>:01040400001234B1&lt;CRLF&gt;</code></p>\n<ul>\n<li>\n<p>响应：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Name</th>\n<th style=\"text-align:center\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">‘:’</td>\n<td style=\"text-align:center\">Start of message - 0x3A</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘0’ ‘1’</td>\n<td style=\"text-align:center\">Node address – 0x01</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘0’ ‘4’</td>\n<td style=\"text-align:center\">Function code (Read Input Registers) – 0x04</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘0’ ‘4’</td>\n<td style=\"text-align:center\">Read data length (4 bytes) – 0x04</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘0’ ‘0’ ‘0’ ‘0’ ‘1’ ‘2’ ‘3’ ‘4’</td>\n<td style=\"text-align:center\">Value read from VAR1 – 0x00001234</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">‘B’ ‘1’</td>\n<td style=\"text-align:center\">LRC</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">&lt;CRLF&gt;</td>\n<td style=\"text-align:center\">End of message, carriage return and line feed – 0x0D0A</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p>好了，那么就直入主题吧，常用功能码部分依然是如下几个：</p>\n<h3 id=\"功能-0101h读线圈\"><a class=\"anchor\" href=\"#功能-0101h读线圈\">#</a> 功能 01（01H）读线圈</h3>\n<ul>\n<li>\n<p>请求</p>\n<p>读取从机中线圈的 ON/OFF 状态。不支持广播。请求消息指定了开始线圈和要读取的线圈数量。</p>\n<p>下面是一个请求读取线圈的例子：19 - 55（Coil 20 to 56），37 个线圈，从设备节点 3（注意起始地址是 19 或 0x13，比线圈 20 小 1）：</p>\n<p><img data-src=\"image-20220327151916968.png\" alt=\"image-20220327151916968\" /></p>\n</li>\n<li>\n<p>响应</p>\n<p>线圈状态响应消息被打包为数据字段的每比特表示一个线圈。状态表示为：1 = ON，0 = OFF。第一个数据字节的 LSB 包含请求中寻址的线圈。其他线圈跟随这个字节的高阶末端，并在随后的字节中从低阶到高阶。</p>\n<p>例如，当线圈 20 - 27 的状态显示  <code>ON - ON - OFF - OFF - ON - OFF - ON - OFF - ON - OFF</code>  时，以字节值二进制  <code>0101 0011 (0x53)</code>  表示。一个字节包含八个线圈的状态。如果返回的线圈数量不是 8 的倍数，则最终数据字节中的剩余位将用 0 填充 (朝向字节的高阶末端)；字节计数字段指定数据的完整字节数。</p>\n<blockquote>\n<p>Figure 6 shows an example of a response to the query shown in Figure 5：</p>\n</blockquote>\n<p><img data-src=\"image-20220327152253123.png\" alt=\"image-20220327152253123\" /></p>\n</li>\n</ul>\n<h3 id=\"功能-0202h读离散输入\"><a class=\"anchor\" href=\"#功能-0202h读离散输入\">#</a> 功能 02（02H）读离散输入</h3>\n<ul>\n<li>\n<p>请求</p>\n<p>读取从机中离散输入的 ON/OFF 状态。不支持广播。请求消息指定起始输入和要读取的输入数量。</p>\n<p>下面是一个从从设备节点 3 读取离散输入 10101 - 10120，总共 20 个输入的例子（注意起始地址是 100 或 0x64，比输入 10101 小 10001）：</p>\n<p><img data-src=\"image-20220327155421391.png\" alt=\"image-20220327155421391\" /></p>\n</li>\n<li>\n<p>响应</p>\n<p>离散输入状态响应消息的构造与线圈状态 (01H) 操作相同。</p>\n<blockquote>\n<p>Figure 8 shows an example of a response to the query shown in Figure 7：</p>\n</blockquote>\n<p><img data-src=\"image-20220327155851480.png\" alt=\"image-20220327155851480\" /></p>\n</li>\n</ul>\n<h3 id=\"功能-0303h读保持寄存器\"><a class=\"anchor\" href=\"#功能-0303h读保持寄存器\">#</a> 功能 03（03H）读保持寄存器</h3>\n<ul>\n<li>\n<p>请求</p>\n<p>读取从机中保持寄存器的二进制内容。不支持广播。请求消息指定起始寄存器和要读取的寄存器数量。</p>\n<p>下面是一个从从设备节点 7 读取保持寄存器 40201 - 40203，总共 3 个寄存器的请求的例子（注意起始地址是 200 或 0xC8，比寄存器 40201 小 40001）：</p>\n<p><img data-src=\"image-20220327160332698.png\" alt=\"image-20220327160332698\" /></p>\n</li>\n<li>\n<p>响应</p>\n<p>响应消息中的保持寄存器数据在每个寄存器中打包为两个字节，二进制内容在每个字节中右对齐；对于每个寄存器，第一个字节包含高阶位，第二个字节包含低阶位。</p>\n<blockquote>\n<p>Figure 10 shows an example of a response to the query shown in Figure 9：</p>\n</blockquote>\n<p><img data-src=\"image-20220327160607639.png\" alt=\"image-20220327160607639\" /></p>\n</li>\n</ul>\n<h3 id=\"功能-0404h读输入寄存器\"><a class=\"anchor\" href=\"#功能-0404h读输入寄存器\">#</a> 功能 04（04H）读输入寄存器</h3>\n<ul>\n<li>\n<p>请求</p>\n<p>读取从机中保持寄存器的二进制内容。不支持广播。请求消息指定起始寄存器和要读取的寄存器数量。</p>\n<p>下面是一个从从设备节点 7 读取输入寄存器 30301 - 30303，总共 3 个寄存器的请求的例子（注意起始地址是 300 或 0x12C，比寄存器 30301 小 30001）：</p>\n<p><img data-src=\"image-20220327171629490.png\" alt=\"image-20220327171629490\" /></p>\n</li>\n<li>\n<p>响应</p>\n<p>读输入寄存器数据的响应消息的构造与读取保持寄存器 (03H) 操作相同。</p>\n<blockquote>\n<p>Figure 12 shows an example of a response to the query shown in Figure 11：</p>\n</blockquote>\n<p><img data-src=\"image-20220327171942458.png\" alt=\"image-20220327171942458\" /></p>\n</li>\n</ul>\n<h3 id=\"功能-0505h写单线圈\"><a class=\"anchor\" href=\"#功能-0505h写单线圈\">#</a> 功能 05（05H）写单线圈</h3>\n<ul>\n<li>\n<p>请求</p>\n<p>将单个线圈写入 ON 或 OFF。当广播时，该函数强制所有附加的从机使用相同的线圈引用。请求消息指定要写入的线圈引用（启动线圈和状态）。</p>\n<p><code>FF 00</code>  的值要求线圈打开，值为  <code>00 00</code>  的请求为关闭，所有其他值都是非法的，不会影响线圈。</p>\n<p>下面是一个在从设备节点 3 中请求打开线圈 150 的例子（注意起始地址是 149 或 0x95，比线圈 150 小 1）：</p>\n<p><img data-src=\"image-20220327172937327.png\" alt=\"image-20220327172937327\" /></p>\n</li>\n<li>\n<p>响应</p>\n<p>正常的响应是请求的回显，在写入线圈状态之后返回。</p>\n<blockquote>\n<p>Figure 14 shows an example of a response to the query shown in Figure 13：</p>\n</blockquote>\n<p><img data-src=\"image-20220327173100544.png\" alt=\"image-20220327173100544\" /></p>\n</li>\n</ul>\n<h3 id=\"功能-0606h写单个保持寄存器\"><a class=\"anchor\" href=\"#功能-0606h写单个保持寄存器\">#</a> 功能 06（06H）写单个保持寄存器</h3>\n<ul>\n<li>\n<p>请求</p>\n<p>将一个值写入单个保持寄存器中。当广播时，该函数在所有附加的从机上设置相同的寄存器引用。请求消息指定要写入的寄存器引用（指定地址和数值）。</p>\n<p>下面是一个请求从从设备节点 3 中的保持寄存器 40150 写入 1000 数值的例子（注意起始地址为 149 或 0x95，比寄存器 40150 小 40001）：</p>\n<p><img data-src=\"image-20220327175033869.png\" alt=\"image-20220327175033869\" /></p>\n</li>\n<li>\n<p>响应</p>\n<p>正常的响应是请求的回显，在写入保持寄存器内容之后返回。</p>\n<blockquote>\n<p>Figure 16 shows an example of a response to the query shown in Figure 15：</p>\n</blockquote>\n<p><img data-src=\"image-20220327175344005.png\" alt=\"image-20220327175344005\" /></p>\n</li>\n</ul>\n<h3 id=\"功能-150fh写多个线圈\"><a class=\"anchor\" href=\"#功能-150fh写多个线圈\">#</a> 功能 15（0FH）写多个线圈</h3>\n<ul>\n<li>\n<p>请求</p>\n<p>将一个线圈序列中的每个线圈写入 ON 或 OFF。当广播时，该函数强制所有附加的从机使用相同的线圈引用。请求消息指定要写入的线圈引用（起始线圈和状态）。</p>\n<p>下面的示例显示了从设备节点 5 中的线圈 20 开始写入一系列 10 个线圈状态的请求。二进制位与线圈的对应方式如下（注意起始地址是 19 或 0x13，比线圈 20 小 1）：</p>\n<table>\n<thead>\n<tr>\n<th>Bit</th>\n<th>1</th>\n<th>1</th>\n<th>0</th>\n<th>1</th>\n<th>0</th>\n<th>0</th>\n<th>0</th>\n<th>1</th>\n<th>0</th>\n<th>0</th>\n<th>0</th>\n<th>0</th>\n<th>0</th>\n<th>1</th>\n<th>0</th>\n<th>1</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Coil</td>\n<td>27</td>\n<td>26</td>\n<td>25</td>\n<td>24</td>\n<td>23</td>\n<td>22</td>\n<td>21</td>\n<td>20</td>\n<td>...</td>\n<td>...</td>\n<td>...</td>\n<td>...</td>\n<td>...</td>\n<td>30</td>\n<td>29</td>\n<td>28</td>\n</tr>\n</tbody>\n</table>\n<p><img data-src=\"image-20220327182406708.png\" alt=\"image-20220327182406708\" /></p>\n</li>\n<li>\n<p>响应</p>\n<p>正常响应返回从地址、功能代码、起始地址和写入的线圈数量，不包括字节数和对应写入的状态。</p>\n<blockquote>\n<p>Figure 24 shows an example of a response to the query shown in Figure 23：</p>\n</blockquote>\n<p><img data-src=\"image-20220327182618637.png\" alt=\"image-20220327182618637\" /></p>\n</li>\n</ul>\n<h3 id=\"功能-1610h写多个保持寄存器\"><a class=\"anchor\" href=\"#功能-1610h写多个保持寄存器\">#</a> 功能 16（10H）写多个保持寄存器</h3>\n<ul>\n<li>\n<p>请求</p>\n<p>将值写入到一个保持寄存器序列中。当广播时，该函数在所有附加的从机上设置相同的寄存器引用。请求消息指定要写入的寄存器引用（起始寄存器和数值）。</p>\n<p>下面是一个请求从从设备节点 5 中的保持寄存器 40020 到 40022 写入以下数据的示例（注意起始地址是 19 或 0x13，比寄存器 40020 小 40001）：</p>\n<table>\n<thead>\n<tr>\n<th>address</th>\n<th>data</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>40020</td>\n<td>0x0164</td>\n</tr>\n<tr>\n<td>40021</td>\n<td>0x0165</td>\n</tr>\n<tr>\n<td>40022</td>\n<td>0x0166</td>\n</tr>\n</tbody>\n</table>\n<p><img data-src=\"image-20220327184941057.png\" alt=\"image-20220327184941057\" /></p>\n</li>\n<li>\n<p>响应</p>\n<p>正常响应返回从地址、功能代码、起始地址和写入的寄存器数量，不包括字节数和对应写入的数据。</p>\n<blockquote>\n<p>Figure 26 shows an example of a response to the query shown in Figure 25：</p>\n</blockquote>\n<p><img data-src=\"image-20220327185223421.png\" alt=\"image-20220327185223421\" /></p>\n</li>\n</ul>\n<h2 id=\"lrc校验\"><a class=\"anchor\" href=\"#lrc校验\">#</a> LRC 校验</h2>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ucMBLRC</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span> pucFrame<span class=\"token punctuation\">,</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> usLen <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> ucLRC <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* LRC char initialized */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span> usLen<span class=\"token operator\">--</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        ucLRC <span class=\"token operator\">+=</span> <span class=\"token operator\">*</span>pucFrame<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">/* Add buffer byte without carry */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">/* Return twos complement */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    ucLRC <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> UCHAR <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">-</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> CHAR <span class=\"token punctuation\">)</span> ucLRC <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">return</span> ucLRC<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>校验原理可看 <a href=\"https://arachnid.cc/check-algorithm/\">常用校验算法</a> - LRC 章节</p>\n",
            "tags": [
                "history",
                "modbus"
            ]
        },
        {
            "id": "https://arachnid.cc/modbus-rtu-protocol/",
            "url": "https://arachnid.cc/modbus-rtu-protocol/",
            "title": "Modbus家族之 RTU",
            "date_published": "2022-03-18T13:01:20.000Z",
            "content_html": "<blockquote>\n<p>您好啊，我是 Modbus 家族成员的 RTU，同时期诞生的还有我的兄弟，它就是 ASCII。本篇呢就来让大家熟悉一下我吧，下一篇则由我兄弟 ASCII 进行介绍。好了，废话不多说，接下来就带你们来认识一下我吧。</p>\n</blockquote>\n<h1 id=\"描述\"><a class=\"anchor\" href=\"#描述\">#</a> 描述</h1>\n<p>Modbus RTU（远程终端单元）是原始 Modbus 规范中定义的两种传输模式之一。 这两种模式是 Modbus RTU 和 ASCII，它们被设计用于支持 RS232，RS485 和 RS422 接口的串行设备。 Modbus RTU 的一个显着特点是它使用二进制编码和强大的 CRC 错误检查。 Modbus RTU 是 Modbus 协议的实现，最常用于工业应用和自动化生产设施。嘻嘻，我可是很受工业场景应用的哦。</p>\n<h1 id=\"通讯方式\"><a class=\"anchor\" href=\"#通讯方式\">#</a> 通讯方式</h1>\n<h2 id=\"帧格式\"><a class=\"anchor\" href=\"#帧格式\">#</a> 帧格式</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Name</th>\n<th style=\"text-align:center\">Length (bytes)</th>\n<th style=\"text-align:center\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Address</td>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\">Node address（节点地址）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Function</td>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\">Function code（功能代码）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Data</td>\n<td style=\"text-align:center\">n</td>\n<td style=\"text-align:center\">n is the number of data bytes, it depends on function&lt;br/&gt;（n 是数据字节数，它取决于功能码）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">CRC</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">Cyclic redundancy check&lt;br/&gt;（CRC 校验码）</td>\n</tr>\n</tbody>\n</table>\n<p>在 RTU 模式下，消息以至少 3.5 个字符的静默间隔为开始，以至少 3.5 个字符的类似间隔结束。这是最容易实现的以波特率在网络上使用的字符次数的倍数 (如下图中所示的 T1 - T2 - T3 - T4)。</p>\n<table>\n<thead>\n<tr>\n<th>START</th>\n<th>ADDRESS</th>\n<th>FUNCTION</th>\n<th>DATA</th>\n<th>CRC CHECK</th>\n<th>END</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>*T1–T2–T3–T4</strong></td>\n<td>8 BITS</td>\n<td>8 BITS</td>\n<td>n x 8 BITS</td>\n<td>16 BITS</td>\n<td><strong>*T1–T2–T3–T4</strong></td>\n</tr>\n</tbody>\n</table>\n<p><strong>*T1-T2-T3-T4</strong>：表示不通信时的 3.5 个字符。</p>\n<p>所有其他字段都由 8 位数据组成。</p>\n<p><img data-src=\"image-20220319201759692.png\" alt=\"image-20220319201759692\" /></p>\n<h2 id=\"功能码\"><a class=\"anchor\" href=\"#功能码\">#</a> 功能码</h2>\n<p>Modbus 设备最常用的功能代码如下表所示：</p>\n<p><img data-src=\"image-20220319195917761.png\" alt=\"image-20220319195917761\" /></p>\n<h3 id=\"功能-0101h读线圈\"><a class=\"anchor\" href=\"#功能-0101h读线圈\">#</a> 功能 01（01H）读线圈</h3>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x01</strong></td>\n</tr>\n<tr>\n<td>开始地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>线圈数量</td>\n<td>2 字节</td>\n<td>1 to 2000 (0x7D0)</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x01</strong>（1byte）+ 起始地址（2byte）+ 线圈数（2byte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>应答：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x01</strong></td>\n</tr>\n<tr>\n<td>线圈数量对应的字节数</td>\n<td>1 字节</td>\n<td><strong>*N</strong></td>\n</tr>\n<tr>\n<td>线圈数据 1</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>线圈数据 2</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>线圈数据 n</td>\n<td>1 字节</td>\n<td>n = N or N+1</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><strong>*N</strong> = 线圈数量 / 8，如果余数非 0，则 N = N+1</p>\n<p>指令：设备地址（1byte）+ <strong>0x01</strong>（1byte）+ 字节数（1byte）+ 线圈状态（Nbyte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>错误返回：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x81</strong></td>\n</tr>\n<tr>\n<td>错误码</td>\n<td>1 字节</td>\n<td>01 or 02 or 03 or 04</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p><strong>流程图：</strong></p>\n<p><img data-src=\"image-20220319211327513.png\" alt=\"image-20220319211327513\" /></p>\n<h3 id=\"功能-0202h读离散输入\"><a class=\"anchor\" href=\"#功能-0202h读离散输入\">#</a> 功能 02（02H）读离散输入</h3>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x02</strong></td>\n</tr>\n<tr>\n<td>开始地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>离散状态数量</td>\n<td>2 字节</td>\n<td>1 to 2000 (0x7D0)</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x02</strong>（1byte）+ 起始地址（2byte）+ 离散数（2byte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>应答：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x02</strong></td>\n</tr>\n<tr>\n<td>离散状态数量对应的字节数</td>\n<td>1 字节</td>\n<td><strong>*N</strong></td>\n</tr>\n<tr>\n<td>离散数据 1</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>离散数据 2</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>离散数据 n</td>\n<td>1 字节</td>\n<td>n = N or N+1</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><strong>*N</strong> = 离散状态数量 / 8，如果余数非 0，则 N = N+1</p>\n<p>指令：设备地址（1byte）+ <strong>0x01</strong>（1byte）+ 字节数（1byte）+ 离散状态（Nbyte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>错误返回：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x82</strong></td>\n</tr>\n<tr>\n<td>错误码</td>\n<td>1 字节</td>\n<td>01 or 02 or 03 or 04</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p><strong>流程图：</strong></p>\n<p><img data-src=\"image-20220319212623922.png\" alt=\"image-20220319212623922\" /></p>\n<h3 id=\"功能-0303h读保持寄存器\"><a class=\"anchor\" href=\"#功能-0303h读保持寄存器\">#</a> 功能 03（03H）读保持寄存器</h3>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x03</strong></td>\n</tr>\n<tr>\n<td>开始地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>保持寄存器数量</td>\n<td>2 字节</td>\n<td>1 to 125 (0x7D)</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x03</strong>（1byte）+ 起始地址（2byte）+ 保持寄存器数（2byte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>应答：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x03</strong></td>\n</tr>\n<tr>\n<td>保持寄存器数量对应的字节数</td>\n<td>1 字节</td>\n<td>2 * N</td>\n</tr>\n<tr>\n<td>寄存器数值 1</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>寄存器数值 2</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>寄存器数值 n</td>\n<td>2 字节</td>\n<td>n = N</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x03</strong>（1byte）+ 字节数（1byte）+ 保持寄存器值（2 * Nbyte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>错误返回：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x83</strong></td>\n</tr>\n<tr>\n<td>错误码</td>\n<td>1 字节</td>\n<td>01 or 02 or 03 or 04</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p><strong>流程图：</strong></p>\n<p><img data-src=\"image-20220319213419588.png\" alt=\"image-20220319213419588\" /></p>\n<h3 id=\"功能-0404h读输入寄存器\"><a class=\"anchor\" href=\"#功能-0404h读输入寄存器\">#</a> 功能 04（04H）读输入寄存器</h3>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x04</strong></td>\n</tr>\n<tr>\n<td>开始地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>输入寄存器数量</td>\n<td>2 字节</td>\n<td>1 to 125 (0x7D)</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x04</strong>（1byte）+ 起始地址（2byte）+ 输入寄存器数（2byte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>应答：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x04</strong></td>\n</tr>\n<tr>\n<td>保持寄存器数量对应的字节数</td>\n<td>1 字节</td>\n<td>2 * N</td>\n</tr>\n<tr>\n<td>寄存器数值 1</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>寄存器数值 2</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>寄存器数值 n</td>\n<td>2 字节</td>\n<td>n = N</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x04</strong>（1byte）+ 字节数（1byte）+ 输入寄存器值（2 * Nbyte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>错误返回：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x84</strong></td>\n</tr>\n<tr>\n<td>错误码</td>\n<td>1 字节</td>\n<td>01 or 02 or 03 or 04</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p><strong>流程图：</strong></p>\n<p><img data-src=\"image-20220319214513539.png\" alt=\"image-20220319214513539\" /></p>\n<h3 id=\"功能-0505h写单线圈\"><a class=\"anchor\" href=\"#功能-0505h写单线圈\">#</a> 功能 05（05H）写单线圈</h3>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x05</strong></td>\n</tr>\n<tr>\n<td>输出地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td><strong>* 线圈数值</strong></td>\n<td>2 字节</td>\n<td>0x0000 or 0xFF00</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>*<strong> 线圈数值</strong> ：0xFF00 -&gt; 请求线圈状态为 ON</p>\n<p>​\t\t\t\t\t\t0x0000 -&gt; 请求线圈状态为 OFF</p>\n<p>​\t\t\t\t\t\t其他值 -&gt; 非法且对线圈不起作用</p>\n<p>指令：设备地址（1byte）+ <strong>0x05</strong>（1byte）+ 输出地址（2byte）+ 线圈值（2byte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>应答：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x05</strong></td>\n</tr>\n<tr>\n<td>输出地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>线圈数值</td>\n<td>2 字节</td>\n<td>0x0000 or 0xFF00</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：正常响应是请求的应答</p>\n</li>\n<li>\n<p>错误返回：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x85</strong></td>\n</tr>\n<tr>\n<td>错误码</td>\n<td>1 字节</td>\n<td>01 or 02 or 03 or 04</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p><strong>流程图：</strong></p>\n<p><img data-src=\"image-20220319215633462.png\" alt=\"image-20220319215633462\" /></p>\n<h3 id=\"功能-0606h写单个保持寄存器\"><a class=\"anchor\" href=\"#功能-0606h写单个保持寄存器\">#</a> 功能 06（06H）写单个保持寄存器</h3>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x06</strong></td>\n</tr>\n<tr>\n<td>寄存器地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>寄存器数值</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x06</strong>（1byte）+ 保持寄存器地址（2byte）+ 保持寄存器值（2byte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>应答：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x06</strong></td>\n</tr>\n<tr>\n<td>寄存器地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>寄存器数值</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：正常响应是请求的应答</p>\n</li>\n<li>\n<p>错误返回：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x86</strong></td>\n</tr>\n<tr>\n<td>错误码</td>\n<td>1 字节</td>\n<td>01 or 02 or 03 or 04</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p><strong>流程图：</strong></p>\n<p><img data-src=\"image-20220319220604204.png\" alt=\"image-20220319220604204\" /></p>\n<h3 id=\"功能-150fh写多个线圈\"><a class=\"anchor\" href=\"#功能-150fh写多个线圈\">#</a> 功能 15（0FH）写多个线圈</h3>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x0F</strong></td>\n</tr>\n<tr>\n<td>开始地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>线圈输出数量</td>\n<td>2 字节</td>\n<td>1 to 1968 (0x7B0)</td>\n</tr>\n<tr>\n<td>线圈数量对应的字节数</td>\n<td>1 字节</td>\n<td><strong>*N</strong></td>\n</tr>\n<tr>\n<td>线圈输出数据 1</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>线圈输出数据 2</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>线圈输出数据 n</td>\n<td>1 字节</td>\n<td>n = N or N+1</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><strong>*N</strong> = 线圈输出数量 / 8，如果余数非 0，则 N = N+1</p>\n<p>指令：设备地址（1byte）+ <strong>0x0F</strong>（1byte）+ 起始地址（2byte）+ 线圈输出数（2byte）+ 字节数（1byte）+ 线圈输出数据（Nbyte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>应答：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x0F</strong></td>\n</tr>\n<tr>\n<td>开始地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>线圈输出数量</td>\n<td>2 字节</td>\n<td>1 to 1968 (0x7B0)</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x0F</strong>（1byte）+ 起始地址（2byte）+ 线圈输出数（2byte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>错误返回：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x8F</strong></td>\n</tr>\n<tr>\n<td>错误码</td>\n<td>1 字节</td>\n<td>01 or 02 or 03 or 04</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p><strong>流程图：</strong></p>\n<p><img data-src=\"image-20220319223636555.png\" alt=\"image-20220319223636555\" /></p>\n<h3 id=\"功能-1610h写多个保持寄存器\"><a class=\"anchor\" href=\"#功能-1610h写多个保持寄存器\">#</a> 功能 16（10H）写多个保持寄存器</h3>\n<ul>\n<li>\n<p>请求：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x10</strong></td>\n</tr>\n<tr>\n<td>开始地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>寄存器数量</td>\n<td>2 字节</td>\n<td>1 to 123 (0x7B)</td>\n</tr>\n<tr>\n<td>寄存器数量对应的字节数</td>\n<td>1 字节</td>\n<td>2 * N</td>\n</tr>\n<tr>\n<td>寄存器数值 1</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>寄存器数值 2</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>寄存器数值 n</td>\n<td>2 字节</td>\n<td>n = N</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x10</strong>（1byte）+ 起始地址（2byte）+ 寄存器数（2byte）+ 字节数（1byte）+ 寄存器数值（2 * Nbyte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>应答：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x10</strong></td>\n</tr>\n<tr>\n<td>开始地址</td>\n<td>2 字节</td>\n<td>0x0000 to 0xFFFF</td>\n</tr>\n<tr>\n<td>寄存器数量</td>\n<td>2 字节</td>\n<td>1 to 123 (0x7B)</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>指令：设备地址（1byte）+ <strong>0x10</strong>（1byte）+ 起始地址（2byte）+ 保持寄存器数（2byte）+ CRC（2byte）</p>\n</li>\n<li>\n<p>错误返回：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>长度</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>设备地址</td>\n<td>1 字节</td>\n<td></td>\n</tr>\n<tr>\n<td>功能码</td>\n<td>1 字节</td>\n<td><strong>0x90</strong></td>\n</tr>\n<tr>\n<td>错误码</td>\n<td>1 字节</td>\n<td>01 or 02 or 03 or 04</td>\n</tr>\n<tr>\n<td>CRC 校验码</td>\n<td>2 字节</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<p><strong>流程图：</strong></p>\n<p><img data-src=\"image-20220319224924985.png\" alt=\"image-20220319224924985\" /></p>\n<h2 id=\"crc校验\"><a class=\"anchor\" href=\"#crc校验\">#</a> CRC 校验</h2>\n<ul>\n<li>\n<p>CRC16_MODBUS 查表法：</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> aucCRCHi<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> aucCRCLo<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x03</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x02</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x07</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC7</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token number\">0x05</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x04</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xCC</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xCD</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xCF</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xCE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0E</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token number\">0x0A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xCA</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xCB</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x09</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x08</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xC8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x18</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x19</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD9</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token number\">0x1B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xDB</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xDA</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1E</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xDE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xDF</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xDD</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xDC</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token number\">0x14</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x17</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token number\">0x11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xD0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x33</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x32</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token number\">0x36</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x37</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x35</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xFC</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xFD</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3D</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token number\">0xFF</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3E</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xFE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xFA</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x3B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xFB</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x39</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xF8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x38</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token number\">0x28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x29</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xEB</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xEA</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xEE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2E</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xEF</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token number\">0x2D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xED</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xEC</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x24</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x25</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x27</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x26</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token number\">0x22</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x23</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x21</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x60</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x61</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token number\">0x63</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x62</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x66</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x67</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x64</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token number\">0x6C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xAC</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xAD</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xAF</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6E</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xAE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xAA</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xAB</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token number\">0x69</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x68</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x78</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x79</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xBB</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xBA</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token number\">0xBE</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7E</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xBF</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xBD</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xBC</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x7C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x74</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token number\">0x77</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x76</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x73</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x71</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x70</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xB0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token number\">0x50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x90</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x91</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x51</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x93</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x53</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x52</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x92</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x96</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x56</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x57</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x97</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token number\">0x55</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x95</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x94</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x54</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9E</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5E</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token number\">0x5A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x9B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x99</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x59</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x58</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x98</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x88</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x49</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x89</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token number\">0x4B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8B</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4E</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8E</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4F</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8C</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token number\">0x44</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x84</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x85</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x45</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x87</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x47</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x46</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x86</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x82</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x42</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x43</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x83</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token number\">0x41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token function\">usMBCRC16</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span> pucFrame<span class=\"token punctuation\">,</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> usLen <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span>   ucCRCHi <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span>   ucCRCLo <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">int</span>             iIndex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span> usLen<span class=\"token operator\">--</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        iIndex <span class=\"token operator\">=</span> ucCRCLo <span class=\"token operator\">^</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span> pucFrame<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        ucCRCLo <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span> ucCRCHi <span class=\"token operator\">^</span> aucCRCHi<span class=\"token punctuation\">[</span>iIndex<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        ucCRCHi <span class=\"token operator\">=</span> aucCRCLo<span class=\"token punctuation\">[</span>iIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">short</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span> ucCRCHi <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">8</span> <span class=\"token operator\">|</span> ucCRCLo <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>CRC16_MODBUS 运算法：</p>\n<p>运算分析及计算，可看文章 <a href=\"https://arachnid.cc/check-algorithm/\">常用校验算法</a> - CRC 章节</p>\n</li>\n</ul>\n<h1 id=\"实例应用\"><a class=\"anchor\" href=\"#实例应用\">#</a> 实例应用</h1>\n<p>测试应用可看以前的文章：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyOTkyMDg0L2FydGljbGUvZGV0YWlscy8xMDc1OTA4MDM=\">Nano130 之 FreeModbus 移植</span></p>\n",
            "tags": [
                "history",
                "modbus"
            ]
        },
        {
            "id": "https://arachnid.cc/modbus-family/",
            "url": "https://arachnid.cc/modbus-family/",
            "title": "Modbus家族之开篇",
            "date_published": "2022-02-08T10:37:49.000Z",
            "content_html": "<h1 id=\"历史溯源\"><a class=\"anchor\" href=\"#历史溯源\">#</a> 历史溯源</h1>\n<p>Modbus 是由 Modicon 公司（现在的施耐德电气 Schneider Electric）在 1979 年开发的一种消息传递结构，为使用可编程逻辑控制器（PLC）通信而发表，用于在智能设备之间建立客户端 - 服务器通信；这是一个划时代、里程碑式的网络协议，因此为工业网络拉开了序幕。Modbus 已经成为工业领域通信协议事实上的业界标准，并且现在是工业电子设备之间常用的连接方式。</p>\n<p>Modbus 在工业环境下很流行，因为它是公开发表并且无著作权要求的。它是为工业应用开发的，与其他标准相比，它相对易于部署和维护，除了要传输的数据格式的大小外，几乎没有其他限制。Modbus 通常使用 <strong>RS485</strong> 作为其物理层。</p>\n<h2 id=\"发展史\"><a class=\"anchor\" href=\"#发展史\">#</a> 发展史</h2>\n<p>Modicon，即今天的施耐德电气，于 1979 年向市场推出了 Modbus 原始协议（Modbus ASCII 和 Modbus RTU）；随着通信领域的迅速发展以及传输速度的提高，扩展版本 Modbus Plus（Modbus + 或者 MB+）紧接着出现，不过此协议是 Modicon 专有的，<strong>和 Modbus 并不相同</strong>；直到以太网技术的标准化和商品化，以太网成为了企业系统的业界标准，同时也成为了工业网络的业界标准；为了将 Modbus 带入 21 世纪，一个开放的 Modbus TCP/IP 规范于 1999 年修订发行；到了 2004 年 4 月，Modbus 协议从施耐德电气转移到 Modbus 组织，这标志着对开放的承诺（<strong>该规范可免费下载，并且</strong>使用 Modbus 或 Modbus TCP/IP 协议无需后续许可费用）；至此，在 Modbus TCP/IP 因为它的开放性、简单、低成本的开发以及支持它所需的最少硬件等特点，存在多个 Modbus TCP 变种，而 Modbus ASCII 和 Modbus RTU 在小型的嵌入式设备当中得到广泛应用。</p>\n<h1 id=\"协议版本\"><a class=\"anchor\" href=\"#协议版本\">#</a> 协议版本</h1>\n<p>Modbus 协议目前存在用于<strong>串口</strong>、<strong>以太网</strong>以及其他支持<strong>互联网协议</strong>的网络的版本。</p>\n<p>Modbus 是一种请求 / 回复协议，提供由功能代码指定的服务。Modbus 功能代码是 Modbus Request (请求) / Response (响应)  PDU 的元素。</p>\n<p>串行端口和以太网存在多种版本的 Modbus 协议，最常见的是：</p>\n<ul>\n<li>Modbus RTU</li>\n<li>Modbus ASCII</li>\n<li>Modbus TCP</li>\n<li>Modbus Plus</li>\n</ul>\n<p><img data-src=\"Modbus-Different-Types.jpg\" alt=\"\" /></p>\n<h2 id=\"modbus-rtu\"><a class=\"anchor\" href=\"#modbus-rtu\">#</a> Modbus RTU</h2>\n<p><code>Modbus RTU</code>  是一种紧凑的，采用二进制表示数据的方式；因为使用二进制编码和 CRC 错误检查的结合使得 Modbus RTU 适用于工业应用，因为它比 ASCII 字符的替代方案更有效地传输。在 Modbus RTU 与 ASCII 之间进行选择时，如果考虑性能，则 RTU 是首选。</p>\n<h2 id=\"modbus-ascii\"><a class=\"anchor\" href=\"#modbus-ascii\">#</a> Modbus ASCII</h2>\n<p><code>Modbus ASCII</code>  是当设备设置为使用  <code>ASCII</code>  （<strong>美国信息交换标准代码</strong>）模式时，在  <code>MODBUS</code>  串行线上把通信消息中的每个 8 位字节将作为两个 ASCII 4 位字符发送。当物理通信链路或设备的功能不允许符合 RTU 计时器管理要求时，使用此模式。所以此模式的效率不如 RTU，因为每个字节需要两个字符。示例：字节 0x7D 编码为两个字符：  <code>0x35</code>  和  <code>0x42</code> （在  <code>ASCII</code>  表中为  <code>0x37</code>  =  <code>'7'</code> ，而  <code>0x44</code>  =  <code>'D'</code> ）。</p>\n<h2 id=\"modbus-tcp\"><a class=\"anchor\" href=\"#modbus-tcp\">#</a> Modbus TCP</h2>\n<p><code>Modbus TCP</code>  是在  <code>TCP/IP</code>  网络上运行的 Modbus 的实现，旨在允许 Modbus ASCII / RTU 协议在基于 TCP / IP 的网络上传输。Modbus / TCP 将 Modbus 消息嵌入 TCP / IP 帧内。尽管实现起来非常简单，但是与网络相关的特性增加了一些挑战。例如，由于 Modbus 主机期望并要求在一定时间范围内对其轮询做出响应，因此必须考虑 TCP / IP 网络的不确定性（和其他方面）。Modbus ASCII 和 Modbus TCP 之间的主要区别在于，Modbus ASCII 所需的 LRC 错误检查由 IP 层执行。</p>\n<blockquote>\n<p>对于以上  <code>TCP</code> /  <code>RTU</code> /  <code>ASCII</code>  的这三种通信协议在数据模型和功能调用上都是相同的，只有封装方式是不同的。</p>\n</blockquote>\n<h2 id=\"modbus-plus\"><a class=\"anchor\" href=\"#modbus-plus\">#</a> Modbus Plus</h2>\n<p><code>Modbus Plus</code>  （Modbus + 或者 MB+）属于 Modbus 的一个扩展版本，不过此协议是 Modicon 专有的，和 Modbus 不同。它需要一个专门的协处理器来处理类似 HDLC 的高速令牌旋转。它使用 1Mbit/s 的双绞线，并且每个节点都有转换隔离设备，是一种采用转换／边缘触发而不是电压／水平触发的设备。连接 Modbus Plus 到计算机需要特别的接口，通常是支持 ISA（SA85），PCI 或者 PCMCIA 总线的板卡。</p>\n<h1 id=\"通信和设备\"><a class=\"anchor\" href=\"#通信和设备\">#</a> 通信和设备</h1>\n<p>Modbus 有下列三种通信方式：</p>\n<p>（1）以太网：对应的通信模式是 <strong>Modbus TCP/IP</strong></p>\n<p>（2）异步串行传输（各种介质如有线 RS-232/422/485/、光纤、无线等）：对应的通信模式是 <strong>Modbus RTU</strong> 或 <strong>Modbus ASCII</strong></p>\n<p>（3）高速令牌传递网络：对应的通信模式是 <strong>Modbus PLUS</strong></p>\n<p>Modbus 通过多种类型的物理介质进行通信，例如：</p>\n<ul>\n<li>串行 RS-232</li>\n<li>串行 RS-485</li>\n<li>串行 RS-422</li>\n<li>以太网</li>\n</ul>\n<p>Modbus RTU 和 Modbus ASCII 协议应用于串口链接（RS232、RS485、RS422），Modbus TCP/IP 协议应用于以太网链接。</p>\n<p><img data-src=\"Modbus-Communication-Physical-Media.gif\" alt=\"img\" /></p>\n<h1 id=\"消息结构\"><a class=\"anchor\" href=\"#消息结构\">#</a> 消息结构</h1>\n<p>Modbus 的主要消息结构是点对点，能够在点对点和多点网络上运行。</p>\n<p><img data-src=\"image-20220208222537825.png\" alt=\"image-20220208222537825\" /></p>\n<p>Modbus 协议遵循 ** 主 / 从（客户端 / 服务器）** 架构，主（客户端）向从（服务器）发送请求并等待响应。注意！目前 Modbus 中使用的术语 “主” 和 “从” 已被术语 “客户端” 和 “服务器” 所取代了。</p>\n<p><img data-src=\"image-20220209165731722.png\" alt=\"image-20220209165731722\" /></p>\n<h1 id=\"常见-modbus开源库\"><a class=\"anchor\" href=\"#常见-modbus开源库\">#</a> 常见 Modbus 开源库</h1>\n<h2 id=\"freemodbus\"><a class=\"anchor\" href=\"#freemodbus\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZW1iZWRkZWQtZXhwZXJ0cy5hdC9lbi9mcmVlbW9kYnVzLw==\">FreeModbus</span></h2>\n<p>FreeMODBUS 是流行的 Modbus 协议的免费实现，专门针对嵌入式系统。FreeMODBUS 提供了 <em>Modbus 应用协议 v1.1a</em> 的实现，并支持 <em>Modbus over serial line 规范 1.0</em> 中定义的 <strong>RTU/ASCII</strong> 传输模式 ；自 0.7 版以来，FreeModbus 还支持 <strong>Modbus/TCP</strong>；0.9 版添加了第一个 Modbus/TCP 端口嵌入式使用 LWIP TCP/IP 堆栈的系统。唯一可惜的是，该 FreeMODBUS 只对从机开放了源码，主机部分并未实现开源。</p>\n<p>以下是该 FreeMODBUS 的下载链接：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZW1iZWRkZWQtZXhwZXJ0cy5hdC9lbi9mcmVlbW9kYnVzLWRvd25sb2Fkcy8=\">https://www.embedded-experts.at/en/freemodbus-downloads/</span></p>\n<h2 id=\"libmodbus\"><a class=\"anchor\" href=\"#libmodbus\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saWJtb2RidXMub3JnLw==\">libmodbus</span></h2>\n<p>libmodbus 是一个多平台的 Modbus 源库，适用于 Linux、Mac OS X、FreeBSD、QNX 和 Win32 等操作系统；可以根据 Modbus 协议发送和接收数据。支持 RTU（串行）和 TCP（以太网）通信。</p>\n<p>以下是该 libmodbus 的下载链接：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saWJtb2RidXMub3JnL2Rvd25sb2FkLw==\">https://libmodbus.org/download/</span></p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2RidXMub3JnLw==\">Modbus 主页</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvTW9kYnVz\">Modbus</span> - wiki</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZWFscGFycy5jb20vbW9kYnVzLw==\">WHAT IS MODBUS?</span></p>\n<p>《<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wcm9jZXNzLmhvbmV5d2VsbC5jb20vdXMvZW4vc3VwcG9ydC9wcm9kdWN0LWRvY3VtZW50cy1kb3dubG9hZHM/c2VhcmNoPW1vZGJ1cyUyMGNvbW11bmljYXRpb24lMjBtYW51YWw=\">modbus communication manual</span>》</p>\n<p>《<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2RidXMub3JnL2RvY3MvTW9kYnVzX0FwcGxpY2F0aW9uX1Byb3RvY29sX1YxXzFiLnBkZg==\">MODBUS APPLICATION PROTOCOL SPECIFICATION V1.1b</span>》</p>\n<p>《<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ2VuZXJhdGlvbnJvYm90cy5jb20vbWVkaWEvcm9ib3RlcS9tb2RidXMtbWFudWFsLnBkZg==\">Modbus Fieldbus Networking</span>》</p>\n<p>《<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubS1zeXN0ZW0uY28uanAvbXNzZW5nbGlzaC9zZXJ2aWNlL2VtbW9kYnVzLnBkZg==\">Modbus Protocol Reference Guide</span>》</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydHVhbC1zZXJpYWwtcG9ydC5vcmcvY24vYXJ0aWNsZXMvbW9kYnVzLXJ0dS1ndWlkZS8=\">Modbus RTU 通信指南</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydHVhbC1zZXJpYWwtcG9ydC5vcmcvY24vYXJ0aWNsZXMvbW9kYnVzLWFzY2lpLWd1aWRlLw==\">高级 Modbus ASCII 教程</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubW9kYnVzdG9vbHMuY29tL21vZGJ1cy5odG1s\">modbus tools</span></p>\n",
            "tags": [
                "history",
                "modbus"
            ]
        }
    ]
}